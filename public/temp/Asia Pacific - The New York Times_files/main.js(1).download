define("shared/adlibrary/helpers/filter-placements-mixin",["underscore/nyt"],function(e){"use strict";var t={map:{forcexxl:{placement:"lede-ad",size:[468,648]},force970x250:{placement:"TopAd",size:[970,250]},force970x90:{placement:"TopAd",size:[970,90]},force300x600:{placement:["lede-ad","MiddleRight"],size:[300,600]},force300x250:{placement:"lede-ad",size:[300,250]},force970x418:{placement:"MegaAd",size:[970,418]},forcexxl2:{placement:"lede-ad",size:[450,623]}},run:function(t,i){var n;!e.isUndefined(t)&&this.map[t]&&(n=this.map[t],e.isArray(n.placement)?e.each(n.placement,function(e){i[e]&&(i[e]=n.size)}):i[n.placement]&&(i[n.placement]=n.size))}};return t}),define("shared/adlibrary/views/base-ad",["underscore/nyt","foundation/views/base-view","shared/adlibrary/helpers/filter-placements-mixin","foundation/cookies"],function(e,t,i,n){"use strict";var s=t.extend({isReady:!1,constructor:function(e){this.isDisabled()||(this.setUpOptions(e),i.run(this.pageManager.getUrlParam("ad-keywords"),this.placements),t.apply(this,arguments),this.sitewide.initialize(this),this.sitewide.async||(this.sitewide.isReady=!0,this.signalReady()),this.requirements.initialize(this),this.requirements.async||(this.requirements.isReady=!0,this.signalReady()))},requirements:{async:!1,initialize:function(e){this[e.viewName]=e}},sitewide:{async:!1,initialize:function(e){this[e.viewName]=e}},placements:{TopAd:[[728,90],[970,90],[970,66],[970,250]]},broadcastAdEvent:function(){var e,t,i=Array.prototype.slice.call(arguments);if(0===i.length)throw"Please provide event name as the first argument to notify()";e=i.slice(0,1)[0],i=i.slice(1),t=-1===e.indexOf("nyt:")?"nyt:ad-library:"+this.viewName+":"+e:e,this.broadcast.apply(this,[t].concat(i))},listenToAdEvent:function(e,t){var i=Array.prototype.slice.call(arguments,2),n="boolean"==typeof i[0]?i[0]:!1,s="object"==typeof i[0]?i[0]:i[1],a=n?"listenToOnce":"listenTo",o=-1===e.indexOf("nyt:")?"nyt:ad-library:"+this.viewName+":"+e:e;if(arguments.length<2)throw"Please provide event name and callback to watch()";this[a].call(s||this,this.pageManager,o,t)},ignoreAdEvent:function(e,t){var i=-1===e.indexOf("nyt:")?"nyt:ad-library:"+this.viewName+":"+e:e;this.stopSubscribing(i,t)},signalReady:function(){this.sitewide.isReady&&this.requirements.isReady&&this.broadcastAdEvent("ready")},triggerTagX:function(){var e=this.$html,t={module:"Page",viewportWidth:this.$window.width(),ledeMediaSize:e.attr("data-lede-media-size"),pageLayout:e.attr("data-page-layout")};this.trackingTriggerRaw("ad-tracking",t,"interaction")},setUpOptions:function(t){t&&(this.placements=t.placements?e.extend({},this.placements,t.placements):this.placements,this.requirements=t.requirements||this.requirements)},getAdPlacements:function(){return this.placements},getAdKeywords:function(){return this.pageManager.getUrlParam("ad-keywords")},getAdSensitivity:function(){return this.pageManager.getMeta("ad_sensitivity")},isDisabled:function(){var e,t=!1;return("realestate"===this.pageManager.getMeta("applicationName")||"nyt-espanol"===this.pageManager.getMeta("applicationName"))&&(e=n.readCookie("NYT-T")||n.readCookie("nyt-t"),t="1"==n.readCookie("nyt-gdpr")&&"out"===e?!0:!1,this.broadcastAdEvent("collapse")),"undefined"!=typeof this.pageManager.getUrlParam("nojoy")||"noads"===this.pageManager.getUrlParam("adx_campaign")||"pay"===this.pageManager.getUrlParam("gwt")||t},isAmazonDisabled:function(){var e="1"==n.readCookie("nyt-gdpr")?!0:!1;return"false"===this.pageManager.getMeta("dfp-amazon-enabled")||this.pageManager.getMeta("dfp-amazon-enabled")===!1||e}});return s}),define("shared/adlibrary/helpers/dfp-ordered-custom-criteria-mixin",["underscore/nyt","foundation/views/page-manager"],function(e,t){"use strict";function i(i){var n="";return"blogs"==t.getMeta("sourceApp")&&e.isString(i)&&i.indexOf(";")>=0&&(i=i.split(";")),e.isArray(i)?(i=e.each(i,function(e,t){n+=t>0?",":"",n+=e.toLowerCase().replace(/[^a-z0-9]+/gi,"").substring(0,30)}),n):e.isString(i)?i.toLowerCase().replace(/[^a-z0-9]+/gi,"").substring(0,30):""}function n(){return"rec"===t.getUrlParam("src")?"recpg":"Recommendation"===t.getUrlParam("module")?"recmod":t.getUrlParam("pgtype")?t.getUrlParam("pgtype"):""}function s(){if(t.getUrlParam("smid")){if("fb-nytimes"===t.getUrlParam("smid")||"fb-share"===t.getUrlParam("smid"))return"facebook";if("tw-nytimes"===t.getUrlParam("smid")||"tw-share"===t.getUrlParam("smid"))return"twitter"}return""}function a(){var e,t=document.createElement("a");return document.referrer?(t.href=document.referrer,e=t.hostname.toLowerCase().split("."),e=e.length>2?e[1]:e[0]):""}var o;return o=[{key:"adv",value:t.getUrlParam("ad-keywords")},{key:"plat",value:t.getViewport().width<765?"mweb":"web"},{key:"prop",value:t.getViewport().width<765?"mnyt":"nyt"},{key:"ver",value:"nyt5"},{key:"sub",value:""},{key:"typ",value:""},{key:"pos",value:""},{key:"spon",value:i(t.getMeta("ad-sponsor")?t.getMeta("ad-sponsor").split(","):[])},{key:"des",value:i(t.getMeta("des"))},{key:"per",value:i(t.getMeta("per"))},{key:"org",value:i(t.getMeta("org"))},{key:"geo",value:i(t.getMeta("geo"))},{key:"ttl",value:i(t.getMeta("ttl"))},{key:"col",value:i(t.getMeta("col"))},{key:"ser",value:i(t.getMeta("ser"))},{key:"id",value:t.getMeta("articleid")},{key:"auth",value:i(t.getMeta("author"))},{key:"amznslots",value:""},{key:"ref",value:n()},{key:"srch",value:""},{key:"edn",value:t.isInternationalEdition()?"intl":"us"},{key:"lan",value:""},{key:"etua",value:""},{key:"subsrc",value:""},{key:"env",value:""},{key:"cs",value:""},{key:"jt",value:""},{key:"ind",value:""},{key:"g",value:""},{key:"em",value:""},{key:"inc",value:""},{key:"wat",value:""},{key:"refdom",value:s()},{key:"topref",value:a()},{key:"sov",value:(Math.floor(4*Math.random())+1).toString()}]}),define("shared/adlibrary/helpers/dfp-placements-mixin",["foundation/views/page-manager"],function(e){"use strict";var t,i=[[728,90],[970,90],[970,66],[970,250]];return e.flag("TopFlexAdSiteWide")&&i.push("fluid"),t={TopAd:i,TopAd1:[728,90],TopAd2:[728,90],TopAd3:[728,90],TopAd4:[728,90],TopAd5:[728,90],"lede-ad":[[468,648],[300,600],[300,250]],"marketing-ad":[300,250],MiddleRight1:[300,250],MiddleRight2:[300,250],MiddleRight3:[300,250],MiddleRight4:[300,250],MiddleRight5:[300,250],MiddleRight6:[300,250],MiddleRight7:[300,250],MiddleRight8:[300,250],MiddleRight9:[300,250],MiddleRight10:[300,250],MiddleRight11:[300,250],MiddleRight12:[300,250],MiddleRight13:[300,250],MiddleRight14:[300,250],MiddleRight15:[300,250],MostEm:[88,31],TopNavAd:[88,31],Moses:[[970,418],[970,40]],Frame4A:[96,60],Frame6A:[336,90],Position1:[96,60],Spon2:[88,31],MiddleRightN:[300,250],TopAdN:[728,90],BigAd3:[300,250],Ribbon:[240,75],RibbonInterstitial:[900,500],Interstitial:[[1,1],[640,480]],WelcomeBack:[300,250],sponsortile:[150,50]}}),define("shared/adlibrary/templates",["underscore/nyt"],function(_){var templates={};return templates.captureAd=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="modal-header">\n<h2 class="reportModal-heading">Debug Info</h2>\n</div>\n<div class="dropDownContainer">\n<select class="adDropdown">\n<option>Select ad behavior...</option>\n<option>Content is inappropriate for the specific article</option>\n<option>Ad is being targeted or recurs over and over</option>\n<option>Ad creative doesn&apos;t render properly or appears to be broken</option>\n<option>Ad is intrusive or violates posted specs or industry standards</option>\n<option>Ad is suspicious or malicious</option>\n<option>Ad violates creative quality (offensive content)</option>\n<option>Great ad! Right on target!</option>\n<option>Other</option>\n</select>\n<div class="reportCaret">\n<div class="reportCaretConceal" />\n</div>\n</div>\n<div class="reportButton"><a href="'+(null==(__t=href)?"":__t)+'" target="_blank" class="reportLink">Submit</a></div>\n<p>Note: This is a test and is for data collection purposes--action will not be taken to remove the ad just yet.</p>\n<ul class="reportData">\n<li><strong>Creative ID:</strong> '+(null==(__t=creativeId)?"":__t)+" </li>\n<li><strong>Line Item ID:</strong> "+(null==(__t=lineItemId)?"":__t)+" </li>\n<li><strong>Query ID:</strong>  "+(null==(__t=queryId)?"":__t)+" </li>\n",advertiserName&&(__p+="\n<li><strong>Company Name:</strong> "+(null==(__t=advertiserName)?"":__t)+" </li>\n"),__p+="\n</ul>\n<ul>\n<li><strong>Platform:</strong> web </li>\n<li><strong>Device Type:</strong> "+(null==(__t=device)?"":__t)+" </li>\n<li><strong>Page Type:</strong> "+(null==(__t=pageType)?"":__t)+" </li>\n<li><strong>Ad Position:</strong>  "+(null==(__t=name)?"":__t)+' </li>\n<li class="last"><strong>Ad Size:</strong>  '+(null==(__t=size)?"":__t)+" </li>\n</ul>";return __p},templates.iFrameStyleSheet=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<style type="text/css">\nbody {\nmargin: 0;\noverflow: hidden;\n}a img {\nborder: none;\n}\n</style>';return __p},templates.interstitialModal=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div id="Interstitial" class="ad interstitial-ad"></div><p class="user-action dismiss-button">Continue &raquo;</p>';return __p},templates.ribbonInterstitial=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="ribbon-interstitial-ad-overlay hidden">\n<h4 class="ad-heading"> Advertisement </h4>\n<div id="RibbonInterstitial" class="ad ribbon-interstitial-ad"> </div>\n</div>';return __p},templates}),define("shared/modal/templates",["underscore/nyt"],function(_){var templates={};return templates.modal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="overlay"></div>\n<div class="modal '+(null==(__t=id)?"":__t)+" "+(null==(__t=addlClasses)?"":__t)+'" style="'+(null==(__t=modalStyles)?"":__t)+'" role="dialog" aria-labelledby="'+(null==(__t=id)?"":__t)+'-modal-heading" tabindex="-1">\n<div class="modal-header">\n<h3 class="modal-heading" id="'+(null==(__t=id)?"":__t)+'-modal-heading">'+(null==(__t=modalTitle)?"":__t)+"</h3>\n"+(null==(__t=headerContent)?"":__t)+'\n</div>\n<div class="modal-content">\n'+(null==(__t=modalContent)?"":__t)+'\n</div>\n<div class="modal-footer">\n'+(null==(__t=modalFooter)?"":__t)+'\n</div>\n<button type="button" class="modal-close '+(null==(__t=closeClass)?"":__t)+'" aria-disabled="false"><i class="icon"></i><span class="visually-hidden">Close this modal window</span></button>\n<div class="modal-pointer '+(null==(__t="modal-pointer-"+tailDirection)?"":__t)+'"><div class="modal-pointer-conceal"></div></div>\n</div>';return __p},templates}),define("shared/modal/views/modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/templates"],function(e,t,i,n){"use strict";var s=i.registerView("modal").extend({template:n.modal,className:"modal-container",events:{"click .modal-close, .modal-pointer, .dismiss-button":"close","mouseenter .modal":"handleMouseOutClose"},defaultSettings:{id:"default-modal",modalTitle:"",headerContent:"",modalContent:"",modalFooter:"",addlClasses:"",binding:"",disableBindings:!1,tailDirection:"down",tailTopOffset:0,tailLeftOffset:0,fixedOverride:!1,hasOverlay:!1,hasCloseButton:!1,canOpenOnHover:!1,closeOnMouseOut:!1,mouseOutDelay:0,mouseEnterDelay:0,closeOnClick:!0,autoPosition:!1,positionTailSide:!1,toggleSpeed:300,focusOnShow:!0,closeOnEsc:!0},initialize:function(e){t.bindAll(this,"close","open","mouseEnterOpen","mouseOutClose","handleClickClose","removeFromPage"),this.settings=t.extend({},this.defaultSettings,e),this.settings.modalStyles="width: "+e.width+";",this.render()},render:function(){var e=this.settings.id+"-container";return this.settings.closeClass=this.settings.hasCloseButton?"":"hidden",this.$el.hide().addClass(e).html(this.template(this.settings)),this.$modal=this.$el.find(".modal"),this.$el.find(".overlay").toggle(this.settings.hasOverlay),this},addToPage:function(e,t){var i="string"==typeof e?this.$body.find(e):this.$body;return t="function"==typeof i[t]?t:"append",i[t](this.$el),""===this.settings.binding||this.settings.disableBindings||(this.$body.on("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.on("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.on("mouseleave",this.settings.binding,this.mouseOutClose))),this},removeFromPage:function(){return this.close(),this.$el.remove(),""===this.settings.binding||this.settings.disableBindings||(this.$body.off("click",this.settings.binding,this.open),this.settings.canOpenOnHover&&(this.$body.off("mouseenter",this.settings.binding,this.mouseEnterOpen),this.$body.off("mouseleave",this.settings.binding,this.mouseOutClose))),this.remove()},updateTemplate:function(e){return this.$modal.find(".modal-content").html(e),this.positionDialog(!1),this},updateModalTitle:function(e){this.$modal.find(".modal-heading").html(e)},open:function(t){var i=this;return t?(t.returnValue=!1,t.preventDefault(),this.$target=e(t.currentTarget)):this.$target=e(this.settings.binding).eq(0),this.$el.fadeIn(this.settings.toggleSpeed,function(){i.broadcast("nyt:modal-show"),i.broadcast("nyt:modal-show-"+i.settings.id)}),this.settings.autoPosition?this.autoPosition():this.positionDialog(!0),(this.settings.openCallback||e.noop).call(this),this.subscribe("nyt:page-resize",this.positionDialog),this.settings.closeOnEsc&&this.subscribeOnce("nyt:page-key-esc",this.close),this.$body.on("click",this.handleClickClose),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.focusOnShow&&this.$modal.focus(),this},mouseEnterOpen:function(e){window.clearTimeout(this.mouseLeaveTimeout),this.mouseEnterTimeout=t.delay(this.open,this.settings.mouseEnterDelay,e)},close:function(t){var i=this;return t&&t.currentTarget&&this.settings.disableBindings&&e(t.currentTarget).hasClass("modal-pointer")?this:(this.$el.fadeOut(this.settings.toggleSpeed,function(){(i.settings.closeCallback||e.noop).call(i),i.broadcast("nyt:modal-hide"),i.broadcast("nyt:modal-hide-"+i.settings.id)}),this.stopSubscribing("nyt:page-resize",this.positionDialog),this.$body.off("click",this.handleClickClose),window.clearTimeout(this.mouseEnterTimeout),this.pageManager.isMobile()&&this.$body.css("cursor",""),this)},mouseOutClose:function(t){var i=e(t.relatedTarget);i.is(this.$.target)||this.$modal.has(i).length>0||(window.clearTimeout(this.mouseEnterTimeout),this.$modal.is(":visible")&&(this.mouseLeaveTimeout=window.setTimeout(this.close,this.settings.mouseOutDelay)))},handleMouseOutClose:function(){this.settings.closeOnMouseOut&&this.$modal.on("mouseleave",this.close)},handleClickClose:function(e){this.settings.closeOnClick&&0===this.$modal.has(e.target).length&&this.$modal[0]!==e.target&&this.close()},positionDialog:function(t){var i,n,s,a,o,r=this.pageManager.getViewport(),l=this.$target,d=this.$modal,c="absolute",h=d.outerHeight(),u=d.outerWidth(),g={marginLeft:"0",marginTop:"0",top:"",left:""};switch(l&&l.length>0&&(a=l.outerHeight(),o=l.outerWidth(),n=l.offset().top+this.settings.tailTopOffset,s=l.offset().left+this.settings.tailLeftOffset),this.settings.tailDirection){case"up":g.top=n+a+14,g.left=s+Math.floor(.5*o)-Math.floor(.5*u)-9;break;case"up-right":g.top=n+a+14,g.left=s+Math.floor(.5*o)-(u-25);break;case"up-left":g.top=n+a+14,g.left=s+Math.floor(.5*o)-25;break;case"down":g.top=n-h-15,g.left=s+Math.floor(.5*o)-Math.floor(.5*u)-8;break;case"down-right":g.top=n-h-15,g.left=s+Math.floor(.5*o)-(u-25);break;case"down-left":g.top=n-this.$el.offset().top-h-15,g.left=s-this.$el.offset().left+Math.floor(.5*o)-25;break;case"left":g.top=n+Math.floor(.5*a)-Math.floor(.5*h)+5,this.pageManager.isMobile()&&this.$html.hasClass("navigation-active")?g.left=s+o:g.left=s+o+15;break;case"left-bottom":g.top=n+Math.floor(.5*a)-(h-25),g.left=s+o+15;break;case"left-top":g.top=n+Math.floor(.5*a)-25,g.left=s+o+15;break;case"right":g.top=n+Math.floor(.5*a)-Math.floor(.5*h)+5,g.left=s-u-16;break;case"right-bottom":g.top=n+Math.floor(.5*a)-(h-25),g.left=s-u-16;break;case"right-top":g.top=n+Math.floor(.5*a)-25,g.left=s-u-16;break;case"centered":i=r.height,g.top=h>i?r.top+5:Math.floor(.5*(i-h))+r.top,g.left=Math.floor(.5*r.width-.5*u);break;case"fixed":default:c="fixed",u=this.settings.width||d.width(),h=this.settings.height||d.height(),g.top="50%",g.left="50%",g.marginLeft=-Math.floor(.5*u)+this.settings.tailLeftOffset+"px",g.marginTop=-Math.floor(.5*h)+this.settings.tailTopOffset+"px"}return l&&"fixed"===l.css("position")||this.settings.fixedOverride?(c="fixed",g.top-=r.top,this.$el.css("position","fixed")):this.$el.css("position",""),g.top+=e.isNumeric(g.top)?"px":"",g.left+=e.isNumeric(g.left)?"px":"",d.css("position",c),t===!0?d.css(g):d.stop().animate(g,"fast"),this},autoPosition:function(){var e,t,i,n=this.pageManager.getViewport(),s=this.$modal.outerHeight(),a=this.$modal.outerWidth();return this.settings.positionTailSide&&(i=this.$target.offset().left>n.width/2,this.settings.tailDirection=i?"right":"left"),this.positionDialog(!0),e=this.$target.offset(),this.settings.positionTailSide?(t=this.settings.tailDirection,e.top-n.top-.5*s<0?t+="-top":e.top-n.top+.5*s>n.height&&s-42<e.top-n.top&&(t+="-bottom")):(t=e.top-s<0?"up":"down",e.left+a>n.width?t+="-right":e.left<0&&(t+="-left")),this.$modal.find(".modal-pointer").attr("class","modal-pointer modal-pointer-"+t),this.settings.tailDirection=t,this.positionDialog(!0),this}});return s}),define("shared/adlibrary/helpers/dfp-sitewide-requirements-mixin",["jquery/nyt","underscore/nyt","foundation/models/user-data","shared/adlibrary/templates","shared/modal/views/modal","foundation/cookies"],function(e,t,i,n,s,a){"use strict";var o={aax:"3030",async:!0,dfp:null,isReady:!1,amazonKeywords:[],tabletPortraitSize:1020,small20ViewportSize:719,hasSentComscore:!1,pageViewId:"",adExclusivity:{active:!1},cookieDataAdded:!1,adTrackingObj:{responseStart:0},initialize:function(e){var t=this;this.dfp=e,this.adDiagnosticActive=window.NYTD&&window.NYTD.Abra&&"1"===window.NYTD.Abra("www-ad-diagnostic"),this.dfp.isAmazonDisabled()?this.async=!1:this.setUpAmazonGlobal(),this.setPageViewId(),this.dfp.setCustomCriteria({page_view_id:this.getPageViewId()}),this.dfp.setCustomCriteria({aid:a.readCookie("nyt-a")}),this.dfp.pageManager.flag("abraInCustomParams")&&this.getAbraDfpVariants(),i.hasSynced?this.addCookieData():this.dfp.listenToAdEvent("nyt:user-ready",t.addCookieData,t),this.adDiagnosticActive&&(this.adTrackingObj.responseStart=window.performance.timing.responseStart),this.integrateKrux(),this.determineAdSizes(),this.modifyChamber(),this.handleSupportedBy(),this.addPostMessage(t),"article"===this.dfp.pageManager.getApplicationName()&&this.addTrendingKeywords(),this.adDiagnosticActive&&e.listenToAdEvent("ad-viewable",t.handleAdViewable,t),e.listenToAdEvent("ad-rendered",t.handleAdRendered,t),e.listenToAdEvent("ad-slot-defined",t.handleSlotDefined,t),e.listenToAdEvent("nyt:masthead-search-toggle",t.handleSearchSponsor,t),e.listenToAdEvent("nyt:page-breakpoint",t.handleBreakpoint,t),e.listenToAdEvent("refresh",t.handleRefresh,t),this.dfp.$body.find(".promo.media.video").length>0&&this.dfp.setCustomCriteria({hasVideo:"true"})},addPostMessage:function(e){var t=e;window.addEventListener("message",this.handlePostMessage.bind(t),!1)},handlePostMessage:function(e){var t=this,i=e.origin||e.originalEvent.origin;if("//tpc.googlesyndication.com"===i.split(":")[1]&&e.data){if(!e.data.exclusive)return;t.adExclusivity.active=!0,t.adExclusivity.type=e.data.type,t.dfp.broadcastAdEvent("ad-exclusive-msg-recieved")}},handlePageExclusivity:function(e,t,i){var n=this;i||n.dfp.listenToAdEvent("ad-exclusive-msg-recieved",function(){n.applyExclusiveAdRules(e,t)},n)},applyExclusiveAdRules:function(t,i){var n,s,a=this;a.adExclusivity.active&&("only-child"===a.adExclusivity.type?(a.dfp.setCustomCriteria({adv:i}),a.dfp.addPageLevelParameters(),a.dfp.pageManager.flag("adExclusiveIERibbonCheck")&&e(".ribbon-ad-container").length?a.removeRibbonContainer():a.dfp.listenToAdEvent("nyt:ribbon-rendered",a.removeRibbonContainer,a),a.dfp.deleteAllPlacements(),a.dfp.ignoreAdEvent("nyt:page-scroll",a.dfp.scan),s=e(".story-ad"),s.length&&s.remove(),n=e("#FlexAd"),n.length&&n.remove(),e("#middle-right-paid-post-container").addClass("hidden")):"family-plan"===a.adExclusivity.type&&(a.dfp.setCustomCriteria({adv:i,excl:"family"}),a.dfp.addPageLevelParameters(),a.modifyChamber(),e("#middle-right-paid-post-container").addClass("hidden")))},removeRibbonContainer:function(){e(".ribbon-ad-container").hide()},setPageViewId:function(){this.pageViewId=this.dfp.pageManager.getPageViewId()},getPageViewId:function(){return this.pageViewId},modifyChamber:function(){var e=this.dfp;e.clearChamber()},signalReady:function(){this.isReady=!0,this.dfp.signalReady()},handleAdRendered:function(e,t,i,n,s,a){var o=this,r=this.dfp.getAdElement(e),l=this.adTrackingObj[e];switch(this.determineVisibility(r,i),t=t||[0,0],this.adDiagnosticActive&&(l.adRendered=Date.now()-this.adTrackingObj.responseStart,l.creativeId=a,l.lineItemId=n,l.isEmpty=i,this.dfp.trackingTriggerRaw("dfp-ad-rendered",this.adTrackingObj[e],"interaction")),t[0]){case 728:"TopAd"!=e&&o.checkPoliticalStatus(r,i,t[0]);break;case 300:o.checkPoliticalStatus(r,i,t[0]),o.triggerComScore(e,n,s);break;case 301:o.checkPoliticalStatus(r,i,t[0]),o.triggerComScore(e,n,s);break;case 468:o.triggerComScore(e,n,s)}switch(e){case"TopAd":o.handleTopAd(r,t,i),o.handlePageExclusivity(e,n,i);break;case"lede-ad":o.handleBigAdRendered(r,t,i);break;case"SupportedBy":o.handleSupportedByAd(r,i);break;case"Interstitial":o.handleInterstitial(r,i,t);break;case"TopTileAds1":case"TopTileAds2":case"TopTileAds3":case"TopTileAds4":case"TopTileAds5":o.handleTileAds(r,i)}},handleTopAd:function(e,t,i){var n=e.find("iframe"),s=n.prev("div"),a=this.dfp.$adsOnPage.TopAd;return i?(this.dfp.$html.removeClass("has-top-ad"),void this.dfp.$html.removeClass("has-top-flex-frame-ad")):(1605==n.width()||1605==t[0]||0==t[0]?(this.dfp.$html.addClass("has-top-flex-frame-ad"),e.addClass("flex-frame-ad")):(this.dfp.$html.addClass("has-top-ad"),e.removeClass("flex-frame-ad")),e.attr("display","block"),this.has970TopAd=this.dfp.$html.hasClass("has-top-ad")&&(n.width()>728||s.width()>728)&&1605!==t[0],this.hasFlexFrameTopAd=this.dfp.$html.hasClass("has-top-ad")&&(1605==t[0]||0==t[0]),void(this.has970TopAd&&a.css("min-height","26px")))},handleBigAdRendered:function(e,t,i){i?this.dfp.$html.removeClass("has-big-ad"):(t[0]>=468||450===t[0]&&623===t[1])&&(this.dfp.$html.addClass("has-xxl"),this.hasXXLAd=!0)},handleSupportedBy:function(){var t=e("html").hasClass("viewport-medium-10");this.dfp.pageManager.flag("supportedBy")&&(t?this.dfp.addPlacementSize("SupportedBy",[150,50]):this.dfp.addPlacementSize("SupportedBy",[320,25]))},handleSupportedByAd:function(t,i){i||(e(".supported-by").removeClass("hidden"),this.dfp.$html.addClass("has-supported-by-ad"))},handleTileAds:function(t,i){i||e(".tile-ads").removeClass("hidden")},handleAdViewable:function(e){this.adTrackingObj[e].adViewable=Date.now()-this.adTrackingObj.responseStart,this.dfp.trackingTriggerRaw("dfp-ad-viewable",this.adTrackingObj[e],"interaction")},checkPoliticalStatus:function(t,i,n){var s;if(!i)try{t.find("iframe").contents().find("html #politicalAd").length>0&&!this.dfp.hasAdSlug(t)&&(s=e("<div>").addClass("ad-header").attr("aria-hidden","true").append(e("<p>")).find("p").css({width:n+"px"}).text("ADVERTISEMENT").end(),t.prepend(s))}catch(a){e.noop()}},integrateKrux:function(){this.setUpKruxGlobal(),this.addKruxKeywords()},setUpKruxGlobal:function(){window.Krux=window.Krux||((window.Krux=function(){window.Krux.q.push(arguments)}).q=[])},addKruxKeywords:function(){var e={},t=this.retrieveKruxData("segs"),i=this.retrieveKruxData("user");t&&(e.ksg=t,window.Krux.segments=t.split(",")||[]),i&&(e.kuid=i,window.Krux.user=i),this.dfp.setCustomCriteria(e)},retrieveKruxData:function(e){var t,i="kx"+e;return window.localStorage?window.localStorage[i]||"":navigator.cookieEnabled?(t=document.cookie.match(i+"=([^;]*)"),t&&window.unescape(t[1])||""):""},setUpAmazonGlobal:function(){var t=this;window.amznads={updateAds:e.noop,renderAd:e.noop},e.ajax({url:"//c.amazon-adsystem.com/aax2/amzn_ads.js",dataType:"script",timeout:1e3}).always(function(){t.getAmazonKeywords()})},getAmazonKeywords:function(){var t=this,i=encodeURIComponent(document.location.toString().split("?")[0]);try{i=encodeURIComponent(""+window.top.location.toString().split("?")[0])}catch(n){e.noop()}e.ajax({url:"//aax.amazon-adsystem.com/e/dtb/bid?src="+t.aax+"&u="+i+"&cb="+Math.round(1e7*Math.random()),dataType:"script",timeout:1e3}).done(function(){t.addAmazonKeywords()}).always(function(){t.signalReady()})},handleRefresh:function(){var e=this.dfp,i=t.toArray(arguments),n=function(){e.refreshSlots.apply(e,i)};this.dfp.isAmazonDisabled()?n():this.refreshAmazonKeywords(n)},refreshAmazonKeywords:function(e){var i=this;window.amznads.getAdsCallback&&(window.amznads.getAdsCallback(this.aax,function(){i.addAmazonKeywords(),t.isFunction(e)&&e()}),this.dfp.googletag.cmd.push(function(){i.dfp.googletag.pubads().clearTargeting("amznslots")}))},addAmazonKeywords:function(){window.amznads.ads&&this.dfp.setCustomCriteria({amznslots:t.keys(window.amznads.ads)})},addTrendingKeywords:function(){var t,i,n=e("#trending-link-json").get(0).innerHTML;try{i=JSON.parse(n)}catch(s){i={}}if(null!==i){switch(i.trending_type){case"trending_page":i.dfpTrendingType="trending";break;case"most_emailed_1":i.dfpTrendingType="email";break;case"most_viewed_7":i.dfpTrendingType="icymi";break;case"most_shared_facebook_1":i.dfpTrendingType="fb"}t={trend:i.dfpTrendingType},this.dfp.setCustomCriteria(t)}},addCookieData:function(){var e=i.attributes;this.addEventTrackerId(e),this.parseSubscriberStatus(e),this.parseDemographicData(e.demographics),this.dfp.broadcastAdEvent("userinfo-data-added"),this.cookieDataAdded=!0},addEventTrackerId:function(e){var t={};"0"!==e.id&&(t.etua=e.id,this.dfp.setCustomCriteria(t))},parseSubscriberStatus:function(e){var t,i={};t="0"===e.id?"anon":e.subscription.length<=4?"reg":"sub",i.sub=t,this.dfp.setCustomCriteria(i)},parseDemographicData:function(e){var n,s={};t.isObject(e)&&(s.cs=i.getCompanySize(),s.jt=i.getJobTitle(),s.ind=i.getJobIndustry(),s.g=i.getGender(),s.em=i.getEmailSubscriptions(),s.inc=i.getIncomeRange(),s.wat=i.getWat(),i.getBundleSubscriptions()&&i.getBundleSubscriptions().length>0&&(n=i.getBundleSubscriptions()[0],s.subprm=n.promotion,s.grace=n.in_grace?"t":"f",t.isString(n.bundle)&&(s.sub=n.bundle.toLowerCase()),t.isString(n.source)&&(s.subsrc=n.source)),this.dfp.setCustomCriteria(s))},determineAdSizes:function(){var e=this.dfp.pageManager.getViewport().width;975>e&&(this.dfp.hasResponsiveSizePlacement("TopAd")||(this.dfp.removePlacementSize("TopAd",[970,90]),this.dfp.removePlacementSize("TopAd",[970,66]),this.dfp.removePlacementSize("TopAd",[970,250])),this.dfp.hasResponsiveSizePlacement("lede-ad")||this.dfp.removePlacementSize("lede-ad",[468,648])),765>e&&(this.dfp.hasResponsiveSizePlacement("TopAd")||this.dfp.removePlacement("TopAd"),this.dfp.hasResponsiveSizePlacement("TopAd1")||this.dfp.removePlacement("TopAd1"),this.dfp.hasResponsiveSizePlacement("TopAd2")||this.dfp.removePlacement("TopAd2"),this.dfp.hasResponsiveSizePlacement("TopAd3")||this.dfp.removePlacement("TopAd3"),this.dfp.hasResponsiveSizePlacement("TopAd4")||this.dfp.removePlacement("TopAd4"),this.dfp.hasResponsiveSizePlacement("TopAd5")||this.dfp.removePlacement("TopAd5"),this.dfp.removePlacement("SponLink"))},handleSlotDefined:function(e,t,i){var n;switch(t){case"lede-ad":n="mid1";break;case"MiddleRight2":n="mid2";break;case"Frame6A":n="artexp";break;case"MostEm":n="emmod";break;case"TopAd":n="top";break;case"TopAd1":n="bottom";break;case"TopNavAd":case"SponsorAd":n="ssearch";break;case"Spon2":n=t;break;case"FlexAd":n="flex";break;case"TopTileAds1":n="tile1";break;case"TopTileAds2":n="tile2";break;case"TopTileAds3":n="tile3";break;case"TopTileAds4":n="tile4";break;case"TopTileAds5":n="tile5";break;case"MoreIn":n="morein"}this.adDiagnosticActive&&(this.adTrackingObj[t]={slotId:t,adSize:i,pageViewId:this.getPageViewId(),responseStart:this.adTrackingObj.responseStart,adSlotDefined:Date.now()-this.adTrackingObj.responseStart,adViewable:null},this.dfp.trackingTriggerRaw("dfp-ad-slot-defined",this.adTrackingObj[t],"interaction")),n&&e.setTargeting("pos",n),e.setTargeting("div",t)},determineVisibility:function(e,t){if(t)e.addClass("hidden").removeClass("request-pending");else try{e.find("iframe").contents().find("html #exclusivity").length>0?e.addClass("hidden ad-exclusivity"):e.removeClass("hidden request-pending")}catch(i){e.removeClass("hidden request-pending")}},handleSearchSponsor:function(){var e=this.dfp.$shell.find("#SponsorAd");e.find("iframe").length>0||this.dfp.requestDynamicAd("SponsorAd",[88,31])},handleBreakpoint:function(e){this.has970TopAd&&this.hideTopAdForSmallViewport(e),this.hasXXLAd&&this.hideXxlForSmallViewport(e),this.hasFlexFrameTopAd&&this.hideFlexFrameTopAdForSmallViewport(e)},hideTopAdForSmallViewport:function(e){var t=this.dfp.getAdElement("TopAd");e<=this.tabletPortraitSize?(t.addClass("hidden"),this.dfp.$html.removeClass("has-top-ad")):(t.removeClass("hidden"),this.dfp.$html.addClass("has-top-ad"))},hideXxlForSmallViewport:function(e){var t=this.dfp.getAdElement("lede-ad");e<=this.tabletPortraitSize?(t.addClass("hidden"),this.dfp.$html.removeClass("has-xxl")):(t.removeClass("hidden"),this.dfp.$html.addClass("has-xxl"))},hideFlexFrameTopAdForSmallViewport:function(e){var t=this.dfp.getAdElement("TopAd");e<=this.small20ViewportSize?(t.addClass("hidden"),this.dfp.$html.removeClass("has-top-ad")):(t.removeClass("hidden"),this.dfp.$html.addClass("has-top-ad"))},triggerComScore:function(e,t,i){this.dfp.getAdElement(e).data("isInitial")||this.hasSentComscore||(this.dfp.trackingComscorePVC({module:"Ad",version:e,action:"Impression",contentCollection:i,contentID:t,region:this.dfp.adPath,eventName:"AdImpression"}),this.hasSentComscore=!0)},setupInterstitial:function(){var e=this;this.interstitialModal=new s({id:"interstitial-ad-modal",modalTitle:"advertisement",tailDirection:"fixed",hasOverlay:!0,hasCloseButton:!0,width:640,height:480,modalContent:n.interstitialModal(),closeCallback:function(){e.closeInterstitial()}}).addToPage(),e.requestInterstitial()},requestInterstitial:function(){this.dfp.broadcastAdEvent("request-placement","Interstitial")},scheduleInterstitialClose:function(){this.closeTimeout=window.setTimeout(this.interstitialModal.close,17e3)},closeInterstitial:function(){window.clearTimeout(this.closeTimeout)},handleInterstitial:function(e,t,i){t||1===i[0]||(this.interstitialModal.open(),this.scheduleInterstitialClose())},getAbraDfpVariants:function(){var e,t,i,n,s,a,o="",r=document.getElementsByTagName("html")[0].getAttribute("data-nyt-ab");if(r)for(o=[],e=r.split(" "),s=0;s<e.length;s++)if(t=e[s].split("=")[0].toLowerCase(),i=e[s].split("=")[1],t.indexOf("dfp")>-1)if(i.indexOf(",")>0)for(n=i.split(","),a=0;a<n.length;a++)o.push(t+"_"+n[a]);else o.push(t+"_"+i);this.dfp.setCustomCriteria({abra_dfp:o})}};return o}),define("shared/adlibrary/views/dfp",["jquery/nyt","underscore/nyt","shared/adlibrary/views/base-ad","foundation/hosts","foundation/cookies","shared/adlibrary/helpers/dfp-ordered-custom-criteria-mixin","shared/adlibrary/helpers/dfp-placements-mixin","shared/adlibrary/helpers/dfp-sitewide-requirements-mixin","shared/adlibrary/templates","shared/modal/views/modal"],function(e,t,i,n,s,a,o,r,l,d){"use strict";var c=i.extend({alreadyRequested:{},notYetRequested:{},readyForDisplay:{},adPath:"",viewName:"dfp",chamber:[],adsOnPage:{},$adsOnPage:{},slots:{},googletag:null,apstag:null,customCriteria:[],placements:o,isScanning:!1,hasTragedy:!1,initialize:function(i){if(i=i||{},this.showCaptureAdButton=s.readCookie("vi_show_report_btn"),this.showCaptureAdButton){var n=e("<button>").addClass("captureAd hidden").html("Capture Ad");n.appendTo(document.querySelectorAll(".ad"))}if(this.listenToAdEvent("ready",this.handleReady),
this.adPath=this.getAdUnitPath(),this.sitewide=r,this.customCriteria=t.each(a,function(e){return t.clone(e)}),this.setCustomCriteria(i.customCriteria),this.discoverAdsOnPage(),this.addToChamber(this.adsOnPage),this.listenToAdEvent("ad-slot-defined",this.handleSlotDefined),this.listenToAdEvent("ad-rendered",this.triggerTagX,!0),this.listenToAdEvent("request-placement",this.requestDynamicAd),this.listenToAdEvent("queue-placement",this.queueDynamicAd),this.listenToAdEvent("scan",this.scan),this.listenToAdEvent("discover",this.discoverAdsOnPage),this.broadcastAdEvent("waiting",this),this.lockdownAds=window.NYTD&&window.NYTD.Abra&&"1"===window.NYTD.Abra("nyt5-ad-sandbox"),this.showCaptureAdButton){var o=this;this.modalSettings=t.extend({},{id:"report-ads-modal hidden",binding:".captureAd",tailDirection:"up"}),e(window).on("click",function(t){var i=o.$body.find(".report-ads-modal"),n=e(t.target).parent();i.length>0&&"BUTTON"!==t.target.tagName&&!n.hasClass("report-ads-modal")&&!n.hasClass("modal-content")&&!n.hasClass("dropDownContainer")&&(i.find("select").val("Select ad behavior..."),i.addClass("hidden"))})}},isGDPR:function(){var e=this.pageManager.flag("gdpr")&&s.readCookie("nyt-gdpr");return e&&"1"===e},isOptedIntoTracking:function(){var e=this.pageManager.flag("gdpr")&&(s.readCookie("NYT-T")||s.readCookie("nyt-t"));return"out"!==e},getAdStatus:function(){var e=this.isGDPR(),t=this.isOptedIntoTracking(),i="homepage"===this.pageManager.getMeta("applicationName"),n=document.referrer||"",s=window.location.href,a=/([a-zA-Z0-9_\-.]+)(@|%40)([a-zA-Z0-9_\-.]+)\.([a-zA-Z]{2,5})/,o=a.test(s)||a.test(n);return e&&!t&&i?"AD_LITE":e&&!t||o?"NO_ADS":"DFP"},showAds:function(){var e=this.getAdStatus();return"AD_LITE"===e||"DFP"===e},showStaticAds:function(){return"AD_LITE"===this.getAdStatus()},getValFromCustomCriteria:function(e){try{return this.customCriteria.find(function(t){return t.key===e}).value}catch(t){return""}},getStaticAdPos:function(e){var t={Top:"top",HPMidLeader:"mid3",HPSponLink:"mid5"};return t[e]||""},getStaticAd:function(e){var i=document.createElement("iframe"),n={prop:this.getValFromCustomCriteria("prop"),ver:this.getValFromCustomCriteria("ver"),pos:this.getStaticAdPos(e),sov:(Math.floor(4*Math.random())+1).toString(),sub:this.getValFromCustomCriteria("sub"),typ:this.getValFromCustomCriteria("typ"),width:970,height:250},s=t.map(n,function(e,t){return t+"="+e},"").join("&");i.className="gdpr-frame",i.scrolling="no",i.src="https://www.nytimes.com/marketing/gdpr/display.html?"+s;try{var a=document.getElementById(e);a.appendChild(i)}catch(o){}},getAdUnitPath:function(){var e,i,s=(this.getAdSensitivity(),this.pageManager.getMeta("dfp-ad-unit-path"));return t.isUndefined(s)&&(e=this.pageManager.getMeta("CG"),i=this.pageManager.getMeta("SCG")?"/"+this.pageManager.getMeta("SCG"):"",s=e+i),n.dfpHost+s},handleReady:function(){var t=this;if(t.showAds()){if(this.googletag=window.googletag,!this.googletag&&!t.showStaticAds())return setTimeout(function(){t.handleReady()},500);if(this.isReady)throw new Error("DFP already in ready state.  Do not signal ready more than once.");this.isReady=!0,this.addPageLevelParameters(),this.initialAdRequest(),this.enableServices(),this.scan(),this.listenToAdEvent("placement-added",this.scan),this.showCaptureAdButton&&("homepage"===this.pageManager.getMeta("applicationName")&&(this.modalSettings.tailLeftOffset=-parseInt(e("#shell").css("margin-left"),10)+100),this.$body.find(".captureAd").on("click",function(i){var n=e(i.target);if("FlexAd"!==n.parent().attr("id")&&"TopAd1"!==n.parent().attr("id")){var s=n.parent().children().last();s.hasClass("hidden")?(t.$body.find(".modalOpened").length>0&&t.$body.find(".modalOpened").addClass("hidden"),s.removeClass("hidden"),s.addClass("modalOpened")):(s.find("select").val("Select ad behavior..."),s.addClass("hidden"),s.removeClass("modalOpened"))}}))}},captureAds:function(e){var i=this;if(!e.isEmpty){var n,s,a=document.getElementById(e.slot.getSlotElementId()),o=a.querySelector(".captureAd"),r=e.slot.getSlotElementId(),c=i.getAdElement(r),h=i.getAdvertiserName(e),u=i.pageManager.getCurrentBreakpoint()<1010?"mobile":"desktop",g=e.slot.getSlotElementId(),m=i.pageManager.getApplicationName(),p="(eg. slow ad, inappropriate ad)",f=e.size;t.isArray(f)&&(n=0===f[0]?"fluid":f.join("x")),s=i.getEmailContent(e,h,u,g,p,n,m),i.modalSettings.modalContent=l.captureAd({creativeId:e.sourceAgnosticCreativeId,lineItemId:e.sourceAgnosticLineItemId,queryId:e.slot.getEscapedQemQueryId(),pageType:m,device:u,name:g,advertiserName:h,href:s,size:n}),this.updateModalSettings(r,o),c.append(o),o.removeClass("hidden"),i.reportAdModal=new d(i.modalSettings),i.reportAdModal.addToPage(),c.append(i.reportAdModal.$modal),c.find(".adDropdown").on("change",function(t){var s=i.getEmailContent(e,h,u,g,t.target.value,n,m);c.find(".reportButton a").attr("href",s)})}},getEmailContent:function(e,t,i,n,s,a,o){var r=e.sourceAgnosticCreativeId,l=e.sourceAgnosticLineItemId,d=this.getClickThroughUrl(e.slot),c=t?"\n\nCompany Name: "+t:"",h="Capture Ad / "+(new Date).toLocaleDateString("en-US")+" / "+r+" / "+l+" / "+s+" (Experimental Only)",u=encodeURIComponent("* * * This is currently only a tech test--no action will be taken at this time. * * *\n\nReason: "+s+"\n\nScreenshot: (please attach a screenshot of the ad)\n\n-----------\n\nCreative ID: "+r+"\n\nLine Item ID: "+l+"\n\nQuery ID: "+e.slot.getEscapedQemQueryId()+"\n\nPlatform: web\n\nDevice Type: "+i+"\n\nPage Type: "+o+"\n\nAd Position: "+n+"\n\nAd Size: "+a+"\n\nPage URL: "+window.location.href+"\n\nClick-through URL:"+d+"\n\n"+c);return"mailto:devtest-AdFrameworks@nytimes.com?subject="+h+"&body="+u},updateModalSettings:function(t,i){var n=this;e("html").hasClass("viewport-medium-10")&&"SupportedBy"===t?(this.modalSettings.tailTopOffset=-400,this.modalSettings.tailLeftOffset=-parseInt(e("#main").css("margin-left"),10)):("MiddleRightPaidPost1"===t||"MiddleRightPaidPost2"===t||"MiddleRightPaidPost3"===t||"MiddleRightPaidPost4"===t)&&(this.modalSettings.openCallback=function(){e("#"+t+" .modalOpened").css({left:0,top:e(i).offset().top-n.getAdElement(t).parent().offset().top+60})}),e("#TopRight").css("height","120px"),e("#TopLeft").css("height","120px")},getAdvertiserName:function(e){var t={33614678:"Faceboook",33597998:"Rubicon Project",30252878:"Index Exchange",39318518:"Index Exchange EBDA",32855678:"Yieldmo",21966278:"Google Ad Exchange",32074718:"Amazon",38636678:"AppNexus",33597638:"OpenX",4400775978:"OpenX EBDA"};if(!e.isEmpty){var i=e.slot.getResponseInformation().advertiserId,n=t[i];return n?n:""}return""},getClickThroughUrl:function(e){if(e.j&&e.j._html_){var t=this.matchClickThroughUrl(e.j._html_);return null!==t?t[0]:""}var i=this,n=e.getSlotElementId(),s=document.getElementById(n),a=s.querySelector("iframe");setTimeout(function(){i.getUrlInFrame(a)},3e3)},getUrlInFrame:function(e){var t=e.contentDocument,i="";if(null!==t){var n=t.querySelectorAll('a[href][target="_blank"]'),s=t.querySelectorAll("iframe");if(n.length>0){for(var a=0;a<n.length;a++)if(i=this.matchClickThroughUrl(n[a].href),null!==i)return i[0]}else if(s.length>0)for(var o=0;o<s.length;o++){var r=this.getUrlInFrame(s[o]);if(""!==r)return r}}else if(i=this.matchClickThroughUrl(e.outerHTML),null!==i)return i[0];return""},matchClickThroughUrl:function(e){return e.match(/(http|https):\/\/((www|googleads|adclick|ade-beta|google-bidout-d)\.(googleadservices|g|media6degrees|openx)\.(|doubleclick\.)(com|net))\/(pagead|pcs|adserv|w)\/(|1.0\/)((aclk|click|view|clktrk|rc)\?[^'">]+)/g)},handleSlotDefined:function(e,t){this.trackRequested(e,t)},requestAdsInViewport:function(){this.requestMultipleAds(this.getAdsInViewport())},trackRequested:function(e,i){this.readyForDisplay[i]=this.notYetRequested[i],delete this.notYetRequested[i],0===t.keys(this.notYetRequested).length&&(this.isScanning=!1,this.stopSubscribing("nyt:page-scroll",this.requestAdsInViewport))},getAdsInViewport:function(){var e=this,i={};return t.each(this.$adsOnPage,function(t,n){!e.alreadyRequested[n]&&e.isElementInViewport(t)&&(i[n]={$el:t,size:e.adsOnPage[n]})}),i},enableServices:function(){var e=this.googletag,t=this,i=this.isGDPR();e&&e.cmd.push(function(){i&&e.pubads().setRequestNonPersonalizedAds(1),e.pubads().addEventListener&&(e.pubads().addEventListener("slotRenderEnded",function(e){t.showCaptureAdButton&&t.captureAds(e),t.broadcastAdEvent("ad-rendered",e.slot.getSlotId().getDomId(),e.size,e.isEmpty,e.lineItemId,e.serviceName,e.creativeId)}),e.pubads().addEventListener("impressionViewable",function(e){t.broadcastAdEvent("ad-viewable",e.slot.getSlotId().getDomId())})),t.broadcastAdEvent("enable-services"),e.pubads().enableSingleRequest(),e.enableServices()})},addPageLevelParameters:function(){var e=this.googletag;e&&t.each(this.customCriteria,function(i){t.isEmpty(i.value)||e.cmd.push(function(){e.pubads().setTargeting(i.key,i.value)})})},setCustomCriteria:function(e){t.isObject(e)&&t.each(e,function(e,i){var n=t.findWhere(this.customCriteria,{key:i});e&&(t.isString(e)||t.isArray(e)||(e=e.toString()),n?n.value=e:this.customCriteria.push({key:i,value:e}))},this)},defineAdSlots:function(e){var i=this,n=e.isInitial,s=i.googletag;if(e=t.omit(e,t.keys(i.slots)),!t.isEmpty(e)&&i.showAds()){if(i.showStaticAds())return void t.each(e,function(e,s){t.isArray(e)&&(i.slots[s]={},i.$adsOnPage[s].data("isInitial",n),i.trackRequested({},s))});s.cmd.push(function(){t.each(e,function(e,a){var o,r,l;t.isArray(e)&&("fluid"===e||t.isArray(e)&&e.indexOf("fluid")>-1?o=e:t.isArray(e)&&t.isArray(e[0])&&t.isArray(e[0][0])?(o=[],r=e):o=e,l=s.defineSlot(i.adPath,o,a),i.lockdownAds&&s.pubads().setForceSafeFrame(!0),r&&l.defineSizeMapping(r),l.addService(s.pubads()).setCollapseEmptyDiv(!0),i.slots[a]=l,i.$adsOnPage[a].data("isInitial",n),i.broadcastAdEvent("ad-slot-defined",l,a,e))})}),this.pageManager.flag("apsTagEnabled")&&!this.isGDPR()&&this.defineApstag(e)}},defineApstag:function(e,i){var n,s=this,a=[],o=[[970,250],[970,90],[728,90],[300,600],[300,250]],r=!1,l=s.pageManager.getViewport().width;765>l&&(n=0),n=l>1020?1020:765,t.each(e,function(e,i){var l;"FlexAd"!==i&&t.isArray(e)&&("fluid"===e||e.indexOf("fluid")>-1?l="":t.isArray(e[0])&&t.isArray(e[0][0])?t.each(e,function(i,s){var a=e[s][0][0],o=e[s][1];if(a===n){var r=t.indexOf(o,"fluid");r>-1&&(l=o.slice(),l.splice(r,1))}}):l=t.isArray(e[0]||!t.isArray(e[0][0]))?e:[e],r=t.find(l,function(e){return t.some(o,e)?!0:void 0}),r&&a.push({slotID:i,slotName:s.adPath,sizes:l}))}),window.apstag.fetchBids({slots:a},function(e){s.googletag.cmd.push(function(){window.apstag.setDisplayBids(),s.requestMultipleAds(e)})})},requestMultipleAds:function(e){t.each(e,function(e,t){"undefined"==typeof this.slots[t]?this.requestDynamicAd(t,e.size):this.requestSingleAd(t)},this)},requestSingleAd:function(e){var i=this.googletag,n=this;if(n.showAds()){if(n.showStaticAds())return n.getStaticAd(e),t.extend(n.alreadyRequested,n.readyForDisplay),void delete n.readyForDisplay[e];if(!this.hasTragedy){if(!n.isReady)return n.listenToAdEvent("ready",function(){n.requestSingleAd(e)},!0);i.cmd.push(function(){i.display(e),t.extend(n.alreadyRequested,n.readyForDisplay),delete n.readyForDisplay[e]})}}},discoverAdsOnPage:function(){var t=this,i=e(".ad, .text-ad, .sponsor-ad");i.each(function(e,i){i.id in t.placements&&!t.$adsOnPage[i.id]&&t.addPlacement(i.id)})},addToChamber:function(){this.chamber.push.apply(this.chamber,t.toArray(arguments))},clearChamber:function(){var e=this.chamber;return this.chamber=[],e},initialAdRequest:function(){t.each(this.chamber,function(e){e.isInitial=!0,this.defineAdSlots(e)},this)},requestDynamicAd:function(t,i){var n=this;return n.isReady?this.alreadyRequested[t]?(this.$adsOnPage[t]=e("#"+t),!1):(this.addPlacement(t,i),this.defineAdSlots(this.getPlacement(t)),void this.requestSingleAd(t)):n.listenToAdEvent("ready",function(){n.requestDynamicAd(t,i)},!0)},queueDynamicAd:function(e,t){this.addPlacement(e,t),this.scan()},getAdElement:function(t){return this.$adsOnPage[t]||e()},hasPlacementSize:function(e,t){var i,n=this.placements[e];if(n)for(i=0;i<n.length;i++)if("string"!=typeof n[i]&&n[i][0]===t[0]&&n[i][1]===t[1])return!0;return!1},addPlacement:function(i,n){var s;return t.isObject(i)?t.each(i,function(e,t){this.addPlacement(t,e)},this):(s=e("#"+i),0===s.length?!1:(this.placements[i]=n||this.placements[i],this.adsOnPage[i]=this.placements[i],this.$adsOnPage[i]=e("#"+i),this.notYetRequested[i]=this.$adsOnPage[i],void this.broadcastAdEvent("placement-added",i,n)))},registerBatchRequest:function(e){this.registerPlacementsInLibrary(e),this.defineAdSlots(e)},registerPlacementsInLibrary:function(i){var n;t.each(i,function(t,i){return n=e("#"+i),0===n.length?!1:(this.placements[i]=t||this.placements[i],this.adsOnPage[i]=this.placements[i],this.$adsOnPage[i]=e("#"+i),void(this.notYetRequested[i]=this.$adsOnPage[i]))},this)},triggerSRARequest:function(){0!=this.notYetRequested.length&&this.requestSingleAd(Object.keys(this.notYetRequested)[0])},getPlacement:function(){var e={};return t.each(t.toArray(arguments),function(t){this.adsOnPage[t]&&(e[t]=this.adsOnPage[t])},this),e},hasResponsiveSizePlacement:function(e){var i=this.placements[e];return t.isUndefined(i)?!1:t.isArray(i)&&t.isArray(i[0])&&t.isArray(i[0][0])?!0:!1},removePlacement:function(e){delete this.placements[e],delete this.adsOnPage[e],delete this.$adsOnPage[e],delete this.notYetRequested[e]},deleteAllPlacements:function(){this.placements={},this.adsOnPage={},this.$adsOnPage={},this.notYetRequested={}},removePlacementSize:function(e,i){var n,s,a;if(this.adsOnPage&&this.adsOnPage[e]&&(n=this.adsOnPage[e]),this.adsOnPage&&this.adsOnPage[e]&&t.isArray(this.adsOnPage[e][0]))for(a=0;a<n.length;a+=1)s=n[a],s[0]===i[0]&&s[1]===i[1]&&n.splice(a,1);else n&&n[0]===i[0]&&n[1]===i[1]&&this.removePlacement(e)},editPlacementSize:function(e,t){this.adsOnPage&&this.adsOnPage[e]&&(this.adsOnPage[e].length=0,this.adsOnPage[e].push.apply(this.adsOnPage[e],t))},addPlacementSize:function(e,i){var n,s,a=!1,o=0;if(t.isUndefined(this.adsOnPage[e]))return this.addPlacement(e,i);if(t.isArray(this.adsOnPage[e][0])){for(o;o<this.adsOnPage[e].length;o+=1)if(n=this.adsOnPage[e][o][0],s=this.adsOnPage[e][o][1],n===i[0]&&s===i[1]){a=!0;break}a||this.adsOnPage[e].push(i)}else n=this.adsOnPage[e][0],s=this.adsOnPage[e][1],(n!==i[0]||s!==i[1])&&(this.adsOnPage[e].length=0,this.adsOnPage[e].push([n,s]),this.adsOnPage[e].push(i))},refreshSlots:function(i,n){var s,a=this;n=n||!1,i&&(s=[],i=t.isArray(i)?i:[i],t.each(i,function(e){this.slots[e]&&s.push(this.slots[e])},this)),t.each(this.$adsOnPage,function(t,i){a.$adsOnPage[i]=e("#"+i)}),this.googletag.cmd.push(function(){a.googletag.pubads().refresh(s,{changeCorrelator:n})})},hasAdSlug:function(e){return e.find(".ad-header").length>0},scan:function(){this.isScanning||(this.isScanning=!0,this.requestAdsInViewport(),this.subscribe("nyt:page-scroll",this.requestAdsInViewport))}});return c}),define("shared/ad/models/ad",["backbone/nyt"],function(e){"use strict";var t=e.Model.extend({});return t}),define("shared/adlibrary/collections/adx-collection",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","foundation/hosts","shared/ad/models/ad"],function(e,t,i,n,s){"use strict";var a=i.extend({url:n.ADXHost+"/adx/bin/adxrun.html",model:s,initialize:function(e){if(this.options=e||{},this.placements=this.options.placements,!this.options.placements)throw new Error("No ad placements found in ADX collection");t.isUndefined(this.pageManager.getMeta("adxPage"))?this.host=this.pageManager.getUrlParam("adx_campaign")||this.options.adx_campaign||"www.nytimes.com":(this.host="",this.options.page=this.pageManager.getMeta("adxPage")),this.interstitial=this.options.interstitial?1:0,this.setPageParameter()},setPageParameter:function(){var e;this.options.page||(e=location.pathname,e=e.replace(/\d{4}/,"yr").replace(/\d{2}/,"mo").replace(/\d{2}/,"day"),this.options.page=this.host+e)},sync:function(i,n,s){var a=this;return s.dataType="jsonp",s.jsonp="jsonp",s.jsonpCallback="processAdx",s.data={page:a.options.page,positions:t.keys(this.placements).join(","),autoconfirm:0,v:3,cpp:0,attributes:"nyt5",keywords:this.getAdxKeywords(),secureClientside:1},e.sync(i,n,s)},getAdxKeywords:function(){var e=this.pageManager.getMeta("keywords")||"",t=this.pageManager.getUrlParam("ad-keywords"),i=3500;return e.length>i&&(e=e.substring(0,i)),t&&(e=e+","+t),e},parse:function(e){var t,i=[];for(t in e.ads)e.ads.hasOwnProperty(t)&&this.placements.hasOwnProperty(t)&&(e.ads[t].adId=t,i.push(e.ads[t]));return i}});return a}),define("shared/adlibrary/helpers/adx-placements-mixin",[],function(){"use strict";var e={Inv1:[],Inv2:[],Inv3:[],ab1:[],ab2:[],ab3:[],prop1:[],prop2:[],Anchor:[],Bar1:[],ADX_CLIENTSIDE:[]};return e}),define("shared/adlibrary/views/adx",["jquery/nyt","underscore/nyt","shared/adlibrary/views/base-ad","shared/adlibrary/templates","shared/adlibrary/collections/adx-collection","shared/adlibrary/helpers/adx-placements-mixin"],function(e,t,i,n,s,a){"use strict";var o=i.extend({viewName:"adx",placements:a,iframeClass:"ad-frame",initialize:function(){this.ads=new s({placements:this.placements}),this.subscribe(this.ads,"sync",this.receiveAds),this.requestAds(),this.listenToAdEvent("request-placement",function(e){this.renderAdFromData({id:e})})},requestAds:function(){this.ads.fetch()},renderAdFromData:function(t){var i,s;(t.model||t.id)&&(i=t.model||this.ads.findWhere({adId:t.id}),s=t.id||(i?i.get("adId"):null),i&&s&&this.renderInIframe({el:e("#"+s),model:i,frameStyle:n.iFrameStyleSheet(),secondaryIframeClass:"frame-for-article"}))},receiveAds:function(e){var t=this;e.each(function(e){t.renderAdFromData({model:e,id:e.get("adId")})})},renderInIframe:function(i){var n,s,a,o,r,l,d,c=document.createElement("iframe");i=i||{},s=i.model,s&&"undefined"!=typeof s.get&&i.el&&!s.get("hasPainted")&&(i.el=e(i.el),o=s.get("confirmation-url"),r=s.get("creative"),d=s.get("isInlineSafe"),"string"==typeof d&&"n"===d.toLowerCase()&&(d=!1),d?i.el.append(i.el.html()+r):0===i.el.find("iframe").length&&"ADX_CLIENTSIDE"!==s.get("name")&&(a=i.frameStyle?i.frameStyle+r:r,e(c).attr("frameBorder",0).addClass(this.iframeClass).css(this.calculateIFrameCss(s.get("width"),s.get("height"))),i.secondaryIframeClass&&(c.className+=" "+i.secondaryIframeClass),i.el.append(c),c.contentDocument?n=c.contentDocument:c.contentWindow&&(n=c.contentWindow.document),n&&(n.open(),n.write(a),t.defer(function(){n.close()}))),e(i.el.selector+"-alternate-content").addClass("hidden"),o&&""!==o&&(l=new Image,l.src=o),this.trackingTriggerImpression("ad-render",{module:"Ad",version:s.get("name"),action:"Impression",contentCollection:s.get("campaign"),contentID:s.get("classification"),region:i.page||"",eventName:"AdImpression"}),this.broadcastAdEvent("ad-rendered",s.get("adId")),i.callback&&i.callback())},calculateIFrameCss:function(e,t){var i={};return i.width=e||0,i.height=t||0,i}});return o}),define("collection/views/adlibrary/placements/adx-placements-mixin",[],function(){"use strict";var e={Inv1:[],Inv2:[],Inv3:[],ab1:[],ab2:[],ab3:[],prop1:[],prop2:[],Anchor:[],Bar1:[]};return e}),define("shared/adlibrary/helpers/responsive-gpt-mixin",[],function(){"use strict";var e={setPlacementAfter:function(e,t){return[[[e,0],t]]},disablePlacementAfter:function(e){return[[[e,0],[]]]},setPlacementForViewport:function(e,t){return[[e,0],t]},disablePlacementAfterViewport:function(e){return[[e,0],[]]}};return e}),define("collection/views/adlibrary/placements/dfp-placements-mixin",["underscore/nyt","foundation/views/page-manager","shared/adlibrary/helpers/responsive-gpt-mixin"],function(e,t,i){"use strict";var n=[i.setPlacementForViewport(1020,["fluid",[728,90],[970,66],[970,90],[970,250],[1605,300]]),i.setPlacementForViewport(765,["fluid",[728,90],[1605,300]]),i.disablePlacementAfterViewport(0)],s=[i.setPlacementForViewport(1020,["fluid",[728,90],[970,90],[970,250],[1605,300]]),i.setPlacementForViewport(765,["fluid",[728,90],[1605,300]]),i.setPlacementForViewport(0,["fluid",[300,250],[300,420]])],a=[i.setPlacementForViewport(1020,[[300,250],[300,600]]),i.disablePlacementAfterViewport(0)],o=[i.setPlacementForViewport(765,[[1,1],[640,480]]),i.disablePlacementAfterViewport(0)],r=[i.setPlacementForViewport(765,[[336,46]]),i.disablePlacementAfterViewport(0)],l=[i.setPlacementForViewport(1015,[[160,90]]),i.disablePlacementAfterViewport(0)],d=[i.setPlacementForViewport(1020,[[301,600],[300,250]]),i.disablePlacementAfterViewport(0)],c=[i.setPlacementForViewport(0,["fluid"])],h=function(){var i={},h={},u=t.getMeta("nyt-collection:identifier"),g={TopAd:n,TopAd1:n,TopNavAd:[88,31],"lede-ad":a,"marketing-ad":[301,251],Middle1C:[88,31],RankAd1:s,RankAd2:s,RankAd3:s,RankAd4:s,RankAd5:s,RankAd6:s,RankAd7:s,RankAd8:s,Spon1:r,Spon2:[88,31],"supplemental-ad-2":d,Interstitial:o};return"awards-season"===u?(i={TopTileAds1:l,TopTileAds2:l,TopTileAds3:l,TopTileAds4:l,TopTileAds5:l},e.extend(g,i)):"realestate"===u&&(h=t.isMobile()?{featprop1:c}:{featprop1:c,featprop2:c},e.extend(g,h)),g};return h()}),define("collection/views/adlibrary/requirements/dfp-collection-requirements-mixin",["jquery/nyt","foundation/views/page-manager"],function(e,t){"use strict";var i={dfp:null,initialize:function(e){var t=this;this.dfp=e,this.counter=1,e.listenToAdEvent("nyt:tabs-tab-click",t.handleSearchTabClick,t),e.listenToAdEvent("nyt:append-ads-to-stream",t.handleAdditionalAds,t),e.listenToAdEvent("nyt:append-paidpost-to-stream",t.handlePaidPost,t),e.listenToAdEvent("ad-slot-defined",this.handleSlotDefined,t),this.handleRealestateCollection(),this.dfp.sitewide.setupInterstitial(),this.prepareInitialRequest(),this.setCollectionCustomCriteria(),this.handleSavedCollection()},prepareInitialRequest:function(){this.dfp.clearChamber(),this.dfp.addToChamber(this.dfp.getPlacement("TopAd","TopTileAds1","TopTileAds2","TopTileAds3","TopTileAds4","TopTileAds5","Spon1","RankAd1","RankAd2","RankAd3","RankAd4","RankAd5","RankAd6","RankAd7","RankAd8","lede-ad"))},setCollectionCustomCriteria:function(){var e=this.dfp.pageManager.getViewport().width,t={typ:"coll"};this.dfp.setCustomCriteria(t),t=765>e?{plat:"mweb",prop:"mnyt",vp:"small"}:e>=766&&1020>e?{vp:"medium"}:{vp:"large"},this.dfp.setCustomCriteria(t)},handleSlotDefined:function(e,t){var i;"RankAd1"===t?i="mid"+this.counter++:"RankAd2"===t?i="mid"+this.counter++:"RankAd3"===t?i="mid"+this.counter++:"RankAd4"===t?i="mid"+this.counter++:"RankAd5"===t?i="mid"+this.counter++:"RankAd6"===t?i="mid"+this.counter++:"RankAd7"===t?i="mid"+this.counter++:"RankAd8"===t?i="mid"+this.counter++:"lede-ad"===t?i="mid"+this.counter++:t.match(/stream-ad-story-id/g)?i="mid"+this.counter++:"supplemental-ad-2"===t?i="mktg":"SupportedBy"===t?i="sponsM":"Spon1"===t?i="pencil":t.match(/paid-post/g)?i="instream":"Interstitial"===t?i="ints":"featprop1"===t?i="feat1":"featprop2"===t&&(i="feat2"),i&&e.setTargeting("pos",i)},handleSearchTabClick:function(e){var t="search"===e?"lede-ad-search":"lede-ad";"search"===e&&this.dfp.$html.find("#lede-ad-search").is(":empty")?this.dfp.requestDynamicAd("lede-ad-search",[[300,250],[300,600]]):this.dfp.broadcastAdEvent("refresh",t,!0)},handleSavedCollection:function(){"saved"===this.dfp.pageManager.getMeta("nyt-collection:type")&&(this.dfp.removePlacementSize("TopAd",[970,90]),this.dfp.removePlacementSize("TopAd",[970,250]),this.dfp.removePlacementSize("TopAd",[970,66]))},handleRealestateCollection:function(){"realestate"===this.dfp.pageManager.getMeta("nyt-collection:identifier")&&(this.dfp.removePlacement("lede-ad"),this.dfp.removePlacement("lede-ad-search"),this.dfp.removePlacement("supplemental-ad-2"),this.dfp.$html.find("#lede-ad-search").remove())},handleAdditionalAds:function(t){var i=this.dfp.pageManager.getViewport().width,n=t.element,s=n.attr("id"),a=n.offset().top,o=t.parentId,r="stream-ad-"+s,l=e("<aside></aside>",{id:r,"class":"ad stream-ad",style:"top:"+a+"px"});i>=1020&&a>1e3&&(e("#"+o+" > .supplemental").append(l),this.dfp.broadcastAdEvent("queue-placement",r,[[300,250],[300,600]]))},handlePaidPost:function(e){var t=e.element;this.dfp.broadcastAdEvent("queue-placement",t.attr("id"),"fluid")}};return i}),define("collection/instances/ads",["foundation/views/page-manager","shared/adlibrary/views/dfp","shared/adlibrary/views/adx","collection/views/adlibrary/placements/adx-placements-mixin","collection/views/adlibrary/placements/dfp-placements-mixin","collection/views/adlibrary/requirements/dfp-collection-requirements-mixin"],function(e,t,i,n,s,a){"use strict";var o;return new i({placements:n}),o=new t({placements:s,requirements:a})}),define("shared/page/helpers/page-mixin",["jquery/nyt"],function(e){"use strict";var t={handleSwipe:function(e){this.broadcast("nyt:app-swipe",e,e.gesture.direction)},handleSwipeStartEnd:function(e){var t="swipestart"===e.type?"start":"end";this.broadcast("nyt:app-swipe",e,t)},handleDrag:function(t){!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,t.gesture.direction)},handleDragStartEnd:function(t){var i="dragstart"===t.type?"start":"end";!t||e(t.srcElement).closest(".slideshow").length>0||this.broadcast("nyt:app-drag",t,i)},truncateCaptionText:function(){var t=this;this.$el.find("figure").each(function(){var i,n,s=88,a=e(this);a.hasClass("layout-small-vertical")||a.hasClass("layout-small-horizontal")||a.hasClass("has-adjacency layout-large-horizontal")?(n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,s,!0)):a.hasClass("layout-large-horizontal")?(i=a.find("img").height()-s,n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,i,!0)):a.hasClass("photo")&&a.hasClass("inline")&&(n=a.find(".caption-text"),n>=1&&n.html().indexOf("<")<0&&t.truncateText(n,s,!0))})}};return t}),define("shared/page/views/app",["underscore/nyt","jquery/nyt","foundation/views/base-view","shared/page/helpers/page-mixin"],function(e,t,i,n){"use strict";var s=i.extend(n).extend({el:"#main",events:{dragleft:"handleDrag",dragright:"handleDrag",dragstart:"handleDragStartEnd",dragend:"handleDragStartEnd"}});return s}),define("shared/page/instances/app",["shared/page/views/app"],function(e){"use strict";new e}),define("shared/messaging/templates",["underscore/nyt"],function(_){var templates={};return templates.followButton=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button class="button follow-button '+(null==(__t=classes)?"":__t)+'">\n<i class="icon sprite-icon"></i>\n<span class="button-text">'+(null==(__t=buttonText)?"":__t)+"</span>\n</button>";return __p},templates.followConfirmation=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="message message-unfollow-confirmation" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n',thumb&&(__p+='\n<div class="thumb">\n<img src="'+(null==(__t=thumb)?"":__t)+'" />\n</div>\n'),__p+='\n<div class="message-content">\n<p class="message-title">'+(null==(__t=unfollowText)?"":__t)+' <span class="collection-name">'+(null==(__t=following)?"":__t)+'</span>?</p>\n<div class="button-container">\n<button class="button unfollow-button"><i class="icon sprite-icon"></i>'+(null==(__t=confirmText)?"":__t)+'</button>\n<button class="button keep-following-button">'+(null==(__t=abortText)?"":__t)+"</button>\n</div>\n</div>\n</div>";return __p},templates.followInfo=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="follow-info '+(null==(__t=followClass)?"":__t)+'">\n',thumb?__p+='\n<div class="thumb '+(null==(__t=type)?"":__t)+'">\n<img src="'+(null==(__t=thumb)?"":__t)+'" alt="" role="presentation"/>\n</div>\n':thumbClass&&(__p+='\n<div class="thumb">\n<i class="'+(null==(__t=thumbClass)?"":__t)+'"></i>\n</div>\n'),__p+='\n<h4 class="collection-name">'+(null==(__t=following)?"":__t)+'</h4>\n<p class="description">'+(null==(__t=description)?"":__t)+"</p>\n</div>";return __p},templates.followUnfollowed=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",__p+=message_type?'\n<div class="message message-unfollow-confirmed message-comment-'+(null==(__t=message_type)?"":__t)+'" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n':'\n<div class="message message-unfollow-confirmed" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n',__p+="\n<div class=\"message-content\">\n<p class='message-title'>"+(null==(__t=confirmedText)?"":__t)+" <span class='collection-name'>"+(null==(__t=following)?"":__t)+"</span>. <button class='button undo-action-button'>Undo</button></p>\n</div>\n</div>";return __p},templates.message=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+="",closeButton&&(__p+='\n<button class="button close-message">\n<i class="icon"></i>\n<span class="visually-hidden">Close alert</span>\n</button>\n'),__p+="",sub_type&&(sub_type=sub_type.replace(/([A-Z])/g,"-$1").toLowerCase(),"-"===sub_type.charAt(0)&&(sub_type=sub_type.substr(1))),__p+='<div class="message '+(null==(__t=sub_type)?"":__t)+'" data-messageId="'+(null==(__t=id)?"":__t)+'"><i class="icon sprite-icon"></i>',label&&(__p+='\n<span class="label">'+(null==(__t=label)?"":__t)+"</span>\n"),__p+='<span class="message-content">\n<span class="message-title">'+(null==(__t=formattedTitle)?"":__t)+"</span>\n",buttons.length>0){__p+="\n";for(var i=0;i<buttons.length;i++)buttons[i].url&&(__p+='\n<a href="'+(null==(__t=buttons[i].url)?"":__t)+'" class="button message-button action-button">'+(null==(__t=buttons[i].text)?"":__t)+"</a>\n");__p+="\n"}if(__p+="\n",1===display_type_id&&start_time){var minutes,hours,formatted,date=new Date(1e3*start_time);hours=date.getHours(),minutes=date.getMinutes(),minutes=9>=minutes?"0"+minutes:minutes,ampm=hours>=12?"PM":"AM",hours=hours>12?hours-12:hours,formatted=""+hours+":"+minutes+" "+ampm,__p+='\n<span class="timestamp">\n'+(null==(__t=formatted)?"":__t)+"\n</span>\n"}__p+="\n",4===display_type_id&&(__p+="\n<a href='#' class=\"close-message\">"+(null==(__t=payload.dsm_cpy)?"":__t)+"</a>\n"),__p+="\n</span></div>"}return __p},templates.messenger=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="message-bed"></div>';return __p},templates.notificationModals=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",__p+=message_type?'\n<div class="message comment-'+(null==(__t=message_type)?"":__t)+'-message">\n':'\n<div class="message">\n',__p+="\n",__p+=link?'\n<a href="'+(null==(__t=link)?"":__t)+'">\n':"\n<a class='link-to-panel' href=\"#\">\n",__p+="\n"+(null==(__t=emphasize(title,emphasis))?"":__t)+'\n</a>\n<span class="message-metadata">\n',timestamp&&(__p+='\n<time class="timestamp" datetime="'+(null==(__t=timestamp)?"":__t)+'">'+(null==(__t=this.prettyDate(1e3*timestamp)||"Just now")?"":__t)+"</time>\n"),__p+="\n</span>\n</div>";return __p},templates.notificationsModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="","default"===show?__p+='\n<div class="message-container">\n<div class="message message-default">\n<div class="message-content">\n<p class="message-title">You have no new notifications.</p>\n<p>Follow columns and be notified when new articles are published.</p>\n</div>\n<div class="follow-suggestions"></div>\n</div>\n</div>\n':(__p+="\n",__p+=message_type?'\n<div class="message message-comment-'+(null==(__t=message_type)?"":__t)+'" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n':'\n<div class="message" data-timestamp="'+(null==(__t=timestamp)?"":__t)+'">\n',__p+="\n",display_type_id>=unfollowThreshold&&(__p+='\n<button class="button unsubscribe-button" title="'+(null==(__t=unfollowText)?"":__t)+" "+(null==(__t=following)?"":__t)+'"><i class="icon sprite-icon"></i></button>\n'),__p+="\n",link&&(__p+='\n<a class="message-link" href="'+(null==(__t=link)?"":__t)+'">\n'),__p+="\n",thumb&&5!==display_type_id&&(__p+='\n<div class="thumb"><img src="'+(null==(__t=thumb)?"":__t)+'" /></div>\n'),__p+='<div class="message-content">\n<p class="message-title">'+(null==(__t=formattedTitle)?"":__t)+"</p>\n",
5===display_type_id&&comment_body&&(__p+='\n<div class="comment-excerpt">\n',display_name&&"replied"===message_type&&(__p+='\n<div class="commenter">\n<p class="commenter-name">'+(null==(__t=display_name)?"":__t)+"</p>\n",location&&(__p+='\n<p class="commenter-location">'+(null==(__t=location)?"":__t)+"</p>\n"),__p+="\n</div>\n"),__p+='\n<p class="comment-text" data-truncate="true">'+(null==(__t=comment_body)?"":__t)+"</p>\n</div>\n"),__p+="\n",5===display_type_id&&(__p+='\n<i class="icon sprite-icon"></i>\n'),__p+="\n",timestamp&&(__p+='\n<time class="timestamp" datetime="'+(null==(__t=timestamp)?"":__t)+'">'+(null==(__t=this.prettyDate(1e3*timestamp)||"Just now")?"":__t)+"</time>\n"),__p+="\n</div>\n",link&&(__p+="</a>"),__p+="\n</div>\n"),__p+="";return __p},templates.onboardingFirstFollow=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="prompt"><strong>You are following '+(null==(__t=collectionName)?"":__t)+".</strong> Every time a new "+(null==(__t=collectionName)?"":__t)+" article is published, you will receive an alert in your notifications panel in the top right corner of your screen.</p>";return __p},templates.onboardingIntroducingNotifications=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<p class="prompt"><strong>Introducing the notifications panel.</strong> Follow columns and receive an alert when new articles are published.</p>';return __p},templates.onboardingSuggestFollow=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="prompt"><strong>Follow '+(null==(__t=collectionName)?"":__t)+"</strong> and receive an alert when a new article is published.</p>";return __p},templates}),define("shared/messaging/views/messenger-format-mixin",["underscore/nyt"],function(e){"use strict";var t={emphasizeTitle:function(t,i){var n,s,a,o,r,l,d,c=[],h=[],u=0,g=t.length;if(!i||0===i.length)return t;for(s=e.sortBy(i,function(e){return e.offset});s.length>0;){if(o=s.shift(),r=o.offset+o.count,l=o.offset,u>l||r>g)return t;l===u&&c.length>0?(a=c.pop(),a+=t.slice(l,r),c.push(a),u=r):(l>u&&c.push(t.slice(u,l)),c.push(t.slice(l,r)),d={index:c.length-1,treatment:o.treatment,url:o.url},h.push(d),u=r),0===s.length&&u!==g&&c.push(t.slice(r))}return e.each(h,function(e){var t=e.index,i=e.treatment;e.url?c[t]='<a class="link action-link" href="'+e.url+'""><span class="'+i+'">'+c[t]+"</span></a>":c[t]='<span class="'+i+'">'+c[t]+"</span>"}),n=c.join("")}};return t}),define("shared/messaging/views/message",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/templates","shared/messaging/views/messenger-format-mixin"],function(e,t,i,n,s){"use strict";var a=i.registerView("messaging").extend({className:"message-container hidden",events:{"click .close-message":"dismissed","click .action-button":"acknowledged","click .action-link":"acknowledged"},defaults:{closeButton:!0,dismissAcknowledged:!0,hiddenClass:"hidden",revealClass:"",show:function(){this.$el.removeClass(this.settings.hiddenClass).addClass(this.settings.revealClass)},hide:function(){this.$el.removeClass(this.settings.revealClass).addClass(this.settings.hiddenClass)}},initialize:function(e){this.settings=t.extend({},this.defaults,e),this.template=n[this.settings.template],this.subscribe("nyt:messaging-modal-"+this.model.id+"-dismissed",this.popupDismissed),this.subscribe("nyt:messaging-modal-"+this.model.id+"-acknowledged",this.popupAcknowledged),this.subscribe(this,"nyt:messaging-message-expired",this.expired)},render:function(){var e=this;return this.$el.html(e.template(t.extend(e.model.toJSON(),e.settings,{formattedTitle:this.getFormattedTitle(),unfollowThreshold:this.pageManager.flag("unfollowComments")?5:6}))).addClass(this.settings.hiddenClass).data("id",e.model.get("id")),!e.model.get("links")||e.model.isNotificationsPanelMessage()||e.pageManager.flag("allTheEmphases")||this.insertLinks(),e.model.get("unread")?e.$el.find(".message").addClass("is-unread"):e.$el.find(".message").addClass("is-read no-transition"),this},replaceBetween:function(e,t,i,n){return n.substring(0,e)+i+n.substring(t)},insertLinks:function(){var e,t,i,n,s,a,o,r=this.$el.find(".message-title"),l=r.html(),d=this.model.get("links");for(d.length>1&&d.sort(function(e,t){return t.start-e.start}),o=0;o<d.length;o++)if(e=d[o].offset,i=d[o].count,n=decodeURI(d[o].url),e+i&&(t=e+i),n&&"null"!==n)if("undefined"!=typeof e&&"undefined"!=typeof t){if(d[o-1]&&t>d[o-1].start)break;s=l.substring(e,t),a='<a class="action-link" href="'+n+'">'+s+"</a>",l=this.replaceBetween(e,t,a,l)}else l='<a class="action-link" href="'+n+'">'+l+"</a>";r.html(l)},getFormattedTitle:function(){var e=this.model.getCombinedEmphasis(),t=this.model.get("title"),i=s.emphasizeTitle(t,e),n=this.model.get("links")[0];return this.pageManager.flag("allTheEmphases")?this.model.isNotificationsPanelMessage()||!n||n.count?i:'<a class="action-link" href="'+n.url+'" >'+i+"</a>":this.model.isNotificationsPanelMessage()?i:t},reveal:function(e){e?this.settings.show.call(this):this.settings.hide.call(this)},dimensions:function(){return{width:this.$el.outerWidth(),height:this.$el.outerHeight()}},displayed:function(e){e=e||0,this.markRead(e),this.model.displayed()},markRead:function(e){var t=this.$el.find(".message"),i=this;e=void 0!==e?e:1500,t.hasClass("is-unread")&&window.setTimeout(function(){i.model.isNotificationsPanelMessage()&&i.broadcast("nyt:messaging-count-received",-1),t.removeClass("is-unread").addClass("is-read")},e)},showOnce:function(){this.model.showOnce()},acknowledged:function(t){var i=e(t.currentTarget).attr("href");t.preventDefault(),this.settings.dismissAcknowledged&&this.model.acknowledged(),this.local(this,"nyt:messaging-message-view-acknowledged",this),i=this.trackingAppendParams(i,{action:"Click",contentCollection:this.model.get("sub_type")||"",contentID:this.model.get("id")}),i!==window.location.href?window.location.href=i:window.location.reload()},expired:function(){this.model.expired(),this.local(this,"nyt:messaging-message-view-expired",this)},dismissed:function(e){this.model.dismissed(),this.local(this,"nyt:messaging-message-view-dismissed",this),e.preventDefault()},popupDismissed:function(){this.model.setRead(),this.markRead(0)},popupAcknowledged:function(){this.model.setRead(),this.markRead()}});return a}),define("shared/messaging/models/message",["backbone/nyt","underscore/nyt","foundation/models/base-model","foundation/models/page-storage"],function(e,t,i,n){"use strict";var s=i.extend({defaults:{display_type_id:1,id:"",title:"",status:"new",sub_type:"",label:"",pub_date:"",start_time:"",end_time:"",links:[],buttons:[],payload:{},message_type:"",thumb:!1,comment_body:!1,timestamp:!1,location:"",unread:!0,version:1},initialize:function(){var e,t=this.get("display_type_id"),i=this.get("start_time"),n=this.get("version"),s=5===t,a=this.getPrimaryLink();s&&n>1?(e=this.get("last_modified"),this.set("timestamp",e)):this.set("timestamp",i),this.isNotificationsPanelMessage()&&this.set({unfollowText:s?"Stop receiving":"Unfollow",confirmText:s?"Turn off":"Unfollow",abortText:s?"Cancel":"Keep following",confirmedText:s?"You will no longer receive":"You are no longer following"}),s&&this.set({following:"comment notifications",tag:"follow.comment-notifications"}),this.isNotificationsPanelMessage()&&void 0===this.get("popup_unread")&&this.set("popup_unread",!0),a&&this.set("link",a)},showOnce:function(){this.setRead(),this.saveToLocalStorage()},setStatus:function(e){this.set("status",e)},displayed:function(){this.set("unread",!1),this.set("status","displayed")},acknowledged:function(){this.set("unread",!1),this.set("status","acknowledged"),this.saveToLocalStorage()},expired:function(){this.set("unread",!1),this.set("status","expired"),this.saveToLocalStorage()},dismissed:function(){this.set("unread",!1),this.set("status","dismissed"),this.saveToLocalStorage()},getPrimaryLink:function(){var e=this.get("links");return e&&e[0]&&e[0].url?e[0].url:null},applyMetadata:function(e){var t,i,n;e&&(i=e[0],n=e[2],this.set("version",i),this.set("unread",n),e.length>3&&(t=e[3],this.set("popup_unread",t)))},updateProperties:function(e){var t,i,n,s,a=["byline","comment_body","display_name","display_location","emphasis","end_time","following","headline","last_modified","links","sub_type","tag","thumb","timestamp","title","link"];if(e)for(t=0;t<a.length;t+=1)s=a[t],i=this.get(s),n=e.get(s),i!==n&&this.set(s,n)},getCombinedEmphasis:function(){var e,i,n,s,a,o=[],r={},l=this.get("emphasis"),d=this.get("links");if(l&&l.length>0&&void 0!==l[0].offset&&l[0].count&&(r.emphasize=l),d&&d.length>0&&void 0!==d[0].offset&&d[0].count&&(r["link-text"]=d),t.isEmpty(r))return!1;for(e in r)if(n=r[e],n&&n.length>0)for(i=0;i<n.length;i+=1)a=this.isNotificationsPanelMessage()?t.omit(n[i],"url"):n[i],s=t.extend({treatment:e},a),o.push(s);return o},setRead:function(){this.set("unread",!1),this.broadcast("nyt:messaging-message-state-update",this)},setPopupRead:function(){this.set("popup_unread",!1),this.broadcast("nyt:messaging-message-state-update",this)},saveToLocalStorage:function(){var e,t,i,s,a;this.isNotificationsPanelMessage()||(e=this.get("id"),t=this.get("version"),i=(new Date).getTime(),s=n.get("messaging"),a=s?s+","+e:e,t&&(a=a+"-"+t+"-"+i),n.set("messaging",a))},isNotificationsPanelMessage:function(){return this.get("display_type_id")>=5}});return s}),define("shared/messaging/collections/account-alerts",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","shared/messaging/models/message","foundation/hosts","foundation/models/page-storage"],function(e,t,i,n,s,a,o){"use strict";var r=n.extend({model:s,url:a.messagingHost+"/svc/message/v1/me/notifications.json",pageStorageKey:"messaging",defaultSettings:{fauxLongPoll:!1,cachePullDelay:5},initialize:function(e){this.settings=t.extend({},this.defaultSettings,e),t.bindAll(this,"fetch","fetchSuccess"),this.received={},this.statusFragments={},this.lastReceived=!1,this.cachePullOver=!1,this.pageManager.isDomReady()?this.makeHTTPRequest():this.subscribe(this.pageManager,"nyt:page-ready",this.makeHTTPRequest)},makeHTTPRequest:function(){var e=this;this.settings.fauxLongPoll=!0,this.url=a.messagingHost+"/svc/message/v1/me/notifications.json",this.fetch({success:function(t,i){i&&i.results&&(i=i.results.messages),e.fetchSuccess(t,i)}})},sync:function(e,t,n){return n.cache=!1,n.xhrFields={withCredentials:!0},i.sync(e,t,n)},parse:function(e){return e&&e.results?e.results.messages:void 0},fetchSuccess:function(e,i){var n,s,a,o,r,l,d={},c=e||this;if(i&&!t.isArray(i)&&(i=[i]),i)for(n=0,s=i.length;s>n;n+=1)l=this.preprocessMessage(i[n]),l&&(a=l.get("id"),o=l.get("title"),c.add(l),l.get("label")||l.set("label","Account Alert"),r="nyt:messaging-account-alert-received",d[r]=d[r]||[],this.received[a]=o,d[r].push(l));if(t.isEmpty(d))return!1;for(r in d)c.trigger(r,d[r])},preprocessMessage:function(e){var t;return this.cachePullOver||this.checkCachePullEnd(),this.ensureMessageID(e)&&this.interceptFragments(e)&&this.ensureUniqueTitles(e)&&(t=this.handleUpdateableData(e))?this.ensureActive(t):!1},ensureMessageID:function(e){return e.id||e.messageId?e:!1},interceptFragments:function(e){return e.title?e:(this.isExpired(e)||this.updateMessageData(e.messageId,this.extractMessageMetadata(e)),!1)},ensureUniqueTitles:function(e){return this.titleExists(e.title)?!1:e},handleUpdateableData:function(e){return this.settings.fauxLongPoll?new s(e):void 0},ensureActive:function(e){return this.isExpired(e)||this.isInactive(e)||this.isInLocalStorage(e)?!1:e},isExpired:function(e){var t,i=e.get?e.get("end_time"):e.end_time,n=(new Date).getTime();return i?(t=new Date(1e3*i).getTime(),n>t):void 0},titleExists:function(i){var n=t.values(this.received);return e.inArray(i,n)>-1},isInactive:function(e){return e&&e.get?!e.get("unread")&&!e.isNotificationsPanelMessage():!0},unionOfState:function(e,t){var i,n,s=e[1],a=e[0]>t[0]?e[0]:t[0],o=e[2]&&t[2];return e.length>3&&(n=e[3]&&t[3]),i=[a,s,o],void 0!==n&&i.push(n),i},updateMessageData:function(e,t,i){var n,s,a=this.get(e)?this.extractMessageMetadata(this.get(e)):this.statusFragments[e];return a?(s=this.unionOfState(t,a),void(s.toString()!==a.toString()&&(this.get(e)?(n={id:e,update:s,message:i},this.broadcast("nyt:messaging-existing-message-update",n)):this.statusFragments[e]=s))):void(this.statusFragments[e]=t)},isInLocalStorage:function(i){var n=[],s=[],a=o.get(this.pageStorageKey),r=i.get("id").toString();return a?(n=a.split(","),s=t.map(n,function(e){return e.split("-")[0]}),e.inArray(r,s)>-1):!1},extractMessageMetadata:function(e){var t,i=e.version||e.get("version")||1,n=e.display_type_id||e.get("display_type_id"),s=e.get?e.get("unread"):e.unread,a=e.get?e.get("popup_unread"):e.popup_unread;return void 0===s&&(s=!0),t=[i,n,s],void 0!==a&&t.push(a),t},checkCachePullEnd:function(){var e=(new Date).getTime();this.lastReceived||(this.lastReceived=e),e-this.lastReceived>1e3*this.settings.cachePullDelay?(this.cachePullOver=!0,this.broadcast("nyt:messaging-cache-pull-over",e)):this.lastReceived=e}});return r}),define("shared/messaging/instances/account-alerts",["shared/messaging/collections/account-alerts","foundation/views/page-manager"],function(e,t){"use strict";if(!t.$html.hasClass("app-interactive")||!/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))return new e}),define("shared/messaging/collections/messages",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/views/websockets-transport","shared/messaging/models/message","foundation/hosts","foundation/cookies","foundation/models/page-storage"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=n.extend({model:a,url:o.messagingHost+"/svc/message/v1/list/global.json",pageStorageKey:"messaging",defaultSettings:{webSockets:!0,longPoll:!1,fauxLongPoll:!1,interval:10,cachePullDelay:5},initialize:function(e){this.cleanLocalStorage(),this.settings=t.extend({},this.defaultSettings,e),t.bindAll(this,"fetch","fetchSuccess","handleSave","stopSaving"),this.received={},this.serverSaveQueue=[],this.statusFragments={},this.beingProcessed=!1,this.followStarts={},this.lastReceived=!1,this.cachePullOver=!1,this.pageManager.isDomReady()?this.prepareToConnect():this.subscribe(this.pageManager,"nyt:page-ready",this.prepareToConnect),this.subscribe(this,"change:status",this.saveMessageEverywhere),this.subscribe("nyt:messaging-message-state-update",this.saveMessageEverywhere)},prepareToConnect:function(){this.settings.fauxLongPoll=!0,this.settings.webSockets=!1,this.makeHTTPRequest()},initWebSockets:function(){var t=r.readCookie("NYT-S")||"";s.registerClient({name:"messaging",collection:this,fabrikApp:"hermes.push",cookies:{"nyt-s":t},handleMessage:this.handleMessage,notifyOnError:e.noop,handleFailover:this.switchToHTTP})},makeHTTPRequest:function(){var e=this;this.url=o.messagingHost+"/svc/message/v1/list/global.json",this.fetch({success:function(t,i){i&&i.results&&(i=i.results.messages),e.fetchSuccess(t,i)},error:function(){}})},switchToHTTP:function(e){e.settings.fauxLongPoll=!0,e.settings.webSockets=!1,e.stopSaving(),e.makeHTTPRequest()},sync:function(e,t,n){return this.settings.longPoll?(n.timeout=2e3,i.sync(e,t,n)):(n.cache=!1,i.sync(e,t,n))},parse:function(e){return e&&e.results?e.results.messages:void 0},handleMessage:function(e,t){var i;t.websocketConnected||t.handleSave(),e.body&&(i=JSON.parse(e.body),t.fetchSuccess(t,i))},fetchSuccess:function(e,i){var n,s,a,o,r,l,d={},c=e||this;if(i&&!t.isArray(i)&&(i=[i]),i)for(n=0,s=i.length;s>n;n+=1)l=this.preprocessMessage(i[n]),l&&(a=l.get("id"),o=l.get("title"),c.add(l),r=this.categorizeMessage(l),d[r]=d[r]||[],this.received[a]=o,d[r].push(l));if(this.settings.fauxLongPoll&&window.setTimeout(function(){c.makeHTTPRequest()},1e3*c.settings.interval),t.isEmpty(d))return!1;for(r in d)c.trigger(r,d[r])},preprocessMessage:function(e){var t;return this.cachePullOver||this.checkCachePullEnd(),this.interceptFollows(e)&&this.ensureMessageID(e)&&this.interceptFragments(e)&&this.ensureUniqueTitles(e)&&(t=this.handleUpdateableData(e))?this.ensureActive(t):!1},interceptFollows:function(e){return e.follows?(t.isEmpty(this.followStarts)&&(this.followStarts=e.follows),this.broadcast("nyt:messaging-follow-data-received",e.follows),!1):e},ensureMessageID:function(e){return e.id||e.messageId?e:!1},interceptFragments:function(e){return e.title?e:(this.isExpired(e)||this.updateMessageData(e.messageId,this.extractMessageMetadata(e)),!1)},ensureUniqueTitles:function(e){return 5!==e.display_type_id&&this.titleExists(e.title)?!1:e},handleUpdateableData:function(e){var t,i,n;if(this.settings.fauxLongPoll)return new a(e);if(this.statusFragments[e.id]?(t=this.statusFragments[e.id],delete this.statusFragments[e.id]):this.get(e.id)&&(t=this.extractMessageMetadata(this.get(e.id))),t){if(i=this.extractMessageMetadata(e),n=this.unionOfState(t,i),n.toString()===t.toString()&&this.get(e.id))return!1;if(e=new a(e),this.get(e.id))return this.updateMessageData(e.id,n,e),!1;e.applyMetadata(n)}return e=e.get?e:new a(e)},ensureActive:function(e){return this.isExpired(e)||this.isInactive(e)||this.isInLocalStorage(e)||this.isBeforeSubscribed(e)?!1:e},categorizeMessage:function(e){var t,i=e.get("display_type_id");switch(i){case 1:e.get("label")||e.set("label","Breaking News"),t="nyt:messaging-breaking-news-received";break;case 2:e.get("label")||e.set("label","Account Alert"),t="nyt:messaging-account-alert-received";break;case 3:e.get("label")||e.set("label","Live Video"),t="nyt:messaging-video-received";break;case 4:t="nyt:messaging-velcro-received";break;case 5:t="nyt:messaging-notification-received";break;case 6:t="nyt:messaging-follow-notice-received";break;default:t="nyt:messaging-message-received"}return t},isExpired:function(e){var t,i=e.get?e.get("end_time"):e.end_time,n=(new Date).getTime();return i?(t=new Date(1e3*i).getTime(),n>t):void 0},titleExists:function(i){var n=t.values(this.received);return e.inArray(i,n)>-1},isInactive:function(e){return e&&e.get?!e.get("unread")&&!e.isNotificationsPanelMessage():!0},isBeforeSubscribed:function(e){var t,i=e.get("tag");return(this.pageManager.flag("unfollowComments")||5!==e.get("display_type_id"))&&e.isNotificationsPanelMessage()?(i&&(t=this.followStarts[i]),t&&t.start?t.start>e.get("start_time"):!0):!1},handleSave:function(){var e;for(this.websocketConnected=!0;this.serverSaveQueue.length>0;)e=this.serverSaveQueue.shift(),this.saveMessageToFabrik(e)},stopSaving:function(){this.websocketConnected=!1},unionOfState:function(e,t){var i,n,s=e[1],a=e[0]>t[0]?e[0]:t[0],o=e[2]&&t[2];return e.length>3&&(n=e[3]&&t[3]),e[0]!==t[0]&&5===s&&(o=!0),i=[a,s,o],void 0!==n&&i.push(n),i},updateMessageData:function(e,t,i){var n,s,a=this.get(e)?this.extractMessageMetadata(this.get(e)):this.statusFragments[e];return a?(s=this.unionOfState(t,a),void(s.toString()!==a.toString()&&(this.get(e)?(n={id:e,update:s,message:i},this.broadcast("nyt:messaging-existing-message-update",n)):this.statusFragments[e]=s))):void(this.statusFragments[e]=t)},isInLocalStorage:function(i){var n=[],s=[],a=l.get(this.pageStorageKey),o=i.get("id").toString();return a?(n=a.split(","),s=t.map(n,function(e){return e.split("-")[0]}),e.inArray(o,s)>-1):!1},cleanLocalStorage:function(){var e,t,i,n,s,a,o,r=l.get(this.pageStorageKey);if(r)for(e=r.split(","),i=0;i<e.length;i++)t=e[i],n=t.split("-")[2],s=(new Date).getTime(),n&&(a=(s-n)/1e3,o=Math.floor(a/86400),o>7&&this.deleteInLocalStorage(t))},deleteInLocalStorage:function(e){var t=l.get(this.pageStorageKey),i=new RegExp(e+",?"),n=t.replace(i,"");l.set(this.pageStorageKey,n)},saveMessageEverywhere:function(e){e&&(this.websocketConnected?this.saveMessageToFabrik(e):this.serverSaveQueue.push(e))},saveMessageToFabrik:function(e){var t,i=e.get("popup_unread"),n=e.get("display_type_id"),a=6===n;(this.allowedToSend(e)||!this.pageManager.flag("limitFabrikSave"))&&(t={status:e.get("status"),messageId:e.get("id"),version:e.get("version")||1,date:(new Date).getTime(),start_time:e.get("start_time"),end_time:e.get("end_time"),display_type_id:n,unread:e.get("unread")},a&&(t.tag=e.get("tag")),void 0!==i&&(t.popup_unread=i),this.settings.webSockets&&s.publish({action:"send",client_app:"hermes.push",message:t}))},extractMessageMetadata:function(e){var t,i=e.version||e.get("version")||1,n=e.display_type_id||e.get("display_type_id"),s=e.get?e.get("unread"):e.unread,a=e.get?e.get("popup_unread"):e.popup_unread;return void 0===s&&(s=!0),t=[i,n,s],void 0!==a&&t.push(a),t},allowedToSend:function(e){var t=e.get("display_type_id");return 4===t||5===t||6===t?!0:!1},checkCachePullEnd:function(){var e=(new Date).getTime();this.lastReceived||(this.lastReceived=e),e-this.lastReceived>1e3*this.settings.cachePullDelay?(this.cachePullOver=!0,this.broadcast("nyt:messaging-cache-pull-over",e)):this.lastReceived=e}});return d}),define("shared/messaging/instances/messages",["shared/messaging/collections/messages","foundation/views/page-manager"],function(e,t){"use strict";if(!t.$html.hasClass("app-interactive")||!/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))return new e}),define("shared/messaging/views/messenger-mixin",["jquery/nyt","underscore/nyt","shared/messaging/views/message","shared/messaging/instances/account-alerts","shared/messaging/instances/messages","shared/messaging/templates"],function(e,t,i,n,s,a){"use strict";var o={template:a.messenger,mixinSettings:{id:null,notifyWhen:null,messageType:null,parent:null,template:"message",newestFirst:!0,closeButton:!0,expiration:!1,animationSpeed:200,expirationAfterPause:null,fadeOutDelay:1500,dismissAcknowledged:!0,trackingVersion:""},events:{"click .action-link":"trackLinkClicks","click .action-button":"trackLinkClicks"},initialize:function(e){this.options=t.extend({},this.mixinSettings,this.defaultSettings,e),this.subscribe(this,"nyt:messaging-message-rendered",this.afterMessageReceived),this.subscribe(this,"nyt:messaging-message-removed",this.afterMessageRemoved),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed nyt:messaging-message-cleared",this.addLastMessageClass),this.subscribe(this,"nyt:messaging-message-"+this.options.id+"-displayed",this.trackImpressions),this.delegateEvents(),this.accountAlertsCollection=n,this.collection=s,this.active={messages:{}},this.notActive={messages:{}},this.received={messages:{}},this.newestTime=0,this.oldestTime=1/0,this.pageManager.isDomReady()?this.render():this.subscribe(this.pageManager,"nyt:page-ready",this.render),this.trackingBaseData={module:"Notification",version:this.options.trackingVersion,region:"FixedTop"},this.local(this,"nyt:messaging-messenger-initialized")},render:function(){return this.$parent=this.options.parent?this.options.parent():this.$body,this.rendered||(this.$el.hide().addClass(this.options.id).append(this.template(this.options)),this.$parent.prepend(this.$el),this.rendered=!0,this.local(this,"nyt:messaging-messenger-rendered"),this.prepareView(),this.accountAlertsCollection&&this.subscribe(this.accountAlertsCollection,this.options.notifyWhen,this.notify),this.collection&&this.subscribe(this.collection,this.options.notifyWhen,this.notify)),this},notify:function(i){var n,s,a=this,o=[];t.each(i||[],function(e){s=e.get("id"),s&&o.push(e)}),n=o.length>0?function(){a.createMessageViews(o)}:e.noop,this.pageManager.isDomReady()?n():this.subscribe(this.pageManager,"nyt:page-ready",t.debounce(n,0))},createMessageViews:function(e){return e&&t.each(e||[],function(e){var t;t=new i({model:e,template:this.options.template,closeButton:this.options.closeButton,dismissAcknowledged:this.options.dismissAcknowledged}),this.subscribe(t,"nyt:messaging-message-view-expired",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.removeMessage),this.subscribe(t,"nyt:messaging-message-view-dismissed",this.trackDismissal),this.addMessage(t)},this),this},addMessage:function(t){var i,n,s,a,o,r,l,d,c,h,u,g;if(t){if(i=t.model.get("id"),n=!0,s=this.options.newestFirst?"prepend":"append",u=t.render().$el,g=this.$(".message-bed"),this.received.messages[i]=t,this.active.messages[i]=t,a=this.countMessages(),this.options.newestFirst&&(o=t.model.get("timestamp"),o>this.newestTime&&(this.newestTime=o),o<this.oldestTime&&(this.oldestTime=o),o<=this.oldestTime?s="append":o<this.newestTime&&(n=!1)),n)g[s](u);else for(r=this.$(".message-bed").find(".message-container"),d=r.length-1,l=d;-1!==l;l-=1)if(h=e(r[l]),c=h.find(".message").data("timestamp"),c>o){h.after(u);break}t.$el.data("messageId",i),this.local(this,"nyt:messaging-message-rendered",t,a)}},removeMessage:function(e){var t,i;e&&(t=e.model.get("id"),this.notActive.messages[t]=e,this.active.messages[t]&&delete this.active.messages[t],i=this.countMessages(),this.local(this,"nyt:messaging-message-removed",e,i))},addLastMessageClass:function(){this.$(".message-container").removeClass("last-message-container").last().addClass("last-message-container")},dimensions:function(){return{width:this.$el.find(".message-bed").outerWidth(!0),height:this.$el.find(".message-bed").outerHeight(!0)}},countMessages:function(){return t.size(this.active.messages)},trackImpressions:function(e){var t,i;e=e||"",t=this.received.messages[e],i=this.getcontentCollection(t)||"",this.trackingTriggerImpression("messaging-impression",{action:"Impression",contentCollection:i,eventName:"Impression",contentID:e})},trackDismissal:function(e){var t=e.model.get("id"),i=this.getcontentCollection(e);this.trackingTrigger("messaging-dismissal",{action:"Click",contentCollection:i,eventName:"DismissNotification",contentID:t})},trackLinkClicks:function(t){var i=e(t.currentTarget),n=i.parents(".message-container").data("messageId"),s=this.received.messages[n],a=this.getcontentCollection(s),o=this.trackingAppendParams(i.attr("href"),{action:"Click",contentCollection:a,contentID:n});i.attr("href",o)},getcontentCollection:function(e){return e.model.get("sub_type")?e.model.get("sub_type"):""}};return o}),define("shared/messaging/views/move-furniture-mixin",["jquery/nyt"],function(e){"use strict";var t={moveFurniture:function(t,i,n){var s,a,o,r=this,l=this.options.animationSpeed||200;"add"===i?s="+="+t:"subtract"===i&&(s="-="+t),a=function(e){e.animate({marginTop:s},l)},o=function(t){t.promise().done(function(){e(this).css({marginTop:s})})},n?(this.$el.promise().done(function(){e(this).css("height",s),r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.messagesHeight=this.dimensions().height,this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",o,s,this)):(this.$el.animate({height:s},l,function(){r.messagesHeight=r.dimensions().height,r.broadcast("nyt:messaging-"+r.options.messageType+"-after")}),this.broadcast("nyt:messaging-"+this.options.messageType+"-move-furniture",a,s,this))}};return t}),define("shared/messaging/views/critical-alerts",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin"],function(e,t,i,n,s){"use strict";var a=i.registerView("messaging").extend(t.extend({},s,n,{defaultSettings:{messageType:"critical-alerts",parent:function(){return 0===e("#critical-alerts").length&&e("body").prepend('<div id="critical-alerts"></div>'),e("#critical-alerts")}},prepareView:function(){this.messagesHeight=0,this.$el.addClass("alerts"),this.$el.parent("#critical-alerts").addClass("critical-alerts messenger"),this.$el.css("height","0")},afterMessageReceived:function(e,t){var i,n=0;e&&t>0&&(this.broadcast("nyt:messaging-message-"+this.options.id+"-received",e,this),1===t&&(n+=this.openMessenger()),e.reveal(!0),e.displayed(),n+=e.dimensions().height,this.moveFurniture(n,"add"),i=e.model.get("id"),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",i),this.createMessageClone(e),this.alignMessages(),this.options.expiration&&this.startTimer(e))},startTimer:function(e){var t;window.setTimeout(function(){t=e.model.get("status"),t&&"dismissed"!==t&&"expired"!==t&&e.trigger("nyt:messaging-message-expired")},60*this.options.expiration*1e3)},openMessenger:function(){var e;return this.$el.show(),this.$el.find(".message-bed").show(),e=this.dimensions().height,this.subscribe(this.pageManager,"nyt:page-resize",this.handleWindowResize),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this),e},afterMessageRemoved:function(e,t){var i=0;e&&null!==t&&(i+=e.dimensions().height,e.$el.hide(),this.local(this,"nyt:messaging-message-cleared"),0===t&&(i+=this.closeMessenger()),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.moveFurniture(i,"subtract",!0))},closeMessenger:function(){var t=this.dimensions().height,i=this;return this.$el.hide(),this.$el.find(".message-bed").hide(),this.stopListening(this.pageManager,"nyt:page-resize"),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this),this.$el.promise().done(function(){e(this).siblings(".alerts").is(":hidden")&&i.broadcast("nyt:messaging-message-"+i.options.messageType+"-closed",i)}),t},createMessageClone:function(e){e.$el.find(".message").clone().addClass("hidden-message").wrapInner('<div class="message-wrap" />').appendTo(e.$el)},handleWindowResize:function(){var e,t,i,n=this;this.$el.promise().done(function(){t=n.dimensions().height,i=n.messagesHeight,t>i?(e=t-i,n.moveFurniture(e,"add",!0),n.messagesHeight=t):i>t&&(e=i-t,n.moveFurniture(e,"subtract",!0),n.messagesHeight=t),n.alignMessages()})},maxMessageWidth:function(){var e=this.$(".message-container").width();this.$(".message:not(.hidden-message)").css({"max-width":e+"px"})},alignMessages:function(){var e=0,i=this.active.messages;t.size(i)>0&&(t.each(i,function(t){var i=t.$el.find(".hidden-message .message-wrap").outerWidth();i>e&&(e=i)}),this.$el.find(".message:not(.hidden-message)").css({width:e+2+"px"}),this.maxMessageWidth())}}));return a}),define("shared/messaging/views/suggestions",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/views/move-furniture-mixin"],function(e,t,i,n,s){"use strict";var a=i.registerView("messaging").extend(t.extend({},s,n,{nytEvents:{"nyt:masthead-storytheme":"toggleTheme","nyt:masthead-contenttheme":"toggleTheme","nyt:messaging-message-breaking-news-alerts-received":"hideMessenger","nyt:messaging-message-account-alerts-received":"hideMessenger"},defaultSettings:{messageType:"suggestions",closeButton:!1,trackingVersion:"Velcro"},prepareView:function(){this.messagePresent=!1,this.stayHidden=!1,this.$el.addClass("messenger"),this.$el.css("height","0")},afterMessageReceived:function(t){var i,n,s=e("#account-alerts"),a=e("#breaking-news-alerts"),o=e("#masthead");t&&this.$el.is(":hidden")&&s.is(":hidden")&&a.is(":hidden")&&(this.stayHidden||this.messagePresent||(t.reveal(!0),t.displayed(),t.showOnce(),this.messagePresent=!0,o.hasClass("theme-in-story")||(this.openMessenger(),i=this.dimensions().height,this.moveFurniture(i,"add"),n=t.model.get("id"),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",n))))},openMessenger:function(){this.$el.show(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){var t=this.dimensions().height;e&&(e.$el.hide(),this.moveFurniture(t,"subtract",!0),this.broadcast("nyt:messaging-message-"+this.options.id+"-closed",e,this),this.closeMessenger())},closeMessenger:function(){this.$el.hide(),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-closed",this)},hideMessenger:function(){var e=this.dimensions().height;this.$el.is(":visible")&&(this.$el.hide(),this.moveFurniture(e,"subtract",!0)),this.broadcast("nyt:messaging-message-"+this.options.id+"-hidden",this),this.stayHidden=!0},showMessenger:function(){var e=this.dimensions().height;this.moveFurniture(e,"add"),this.broadcast("nyt:messaging-message-"+this.options.id+"-shown",this),this.$el.show()},toggleTheme:function(t){var i,n=e("#account-alerts"),s=e("#breaking-news-alerts"),a=t?"hide":"show";
"hide"===a&&this.$el.is(":visible")?(i=this.dimensions().height,this.moveFurniture(i,"subtract",!0),this.$el.addClass("theme-changed"),this.$el.hide()):"show"===a&&this.$el.is(":hidden")&&n.is(":hidden")&&!this.stayHidden&&this.messagePresent&&n.is(":hidden")&&s.is(":hidden")&&(this.$el.show(),i=this.dimensions().height,this.moveFurniture(i,"add",!0),this.$el.removeClass("theme-changed")),this.broadcast("nyt:messaging-message"+this.options.id+a,i,this)}}));return a}),define("shared/messaging/views/announcements",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin"],function(e,t,i,n){"use strict";var s=i.registerView("messaging").extend(t.extend({},n,{nytEvents:{"nyt:page-resize":"adjustWidth"},defaultSettings:{messageType:"announcements",parent:function(){return e("#masthead").find(".container")},animationSpeed:400,expiration:30,expirationAfterPause:3,trackingVersion:"LiveVideo"},prepareView:function(){var e=this,t=1e3*this.options.expirationAfterPause;this.messagePresent=!1,this.timer=null,this.currentMessageId=null,this.widthDiff=45,this.$el.addClass("messenger"),this.adjustWidth(),this.$el.on("mouseenter",function(){e.clearTimer()}),this.$el.on("mouseleave",function(){e.startTimer(t)})},afterMessageReceived:function(e){var t=e.model.get("id"),i=this,n=1e3*this.options.expiration;e&&(this.messagePresent?window.setTimeout(function(){i.afterMessageReceived(e)},n):(e.reveal(!0),e.displayed(),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",t),this.messagePresent=!0,this.openMessenger(),this.currentMessageId=t,this.startTimer(n)))},startTimer:function(e){var t=this.currentMessageId,i=this.active.messages[t],n=function(){i&&i.trigger("nyt:messaging-message-expired")};e=e||5e3,this.timer=window.setTimeout(n,e)},clearTimer:function(){window.clearTimeout(this.timer)},openMessenger:function(){var e=this.options.animationSpeed||500;this.$el.stop(!0).show().animate({top:0},e),this.broadcast("nyt:messaging-messenger-"+this.options.id+"-opened",this)},afterMessageRemoved:function(e){e&&this.closeMessenger(e)},closeMessenger:function(t){var i=this.dimensions().height,n=this.options.animationSpeed||500,s=this;t&&this.$el.stop(!0).animate({top:"-"+i},n,function(){e(this).hide(),t.$el.hide(),s.messagePresent=!1,s.broadcast("nyt:messaging-messenger-"+s.options.id+"-closed",s)})},adjustWidth:function(){var t,i=e("#masthead"),n=i.width(),s=this.widthDiff,a=this.pageManager.getCurrentBreakpoint(),o=0;a>1020?(10060>=a&&(o=parseInt(i.css("margin-left"),10)),t=n-(2*s+o),this.$el.css("width",t+"px"),this.$el.css("left",s+"px")):(this.$el.css("left","0px"),this.$el.css("width","100%"))}}));return s}),define("shared/messaging/models/follow",["underscore/nyt","foundation/models/base-model"],function(e,t){"use strict";var i=t.extend({defaults:{tag:"",type:"",following:"",thumb:"",thumbClass:!1,description:"",isFollowing:!1},follow:function(){this.set("isFollowing",!0),this.broadcast("nyt:messaging-following-"+this.id)},unfollow:function(){this.set("isFollowing",!1),this.broadcast("nyt:messaging-unfollowing-"+this.id)},isFollowing:function(){return this.get("isFollowing")},getButtonText:function(){return e.pick(this.toJSON(),["followText","followingText","unfollowText"])}});return i}),define("shared/messaging/views/follow-onboarding",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal"],function(e,t,i,n){"use strict";var s=i.registerView("messaging").extend({defaults:{featureName:"",extractTemplateData:function(e){return e},animationDuration:1e3,modalDefaults:{className:"",superclass:"",template:function(){},modalOptions:{tailDirection:"up-right",disableBindings:!0,toggleSpeed:200},onShow:function(){},onHide:function(){}},allows:{}},initialize:function(e){var i,n,s,a=this;if(!e.types)return!1;this.modals={},this.settings=t.extend({},this.defaults,e),this.modalSettings={},this.settings.modalOptions=t.extend({},this.defaults.modalOptions,e.modalOptions),this.extractTemplateData=this.settings.extractTemplateData,this.allows=t.extend({},this.defaults.allows,e.allows);for(i in e.types)this.modals[i]={},this.modalSettings[i]=t.extend({},this.settings.modalDefaults,e.types[i]),this.modalSettings[i].modalOptions=t.extend({},this.settings.modalDefaults.modalOptions,e.types[i].modalOptions),n=this.modalSettings[i].modalOptions.addlClasses,s=this.modalSettings[i].className+" "+this.modalSettings[i].superclass,n=n?n+" "+s:s,n.replace(/\s/g,"").length>0&&(this.modalSettings[i].modalOptions.addlClasses=n);return this.subscribe("nyt:"+this.settings.featureName+"-onboarding-show",function(e){a.handleModalOpen(e.type,e)}),this.subscribe("nyt:"+this.settings.featureName+"-onboarding-hide",function(e){a.handleModalClose(e.type,e)}),this},createNewModal:function(i,s){var a=this,o=s?s.binding:void 0,r=s&&s.modalOptions?s.modalOptions:{},l=this.modalSettings[i];return new n(t.extend({},this.settings.modalOptions,l.modalOptions,r,{id:this.settings.featureName+"-tooltip-"+i,modalContent:l.template(a.extractTemplateData(s)),binding:o,openCallback:function(){a.trackOnboardingEvent("impression",i,o),l.onShow(a),e("#notifications-tooltip-"+i).find(".dismiss-button").on("click",function(){a.trackOnboardingEvent("click",i,o)})},closeCallback:function(){l.onHide(a)},instanceData:s}))},showModal:function(e){e&&(this.modals[e].addToPage().open(),this.broadcast("nyt:"+this.settings.featureName+"-onboarding-shown",e))},hideModal:function(e){e&&(this.modals[e].close().removeFromPage(),this.broadcast("nyt:"+this.settings.featureName+"-onboarding-hidden",this),this.modals[e]=!1)},handleModalOpen:function(e,t){(t.force||e&&this.allows[e])&&(this.modals[e]=this.createNewModal(e,t),this.showModal(e),this.allows[e]=!1)},handleModalClose:function(e){e&&!t.isEmpty(this.modals[e])&&this.hideModal(e)},trackOnboardingEvent:function(i,n,s){var a,o,r,l,d,c,h="impression"===i;n&&(r={version:"Follow"+n.toUpperCase().slice(0,1)+n.slice(1),module:"follow",eventName:h?"tooltip-shown":"tooltip-CTA",priority:h},l=["marginalia","next-in","notifications-modal","extended-byline","collection-heading","masthead"],o=t.isString(s)?e(s):s,o&&o.length&&(d=t.find(l,function(e){return o.parents("."+e).length>0})),d&&(r.region=d),a=h?"trackingTriggerImpression":"trackingTrigger",c=h?void 0:"interaction",this[a]("follow-events",r,c))}});return s}),define("shared/messaging/collections/follows",["jquery/nyt","underscore/nyt","foundation/collections/base-collection","shared/messaging/models/follow","shared/messaging/views/follow-onboarding","shared/messaging/templates","foundation/hosts"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend({model:n,defaultSettings:{},initialize:function(e){this.settings=t.extend({},this.defaultSettings,e),this.followSorts=!1,this.followQueue=[],this.followsInitialized=!1,this.knowsSubscriptionData=!1,this.followLater={},this.followedAlready=!1,this.onboarding=null,this.stateKeys={onboardWelcome:"follow.onboard-welcome",onboardSuggest:"follow.onboard-suggest",onboardConfirm:"follow.onboard-confirm",betaWhitelist:"follow.whitelist"},t.bindAll(this,"createOnboardingInstance","handleOnboardingComplete"),this.pageManager.isDomReady()?this.getFollowables():this.subscribe(this.pageManager,"nyt:page-ready",this.getFollowables),this.subscribe("nyt:messaging-follow-data-received",this.handleFollowingDataReceived),this.subscribe("nyt:messaging-unfollow-tag",this.unsubscribeFromFollowable),this.subscribe("nyt:messaging-follow-tag",this.subscribeToFollowable),this.subscribe("nyt:notifications-onboarding-complete",this.handleOnboardingComplete),this.subscribe("nyt:notifications-instantiate-onboarding",this.createOnboardingInstance)},changeSubscription:function(t,i,n){var s=o.followApiHost+"/svc/pushmobile/follow/v0/"+i+".json";e.ajax({url:s,type:t,xhrFields:{withCredentials:!0}}).done(n)},unsubscribeFromFollowable:function(e){var t=this.get(e);t&&t.unfollow(),this.changeSubscription("DELETE",e,function(){})},subscribeToFollowable:function(e){var t=this.get(e);t&&(t.follow(),this.followedAlready||"follow"===e.slice(0,6)||(this.broadcast("nyt:notifications-onboarding-show",{type:"confirm",model:t}),this.followedAlready=!0)),this.changeSubscription("POST",e,function(){})},getFollowables:function(){var i=this;e.ajax({url:o.s1Host+"/messaging/available_follows.jsonp",dataType:"jsonp",jsonpCallback:"followablesCallback"}).done(function(e){var n,s;if(!e)return!1;if(e.followables)for(n in e.followables)s=e.followables[n],s.id=n,i.add(s);i.followSorts=t.omit(e,"followables"),i.followsInitialized=!0,i.local(i,"nyt:messaging-followables-received")})},handleFollowingDataReceived:function(e){var t=this;this.knowsSubscriptionData||!this.pageManager.flag("followingRelease")&&!e[this.stateKeys.betaWhitelist]||(this.knowsSubscriptionData=!0,this.pageManager.setMeta("nyt:messaging-user-has-ability-to-follow","true"),this.broadcast("nyt:messaging-user-has-ability-to-follow"),this.followsInitialized?this.followFollowables(e):(this.followQueue=e,this.subscribe(this,"nyt:messaging-followables-received",this.followFollowables)),this.pageManager.getMeta("nyt:messaging-notifications-panel-active")?this.handleOnboardingReady(e):this.subscribe("nyt:messaing-notifications-panel-active",function(){t.handleOnboardingReady(e)}))},handleOnboardingReady:function(e){e&&!e[this.stateKeys.onboardConfirm]&&"homepage"!==this.pageManager.getApplicationName()&&(this.createOnboardingInstance({following:e}),e[this.stateKeys.onboardWelcome]||this.broadcast("nyt:notifications-onboarding-show",{type:"welcome",binding:".notifications-button"}))},createOnboardingInstance:function(e){!this.onboarding&&e.following&&(this.onboarding=new s({featureName:"notifications",extractTemplateData:function(e){return e&&e.model&&e.model.get?{collectionName:e.model.get("following")}:{}},types:{welcome:{template:a.onboardingIntroducingNotifications,className:"notifications-tooltip",superclass:"tooltip",modalOptions:{tailTopOffset:-8,tailLeftOffset:-1,fixedOverride:!0},onShow:function(t){var i=function(){t.broadcast("nyt:notifications-onboarding-hide",{type:"welcome"})};t.broadcast("nyt:notifications-onboarding-complete","welcome"),"homepage"===t.pageManager.getApplicationName()?t.subscribeOnce("nyt:masthead-hidden",i):t.subscribeOnce("nyt:masthead-storytheme",i),e.cbExtension&&e.cbExtension(t.modals.welcome)}},suggest:{template:a.onboardingSuggestFollow,className:"notifications-tooltip",superclass:"tooltip",modalOptions:{tailDirection:"down-right"},onShow:function(t){t.broadcast("nyt:notifications-onboarding-complete","suggest"),t.modals.suggest.settings.fixedOverride&&t.subscribeOnce("nyt:masthead-storytheme",function(){t.broadcast("nyt:notifications-onboarding-hide",{type:"suggest"})}),e.cbExtension&&e.cbExtension(t.modals.suggest)}},confirm:{template:a.onboardingFirstFollow,className:"notifications-confirmation",modalOptions:{modalTitle:'<i class="icon"></i>Success!',hasOverlay:!0,hasCloseButton:!0,tailDirection:"centered"},onShow:function(e){e.broadcast("nyt:notifications-onboarding-complete","confirm")}}},modalOptions:{modalFooter:e.footerOverride||'<button class="button dismiss-button">Ok, got it</button>'},allows:{welcome:!e.following[this.stateKeys.onboardWelcome],suggest:!e.following[this.stateKeys.onboardSuggest],confirm:!e.following[this.stateKeys.onboardConfirm]}}),this.broadcast("nyt:messaging-user-onboarding-start"))},followFollowables:function(e){var i,n,s=e||this.followQueue;for(s=t.isArray(s)?s:t.keys(s);s.length>0;)i=s.shift(),n=this.get(i),n?n.follow():this.followLater[i]=!0;this.handleFollowDataReady()},handleFollowDataReady:function(){var e,t=this.createOrderedFullList();e=this.pageManager.flag("moreFollowSuggestions")?t:this.generateFollowSuggestions(),this.broadcast("nyt:messaging-follow-suggestions-received",e),this.broadcast("nyt:messaging-followable-list-received",t)},generateFollowSuggestions:function(e){var i,n,s=[],a=[],o=this.followSorts.weighted||this.followSorts.alpha||t.pluck(this.models,"id"),r=t.clone(o);for(e=e||3;s.length<e;)if(r.length>0){if(i=r.shift(),n=this.get(i),!n)continue;n.isFollowing()?a.push(n):s.push(n)}else{if(0===a.length)break;s.push(a.shift())}return s},createOrderedFullList:function(e){var i,n,s,a,o=[];for(a=t.pluck(this.models,"id"),e=e||this.followSorts.alpha||a,i=0;i<e.length;i+=1)s=this.followSorts.alpha[i],n=this.get(s),n&&o.push(n);return o},getModelFromMeta:function(e){var t,i,n=this.pageManager.getMeta("applicationName");return"article"!==n&&"collection"!==n||(t=this.pageManager.getMeta("CT")+"."+this.pageManager.getMeta("CN"),t!==e)?void 0:(i=this.add({following:this.pageManager.getMeta("nyt-collection:display-name"),id:t,tag:t,thumb:"collection"===n?this.pageManager.getMeta("og:image"):void 0,description:this.pageManager.getMeta("nyt-collection:tagline")}),this.followLater[t]&&i.follow(),i)},handleOnboardingComplete:function(e){var t;this.pageManager.flag("followingRelease")&&this.isUserLoggedIn===!1||(t={welcome:this.stateKeys.onboardWelcome,suggest:this.stateKeys.onboardSuggest,confirm:this.stateKeys.onboardConfirm},t[e]&&this.subscribeToFollowable(t[e]))}});return r}),define("shared/messaging/instances/follows",["foundation/views/page-manager","shared/messaging/collections/follows"],function(e,t){"use strict";return e.flag("followFeature")?new t:{}}),define("shared/messaging/views/notification-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/messaging/views/messenger-mixin","shared/messaging/templates","shared/messaging/views/messenger-format-mixin","shared/modal/views/modal"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend({defaultSettings:{expiration:7,stackSize:3,modalHeight:91,modalMargin:6,truncateTextHeight:34},template:s.notificationModals,el:"#notification-modals",nytEvents:{"nyt:messaging-notification-archive-opened":"closeModals"},initialize:function(e){this.options=t.extend({},this.defaultSettings,e),this.queue={},this.active={},this.timer={},this.maxHeight=this.options.stackSize*this.options.modalHeight+this.options.modalMargin,this.$el.css({"max-height":this.maxHeight+"px"})},instantiateModal:function(i,n){var s=this,r=new o({id:"notification-modal-"+n,hasCloseButton:!0,modalContent:s.template(t.extend(i.toJSON(),{link:i.getPrimaryLink(),emphasize:a.emphasizeTitle,emphasis:i.getCombinedEmphasis()})),tailDirection:"up",autoPosition:!1,closeOnClick:!1,toggleSpeed:400,openCallback:function(){this.$el.css("left",5)},closeCallback:function(){s.closeModal(n)}});return r.addToPage("#notification-modals"),r.$el.data("messageId",n),r.$el.on("click",function(e){var t;e.preventDefault(),s.local(s,"nyt:messaging-notification-modal-clicked",n),s.closeModal(n),t=s.trackingAppendParams(i.get("link"),{module:"notification",version:"NotificationPopup",action:"click",region:"TopBar",eventName:"click",contentCollection:i.get("tag")}),s.broadcast("nyt:messaging-notifications-navigate",t)}),r.$el.find(".modal-close").on("click",function(e){e.stopPropagation(),s.local(s,"nyt:messaging-notification-modal-closed",n),s.closeModal(n),s.trackNotificationClose(i)}),r.$el.on("mouseenter",function(){e(this).parent().children(".active").each(function(){var t=e(this).data("timerId");s.clearTimer(t)})}),r.$el.on("mouseleave",function(){e(this).parent().children(".active").each(function(){var t=s.startTimer(n,2e3);e(this).data("timerId",t)})}),r},render:function(e){var t,i,n,s,a,o,r=this.options.truncateTextHeight;e&&(t=e.model.get("id"),i=this.instantiateModal(e.model,t),t&&i&&(n=i.$el.find(".message"),s=n.find(".timestamp"),a=s.attr("datetime"),i.open(),i.truncateText(n.find("a"),r),o=this.prettyDate(a),o&&s.text(o),this.showOrWait(t,i)))},showOrWait:function(e,t){var i,n=t.$el.position().top,s=1e3*this.options.expiration;n>=this.maxHeight?this.queue[e]=t:(this.queue[e]&&delete this.queue[e],this.active[e]=t,t.$el.addClass("active"),i=this.startTimer(e,s),t.$el.data("timerId",i))},startTimer:function(e,t){var i,n,s=this,a=function(){n=s.active[e],n&&n.close()};return i=window.setTimeout(a,t)},clearTimer:function(e){e&&window.clearTimeout(e)},closeModal:function(e){var t,i=this.active[e];i&&(t=i.$el.data("timerId"),t&&this.clearTimer(t),i.removeFromPage(),this.active[e]&&delete this.active[e],this.queue[e]&&delete this.queue[e]),this.showNext()},closeModals:function(){var e,t;for(e in this.queue)t=this.queue[e],t.removeFromPage(),delete this.queue[e];for(e in this.active)t=this.active[e],t.removeFromPage(),delete this.active[e]},showNext:function(){var e;for(e in this.queue)this.showOrWait(e,this.queue[e])},trackNotificationClose:function(e){e&&e.get&&this.trackingTrigger("notification-events",{module:"notification",version:"NotificationPopup",action:"close",region:"TopBar",contentId:e.get("link"),contentCollection:e.get("tag")},"interaction")}});return r}),define("shared/messaging/views/follow-button",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/messaging/templates","shared/messaging/instances/follows"],function(e,t,i,n,s,a){"use strict";var o=i.registerView("messaging").extend({className:"follow-button-container",defaults:{template:s.followButton,followingText:"Following",followText:"Follow",unfollowText:"Unfollow"},initialize:function(e){this.settings=t.extend({},this.defaults,e),this.template=this.settings.template,e.$el&&(this.model=a.get(e.$el.data("collection-id")),this.model||(this.model=a.getModelFromMeta(e.$el.data("collection-id")))),this.model&&(this.settings=t.extend(this.settings,this.model.getButtonText()),this.subscribe("nyt:messaging-following-"+this.model.id,this.updateFollowView),this.subscribe("nyt:messaging-unfollowing-"+this.model.id,this.updateFollowView),e.$el&&e.$el.replaceWith(this.render().$el))},render:function(){var i=this,n=t.extend(i.model.toJSON(),i.getRenderVars()),s=i.template(n);return i.$el.html(s),i.$el.on("click",".follow-button",function(){var t,n;return i.trackFollowButtonClick(e(this)),void 0===i.isUserLoggedIn?!1:i.isUserLoggedIn?(n=i.model.get("tag"),i.model.isFollowing()?i.broadcast("nyt:messaging-unfollow-tag",n):i.broadcast("nyt:messaging-follow-tag",n),!1):(t="Log in to follow "+i.model.get("following"),i.broadcast("nyt:loginmodal-open",{modalTitle:t,registrationPlatform:"follow_button"}),!1)}),i.$el.on("focusin mouseenter",".follow-button",function(){var t=e(this),n=t.parent().parent(),s={tailDirection:"down-right",fixedOverride:!1};t.hasClass("is-following")?t.addClass("active").find(".button-text").html(i.settings.unfollowText):n.hasClass("follow-option")||(n.hasClass("collection-heading")?s.tailTopOffset=3:n.hasClass("collection-meta")?s.tailTopOffset=-2:n.hasClass("collection-header")?(s.tailDirection="up-left",s.tailTopOffset=-2,s.tailLeftOffset=-44):n.hasClass("user-tools-button-group")?(s.tailDirection="up-right",s.tailTopOffset=-2,s.fixedOverride=!0):n.hasClass("extended-byline")&&(s.tailDirection="up-left"),i.broadcast("nyt:notifications-onboarding-show",{type:"suggest",binding:i.$el,model:i.model,modalOptions:s}))}),i.$el.on("mouseleave focusout",".follow-button.is-following",function(){e(this).removeClass("active").find(".button-text").html(i.settings.followingText)}),this},getRenderVars:function(){var e={};return this.model.isFollowing()?(e.buttonText=this.settings.followingText,e.classes="is-following"):(e.buttonText=this.settings.followText,e.classes=""),e},updateFollowView:function(){var e=this.getRenderVars(),t=this.$el.find(".follow-button"),i=t.find(".button-text");t.removeClass("is-following active").addClass(e.classes),i.html(e.buttonText)},trackFollowButtonClick:function(i){var n,s,a=this.model.get("id").split("."),o={module:"follow",state:this.model.isFollowing()?"following":"not-following",action:"click",contentId:a[1]||"",version:a[0]||"",eventName:this.model.isFollowing()?"unfollow":"follow",mData:{textLabel:!0}},r=["marginalia","next-in","notifications-modal","extended-byline","collection-heading","masthead"],l=["notifications","follow-options"];n=t.find(r,function(e){return i.parents("."+e).length>0}),n&&(o.region=n),"notifications-modal"===n&&(s=t.find(l,function(e){return i.parents("."+e).length>0}),s&&(o.state="follow-options"===s?"customize":"notification",o.contentPlacement=e(".notifications-modal ."+s+" .follow-button").index(i)+1)),this.trackingTrigger("follow-events",o,"interaction")},handleUserReady:function(){this.isUserLoggedIn=n.isLoggedIn()}});return o}),define("shared/messaging/views/follow",["underscore/nyt","foundation/views/base-view","shared/messaging/views/follow-button","shared/messaging/templates"],function(e,t,i,n){"use strict";var s=t.registerView("messaging").extend({className:"follow-option",defaults:{template:n.followInfo},initialize:function(t){this.settings=e.extend({},this.defaults,t),this.template=this.settings.template,this.followButton=new i({model:this.model}),this.subscribe("nyt:messaging-following-"+this.model.id,this.updateFollowView),this.subscribe("nyt:messaging-unfollowing-"+this.model.id,this.updateFollowView)},render:function(){var t=e.extend(this.model.toJSON(),{followClass:this.getFollowClass()}),i=this.template(t);return this.$el.html(i).append(this.followButton.render().$el),this},getFollowClass:function(){return this.model.isFollowing()?"following":""},updateFollowView:function(){var e=this.getFollowClass(),t=this.$el.find(".follow-info");t.removeClass("following").addClass(e)}});return s}),define("shared/messaging/views/notifications",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/messaging/instances/follows","shared/messaging/views/messenger-mixin","shared/messaging/views/notification-modal","shared/messaging/views/follow","shared/messaging/templates","shared/modal/views/modal"],function(e,t,i,n,s,a,o,r,l,d){"use strict";var c=i.registerView("messaging").extend(t.extend({},a,{defaultSettings:{messageType:"notifications",parent:function(){var t=new d({id:"notifications-modal",binding:".notifications-button",modalTitle:"Notifications",headerContent:"<button class='button customize-button hidden' id='toggle-customize-button'>Customize</button>",modalFooter:'<p class="disclaimer">This is a beta version of notifications. <a class="user-action" href="mailto:messaging.feedback@nytimes.com?Subject=Notifications feedback">Send feedback &raquo;</a></p>',tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"360px",toggleSpeed:1,fixedOverride:this.isFixed,openCallback:function(){this.$target.addClass("active"),this.subscribedAlready||(this.subscribe("nyt:comments-panel-opened",this.close),this.subscribe("nyt:loginmodal-open",this.close),"homepage"===this.pageManager.getApplicationName()?this.subscribe("nyt:masthead-hidden",this.close):this.subscribe("nyt:masthead-storytheme",this.close),this.subscribedAlready=!0),this.broadcast("nyt:messaging-notification-archive-opened",this)},closeCallback:function(){this.$target.removeClass("active"),this.broadcast("nyt:messaging-notification-archive-closed")}});return t.addToPage(),e("#notifications-modal").find(".modal-content")},template:"notificationsModal",fadeOutDelay:3e3,trackingVersion:"ReaderActivity",timestampUpdateFreq:3e4,truncateTextHeight:34,isFixed:!0,scrollCheckHeight:15},nytEvents:{"nyt:messaging-notification-archive-opened":"handleArchivePanelOpened","nyt:messaging-notification-archive-closed":"handleArchivePanelClosed","nyt:messaging-count-received":"updateCounter","nyt:messaging-existing-message-update":"updateMessageView","nyt:messaging-critical-alerts-move-furniture":"movePanelForOtherAlerts","nyt:messaging-suggestions-move-furniture":"movePanelForAlerts","nyt:messaging-follow-suggestions-received":"addSuggestedFollows","nyt:messaging-followable-list-received":"createFollowableList","nyt:messaging-cache-pull-over":"setCachePullOver","nyt:messaging-notifications-navigate":"handleNavigationRequired","nyt:messaging-notifications-panel-active":"setupPanel"},events:{"click .unsubscribe-button":"confirmUnfollowIntent","click .unfollow-button":"confirmUnfollowed","click .keep-following-button":"restoreOriginalFollowable","click .undo-action-button":"undoUnfollowFollowable","click .message-link":"handleMessageClicked"},prepareView:function(){t.bindAll(this,"trackArchiveAction"),this.notificationModal=new o,this.$el.find(".message-bed").append(l.notificationsModal({show:"default"})),this.$archivePanel=e("#notifications-modal"),this.$modalContent=this.$archivePanel.find(".modal-content"),this.$notificationsModal=this.$archivePanel.find(".notifications-modal"),this.$notificationsButton=e(".notifications-button"),this.messageCount=0,this.archiveOpen=!1,this.timestampsUpdating=!1,this.sliding=!1,this.maxHeight=parseInt(this.$modalContent.css("max-height"),10),this.isUnfollowing=!1,this.unfollowing={model:void 0,$el:void 0},this.cachePullOver=!1,this.modalsEnabled=!1,this.lastScrollCheck=0,this.unreadMessages=[],this.subscribe(this.notificationModal,"nyt:messaging-notification-modal-clicked",this.handleMessageAcknowledged),this.subscribe(this.notificationModal,"nyt:messaging-notification-modal-closed",this.handleMessageDismissed),this.pageManager.setMeta("nyt:messaging-notifications-panel-active","true"),this.broadcast("nyt:messaging-notifications-panel-active"),this.$el.show(),this.disablePageScrollOnHover()},afterMessageReceived:function(e){var t,i,n=this.$archivePanel.is(":visible");e&&(t=e.model.get("unread"),i=e.model.get("popup_unread"),t&&(this.broadcast("nyt:messaging-count-received",1),this.unreadMessages.push(e),!n&&i&&this.displayPopup(e)),this.hideDefaultNotification(),e.reveal(!0),n&&(this.truncateCommentBodies(),this.markAppropriateMessagesRead()),this.addBottomBorder())},setCachePullOver:function(){this.cachePullOver=!0},displayPopup:function(e){this.cachePullOver&&this.modalsEnabled&&this.notificationModal.render(e),e.model.setPopupRead()},markRead:function(e){var t=this.active.messages[e];t.displayed()},handleMessageAcknowledged:function(e){this.broadcast("nyt:messaging-modal-"+e+"-acknowledged")},handleMessageDismissed:function(e){this.broadcast("nyt:messaging-modal-"+e+"-dismissed")},handleArchivePanelOpened:function(){var e=this;e.archiveOpen=!0,e.timestampsUpdating||(e.updateTimestamps(e),e.timestampsUpdating=setInterval(function(){e.updateTimestamps(e)},e.timestampUpdateFreq)),e.markAppropriateMessagesRead(),e.truncateCommentBodies(),e.addBottomBorder(),e.trackArchiveAction("open")},handleArchivePanelClosed:function(){this.archiveOpen=!1,this.stopUpdatingTimestamps(),this.trackArchiveAction("close"),this.isUnfollowing&&this.restoreOriginalFollowable()},isMessageVisible:function(e){var t,i,n,s,a;return this.$modalContent.find(".follow-options").is(":visible")?!1:(t=this.$modalContent.offset().top,i=t+this.$modalContent.height(),n=e.$el.find(".message-title"),s=n.offset().top,a=s+n.height(),s>=t&&i>=a)},markAppropriateMessagesRead:function(){var t,i,n,s,a,o=this,r=[];for(i=0;i<this.unreadMessages.length;i++)s=this.unreadMessages[i],t=s.model.get("id"),a=this.isMessageVisible(s),n=s.model.get("unread"),a&&n?(s.displayed(this.options.fadeOutDelay),this.local(this,"nyt:messaging-message-"+this.options.id+"-displayed",t)):!a&&n&&r.push(s);this.unreadMessages=r,this.watchingWhichMessagesAreSeen||(this.$modalContent.on("scroll",function(){var t=e(this).scrollTop(),i=Math.abs(t-o.lastScrollCheck),n=i/o.options.scrollCheckHeight>1;o.unreadMessages.length>0&&n&&(o.markAppropriateMessagesRead(),o.lastScrollCheck=t)}),this.watchingWhichMessagesAreSeen=!0)},updateCounter:function(e){var t,i;void 0!==e&&(t=this.messageCount+e,this.messageCount=Math.max(t,0),i={count:this.messageCount,delta:e},this.broadcast("nyt:messaging-notification-count-update",i))},showDefaultNotification:function(){this.$el.find(".default-message").show()},hideDefaultNotification:function(){var e=this.$el.find(".message-default").closest(".message-container");"block"===e.css("display")&&e.hide()},disablePageScrollOnHover:function(){this.$modalContent.on("mousewheel DOMMouseScroll",function(t){var i=0;"mousewheel"===t.type?i=-1*t.originalEvent.wheelDelta:"DOMMouseScroll"===t.type&&(i=40*t.originalEvent.detail),i&&(t.preventDefault(),e(this).scrollTop(i+e(this).scrollTop()))})},addBottomBorder:function(){var t=this.dimensions().height,i=parseInt(this.$modalContent.css("max-height"),10);t>i&&(e("#notifications-modal").find(".modal").addClass("scroll-active"),this.$modalContent.find(".comment-text").data("truncate",!0))},handleMessageClicked:function(t){var i,n,s,a,o;t.preventDefault(),i=e(t.currentTarget),n=i.closest(".message-container"),a=n.data("messageId"),o=this.collection.get(a),s=this.trackingAppendParams(i.attr("href"),{module:"notification",version:"NotificationPanel",action:"click",region:"TopBar",eventName:"click",contentCollection:o?o.get("tag"):"",contentPlacement:this.determineMessagePlacement(n)}),this.handleNavigationRequired(s)},handleNavigationRequired:function(e){var t,i,n,s=window.location.href.split("#")[0]===e.split("#")[0];window.location.href=e,t=e.split("#")[1],t&&s&&(n=t.split("="),i=n[1],"permid"===n[0]&&i&&this.broadcast("nyt:community-commentspanel-open",i))},trackArchiveAction:function(e){this.trackingTrigger("notification-events",{module:"notification",version:"NotificationPanel",action:e,region:"TopBar"},"interaction")},confirmUnfollowIntent:function(t){var i,n,s=e(t.currentTarget).closest(".message-container"),a=this.collection.get(s.data("id"));this.trackInlineUnfollow("dismiss",s,a),this.isUnfollowing&&this.restoreOriginalFollowable(),a.set("originalHTML",s.html()),t.preventDefault(),t.stopPropagation(),i=s.height(),s.css({height:i}),s.find(".unsubscribe-button").remove(),n=l.followConfirmation(a.toJSON()),s.find(".message").replaceWith(n),this.isUnfollowing=!0,this.unfollowing={$el:s,model:a}},confirmUnfollowed:function(t){var i,n=e(t.currentTarget).closest(".message-container"),s=this.collection.get(n.data("id")),a=s.get("tag");this.trackInlineUnfollow("unfollowing",n,s),t.preventDefault(),t.stopPropagation(),this.broadcast("nyt:messaging-unfollow-tag",a),i=l.followUnfollowed(s.toJSON()),n.css({height:"auto"}),n.find(".message").replaceWith(i),this.isUnfollowing=!1},restoreOriginalFollowable:function(t){var i=t?e(t.currentTarget).closest(".message-container"):this.unfollowing.$el,n=t?this.collection.get(i.data("id")):this.unfollowing.model;return t&&(t.preventDefault(),t.stopPropagation()),t&&t.currentTarget&&e(t.currentTarget).hasClass("keep-following-button")&&this.trackInlineUnfollow("keepfollowing",i,n),i.find(".message").replaceWith(n.get("originalHTML")),i.css({height:"auto"}),this.isUnfollowing=!1,n},undoUnfollowFollowable:function(t){var i=e(t.currentTarget).closest(".message-container"),n=this.restoreOriginalFollowable(t),s=n.get("tag");this.trackInlineUnfollow("follow",i,n),this.broadcast("nyt:messaging-follow-tag",s)},updateMessageView:function(e){var t,i,n=this.received.messages[e.id],s=n.model;t=s.get("unread"),s.applyMetadata(e.update),i=s.get("unread"),e.message&&s.updateProperties(e.message),!t&&i?this.broadcast("nyt:messaging-count-received",1):t&&!i&&this.broadcast("nyt:messaging-count-received",-1),i?(n.$el.detach(),n.render(),this.$el.find(".message-bed").prepend(n.$el),n.reveal(!0),this.archiveOpen&&this.markAppropriateMessagesRead()):n.render().reveal(!0)},movePanelForOtherAlerts:function(e){var t;this.archiveOpen&&(t=this.$archivePanel.find(".notifications-modal"),e(t))},updateTimestamps:function(t){e(".notifications-modal .timestamp").each(function(){var i=e(this),n=1e3*parseInt(i.attr("datetime"),10),s=t.prettyDate(n);s&&i.html(s)})},stopUpdatingTimestamps:function(){this.updating&&(clearInterval(this.updating),this.updating=!1)},addSuggestedFollows:function(e){var t,i,n,s=this,a=s.$el.find(".follow-suggestions");for(i=0;i<e.length;i+=1)t=e[i],n=new r({model:t}),a.append(n.render().$el)},createFollowableList:function(e){var t,i,n,s=this;for(this.$archivePanel.find("#toggle-customize-button").removeClass("hidden"),this.$modalContent.append("<div class='follow-options'><h4 class='follow-options-heading'>Follow columns and columnists</h4></div>"),
n=this.$modalContent.find(".follow-options"),t=0;t<e.length;t+=1)i=new r({model:e[t]}),n.append(i.render().$el);this.$archivePanel.find(".modal-header").on("click",".button",function(e){e.preventDefault(),e.stopPropagation(),s.sliding||(s.sliding=!0,s.toggleFollowableView(e,function(){s.sliding=!1}))})},toggleFollowableView:function(e,t,i){var n,s=this,a=this.$archivePanel.find(".modal-header");n=this.prepareToAnimateFollows(),i=i||250,this.trackPanelCustomizeToggle(e,n.$showing),a.find("#toggle-customize-button").toggleClass("active"),n.wrapButton?a.find(".modal-heading").wrap("<button class='button back-button'></button>"):a.find(".modal-heading").unwrap(),s.$modalContent.removeClass("scroll-active").css({height:n.destinationHeight}).addClass("is-animating"),n.$showing.addClass("is-animating").css({width:n.width,"max-height":s.maxHeight,left:n.moveShowingTo}),n.$toShow.addClass("is-animating").css({width:n.width,left:0}),setTimeout(function(){n.scrollActive&&s.$notificationsModal.addClass("scroll-active"),n.$showing.removeClass("is-animating scroll-active").css({display:"none"}),n.$toShow.removeClass("is-animating scroll-active").css({width:"auto"}),s.$modalContent.removeClass("is-animating").css({height:"auto"}),t&&t()},i)},prepareToAnimateFollows:function(){var e,t,i,n,s,a=this.$modalContent.find(".follow-options"),o=this.$modalContent.width(),r=this.$modalContent.height(),l=this.maxHeight;return n=!1,s=a.is(":hidden"),e=s?this.$el:a,t=s?a:this.$el,this.$modalContent.css({height:r}),l=t.css({display:"inherit",width:o}).height(),l>=this.maxHeight?(t.addClass("scroll-active"),n=!0):this.$notificationsModal.removeClass("scroll-active"),r===this.maxHeight&&e.addClass("scroll-active"),l=l>this.maxHeight?this.maxHeight:l,i=s?-o:o,{$showing:e,$toShow:t,wrapButton:s,destinationHeight:l,moveShowingTo:i,width:o,scrollActive:n}},truncateCommentBodies:function(){var t=this;this.$modalContent.find(".comment-text").each(function(){var i=e(this);i.data("truncate")&&(t.truncateText(i,t.options.truncateTextHeight),i.data("truncate",!1))})},determineMessagePlacement:function(t){return e(".notifications-modal .notifications .message-container:visible").index(t)+1},trackPanelCustomizeToggle:function(t,i){i&&this.trackingTrigger("notification-events",{module:"follow",state:i.hasClass("follow-options")?"customize":"notification",action:"click",version:"NotificationPanel",region:"TopBar",contentId:e(t.currentTarget).hasClass("back-button")?"back-button":"customize-button",eventName:"click"},"interaction")},trackInlineUnfollow:function(e,t,i){var n;e&&(n=i.get("tag").split("."),this.trackingTrigger("notification-events",{module:"follow",state:"notification-unfollow",action:"click",contentId:n[1],version:n[0],eventName:e,region:"TopBar",contentPlacement:this.determineMessagePlacement(t)},"interaction"))},handleUserReady:function(){this.pageManager.flag("followingRelease")&&(this.isUserLoggedIn=n.isLoggedIn(),s.isUserLoggedIn=n.isLoggedIn(),this.setupPanel())},revealBell:function(){this.$notificationsButton.removeClass("hidden")},setupPanel:function(){var e=this;if(this.pageManager.getMeta("nyt:messaging-notifications-panel-active")){if(!this.pageManager.flag("followingRelease"))return this.revealBell(),void(this.modalsEnabled=!0);if(void 0!==this.isUserLoggedIn)return this.isUserLoggedIn?(this.modalsEnabled=!0,this.pageManager.getMeta("nyt:messaging-user-has-ability-to-follow")?void this.revealBell():void this.subscribe("nyt:messaging-user-has-ability-to-follow",function(){e.revealBell()})):(this.revealBell(),void this.handleAnonInteractions())}},handleAnonInteractions:function(){var e=this,t=(new Date).getTime()-6e4;this.broadcast("nyt:notifications-instantiate-onboarding",{following:{"follow.whitelist":{start:t},"follow.onboard-welcome":{start:t}},footerOverride:'<button class="button login-button">Log in</button>',cbExtension:function(t){var i,n,s,a=t.settings.instanceData?t.settings.instanceData.type:null,o="Notification";a&&(i=t.settings.instanceData?t.settings.instanceData.model:null,n="Log in to follow",i&&(n=n+" "+i.get("following"),s="follow_button",o="Follow"),t.$el.find(".login-button").on("click",function(t){t.stopPropagation(),e.broadcast("nyt:notifications-onboarding-hide",{type:a}),e.trackingTrigger("tagx-auth-interaction",{module:o,state:e.isUserLoggedIn?"logged in":"logged out",eventName:"login click | "+o}),e.broadcast("nyt:loginmodal-open",{modalTitle:n,registrationPlatform:s||"follow_bell",moduleName:o})}))}}),this.$notificationsButton.hover(function(){e.anonOnboardingShown||(e.anonOnboardingShown=!0,e.broadcast("nyt:notifications-onboarding-show",{type:"welcome",binding:".notifications-button",force:!0}))}),this.$notificationsButton.click(function(t){t.stopPropagation(),e.broadcast("nyt:loginmodal-open",{modalTitle:"Log in to follow",registrationPlatform:"follow_bell",moduleName:"Notification"})})}}));return c}),define("shared/messaging/instances/messaging",["foundation/views/page-manager","shared/messaging/views/critical-alerts","shared/messaging/views/suggestions","shared/messaging/views/announcements","shared/messaging/views/notifications"],function(e,t,i,n,s){"use strict";var a=e.getMeta("nyt:messaging-user-has-ability-to-follow"),o=function(){e.flag("followFeature")&&!e.$html.hasClass("has-cover-media")&&new s({id:"notifications",notifyWhen:"nyt:messaging-notification-received nyt:messaging-follow-notice-received"})};(!e.$html.hasClass("app-interactive")||e.$html.hasClass("page-interactive-default"))&&!e.$html.hasClass("lt-ie9")&&!e.$html.hasClass("template-minimal")&&e.getCurrentBreakpoint()>=120&&(e.getCurrentBreakpoint()>=1010&&(new i({id:"suggestions",notifyWhen:"nyt:messaging-velcro-received"}),new t({id:"breaking-news-alerts",notifyWhen:"nyt:messaging-breaking-news-received",expiration:20,dismissAcknowledged:"homepage"!==e.getApplicationName(),trackingVersion:"BreakingNews"}),new t({id:"account-alerts",notifyWhen:"nyt:messaging-account-alert-received",expiration:10,trackingVersion:"UserAccounts"}),new n({id:"announcements",notifyWhen:"nyt:messaging-video-received"})),a||e.flag("followingRelease")?o():e.listenToOnce(e,"nyt:messaging-user-has-ability-to-follow",o))}),define("shared/account/templates",["underscore/nyt"],function(_){var templates={};return templates.accountModalHeader=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<h4 class="modal-subheading">To save articles or get newsletters, alerts or recommendations &ndash; all free.</h4>';return __p},templates.logInModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="buttons">\n'+(null==(__t=oauthButtons)?"":__t)+'\n</div><!-- close buttons -->\n<div class="separator">\n<span class="separator-text">OR</span>\n</div>\n<div class="login-form-control form-control">\n<form id="login-form" class="login-form" role="form" method="post" action="'+(null==(__t=loginUrl)?"":__t)+'">\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-email" id="login-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="text" id="login-email" name="userid" class="text login-email" placeholder="Email address" aria-labelledby="login-email-label" aria-required="true">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="login-password" id="login-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="login-password" name="password" class="text login-password" placeholder="Password" data-type="password" aria-labelledby="login-password-label" aria-required="true">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control user-action-control layout-horizontal">\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="login-remember-checkbox" name="login-remember" class="checkbox login-remember" checked="checked" aria-labelledby="login-remember-label" aria-checked="true" value="">\n</div>\n<div class="label-container">\n<label for="login-remember" class="checkbox-label" id="login-remember-label">Remember me</label>\n</div>\n</div>\n<p class="form-hint password-hint"><a href="'+(null==(__t=forgotPasswordUrl)?"":__t)+'">Forgot password?</a></p>\n</div>\n<div class="control">\n<p class="disclaimer"><a href="http://www.nytimes.com/content/help/rights/terms/terms-of-service.html">Terms of Service</a> <a href="http://www.nytimes.com/content/help/rights/privacy/policy/privacy-policy.html">Privacy Policy</a></p>\n</div>\n<div class="control button-control">\n<button id="login-send-button" class="button login-button">Log in</button>\n</div>\n<input name="is_continue" value="1" type="hidden">\n<input id="account-form-token" name="token" value="" type="hidden">\n<input id="account-form-expiration" name="expires" value="" type="hidden">\n<input id="login-remember" name="remember" value="1" type="hidden">\n</form>\n</div><!-- close login-form-control -->';return __p},templates.loginModalFooter=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<p class="user-action registration-modal-trigger">Don&#8217;t have an account? <a href="javascript:;">Sign Up</a></p>';return __p},templates.oauthButtons=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button id="'+(null==(__t=facebookId)?"":__t)+'" data-provider-name="facebook" class="button oauth-button facebook-oauth-button">\n<i class="icon sprite-icon"></i>\n<span class="button-text">'+(null==(__t=prefix)?"":__t)+' with Facebook</span>\n</button>\n<button id="'+(null==(__t=googleId)?"":__t)+'" data-provider-name="google" class="button oauth-button google-oauth-button">\n<i class="icon sprite-icon"></i>\n<span class="button-text">'+(null==(__t=prefix)?"":__t)+" with Google</span>\n</button>";return __p},templates.registrationModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="buttons">\n'+(null==(__t=oauthButtons)?"":__t)+'\n</div><!-- close buttons -->\n<div class="separator">\n<span class="separator-text">OR</span>\n</div>\n<div class="registration-form-control form-control">\n<form id="registration-form" class="registration-form" role="form" method="post" action="'+(null==(__t=regiUrl)?"":__t)+'">\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-email" id="register-email-label">Email address</label>\n</div>\n<div class="field-container">\n<input type="email" id="register-email" name="email_address" class="text register-email" placeholder="Email address" aria-labelledby="register-email-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-email-description"><i class="icon"></i><span class="visually-hidden" id="clear-email-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="register-password" id="register-password-label">Password</label>\n</div>\n<div class="field-container">\n<input type="password" id="register-password" name="password1" class="text register-password" placeholder="Password" data-type="password" aria-labelledby="register-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="retype-password" id="retype-password-label">Retype password</label>\n</div>\n<div class="field-container">\n<input type="password" id="retype-password" name="password2" class="text retype-password" placeholder="Retype password" data-type="password" aria-labelledby="retype-password-label" aria-required="true" />\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-retyped-password-description"><i class="icon"></i><span class="visually-hidden" id="clear-retyped-password-description">Clear this text input</span></button>\n</div>\n</div><!-- close control -->\n<div class="control layout-horizontal special-offers">\n<input class="checkbox special-offers-checkbox" id="special-offers-checkbox" type="checkbox" name="mnl_opt_in_proxy" value="" ',"undefined"!=typeof marketing&&marketing&&(__p+="checked='checked'"),__p+='/>\n<label class="form-hint special-offers-label" for="special-offers-checkbox">\nYou agree to receive occasional updates and special offers for The New York Times\'s products and services. You may opt out or <a href="/help/index.html">contact us</a> anytime.\n</label>\n<input class="special-offers-hidden" type="hidden" name="mnl_opt_in" value="" />\n</div>\n<div class="control">\n<p class="disclaimer"><a href="http://www.nytimes.com/content/help/rights/terms/terms-of-service.html">Terms of Service</a> <a href="http://www.nytimes.com/content/help/rights/privacy/policy/privacy-policy.html">Privacy Policy</a> <a href="/help/index.html">Contact Us</a></p>\n</div>\n<div class="control button-control">\n<button id="register-send-button" class="button register-button">Create Account</button>\n</div>\n<input name="is_continue" value="1" type="hidden">\n<input id="account-form-token" name="token" value="" type="hidden">\n<input id="account-form-expiration" name="expires" value="" type="hidden">\n<input name="signupFormVersions" class="signupFormVersions" value="NYT5_MyAccount_Modal_global_v2" type="hidden">\n</form>\n</div><!-- close registration-form-control -->';return __p},templates.registrationModalFooter=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<p class="user-action login-modal-trigger">Already have an account? <a href="javascript:;">Log In</a></p>';return __p},templates.userProfileModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="user-profile-form-control form-control '+(null==(__t=user?"":"user-profile-form-control-loading")?"":__t)+'">\n',user&&(__p+='\n<form id="user-profile-form" class="user-profile-form" role="form" method="post">\n<div class="controls">\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="user-profile-name" id="user-profile-name-label">Name</label>\n</div>\n<div class="field-container">\n<input type="text" id="user-profile-name" name="name" class="text user-profile-name" placeholder="Name" aria-labelledby="user-profile-name-label" aria-required="true" value="'+(null==(__t=user.getName())?"":__t)+'">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-name-description"><i class="icon"></i><span class="visually-hidden" id="clear-name-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control">\n<div class="label-container visually-hidden">\n<label for="user-profile-location" id="user-profile-location-label">Location</label>\n</div>\n<div class="field-container">\n<input type="text" id="user-profile-location" name="location" class="text user-profile-location" placeholder="Location" aria-labelledby="user-profile-location-label" aria-required="true" value="'+(null==(__t=user.getLocation())?"":__t)+'">\n<button type="button" class="button clear-button" tabindex="-1" aria-describedby="clear-location-description"><i class="icon"></i><span class="visually-hidden" id="clear-location-description">Clear this text input</span></button>\n</div>\n</div>\n<div class="control checkbox-control">\n<div class="field-container">\n<input type="checkbox" id="global-comment-notify-checkbox" name="global-comment-notify" class="checkbox comment-notify" '+(null==(__t=user.getNotify()?'checked="checked"':"")?"":__t)+' aria-labelledby="comment-notify-label" aria-checked="true" value="">\n</div>\n<div class="label-container">\n<label for="global-comment-notify" class="checkbox-label" id="global-comment-notify-label">Receive email notifications when your comments are published.</label>\n</div>\n</div>\n<div class="control button-control">\n<button class="button save-button">Save</button>\n<button class="button cancel-button">Cancel</button>\n</div>\n</div>\n<div class="avatar" role="presentation">\n<span class="avatar-image"><img width="80" height="80" src="'+(null==(__t=user.getAvatar())?"":__t)+'"/></span>\n<label class="user-profile-avatar-button" for="user-profile-avatar-input">\nEdit photo\n<input type="file" name="avatar" id="user-profile-avatar-input" class="user-profile-avatar-input"/>\n</label>\n<div class="avatar-editor">\n<div class="avatar-crop"></div>\n<button class="button crop-button">Crop</button>\n</div>\n</div>\n</form>\n'),__p+="\n</div><!-- close user-profile-form-control -->";return __p},templates.userProfileModalHeader=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<h4 class="modal-subheading">Your profile is public. It will appear with any comments you leave on NYTimes.com</h4>';return __p},templates}),define("shared/account/helpers/account-modal-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder","shared/account/templates","foundation/hosts"],function(e,t,i,n,s){"use strict";var a={oauthProviders:["google","facebook"],handleFormSubmit:function(e){var t=this.$el.find(".special-offers-checkbox"),i=this.$el.find(".special-offers-hidden"),n=this.$el.find(".signupFormVersions"),s="abcdefghijklmnopqrstuvxyz",a=Math.round((new Date).getTime()/1e3)+60;this.$el.find("#account-form-token").val(s),this.$el.find("#account-form-expiration").val(a),this.$el.find("#login-remember").val(this.$el.find("#login-remember-checkbox").is(":checked")?1:0),t.length&&i.val(t.is(":checked")?"Y":"N"),n.length&&this.applicationName&&n.val("NYT5_MyAccount_Modal_"+this.applicationName+"_v2")},handleFormButton:function(){this.$el.find("form").submit()},handleKeyUp:function(t){var i=e(t.target);i.parent().find(".clear-button").toggle(""!==i.val())},handleClearButton:function(t){var n=e(t.currentTarget),s=n.parent().find("input");n.toggle(!1),s.val(""),i()},executeOauthLogin:function(t){t.preventDefault(),this.oauthPopup(e(t.currentTarget).data("providerName"))},addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},getPageUrlParams:function(){var t,i=window.location,n={URI:i.protocol+"//"+i.hostname+"/"+i.pathname.replace(/^\//,"")};return i.search.length>1&&(t=i.search.substr(1),t=t.replace(/(\?|&)?gwh=([^&]+)/g,""),t=t.replace(/(\?|&)?gwt=([^&]+)/g,""),t=t.replace(/%/g,"Q"),n.OQ=t),e.param(n)},getSocialLinkUrl:function(e,t,i){return s.myaccount+"/oauth/"+t+"-link?type=login&URI="+e+(i?"&view=popup":"")+"&flow=HPLI"},oauthPopup:function(e){var i,n,s="oauthPopup",a=450,o=600,r=this.getReturnUrl&&"function"==typeof this.getReturnUrl?this.getReturnUrl():document.URL;-1!==t.indexOf(this.oauthProviders,e)&&(n=["height="+o,"width="+a,"left="+(window.screen.availLeft+window.screen.width/2-a/2),"top="+Math.max(window.screen.height/2-o/2-20,0),"scrollbars=1"],i=window.open("about:blank",s,n.join(",")),i?(i=window.open(this.getSocialLinkUrl(r,e,!0),s,n.join(",")),i.focus()):window.location.href=this.getSocialLinkUrl(r,e))},renderOauthButtons:function(){return n.oauthButtons({facebookId:this.getFacebookButtonId(this.modalSettings.id),googleId:this.getGoogleButtonId(this.modalSettings.id),prefix:this.modalSettings.oauthButtonText})},addOauthEvents:function(e){this.$el.find("#"+this.getGoogleButtonId(e)+", #"+this.getFacebookButtonId(e)).on("click",t.bind(this.executeOauthLogin,this))},getFacebookButtonId:function(e){return"facebook-oauth-button-"+e},getGoogleButtonId:function(e){return"google-oauth-button-"+e}};return a}),define("shared/account/views/login-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/modal/views/modal","shared/account/templates","foundation/hosts","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=i.extend(t.extend({},r,{state:n.isLoggedIn()?"logged in":"logged out",events:{"click .registration-modal-trigger":"handleRegisterClick","click #login-send-button":"handleFormButton","submit #login-form":"handleFormSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp","click .oauth-button":"handleLoginModalClick","click .login-form":"handleLoginModalClick"},nytEvents:{"nyt:loginmodal-open":"handleOpen"},clearSelector:".field-container input",defaultSettings:{id:"login-modal",addlClasses:"account-modal",headerContent:a.accountModalHeader(),modalContent:"",modalFooter:a.loginModalFooter(),modalTitle:"Log in",moduleName:"LogIn",oauthButtonText:"Log in",binding:".login-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40,regiSource:"nyt"},initialize:function(e){var i=this;this.modalSettings=t.extend({},this.defaultSettings,e),this.registrationPlatform=!1,this.modalSettings.modalContent=a.logInModalContent({oauthButtons:this.renderOauthButtons(),loginUrl:o.myaccount+"/auth/login?"+this.getPageUrlParams(),forgotPasswordUrl:o.myaccount+"/seg/forgot-password?EXIT_URI="+encodeURIComponent(window.location.href)}),this.modalSettings.openCallback=function(){var e=i.modalTitle||(this.$target?this.$target.data("modal-title"):!1)||"Log in",t=i.moduleName||"LogIn";i.hasPlaceholderSupport&&this.$modal.find(".login-email").focus(),this.$modal.find("#login-modal-modal-heading").text(e),this.$modal.find(".modal-subheading").toggleClass("hidden","Log in"!==e),this.$modal.find(i.clearSelector).val(""),i.modalTitle=null,this.trackingTrigger("tagx-auth-interaction",{module:t,state:i.state,eventName:"modal popup | "+t})},this.subscribe("nyt:modal-show-login-modal",l)},handleDomReady:function(){this.render()},render:function(){this.logInModal=new s(this.modalSettings).addToPage(),this.setElement(this.logInModal.$modal),this.local(this,"nyt:modal-login-modal-rendered"),this.addOauthEvents(this.modalSettings.id)},handleOpen:function(e){e&&e.modalTitle&&(this.modalTitle=e.modalTitle),e&&e.moduleName&&(this.moduleName=e.moduleName),e&&e.registrationPlatform&&(this.registrationPlatform=e.registrationPlatform,this.regiSource=e.regiSource),this.logInModal&&this.logInModal.open()},handleUserReady:function(){n.isLoggedIn()&&(this.logInModal?(this.logInModal.removeFromPage(),this.remove()):this.subscribeOnce(this,"nyt:modal-login-modal-rendered",this.handleUserReady))},handleRegisterClick:function(e){var t={};e.stopPropagation(),this.registrationPlatform&&(t.platformTracking=this.registrationPlatform,t.regiSource=this.regiSource,this.registrationPlatform=!1),this.logInModal.close(),this.broadcast("nyt:registrationmodal-open",t),this.trackingTrigger("loginmodal-register-click",{module:"Registration",action:"Click","WT.z_ract":"Regnow"}),this.trackingTrigger("tagx-auth-interaction",{module:"Registration",state:this.state,eventName:"modal click | Registration"})},handleLoginModalClick:function(){this.trackingTrigger("tagx-auth-interaction",{module:"LogIn",state:this.state,eventName:"modal click | LogIn"})}}));return d}),define("shared/account/views/registration-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/modal/views/modal","shared/account/templates","foundation/hosts","shared/account/helpers/account-modal-mixin","foundation/lib/polyfills/placeholder"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=i.extend(t.extend({},r,{events:{"click .login-modal-trigger":"handleLoginClick","click #register-send-button":"handleFormButton","submit #registration-form":"handleFormSubmit","click .clear-button":"handleClearButton","keyup .text":"handleKeyUp"},nytEvents:{"nyt:registrationmodal-open":"handleOpen"},clearSelector:".field-container input",defaultSettings:{id:"registration-modal",addlClasses:"account-modal",headerContent:a.accountModalHeader(),modalContent:"",modalFooter:a.registrationModalFooter(),modalTitle:"Sign up",oauthButtonText:"Sign up",binding:".registration-modal-trigger",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,tailLeftOffset:-40,tailTopOffset:-40,regiSource:"nyt"},initialize:function(e){this.modalSettings=t.extend({},this.defaultSettings,e),this.platformTracking=!1,this.applicationName=this.pageManager.getMeta("applicationName")},handleUserReady:function(){var t=this;return-1!==o.www.indexOf("stg")&&-1!==window.location.search.indexOf("fakeCanada")?(this.country="Canada",void this.continueUserReady()):void(n.getCountry()?(this.country=n.getCountry(),this.continueUserReady()):e.ajax({url:o.contentApiHost+"/svc/location/v1/current.json",type:"GET",dataType:"json",success:function(e){t.country=e.country,t.continueUserReady()}}))},continueUserReady:function(){var t=this;this.modalSettings.modalContent||(this.modalSettings.modalContent=a.registrationModalContent({oauthButtons:this.renderOauthButtons(),regiUrl:o.myaccount+"/register?"+this.getPageUrlParams(),marketing:this.country&&"canada"!==this.country.toLowerCase()})),this.modalSettings.openCallback=function(){var i=t.modalTitle||(this.$target?this.$target.data("modal-title"):!1)||"Sign up";t.hasPlaceholderSupport&&this.$modal.find(".register-email").focus(),this.$modal.find("#registration-modal-modal-heading").text(i),this.$modal.find(".modal-subheading").toggleClass("hidden","Sign up"!==i),this.$modal.find(t.clearSelector).val(""),e("#account-form-platform").remove(),t.modalTitle=null,t.platformTracking&&(e("#registration-form").append('<input type="hidden" name="regi_info_platform" id="account-form-platform" value="'+t.platformTracking+'">').append('<input type="hidden" name="regi_info_source" value="'+t.regiSource+'"><input type="hidden" name="regi_info_interface" value="nytpw">'),t.platformTracking=!1)},this.subscribe("nyt:modal-show-registration-modal",l),this.userDataDone=!0,this.trigger("nyt:user-data-done")},handleDomReady:function(){this.userDataDone?this.render():this.listenToOnce(this,"nyt:user-data-done",this.render)},render:function(){this.registrationModal=new s(this.modalSettings).addToPage(),this.setElement(this.registrationModal.$modal),this.addOauthEvents(this.modalSettings.id)},handleLoginClick:function(){this.registrationModal.close()},handleOpen:function(e){e&&e.modalTitle&&(this.modalTitle=e.modalTitle),e&&e.platformTracking&&(this.platformTracking=e.platformTracking,this.regiSource=e.regiSource),this.registrationModal&&this.registrationModal.open()}}));return d}),define("shared/account/instances/account",["shared/account/views/login-modal","shared/account/views/registration-modal","foundation/models/user-data"],function(e,t,i){"use strict";i.isLoggedIn()||(new e,new t)}),define("shared/navigation/templates",["underscore/nyt"],function(_){var templates={};return templates.mainPanel=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="sections">\n';var count=1;__p+="\n",_.each(level1,function(e){__p+='\n<div class="section '+(null==(__t=isVisible(e[0],count)===!1?"hidden":"")?"":__t)+'">\n<ul class="menu" role="menubar">\n',_.each(e,function(e){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:isVisible(e,count)}))?"":__t)+"\n",count+=iterateTemplateCount(e),__p+="\n"}),__p+="\n",count+=1,__p+="\n</ul>\n</div>\n"}),__p+="\n</div>"}return __p},templates.menuItem=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li role="presentation" class="'+(null==(__t=isVisible===!1?"hidden":"menuitem-visible")?"":__t)+'">\n<a id="navId-'+(null==(__t=model.getTaxonomyId())?"":__t)+'"\nclass="'+(null==(__t=model.getEdition())?"":__t)+" "+(null==(__t=model.hasChildren()?"expandable":"")?"":__t)+'"\nrole="menuitem" '+(null==(__t=model.getPath()?' href="'+model.getPath()+'"':' tabindex="0"')?"":__t)+"\n"+(null==(__t=model.hasChildren()?' aria-haspopup="true" aria-expanded="false"':"")?"":__t)+">\n"+(null==(__t=model.get("name"))?"":__t)+"\n",model.hasChildren()&&(__p+='\n<div class="arrow arrow-right">\n<div class="arrow-conceal"></div>\n</div>\n',model.getLevel()>1&&(__p+='\n<div class="arrow arrow-left">\n<div class="arrow-conceal"></div>\n</div>\n'),__p+="\n"),__p+="\n</a>\n</li>";return __p},templates.mobileNav=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<section class="edition-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li class="'+(null==(__t=isGlobalEdition?"":"active")?"":__t)+'"><a href="https://mobile.nytimes.com/"><span>U.S. Edition</span></a></li>\n</ul>\n<ul class="menu">\n<li class="'+(null==(__t=isGlobalEdition?"active":"")?"":__t)+'"><a href="https://mobile.nytimes.com/international/"><span>International Edition</span></a></li>\n</ul>\n</section>\n<section class="primary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="https://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'"><span>Home</span></a></li>\n<li><a href="https://mobile.nytimes.com/world/"><span>World</span></a></li>\n<li><a href="https://mobile.nytimes.com/national/"><span>U.S. '+(null==(__t=isGlobalEdition?"News":"")?"":__t)+'</span></a></li>\n<li><a href="https://mobile.nytimes.com/politics/"><span>'+(null==(__t=isGlobalEdition?"U.S.":"")?"":__t)+' Politics</span></a></li>\n<li><a href="https://mobile.nytimes.com/upshot/"><span>The Upshot</span></a></li>\n<li><a href="https://mobile.nytimes.com/nyregion/"><span>New York</span></a></li>\n<li><a href="https://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'business/"><span>Business '+(null==(__t=isGlobalEdition?"":"Day")?"":__t)+'</span></a></li>\n<li><a href="https://mobile.nytimes.com/technology/"><span>Technology</span></a></li>\n<li><a href="https://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'sports/"><span>Sports</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="https://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'opinion/"><span>Opinion</span></a></li>\n<li><a href="https://mobile.nytimes.com/science/"><span>Science</span></a></li>\n<li><a href="https://mobile.nytimes.com/health/"><span>Health</span></a></li>\n<li><a href="https://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'arts/"><span>Arts</span></a></li>\n<li><a href="https://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'style/"><span>Style</span></a></li>\n<li><a href="https://mobile.nytimes.com/photos/"><span>Photos</span></a></li>\n<li><a href="https://mobile.nytimes.com/video/"><span>Video</span></a></li>\n<li><a href="https://mobile.nytimes.com/most-emailed/"><span>Most Emailed</span></a></li>\n<li><a href="https://mobile.nytimes.com/times-insider/"><span>Times Insider</span></a></li>\n</ul>\n</section>\n<section class="secondary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="https://mobile.nytimes.com/automobiles/"><span>Automobiles</span></a></li>\n<li><a href="https://mobile.nytimes.com/blogs/"><span>Blogs</span></a></li>\n<li><a href="https://mobile.nytimes.com/books/"><span>Books</span></a></li>\n<li><a href="https://mobile.nytimes.com/'+(null==(__t=isGlobalEdition?"international/":"")?"":__t)+'dining/"><span>Food</span></a></li>\n<li><a href="https://mobile.nytimes.com/education/"><span>Education</span></a></li>\n<li><a href="https://mobile.nytimes.com/magazine/"><span>Magazine</span></a></li>\n<li><a href="https://mobile.nytimes.com/mens-style/"><span>Men\'s Style</span></a></li>\n<li><a href="https://mobile.nytimes.com/movies/"><span>Movies</span></a></li>\n<li><a href="https://mobile.nytimes.com/music/"><span>Music</span></a></li>\n<li><a href="https://mobile.nytimes.com/business/media/"><span>Media &amp; Advertising</span></a></li>\n<li><a href="https://mobile.nytimes.com/obituaries/"><span>Obituaries</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="https://www.nytimes.com/section/reader-center"><span>Reader Center</span></a></li>\n',
isGlobalEdition||(__p+='\n<li><a href="https://mobile.nytimes.com/realestate/"><span>Real Estate</span></a></li>\n'),__p+='\n<li><a href="https://mobile.nytimes.com/opinion/sundayreview/"><span>Sunday Review</span></a></li>\n',isGlobalEdition&&(__p+='\n<li><a href="https://mobile.nytimes.com/opinion/international/greathomes/"><span>Great Homes and Destinations</span></a></li>\n'),__p+='\n<li><a href="https://mobile.nytimes.com/tmagazine/"><span>T Magazine</span></a></li>\n<li><a href="https://mobile.nytimes.com/television/"><span>Television</span></a></li>\n<li><a href="https://mobile.nytimes.com/theater/"><span>Theater</span></a></li>\n<li><a href="https://mobile.nytimes.com/timeswire/"><span>Times Wire</span></a></li>\n<li><a href="https://mobile.nytimes.com/travel/"><span>Travel</span></a></li>\n<li><a href="https://mobile.nytimes.com/weddings/"><span>Weddings</span></a></li>\n<li><a href="http://nytlive.nytimes.com/womenintheworld/"><span>Women In The World</span></a></li>\n<li><a href="https://mobile.nytimes.com/corrections/"><span>Corrections</span></a></li>\n</ul>\n</section>\n<section class="tertiary-navigation">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="https://mobile.nytimes.com/recommendations/"><span>Recommendations</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="https://mobile.nytimes.com/saved/"><span>Saved</span></a></li>\n</ul>\n</section>\n<section class="settings '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><span class="label">Account:</span> '+(null==(__t=userData.getUserName())?"":__t)+'</li>\n</ul>\n</section>\n<section class="logout '+(null==(__t=userData.isLoggedIn()?"":"hidden")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="https://myaccount.nytimes.com/mobile/logout/smart/index.html?EXIT_URI='+(null==(__t=encodeURIComponent(window.location))?"":__t)+'"><span>Log out</span></a></li>\n</ul>\n</section>\n<section class="account '+(null==(__t=userData.isLoggedIn()?"hidden":"")?"":__t)+'">\n<h2 class="section-heading visually-hidden">Navigation Section</h2>\n<ul class="menu">\n<li><a href="http://www.nytimes.com/mowweb/ftnotlog"><span>Subscribe</span></a></li>\n</ul>\n<ul class="menu">\n<li><a href="https://myaccount.nytimes.com/mobile/login/smart/index.html?EXIT_URI='+(null==(__t=encodeURIComponent(window.location))?"":__t)+'"><span>Log In</span></a></li>\n</ul>\n</section>';return __p},templates.navigationModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="secondary-container">\n'+(null==(__t=secondary)?"":__t)+'\n</div>\n<div class="tertiary-container">\n'+(null==(__t=tertiary)?"":__t)+"\n</div>";return __p},templates.secondaryPanel=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="secondary-container">\n<div class="header">\n<h5 class="section-heading"><a href="" role="menuitem"></a></h5>\n</div>\n';var count=1;__p+="",_.each(level2,function(e){__p+='\n<div class="section '+(null==(__t="432A1823-3F24-43C0-8004-79088F94E754"===e[0].getParentId()?"video":"")?"":__t)+'" data-parent="navId-'+(null==(__t=e[0].getParentId())?"":__t)+'">\n<ul class="secondary" role="menu">\n',_.each(e,function(e){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:!0}))?"":__t)+"\n"}),__p+="\n</ul>\n</div><!-- close secondary "+(null==(__t=e[0].getParentId())?"":__t)+" sections -->\n"}),__p+="",_.each(level1,function(e){__p+='\n<div class="section section-more '+(null==(__t=isVisible(e[0],count,!0)===!1?"hidden":"")?"":__t)+'"  data-parent="navId-more-section">\n<ul class="secondary" role="menu">\n',_.each(e,function(e){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:isVisible(e,count,!0)}))?"":__t)+"\n",count+=iterateTemplateCount(e),__p+="\n"}),__p+="\n",count+=1,__p+="\n</ul>\n</div>\n"}),__p+="</div><!-- close secondary modal -->"}return __p},templates.tertiaryPanel=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="header">\n<h5 class="section-heading"><a href="" role="menuitem"></a></h5>\n</div>\n',_.each(level3,function(e,t){__p+='\n<ul class="tertiary" data-parent="navId-'+(null==(__t=e[0].getParentId())?"":__t)+'" role="menu">\n',_.each(e,function(e,t){__p+="\n"+(null==(__t=liTemplate({model:e,isVisible:!0}))?"":__t)+"\n"}),__p+="\n</ul>\n"}),__p+="";return __p},templates}),define("shared/data/models/section",["backbone/nyt"],function(e){"use strict";var t=e.Model.extend({defaults:{name:"",edition:"",className:"",path:"",show_in_nav:!0,hasSubsections:!1,level:1,taxonomyId:""},getTaxonomyId:function(){return this.get("taxonomyId")},getParentId:function(){return this.get("parent")},getEdition:function(){var e=this.get("edition");return"global"===e?"international":e},hasChildren:function(){return this.get("hasSubsections")},getPath:function(){return this.get("path")},getLevel:function(){return this.get("level")}});return t}),define("shared/data/collections/taxonomy",["backbone/nyt","underscore/nyt","foundation/collections/base-collection","shared/data/models/section","foundation/hosts","foundation/models/user-data"],function(e,t,i,n,s){"use strict";var a=i.extend({url:s.staticHost+"/services/json/taxonomy/v2/flat.json",model:n,sectionMarkers:["C5BFA7D5-359C-427B-90E6-6B7245A6CDD8","5C13EEDD-D905-4D8C-A284-6859EA434563","8FB1308A-FFE4-4BED-ADF6-659A680D0884","6101A43A-8BDE-45FF-AAD5-EF7396F83AC9","FED853D9-D192-46F6-8D18-447803EB4A7B"],initialize:function(){this.editionString="us"===this.pageManager.getEdition()?"domestic":"global",this.level1=[],this.level2=[],this.level3=[],this.fetch()},sync:function(t,i,n){return n.dataType="json",n.cache=!0,e.sync(t,i,n)},parse:function(i){var s,a,o,r=0,l=new e.Collection,d=t.map(i.elements,function(e){return e.taxonomyId=e.id,e.id=r++,e});for(l.model=n,l.reset(d),s=l.where({parent:null}),a=0,r=0,o=s.length;o>r;r+=1)t.indexOf(this.sectionMarkers,s[r].get("taxonomyId"))>=0&&(this.levelData(l,s.slice(a,r),0),a=r);return this.levelData(l,s.slice(a,s.length),0),this.level1.push([new n({name:"More",taxonomyId:"more-section",hasSubsections:!0})]),l.toJSON()},levelData:function(e,i,n){var s,a,o,r,l,d,c;if(t.isArray(i))for(this["level"+(n+1)].push(i),s=0,a=i.length;a>s;s+=1)this.levelData(e,i[s],n+1);else 3>n&&(c=e.where({taxonomyId:i.get("taxonomyId")}).length>1,o=e.where({parent:i.get("taxonomyId"),show_in_nav:!0}),c&&(o=t.uniq(o,function(e){return e.get("taxonomyId")}))),r=o&&o.length>0,i.set("className",i.get("name").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()),i.set("hasSubsections",r),i.set("level",n),l=i.get("alternate_editions"),l&&l[this.editionString]&&(d=e.findWhere({taxonomyId:l[this.editionString]}),i.set("editionName",d.get("name")),i.set("editionPath",d.get("path"))),r&&this.levelData(e,o,n)},getPrimarySections:function(){return this.level1},getSecondarySections:function(){return this.level2},getTertiarySections:function(){return this.level3},getSectionByKeyword:function(e){return this.find(function(t){var i=t.get("path")||"";return i.indexOf("/"+e+"/index.html")>0})}});return a}),define("shared/data/instances/taxonomy",["shared/data/collections/taxonomy"],function(e){"use strict";return new e}),define("shared/navigation/views/navigation",["module","jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager","foundation/hosts","foundation/models/user-data","shared/modal/views/modal","shared/navigation/templates","shared/data/instances/taxonomy"],function(e,t,i,n,s,a,o,r,l,d){"use strict";var c=n.registerView("navigation").extend({module:e,el:"#navigation",navTemplate:l.navigation,modalTemplate:l.navigationModalContent,events:{mouseleave:"delayedClose",mouseenter:"cancelDelayedClose","mouseenter li a":"tryPrimaryHover","mouseleave li a.expandable":"delayedModalClose","click li a":"activatePrimaryItem","click .menu a[href]":"handlePrimaryNavigationClick"},nytEvents:{"nyt:masthead-section-click":"toggle","nyt:navigation-toggle-ready":"toggle","nyt:navigation-edge-click":"open","nyt:navigation-edge-mouse-enter":"delayedOpen","nyt:navigation-edge-mouse-leave":"cancelDelayedOpen","nyt:messaging-critical-alerts-move-furniture":"moveNav","nyt:messaging-suggestions-move-furniture":"moveNav","nyt:a11y-enabled":"enableA11Nav","nyt:a11y-disabled":"disableA11yNav"},defaultSettings:{panelwidth:210,navTimeout:500,navAnimation:150,hoverTimeout:500,intentRangeLower:10,intentRangeUpper:170,maxMouseLocs:2,a11yEnabled:!1},modalSettings:{id:"navigation-modal",modalTitle:"",modalContent:"",tailDirection:"left-top",closeOnClick:!1,fixedOverride:!0,autoPosition:!0,positionTailSide:!0,toggleSpeed:1},mouseLocs:[],navIds:{REAL_ESTATE:"navId-92720057-BCB6-4BDB-9351-12F29393259F",OPINION_DOMESTIC:"navId-09736473-CB3F-4B2F-9772-3AF128ABE12D",OPINION_INTERNATIONAL:"navId-AD8090D7-4137-4D71-84C8-70DA3BD89778",VIDEO:"navId-432A1823-3F24-43C0-8004-79088F94E754",CONFERENCES:"navId-0442C365-4B63-4B63-B9DE-3C28319CB622",MORE:"navId-more-section"},navLevels:{PRIMARY:1,SECONDARY:2,TERTIARY:3},initialize:function(e){i.bindAll(this,"tryPrimaryHover","trySecondaryHover","open","close","render","saveMousePosition","delayedOpen","delayedClose","cancelDelayedOpen","cancelDelayedClose","delayedModalOpen","delayedModalClose","cancelDelayedModalOpen","cancelDelayedModalClose","delayedPrimaryHover","cancelDelayedPrimaryHover","delayedSecondaryHover","cancelDelayedSecondaryHover","handleClickClose","handleTapClose","detectFalsePositive","isNavItemVisible","iterateTemplateCount"),this.settings=i.extend({},this.defaultSettings,e),this.singlePanelWidth=this.settings.panelwidth+"px",this.singlePanelPartlyShut=this.settings.panelwidth-20+"px",this.isNavAnimating=!1,this.timer={},d.length>0?this.render():this.subscribeOnce(d,"sync",this.render),this.$document.on("click","#navigation-modal a[href]",i.bind(this.handleModalClick,this)),this.trackingBaseData={module:"SectionsNav",action:"click",version:"BrowseTree",region:"TopBar"}},handleUserReady:function(){this.updateCrosswordSubscriptionLink(),this.updateSiteIndexNavigation()},updateCrosswordSubscriptionLink:function(){var e=o.isTabletSubscriber(),i=o.isSmartphoneSubscriber(),n=o.isHomeDeliverySubscriber(),s=o.isPremierSubscriber(),r=o.isOpinionSubscriber(),l=o.isCrosswordsSubscriber(),d=a.www+"/subscriptions/games/lp8J6KQ.html?campaignId=49W96",c=a.www+"/subscriptions/games/lp897H9.html?campaignId=49W8Y";(e||i||n||s||r)&&!l?t("#nyt-crossword").attr("href",d):l||t("#nyt-crossword").attr("href",c)},handlePrimaryNavigationClick:function(e){var i=t(e.currentTarget),n=this.trackingAppendParams(i.attr("href"),{contentCollection:t.trim(i.text())});i.attr("href",n)},handleModalClick:function(e){var i=t(e.currentTarget),n=t.trim(t("#navigation-modal").find(".secondary-container .header").text()),s=this.trackingAppendParams(i.attr("href"),{contentCollection:n+"/"+t.trim(i.text()),contentPlacement:i.closest("ul").hasClass("secondary")?2:3});i.attr("href",s)},moveNav:function(e){e(this.$el)},render:function(){var e,t,n,s=23,a=33,o=this,c=this.$body.find(".navigation-modal");this.navItemsInView=s,this.navItemsInView=Math.floor((this.pageManager.getViewport().height-41)/26),this.pageManager.isMobile()?this.navItemsInView=s:this.navItemsInView>a?this.navItemsInView=a:this.navItemsInView<s&&(this.navItemsInView=s),this.$el.append(l.mainPanel({level1:d.getPrimarySections(),liTemplate:l.menuItem,isVisible:this.isNavItemVisible,iterateTemplateCount:this.iterateTemplateCount})),e=l.secondaryPanel({level1:i.initial(d.getPrimarySections()),level2:d.getSecondarySections(),liTemplate:l.menuItem,isVisible:this.isNavItemVisible,iterateTemplateCount:this.iterateTemplateCount}),t=l.tertiaryPanel({level3:d.getTertiarySections(),liTemplate:l.menuItem}),c.eq(0).remove(),this.modalSettings.modalContent=l.navigationModalContent({secondary:e,tertiary:t}),this.navigationModal=new r(this.modalSettings),this.navigationModal.addToPage(),this.navigationModal.$modal.on("mouseover",".secondary li a",o.trySecondaryHover).on("click",".secondary li a.expandable",o.activateSecondaryItem).on("mouseenter",".tertiary-container",o.cancelDelayedSecondaryHover).on("mouseenter",function(){o.cancelDelayedClose(),o.cancelDelayedModalClose(),o.cancelDelayedPrimaryHover()}).on("mouseleave",function(){o.delayedClose(),o.delayedModalClose()}),this.navigationModal.$modal.find(".secondary-container .hidden .menuitem-visible").eq(0).closest(".section").removeClass("hidden"),n=this.navigationModal.$modal.find(".section-more"),this.moreInModalHeight=25*n.find(".menuitem-visible").length+30*n.not(".hidden").length+45},isNavItemVisible:function(e,t,i){return i?t>this.navItemsInView&&"more-section"!==e.getTaxonomyId():t<=this.navItemsInView||"more-section"===e.getTaxonomyId()},iterateTemplateCount:function(e){var t="global"===this.pageManager.getEdition()?"international":"domestic";return e.getEdition()&&t!==e.getEdition()?0:1},toggle:function(){this.$el.hasClass("active")?this.close():this.open()},open:function(){var e=this,t={width:e.singlePanelPartlyShut,display:"block",opacity:"0"},i={width:e.singlePanelWidth,opacity:"1"};this.isNavAnimating||this.$el.hasClass("active")!==!1||(this.$el.css(t),this.$el.toggleClass("active"),this.$html.toggleClass("navigation-active"),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.isNavAnimating=!1,e.$body.on("click",e.handleTapClose)}),this.pageManager.isMobile()&&this.$body.css("cursor","pointer"),this.settings.a11yEnabled&&this.toggleFocusEvents(!0),this.broadcast("nyt:navigation-opened",this),this.$document.on("mousemove",this.saveMousePosition))},close:function(){var e,t,i;this.isNavAnimating||this.$el.hasClass("active")!==!0||(e=this,t=this.$el.css("marginTop"),i={width:this.singlePanelPartlyShut,opacity:"0"},this.navigationModal.close(),this.resetNav(this.navLevels.SECONDARY),this.isNavAnimating=!0,this.$el.animate(i,this.settings.navAnimation,function(){e.$el.toggleClass("active"),e.$html.toggleClass("navigation-active"),e.$body.off("click",e.handleClickClose),e.$body.off("click",e.handleTapClose),e.$el.removeAttr("style"),e.$el.css("marginTop",t),e.$el.find("a").removeClass("active"),e.isNavAnimating=!1}),this.pageManager.isMobile()&&this.$body.css("cursor",""),this.settings.a11yEnabled&&this.toggleFocusEvents(!1),this.broadcast("nyt:navigation-closed",this),this.$document.off("mousemove",this.saveMousePosition))},resetNav:function(e){var t=this.navigationModal.$modal;e===this.navLevels.SECONDARY&&t.find(".section").removeClass("active"),t.find(".secondary a").removeClass("active"),t.find(".tertiary").removeClass("active"),t.find(".modal-content").removeClass("expanded"),t.find(".section-heading a").removeClass("active")},activatePrimaryItem:function(e){var i,n,s,a,o,r,l,d=t(e.target).closest("a"),c=d.attr("id");e.stopPropagation(),d.hasClass("active")||this.isNavAnimating!==!1||(d.hasClass("expandable")?(i=this.navigationModal,n=i.$modal.find('[data-parent="'+c+'"]').find("li").length,s=55,a=29*n,o=a+s,l=i.$modal.find(".secondary-container"),c===this.navIds.MORE?o=this.moreInModalHeight||553:c===this.navIds.OPINION_DOMESTIC||c===this.navIds.OPINION_INTERNATIONAL?o=357:c===this.navIds.VIDEO?(o=310,l.css("width","380px")):c===this.navIds.CONFERENCES&&l.css("width","220px"),this.cancelDelayedModalClose(),this.resetNav(this.navLevels.SECONDARY),i.$modal.height(o),e.currentTarget=e.target,i.open(e),this.moveModalArrow(),this.$el.find("a").removeClass("active").attr("aria-expanded","false"),d.addClass("active").attr("aria-expanded","true"),i.$modal.find(".secondary").removeClass("active"),r=i.$modal.find(".secondary-container .section-heading"),this.setHeadingText(d,r),i.$modal.find('[data-parent="'+c+'"]').addClass("active"),c!==this.navIds.VIDEO&&c!==this.navIds.CONFERENCES&&l.css("width","190px"),this.broadcast("nyt:navigation-level-one-open",i.$modal)):this.modalClose())},setHeadingText:function(e,t){e.attr("href")?t.html('<a href="'+e.attr("href")+'" tabinxdex="0" role="menuitem" class="active">'+e.text()+"</a>"):t.html(e.text())},moveModalArrow:function(){var e,i,n,s=this.navigationModal.$modal,a=12,o=18,r=39,l=this.settings.panelwidth-10;t("html").hasClass("viewport-large-70")&&(l+=t("#navigation-edge").width()),s.css("left",l+"px"),e=s.find(".modal-pointer"),e.hasClass("modal-pointer-left")?(i=Math.floor(s.outerHeight()/2)-o,e.css("top",i+"px")):e.hasClass("modal-pointer-left-top")?e.css("top",a,"px"):e.hasClass("modal-pointer-left-bottom")&&(n=s.outerHeight()-r,e.css("top",n+"px"))},activateSecondaryItem:function(e){var i,n,s=t(e.target).closest("a");s.hasClass("active")||this.isNavAnimating!==!1||(e.preventDefault(),i=this.navigationModal.$modal,s.hasClass("expandable")?(this.resetNav(this.navLevels.TERTIARY),i.find(".modal-content").addClass("expanded"),n=i.find(".tertiary-container .section-heading"),this.setHeadingText(s,n),i.find('[data-parent="'+s.attr("id")+'"]').eq(0).addClass("active"),s.addClass("active").attr("aria-expanded","true"),this.broadcast("nyt:navigation-level-two-open",i.find(".tertiary-container"))):(this.resetNav(this.navLevels.TERTIARY),s.addClass("active")))},tryPrimaryHover:function(e){var i,n=t(e.target).closest("a"),s=n.hasClass("expandable");this.cancelDelayedClose(),s&&this.cancelDelayedModalClose(),this.cancelDelayedPrimaryHover(),this.$el.find("li a.active").length>0?(i=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),i>this.defaultSettings.intentRangeLower&&i<this.defaultSettings.intentRangeUpper?this.delayedPrimaryHover(e):this.activatePrimaryItem(e)):this.activatePrimaryItem(e)},trySecondaryHover:function(e){var t;this.cancelDelayedClose(),this.cancelDelayedModalClose(),this.cancelDelayedSecondaryHover(),this.navigationModal.$modal.find(".modal-content").hasClass("expanded")?(t=this.getAngle(this.mouseLocs[0],this.mouseLocs[1]),t>this.defaultSettings.intentRangeLower&&t<this.defaultSettings.intentRangeUpper?this.delayedSecondaryHover(e):this.activateSecondaryItem(e)):this.activateSecondaryItem(e)},getAngle:function(e,t){var i,n,s,a,o,r,l;return e&&t?(i=e.x,n=e.y,s=t.x,a=t.y,o=s-i,r=a-n,l=Math.round(180*Math.atan2(o,r)/Math.PI*10)/10):null},delayedOpen:function(){this.timer.navOpen=window.setTimeout(this.open,this.defaultSettings.navTimeout)},delayedClose:function(){this.timer.navClose=window.setTimeout(this.close,this.defaultSettings.navTimeout)},cancelDelayedOpen:function(){window.clearTimeout(this.timer.navOpen)},cancelDelayedClose:function(){window.clearTimeout(this.timer.navClose)},delayedModalOpen:function(){this.timer.modalOpen=window.setTimeout(this.navigationModal.open,this.defaultSettings.navTimeout)},delayedModalClose:function(){var e=this;this.cancelDelayedPrimaryHover(),this.cancelDelayedSecondaryHover(),this.timer.modalClose=window.setTimeout(function(){e.modalClose()},this.defaultSettings.navTimeout)},modalClose:function(){this.$el.find("a").removeClass("active"),this.navigationModal.close(),this.broadcast("nyt:navigation-level-one-closed")},cancelDelayedModalOpen:function(){window.clearTimeout(this.timer.modalOpen)},cancelDelayedModalClose:function(){window.clearTimeout(this.timer.modalClose)},delayedPrimaryHover:function(e){var t=this;t.timer.primaryHoverIntent=window.setTimeout(function(){t.activatePrimaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedPrimaryHover:function(){window.clearTimeout(this.timer.primaryHoverIntent)},delayedSecondaryHover:function(e){var t=this;t.timer.secondaryHoverIntent=window.setTimeout(function(){t.activateSecondaryItem(e)},this.defaultSettings.hoverTimeout)},cancelDelayedSecondaryHover:function(){window.clearTimeout(this.timer.secondaryHoverIntent)},handleClickClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},handleTapClose:function(e){0===t(e.target).closest("#navigation, #navigation-modal").length&&this.close()},saveMousePosition:function(e){this.mouseLocs.length>1?(this.mouseLocs[1].x!==e.pageX||this.mouseLocs[1].y!==e.pageY)&&(this.mouseLocs.push({x:e.pageX,y:e.pageY}),this.mouseLocs.length>this.defaultSettings.maxMouseLocs&&this.mouseLocs.shift()):this.mouseLocs.push({x:e.pageX,y:e.pageY})},toggleFocusEvents:function(e){var t=e?"subscribe":"stopSubscribing";this[t]("nyt:page-key-tab nyt:page-key-up-a11y nyt:page-key-down-a11y",this.handleFocusKey),this[t]("nyt:page-key-esc-a11y nyt:page-key-left-a11y",this.handleCollapseKey),this[t]("nyt:page-key-enter nyt:page-key-right-a11y",this.handleExpandKey),this[t]("nyt:navigation-level-one-open nyt:navigation-level-two-open",this.addFocusableElements),e?(this.focusableElements=[],this.addFocusableElements(),this.$document.on("mousemove",this.detectFalsePositive)):delete this.focusableElements},addFocusableElements:function(e){var t,n;this.settings.a11yEnabled&&(e&&e.length>0?n=".active a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible":(e=this.$el,n="a[role=menuitem]:visible, .section-heading a.active[role=menuitem]:visible"),t=e.find(n).toArray(),this.focusableElements.push({first:t[0],all:t,last:i.last(t)}),t[0].focus())},handleFocusKey:function(e){var t=i.last(this.focusableElements),n=this.getKeyDirection(e),s=document.activeElement;if(s===t.last&&"forward"===n)t.first.focus();else if(s===t.first&&"backward"===n)t.last.focus();else if("forward"===n)t.all[i.indexOf(t.all,s)+1].focus();else{if("backward"!==n)return;t.all[i.indexOf(t.all,s)-1].focus()}e.preventDefault()},handleCollapseKey:function(){var e;this.focusableElements.pop(),e=i.last(this.focusableElements),this.focusableElements.length>1?(this.resetNav(this.navLevels.TERTIARY),e.active.focus()):this.focusableElements.length>0?(this.modalClose(),e.active.focus()):this.close()},handleExpandKey:function(e){var n=t(document.activeElement),s=i.last(this.focusableElements);s.active=n,n.hasClass("expandable")&&(e.preventDefault(),n.closest(".secondary").length>0?this.activateSecondaryItem(e):this.activatePrimaryItem(e))},detectFalsePositive:i.throttle(function(e){t(e.target).is('a[role="menuitem"], li[role="presentation"')&&this.disableA11yNav()},1e3),getKeyDirection:function(e){var t="",i=this.pageManager.KEYS,n=e&&e.keyCode?e.keyCode:null;switch(n){case i.UP:case i.LEFT:t="backward";break;case i.DOWN:case i.RIGHT:case i.TAB:t="forward"}return t},enableA11Nav:function(){this.settings.a11yEnabled=!0},disableA11yNav:function(){this.settings.a11yEnabled=!1,this.toggleFocusEvents(!1),this.$document.off("mousemove",this.detectFalsePositive)},updateSiteIndexNavigation:function(){var e=a.www+"/subscriptions/Multiproduct/lp8R34X.html?campaignId=6L9RJ",i=a.www+"/newsletters?campaignId=6L9RL";(o.isWebSubscriber()||o.isMobileSubscriber())&&(t(".digital-subscription").attr("href",e).html("Gift Subscriptions"),t(".gift-subscription").hide()),o.isHomeDeliverySubscriber()&&(t(".nyt-home-delivery").attr("href",i).html("Newsletters"),t(".digital-subscription").attr("href",e).html("Gift Subscriptions"),t(".email-newsletters, .gift-subscription").hide())}});return c}),define("shared/navigation/views/navigation-edge-adjust",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.registerView("navigation").extend({el:"#navigation-edge",events:{mouseenter:"handleMouseOver",mouseleave:"handleMouseOut",click:"handleClick"},nytEvents:{"nyt:page-breakpoint":"handleBreakPoint"},initialize:function(){this.pageManager.isDomReady()?this.render():this.subscribe("nyt:page-ready",this.render)},render:function(){this.$shell=e("#shell"),this.pageManager.getCurrentBreakpoint()>=10070&&(this.setNavWidth(),this.subscribe("nyt:page-resize",this.setNavWidth))},setNavWidth:function(){var e=this.$shell.offset();this.$shell.offset()&&(this.broadcast("nyt:navigation-edge-size-change",e.left),this.$el.css("width",e.left))},handleBreakPoint:function(e){e>=10070?this.subscribe("nyt:page-resize",this.setNavWidth):(this.stopSubscribing("nyt:page-resize",this.setNavWidth),this.$el.css("width",""))},handleMouseOver:function(e){(0!==e.clientX||0!==e.clientY)&&this.broadcast("nyt:navigation-edge-mouse-enter",e)},handleMouseOut:function(e){this.broadcast("nyt:navigation-edge-mouse-leave",e)},handleClick:function(){this.broadcast("nyt:navigation-edge-click")}});return n}),define("shared/navigation/views/mobile-navigation",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/navigation/views/navigation","shared/navigation/views/navigation-edge-adjust","shared/navigation/templates","foundation/models/user-data"],function(e,t,i,n,s,a,o){"use strict";var r=i.registerView("mobile-navigation").extend({el:"#mobile-navigation",hiddenEl:"#main, #ribbon, #site-index",nytEvents:{"nyt:masthead-section-click":"handleSectionClick","nyt:page-breakpoint":"handleBreakPoint"},handleUserReady:function(){this.$masthead=e("#masthead").find(".sections-button"),this.$homeButton=e("#masthead").find(".home-button"),this.render()},render:function(){this.$el.append(a.mobileNav({userData:o,isGlobalEdition:this.pageManager.isInternationalEdition()}))},open:function(){this.$el.removeClass("hidden"),this.$masthead.addClass("mobile-navigation-active"),this.$homeButton.addClass("hidden"),this.$el.focus(),e(this.hiddenEl).addClass("hidden"),window.scrollTo(0,0)},close:function(){this.$el.addClass("hidden"),this.$masthead.removeClass("mobile-navigation-active"),e(this.hiddenEl).removeClass("hidden"),this.$homeButton.removeClass("hidden")},handleSectionClick:function(){this[this.$el.is(":visible")?"close":"open"]()},handleBreakPoint:function(e){e>=765&&(new n,new s,this.close(),this.remove())}});return r}),define("shared/navigation/views/site-index-responsive",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.registerView("navigation").extend({events:{"click a":"handleSiteIndexClick","click .menu-heading":"handleClick","click .menu-label":"handleClick","keyup .menu-heading":"handleKeyboard"},nytEvents:{"nyt:page-breakpoint":"handleBreakPoint"},initialize:function(){var e=this.$el.find(".column");this.$columnHeader=e.find("h3"),this.$columnContents=e.find("ul")},handleDomReady:function(){this.render()},render:function(){this.subscribe("nyt:page-resize",this.setNavWidth),this.handleBreakPoint()},handleBreakPoint:function(){var t,i,n,s;this.pageManager.getCurrentBreakpoint()>=1e3?(this.isSmallSiteIndex=!1,t="removeClass",i="removeAttr",this.$columnContents[t]("expanded")[t]("collapsed")[i]("aria-expanded","true")[i]("aria-expanded","false")):(this.isSmallSiteIndex=!0,t="addClass",i="attr",this.$columnContents[t]("collapsed")[i]("aria-expanded","true")[i]("aria-expanded","false")),this.$columnHeader[t]("toggle")[i]("role","button")[i]("tabindex","0")[i]("aria-pressed","true")[i]("aria-pressed","false"),e.each(this.$columnHeader,function(t,a){s=e(a),n=s.text(),n=n.substr(0,n.indexOf(" ")).toLowerCase(),s[i]("id",n+"-menu-heading")[i]("aria-controls",n+"-menu"),s.siblings("ul")[i]("id",n+"-menu")[i]("aria-labelled-by",n+"-menu-heading")})},handleKeyboard:function(e){(13===e.keyCode||32===e.keyCode)&&this.handleClick(e)},handleClick:function(t){var i,n,s;this.isSmallSiteIndex&&(n=e(t.target),i=n.nextAll("ul"),s=i.find("a"),i.toggleClass("collapsed"),i.toggleClass("expanded"),"false"===n.attr("aria-pressed")?(n.attr("aria-pressed","true"),i.attr("aria-expanded","true"),s.removeAttr("tabindex","-1")):(n.attr("aria-pressed","false"),i.attr("aria-expanded","false"),s.attr("tabindex","-1")))},handleSiteIndexClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"SiteIndex",region:"Footer"});i.attr("href",n)}});return n}),define("shared/navigation/instances/navigation",["jquery/nyt","foundation/views/page-manager","shared/navigation/views/navigation","shared/navigation/views/mobile-navigation","shared/navigation/views/navigation-edge-adjust","shared/navigation/views/site-index-responsive"],function(e,t,i,n,s,a){"use strict";t.getCurrentBreakpoint()>765?(new i,new s,new a({el:e("#site-index")})):(new n,new a({el:e("#site-index")}))}),define("shared/following/views/follow-button-manager",["jquery/nyt","shared/messaging/views/follow-button","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({initialize:function(){return this.subscribe("nyt:new-follow-button",this.createNewButton),this.pageManager.flag("followingRelease")?void this.findFollowButtons():void this.subscribe("nyt:messaging-user-has-ability-to-follow",this.findFollowButtons)},findFollowButtons:function(){var t=this;e(".follow-button-placeholder").each(function(){t.createNewButton(e(this))})},createNewButton:function(e){(this.pageManager.flag("followingRelease")||this.pageManager.getMeta("nyt:messaging-user-has-ability-to-follow"))&&new t({$el:e})}});return n}),define("shared/following/instances/follow-button",["shared/following/views/follow-button-manager"],function(e){"use strict";new e}),define("shared/externallinkmodal/templates",["underscore/nyt"],function(_){var templates={};return templates.externalLinkModalBody=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="modal-meta">\n<p>You are now leaving <strong>The New York Times</strong>, and will be taken to our third party website'+(null==(__t=name?",":"")?"":__t)+" <strong>"+(null==(__t=name)?"":__t)+'</strong> to process your request.</p>\n<p>Thank You.</p>\n<div class="button-control">\n<a target="_blank" rel="noopener" href="'+(null==(__t=url)?"":__t)+'" class="button external-link-modal-button">Continue</a>\n</div>\n</div>';return __p},templates}),define("shared/externallinkmodal/views/external-link-modal",["foundation/views/base-view","shared/modal/views/modal","shared/externallinkmodal/templates"],function(e,t,i){"use strict";var n=e.extend({events:{click:"handleClick"},defaultSettings:{id:"external-link-modal",addlClasses:"",modalFooter:"",moduleName:"",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0},initialize:function(){this.url=this.$el.attr("href"),this.serviceName=this.$el.data("serviceName")?this.$el.data("serviceName"):"",this.defaultSettings.modalContent=i.externalLinkModalBody({url:this.url,name:this.serviceName}),this.modal=new t(this.defaultSettings)},handleClick:function(e){e.preventDefault(),e.stopPropagation(),this.showConfirmationModal()},showConfirmationModal:function(){this.url&&(this.modal.addToPage(),this.modal.open())}});return n}),define("shared/externallinkmodal/instances/external-link-modal",["jquery/nyt","foundation/views/page-manager","shared/externallinkmodal/views/external-link-modal"],function(e,t,i){"use strict";var n=e("body").find(".external-menu-link");t.flag("externalLinkModal")&&n.each(function(e,t){new i({el:t})})}),define("shared/tabs/views/tabs",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({events:{"click .tab":"handleTabClick","focusin .tab":"handleFocusOn","focusout .tab":"handleFocusOff","click .search-tab-form .clear-button":"handleClearButtonClick"},nytEvents:{"nyt:tabs-empty-search-tab-activated":"clearSearchQuery"},searchTabHasHalted:!1,initialize:function(){t.bindAll(this,"handleKeyDown","handleKeyUp")},handleClearButtonClick:function(e){e.preventDefault(),e.stopImmediatePropagation(),this.searchTabHasHalted=!1,this.clearSearchQuery(),this.broadcast("nyt:tabs-search-clear",e)},handleTabClick:function(t){t.preventDefault(),e(t.currentTarget).closest(".tab").hasClass("active")||this.switchTabs(e(t.currentTarget).index())},handleFocusOn:function(t){this.$activeTab=e(t.currentTarget),this.$document.on("keydown",this.handleKeyDown),this.$document.on("keyup",this.handleKeyUp)},handleFocusOff:function(){this.$document.off("keydown",this.handleKeyDown),this.$document.off("keyup",this.handleKeyUp)},handleKeyDown:function(i){var n=i.keyCode,s=e(i.target).val(),a=this.pageManager.KEYS,o=this.$activeTab.index(),r=this.$el.find(".tab").length,l=this.$activeTab.hasClass("search-tab"),d=0;
if(n===a.ENTER&&l)return void i.preventDefault();if(n===a.LEFT||n===a.UP){if(l&&s.length>0)return;d=o-1}else if((n===a.RIGHT||n===a.DOWN)&&r>o+1)d=o+1;else{if(t.indexOf([a.RIGHT,a.LEFT,a.UP,a.DOWN],n)<0)return;if(l&&s.length>0)return}i.preventDefault(),this.switchTabs(d)},handleKeyUp:function(i){var n,s,a=i.keyCode,o=this.pageManager.KEYS,r=this.$activeTab.hasClass("search-tab");r&&a===o.ESC&&e(i.target).val(""),n=e(i.target).val(),s=n.length,r&&(0===s?this.$activeTab.find(".clear-button").addClass("hidden"):this.$activeTab.find(".clear-button").removeClass("hidden"),this.adjustSearchTabSize(n),t.indexOf([o.RIGHT,o.LEFT,o.UP,o.DOWN],a)<0&&this.broadcast("nyt:tabs-search-keyup",n))},switchTabs:function(e){this.$activeTab=this.$el.find(".tab").removeClass("active").attr("aria-selected","false").attr("tabindex","-1").eq(e).addClass("active").attr({"aria-selected":"true",tabindex:"0"}),this.broadcast("nyt:tabs-tab-click",this.$activeTab.data("name")),this.$el.find(".tab-panel").addClass("hidden").attr("aria-expanded","false").eq(e).removeClass("hidden").attr({"aria-expanded":"true"}),this.$activeTab.hasClass("search-tab")?this.$activeTab.find("input").focus():this.$activeTab.focus()},clearSearchQuery:function(){this.$el.find("#search-tab-input").val("").focus(),this.$el.find(".search-tab-form .clear-button").addClass("hidden"),this.adjustSearchTabSize()},adjustSearchTabSize:function(i){var n,s,a,o,r,l,d,c;i?(n=e("<span>"+t.escape(i)+"</span>").hide(),n.insertAfter(this.$activeTab.find("input")),s=n.width(),n.remove()):s=0,a=62,s>a?(o=this.$el.find(".latest-tab"),r=this.$el.find(".search-tab"),l=this.$el.find(".tab-navigation").width()-o.width()-r.width(),d=e("html").hasClass("viewport-medium")?200:70,d>=l&&!this.searchTabHasHalted&&(c=e("#search-tab-input"),this.searchTabHasHalted=!this.searchTabHasHalted,r.css("max-width",r.width()+"px"),c.css("max-width",c.width()+"px"),r.width(d)),this.$activeTab.css("width",188+(s-40)).find("input").css("width",s+36)):this.$activeTab.add("input").removeAttr("style")}});return n}),define("collection/instances/tabs",["jquery/nyt","shared/tabs/views/tabs"],function(e,t){"use strict";var i=e("#story-tabs").length>0?"#story-tabs":"#main-tabs",n=window.magnum.getFlags().indexOf("readingListFollowTest")>0,s=window.NYTD&&window.NYTD.Abra&&"variant"===window.NYTD.Abra("www-follow-test-1");new t({el:i}),n&&s&&e('#main-tabs li[data-name="following"]').trigger("click")}),define("collection/views/stream-controls-search",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({events:{"click #clear-stream-search-input-button":"handleClearButtonClick","focusin #stream-search-input":"handleFocusOn","focusout #stream-search-input":"handleFocusOff"},nytEvents:{"nyt:tabs-empty-search-tab-activated":"clearSearchQuery"},initialize:function(){t.bindAll(this,"handleKeyDown","handleKeyUp")},handleFocusOn:function(){this.$document.on("keydown",this.handleKeyDown),this.$document.on("keyup",this.handleKeyUp)},handleFocusOff:function(){this.$document.off("keydown",this.handleKeyDown),this.$document.off("keyup",this.handleKeyUp)},handleClearButtonClick:function(e){e.preventDefault(),e.stopImmediatePropagation(),this.clearSearchQuery(),this.broadcast("nyt:tabs-search-clear",e)},handleKeyDown:function(e){var t=e.keyCode,i=this.pageManager.KEYS;t===i.ENTER&&e.preventDefault()},handleKeyUp:function(i){var n,s,a=i.keyCode,o=this.pageManager.KEYS;a===o.ESC&&e(i.target).val(""),n=e(i.target).val(),s=n.length,0===s?this.$el.find(".clear-button").addClass("hidden"):this.$el.find(".clear-button").removeClass("hidden"),t.indexOf([o.RIGHT,o.LEFT,o.UP,o.DOWN],a)<0&&this.broadcast("nyt:tabs-search-keyup",n)},clearSearchQuery:function(){this.$el.find("#stream-search-input").val("").focus(),this.$el.find(".clear-button").addClass("hidden")}});return n}),define("collection/instances/stream-controls-search",["jquery/nyt","collection/views/stream-controls-search"],function(e,t){"use strict";var i=e("#stream-controls-form");return 0===e("#story-tabs").length&&0===e("#main-tabs").length&&i.length>0?new t({el:i}):void 0}),define("shared/masthead/templates",["underscore/nyt"],function(_){var templates={};return templates.profileIcon=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<span class="avatar" role="presentation">\n<a href="javascript:;" class="user-profile-button"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" alt="" /></a>\n</span>';return __p},templates.userName=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button class="button user-name-button">\n<span class="button-text">'+(null==(__t=getTruncatedUserName(15))?"":__t)+'</span>\n<i class="icon sprite-icon user-icon"></i>\n<i class="icon caret-icon"></i>\n</button>';return __p},templates.userNameModalContent=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<ul>\n<li><a href="javascript:;" class="user-profile-button">Edit Profile</a></li>\n<li><a href="'+(null==(__t=hosts.myaccount)?"":__t)+'/membercenter/myaccount.html">My Account</a></li>\n<li><a href="'+(null==(__t=hosts.myaccount)?"":__t)+"/get-started/manage-billing?EXIT_URI="+(null==(__t=encodeURIComponent(window.location))?"":__t)+'">My Billing Information</a></li>\n<li><a href="'+(null==(__t="http:"+hosts.www)?"":__t)+'/saved">My Saved Items</a></li>\n<li><button class="button log-out-button">Log Out</button></li>\n</ul>';return __p},templates.userNameModalTitle=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",""!=userData.getImageUrl()&&(__p+='<span class="avatar">\n<a href="javascript:;" class="user-profile-button"><img src="'+(null==(__t=userData.getImageUrl())?"":__t)+'" /></a>\n</span>'),__p+='\n<span class="user-name-subscription">\n<span class="user-name">'+(null==(__t=userData.getUserName())?"":__t)+'</span>\n<span class="user-subscription"><a href="https://myaccount.nytimes.com/membercenter/myaccount.html">'+(null==(__t=subscription.label)?"":__t)+"</a></span>\n</span>";return __p},templates.userSettingsModal=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="menu edition-menu">\n<h5 class="modal-heading">Edition</h5>\n<ul>\n',__p+=internationalEditionFlag?'\n<li><a href="https://www.nytimes.com" data-edition="us">English</a></li>\n':'\n<li><a href="https://www.nytimes.com" data-edition="us">U.S.</a></li>\n<li><a href="http://global.nytimes.com" data-edition="global">International</a></li>\n',__p+='\n<li><a href="http://cn.nytimes.com" data-edition="chinese"> (Chinese)</a></li>\n<li><a href="https://www.nytimes.com/es/" data-edition="spanish">Espaol</a></li>\n</ul>\n</div>\n<div class="menu help-menu">\n<h5 class="modal-heading">Help</h5>\n<ul>\n<li><a href="https://www.nytimes.com/content/help/front.html">FAQ</a></li>\n<li><a href="http://www.nytimes.com/help/index.html">Contact Us</a></li>\n</ul>\n</div>\n',showTypeSizer&&(__p+='\n<div class="menu type-sizer-menu">\n<h5 class="modal-heading">Type Size</h5>\n<ul>\n<li data-size="small" class="type-sizer-small"><a href="javascript:;">A <span class="visually-hidden">Type size small</span></a></li>\n<li data-size="medium" class="type-sizer-medium"><a href="javascript:;">A <span class="visually-hidden">Type size medium</span></a></li>\n<li data-size="large" class="type-sizer-large"><a href="javascript:;">A <span class="visually-hidden">Type size large</span></a></li>\n</ul>\n</div>\n'),__p+="";return __p},templates}),define("shared/masthead/views/masthead",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/masthead/templates"],function(e,t,i,n,s){"use strict";var a=i.registerView("masthead").extend({el:"#masthead",events:{"click .home-button":"handleHomeClick","click .search-button":"handleSearchClick","click .sections-button":"handleSectionsClick","click .branding a":"handleLogoClick","click .story-meta .nyt-logo":"handleLeftLogoClick","click .editions-menu a":"handleEditionClick","click .login-button":"handleLogInClick","click .subscribe-button":"handleSubscribeClick"},nytEvents:{"nyt:ribbon-visiblility":"accomodateRibbon","nyt:masthead-search-toggle":"handleSearchToggle","nyt:messaging-critical-alerts-move-furniture":"handlePageAlerts","nyt:messaging-suggestions-move-furniture":"handlePageAlerts","nyt:messaging-notification-count-update":"handleMessagingCountChange","nyt:masthead-edition-change":"handleEditionClick"},initialize:function(){this.trackingBaseData={action:"click",contentCollection:this.pageManager.getMeta("article:section"),region:"TopBar"}},handleUserReady:function(){var e=this.$el.find(".user-tools-button-group");n.isLoggedIn()?e.prepend(s.userName(n)):(this.pageManager.hasAdBlock().done(function(){e.find(".subscribe-button").removeClass("hidden")}),e.find(".login-button").removeClass("hidden"))},accomodateRibbon:function(e){e?(this.$el.addClass("ribbon-visible"),this.$el.find(".update-text").css("display","inline-block")):(this.$el.find(".update-text").css("display","none"),this.$el.removeClass("ribbon-visible"))},handlePageAlerts:function(e){e(this.$el)},handleHomeClick:function(t){var i,n;i=e(t.currentTarget).closest(".home-button"),n=this.trackingAppendParams(i.data("href"),{module:"HomePage-Button"}),window.location=n},handleSearchClick:function(e){this.broadcast("nyt:masthead-search-click",e),this.trackingTrigger("masthead-search-click",{module:"SearchOpen",eventName:"OpenSearchBar"})},handleSectionsClick:function(e){this.broadcast("nyt:masthead-section-click",e)},handleLogoClick:function(t){var i,n;i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"HomePage-Title"}),i.attr("href",n)},handleLeftLogoClick:function(t){var i,n;i=e(t.currentTarget).parent("a"),n=this.trackingAppendParams(i.attr("href"),{module:"HomePage-Left-Title"}),i.attr("href",n)},handleSearchToggle:function(e){this.$el.find(".search-button")[e?"addClass":"removeClass"]("active")},handleMessagingCountChange:function(e){var t=this.$el.find(".notifications-button"),i=e.count>99?"99+":e.count;t.find(".button-text").html(i),e.delta>0?(t.addClass("has-notifications animate-notifications"),setTimeout(function(){t.removeClass("animate-notifications")},2e3)):0===e.count&&t.removeClass("has-notifications")},handleEditionClick:function(t){var i=e(t.target),n=i.data("edition"),s=i.attr("href"),a="";switch(this.pageManager.setEdition(n),n){case"us":a="EditionToggleToUS";break;case"global":a="EditionToggleToGlobal";break;case"chinese":a="EditionToggleToCHNS";break;case"spanish":a="EditionToggleToSpanish"}s=this.trackingAppendParams(s,{module:a}),i.attr("href",s)},handleLogInClick:function(){var e="masthead-login";this.trackingTrigger("masthead-login-click",{module:"LogIn","WT.nav":"shell"}),this.trackingTrigger("tagx-auth-interaction",{module:e,state:n.isLoggedIn()?"logged in":"logged out",eventName:"login click | "+e})},handleSubscribeClick:function(t){var i,n;i=e(t.currentTarget).closest(".subscribe-button"),n=this.trackingAppendParams(i.data("href"),{module:"Subscribe-Now"}),window.location=n}});return a}),define("shared/masthead/views/masthead-api",["jquery/nyt","foundation/views/base-view"],function(e,t){"use strict";var i=t.extend({el:"#masthead",position:"fixed",inStory:!1,initialize:function(){var t=this;this.$container=e(".container"),this.$ribbon=e(".ribbon"),this.inStoryHeight=this.$el.height(),e("#Bar1").is(":empty")?document.addEventListener("bar1rendered",function(){t.handleAdRendered("Bar1")}):t.handleAdRendered("Bar1")},hide:function(){this.$el.hide(),this.$ribbon.addClass("no-masthead")},show:function(){this.$el.show(),this.$ribbon.removeClass("no-masthead")},getElement:function(){return this.$el},swap:function(e){this.$el.find(".container").hide(),e&&(this.$emptyMasthead||(this.$el.append('<div class="empty-masthead"></div>'),this.$emptyMasthead=this.$el.find(".empty-masthead")),this.$emptyMasthead.html(e))},restore:function(){this.$el.find(".container").show(),this.$el.find(".empty-masthead").remove(),this.$emptyMasthead=!1,this.$el.removeAttr("style"),this.$ribbon.css("margin-top","").removeClass("no-masthead"),this.$container.css("min-height",""),this.inStoryHeight=this.$el.height()},setHeight:function(e){if(!e||"number"!=typeof e)throw new Error("Masthead API - setHeight requires a number as an argument");this.inStoryHeight=e,this.$el.css("height",e),this.$container.css("min-height",e),this.$ribbon.css("margin-top",e),"absolute"===this.$el.css("position")&&this.$el.css("margin-top",-e)},setPosition:function(e){if("fixed"===e)this.$el.css({position:"fixed","margin-top":"0"}),this.broadcast("nyt:masthead-fixed");else{if("absolute"!==e)throw new Error('Masthead API - setPosition only accepts "absolute" or "fixed" as arguments');this.$el.css({position:"absolute","margin-top":-this.inStoryHeight+1,right:0,width:"auto"}),this.$ribbon.addClass("no-masthead"),this.broadcast("nyt:masthead-absolute")}},set:function(e){if(!e||"object"!=typeof e)throw new Error("Masthead API - set method requires an object as an argument");e.height&&this.setHeight(e.height),e.position&&this.setPosition(e.position),e.content&&this.swap(e.content),e.change&&this.change(e.change)},change:function(e){var t=this;if(!e||"function"!=typeof e)throw new Error("Masthead API - change method requires a function as an argument");this.subscribe("nyt:masthead-storytheme",function(i){t.inStory=i,e(i)})},isInStory:function(){return this.inStory},renderedAds:[],handleAdRendered:function(e){this.renderedAds.push(e)},returnRenderedAds:function(){return this.renderedAds}});return i}),define("shared/masthead/instances/masthead-api",["shared/masthead/views/masthead-api"],function(e){"use strict";return new e}),define("shared/masthead/views/in-story-theme",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/views/page-manager","foundation/models/user-data","foundation/cookies","shared/masthead/instances/masthead-api"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend(t.extend({},o,{el:"#masthead",events:{"click .kicker":"scrollToTop","click .kicker-label a":"handleSectionClick","click #nyt-button-sub":"trackSubscribeClick","click #subscribe_small":"trackSubscribeClick"},nytEvents:{"nyt:page-scroll":"toggleTheme","nyt:page-scroll-after":"setSwitchPosition","nyt:page-resize":"handleResize","nyt:page-breakpoint":"handleBreakPoint","nyt:masthead-switch-change":"handleSwitchChange","nyt:masthead-position-change":"handlePositionChange"},defaultSettings:{themeClass:"in-content",switchPosition:0,shouldScrollAway:!1,currentBreakPoint:n.getCurrentBreakpoint(),metaContainer:".story-meta",contentSelector:"#story",contentSwitchPointSelector:".story-meta .kicker"},initialize:function(e){this.settings=t.extend({},this.defaultSettings,e),this.viewportSmall=100,this.viewportMedium10=1010},handleDomReady:function(){this.isTransparent()?this.setSwitchOverrides("#story .story-body-text",!0):this.$switchSelector=e("#story").find(".story-meta .kicker"),this.$pageContainer=this.$el.find(".container"),this.$mastheadKicker=this.$el.find(".kicker"),this.setSwitchPosition(),this.toggleTheme(),this.checkAdsRendered(this.returnRenderedAds())},handleSwitchChange:function(e,t){this.setSwitchOverrides(e,t)},handlePositionChange:function(e){this.settings.shouldScrollAway=e||!1,e||this.$el.css("position","fixed"),this.toggleTheme()},handleResize:function(){n.isDomReady()&&(this.isTransparent()?this.setSwitchOverrides("#story .story-body-text",!0):this.$switchSelector=e("#story").find(".story-meta .kicker"),this.moveMastheadKicker(),this.bar1IsRendered?this.fixedNavSubscribe():this.checkAdsRendered(this.returnRenderedAds()),this.settings.currentBreakPoint<this.viewportSmall?this.removeStoryTheme():this.toggleTheme(),this.settings.currentBreakPoint<this.viewportMedium10&&this.$el.find(this.settings.metaContainer).hide())},handleUserReady:function(){!s||s.isHomeDeliverySubscriber()||s.isWebSubscriber()||s.isMobileSubscriber()||s.isTabletSubscriber()||a.readCookie("b2b_cig_opt")||t.isUndefined(window.Krux)||t.contains(window.Krux.segments,"qxk0hzyjh")||(this.userNotSub=!0,this.fixedNavSubscribe())},checkAdsRendered:function(e){var i=this;t.each(e,function(e){"Bar1"==e&&(i.bar1IsRendered=!0,i.fixedNavSubscribe())})},setSwitchOverrides:function(t,i){this.settings.shouldScrollAway=i||!1,this.$switchSelector=e(t),this.setSwitchPosition(!0),this.toggleTheme()},setSwitchPosition:function(e){this.$switchSelector.length>0&&(this.settings.switchPosition=this.$switchSelector.offset().top-this.$el.height()),e===!0&&(this.settings.overridePosition=this.settings.switchPosition)},toggleTheme:function(){var e,t,i,s,a,o,r=this.settings.overridePosition||100;this.settings.switchPosition<r&&(this.settings.switchPosition=r),e=n.getViewport().top,t=e>this.settings.switchPosition,i=e>r,s=this.$el.hasClass(this.settings.themeClass),a="nyt:masthead-storytheme",o=this.$el.find(".sections-button").hasClass("mobile-navigation-active"),t&&!s&&this.settings.currentBreakPoint>=this.viewportSmall?(this.settings.shouldScrollAway===!0&&this.$el.css("position","fixed"),o||this.addStoryTheme(),this.removeSmallCommentButton(),this.broadcast(a,!0)):i||!s||o?s||this.settings.shouldScrollAway!==!0||this.$el.css("position","absolute"):(this.settings.shouldScrollAway===!0&&this.$el.css("position","absolute"),this.removeStoryTheme(),this.removeExtraSmallCommentButton(),this.broadcast(a,!1))},addStoryTheme:function(){this.isTransparent()||this.$el.find(".branding").fadeOut(300).end().addClass(this.settings.themeClass),this.$el.find(".comments-button").removeClass("theme-speech-bubble-x-small").addClass("theme-speech-bubble-small"),this.settings.currentBreakPoint>=this.viewportMedium10&&this.$el.find(this.settings.metaContainer).fadeIn(300),this.$el.addClass(this.settings.themeClass),this.moveMastheadKicker(),this.bar1IsRendered?this.fixedNavSubscribe():this.checkAdsRendered(this.returnRenderedAds())},removeStoryTheme:function(){this.isTransparent()||this.$el.find(".branding").stop(!1,!0).show().end().removeClass(this.settings.themeClass),this.$el.find(".comments-button").removeClass("theme-speech-bubble-small").addClass("theme-speech-bubble-x-small"),this.settings.currentBreakPoint>=this.viewportMedium10&&this.$el.find(this.settings.metaContainer).stop().hide(),this.bar1IsRendered?this.fixedNavSubscribe():this.checkAdsRendered(this.returnRenderedAds()),this.$el.removeClass(this.settings.themeClass)},fixedNavSubscribe:function(){var e=this.$el.find("#nyt-button-sub").children();this.userNotSub&&(this.$el.hasClass(this.settings.themeClass)&&this.$el.not(".fixed-nav-subscribe")&&(this.trackSubscribeImpressionOnce(),this.$el.addClass("fixed-nav-subscribe")),this.pageManager.getViewport().width>=this.viewportMedium10&&this.$el.hasClass(this.settings.themeClass)?this.$el.find("#nyt-button-sub").html("Subscribe").append(e):this.pageManager.getViewport().width>=this.viewportMedium10&&!this.$el.hasClass(this.settings.themeClass)&&this.$el.find("#nyt-button-sub").html("SUBSCRIBE NOW").append(e))},trackSubscribeImpressionOnce:function(){this.trackedImpression||this.trackingTriggerImpression("fixed-nav-subscribe",{module:"fixed-nav-subscribe",action:"impression"}),this.trackedImpression=!0},trackSubscribeClick:function(){this.trackingTriggerRaw("fixed-nav-subscribe",{module:"fixed-nav-subscribe",action:"click",eventName:"subscribe"},"interaction")},removeSmallCommentButton:function(){this.isTransparent()&&this.$el.find(".theme-speech-bubble-small .button-meta").remove()},removeExtraSmallCommentButton:function(){this.isTransparent()&&this.$el.find(".theme-speech-bubble-x-small .icon").remove()},moveMastheadKicker:function(){var e;this.$mastheadKicker&&"collection"!==this.pageManager.getApplicationName()&&(e=this.$pageContainer.width()-1375,this.settings.currentBreakPoint>=10050&&this.settings.currentBreakPoint<10070&&e>0?this.$mastheadKicker.css({"margin-left":Math.floor(e/2)+"px"}):this.settings.currentBreakPoint>=10070?this.$mastheadKicker.css("margin-left","138px"):this.settings.currentBreakPoint<10050&&this.$mastheadKicker.css("margin-left","0px"))},scrollToTop:function(t){var i=e(t.target);i.is("a")||i.parent().is("a")||e("html, body").animate({scrollTop:0},400)},handleBreakPoint:function(e){this.settings.currentBreakPoint=e},isTransparent:function(){return this.$el.is(".masthead-theme-transparent, .masthead-theme-transparent-ffffff")},handleSectionClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{module:"SF-FixedNav",action:"click",contentCollection:this.pageManager.getMeta("article:section"),region:"TopBar"});i.attr("href",n)}}));return r}),define("shared/searchform/models/search-suggest",["foundation/models/base-model"],function(e){"use strict";var t=e.extend({defaults:{query:"",results:[]}});return t}),define("shared/searchform/collections/search-suggest",["backbone/nyt","foundation/collections/base-collection","foundation/views/page-manager","shared/searchform/models/search-suggest","foundation/hosts"],function(e,t,i,n,s){"use strict";var a=t.extend({model:n,mobileBaseUrl:s.mobileWeb,desktopBaseUrl:s.www,settings:{numOfSuggestions:7},query:"",sync:function(t,i,n){var s="/svc/suggest/v1/homepage?query="+this.query;return this.pageManager.getCurrentBreakpoint()<120?n.url=this.mobileBaseUrl+s:n.url=this.desktopBaseUrl+s,e.sync(t,i,n)},parse:function(e){return{query:e[0],results:e[1].slice(0,this.settings.numOfSuggestions)}},newQuery:function(e){this.query=e,this.fetch()}});return a}),define("shared/searchform/templates",["underscore/nyt"],function(_){var templates={};return templates.autoSuggest=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li><a href="'+(null==(__t=queryUrl)?"":__t)+'">\n'+(null==(__t=suggest.replace(queryRegExp,"<strong>"+query+"</strong>"))?"":__t)+"\n</a></li>";return __p},templates}),define("shared/searchform/helpers/search-form-mixin",["jquery/nyt","underscore/nyt","foundation/lib/polyfills/placeholder","shared/searchform/collections/search-suggest","shared/searchform/templates","foundation/hosts"],function(e,t,i,n,s,a){"use strict";var o=t.extend({},{collection:new n,searchBaseUrl:a.www+"/search/",KEYS:{ENTER:13,ESC:27,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39},initialize:function(){var e=this.pageManager.getMeta("article:section")||"";t.bindAll(this,"handlePageClicks"),this.trackingBaseData={action:"click",contentCollection:e,region:"TopBar"}},handleDomReady:function(){this.$list=this.$el.find(".auto-suggest"),this.$clearButton=this.$el.find(".clear-button"),this.$overlay=this.$shell.find(".search-overlay"),this.$input=this.$el.find(".search-input"),this.$submitButton=this.$el.find(".submit-button"),this.disableSubmitButton(),this.listenTo(this.collection,"sync change",this.render),this.throttledSuggestions=t.debounce(this.getAutoSuggestions,250),this.afterInitialize()},afterInitialize:e.noop,render:function(){var e,t="",i=this.collection.toJSON()[0],n=new RegExp(i.query,"ig"),a=s.autoSuggest,o=i.results.length;if(o>0&&this.getSearchValue().length>0){for(e=0;o>e;e+=1)t+=a({query:i.query,queryUrl:this.getSearchUrl(i.results[e]),suggest:i.results[e],queryRegExp:n});this.$list.show().find("ol").html(t)}else this.$list.hide()},handleKeyDown:function(e){var t=e.which;t===this.KEYS.ENTER&&e.preventDefault()},handleKeyUp:function(e){var t=e.which;e.preventDefault(),t===this.KEYS.UP_ARROW||t===this.KEYS.DOWN_ARROW?this.navigateAutoSuggestions(t):t===this.KEYS.ENTER?this.handleEnterKey(e):t===this.KEYS.RIGHT_ARROW||t===this.KEYS.LEFT_ARROW?this.handleRightLeftKey(e):(this.$clearButton[this.getSearchValue().length>0?"fadeIn":"fadeOut"](200),this.getSearchValue().length?this.$submitButton.hasClass("disabled")&&this.$submitButton.removeClass("disabled"):this.disableSubmitButton(),this.throttledSuggestions())},handleEnterKey:function(){this.submitSearch()},handleRightLeftKey:e.noop,handleClearButton:function(e){e.preventDefault(),this.setSearchValue(""),this.$clearButton.fadeOut(200),this.disableSubmitButton(),this.$input.focus(),i()},setSearchValue:function(e){this.$input.val(e)},getSearchValue:function(){return e.trim(this.$input.val())},hideAutoSuggest:function(){this.$list.hide()},getAutoSuggestions:function(){var e=this.getSearchValue();e.length>1?this.collection.newQuery(e):this.hideAutoSuggest()},getSearchUrl:function(e){return this.searchBaseUrl+e},navigateAutoSuggestions:function(e){var t,i;i=this.$list.find(".active"),t=i.parent().index()||0,t+=e===this.KEYS.UP_ARROW?-1:1,this.$list.find("a").removeClass("active").eq(t).addClass("active"),this.setSearchValue(this.$list.find("a").eq(t).text())},submitSearch:function(e){var t,i=this.getSearchValue();e&&e.preventDefault(),i&&(t=this.trackingAppendParams(this.getSearchUrl(i),{module:"SearchSubmit"}),this.$el.is(":visible")&&(window.location=t))},handlePageClicks:function(){this.hideAutoSuggest()},disableSubmitButton:function(){this.$submitButton.addClass("disabled")}});return o}),define("shared/masthead/views/search",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/searchform/helpers/search-form-mixin"],function(e,t,i,n){"use strict";var s=i.extend(t.extend({},n,{el:e("#masthead").find(".search-flyout-panel"),events:{"click .close-button":"close","keyup .search-input":"handleKeyUp","keydown .search-input":"handleKeyDown","click .submit-button":"submitSearch","click .clear-button":"handleClearButton"},nytEvents:{"nyt:masthead-search-click":"toggle","nyt:masthead-search-toggle":"handleSearchToggle","nyt:navigation-search-click":"toggle","nyt:search-close-ready":"close"},slideTiming:100,afterInitialize:function(){this.trackingBaseData["WT.nav"]="searchWidget",this.$input.removeAttr("placeholder")},open:function(){var e=this;this.$el.slideDown(this.slideTiming,function(){e.$el.find(".control").fadeIn(e.slideTiming).end().find(".search-input").val("").focus()}),this.broadcast("nyt:masthead-search-toggle",!0),this.$shell.on("click",this.handlePageClicks),this.subscribeOnce("nyt:page-key-esc",this.close),this.$overlay.fadeIn(200),this.$html.addClass("search-active")},close:function(){var e=this;this.$html.hasClass("search-active")&&(this.$el.find(".control").fadeOut(this.slideTiming,function(){e.$el.slideUp(e.slideTiming,function(){e.$html.removeClass("search-active")})}),this.broadcast("nyt:masthead-search-toggle",!1),this.$shell.off("click",this.handlePageClicks),this.setSearchValue(""),this.$overlay.fadeOut(200))},toggle:function(){this[this.$el.is(":visible")?"close":"open"]()},isSearchButton:function(t){var i=e(t).hasClass("search-button"),n=1===e(t).parents(".search-button").length;return i||n},isSearchFlyout:function(t){var i=e(t).hasClass("search-flyout-panel"),n=1===e(t).parents(".search-flyout-panel").length;return i||n},handlePageClicks:function(e){this.isSearchButton(e.target)||this.isSearchFlyout(e.target)||this.close(),this.hideAutoSuggest()},handleSearchToggle:function(e){e===!1&&(this.$el.find(".submit-button").addClass("disabled"),this.$el.find(".clear-button").hide())}}));return s}),define("shared/masthead/views/user-settings-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates"],function(e,t,i,n,s){"use strict";var a=i.extend({events:{"click .edition-menu a":"handleEditionClick","click .type-sizer-menu li":"handleFontSizeClick","click .help-menu a":"handleHelpMenuClick"},nytEvents:{"nyt:fontsizer-initialize":"handleFontSizeChange","nyt:fontsizer-change":"handleFontSizeChange"},defaultSettings:{id:"user-settings-modal",binding:".user-settings-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,showTypeSizer:!0,internationalEditionFlag:!1,openCallback:function(){this.$target.addClass("active"),this.subscribeOnce("nyt:page-scroll",this.close)},closeCallback:function(){this.$target.removeClass("active")}},webTrendsNav:"user-settings-modalContainer",initialize:function(e){var i=this.pageManager.getMeta("article:section")||"";this.settings=t.extend({},this.defaultSettings,e),this.settings.modalContent=s.userSettingsModal({showTypeSizer:this.settings.showTypeSizer,internationalEditionFlag:this.pageManager.flag("removeInternationalEdition")}),this.trackingBaseData={action:"click",region:"TopBar","WT.nav":this.webTrendsNav,contentCollection:i}},handleDomReady:function(){this.render()},render:function(){var e=new n(this.settings);this.setElement(e.$modal),e.$modal.find("a[data-edition="+this.pageManager.getEdition()+"]").addClass("selected"),e.addToPage(),this.handleFontSizeChange()},handleEditionClick:function(e){this.broadcast("nyt:masthead-edition-change",e,{"WT.nav":this.webTrendsNav})},handleHelpMenuClick:function(t){var i=e(t.target),n=i.attr("href");n&&(n=this.trackingAppendParams(n,{}),i.attr("href",n))},handleFontSizeClick:function(t){var i=e(t.currentTarget).data("size");this.broadcast("nyt:fontsizer-change",i)},handleFontSizeChange:function(e){var t="type-size-selected";e=e||this.pageManager.getMeta("fontsizer_typeSize"),this.$el.find(".type-sizer-menu li").removeClass(t),this.$el.find(".type-sizer-"+e).addClass(t)}});return a}),define("shared/account/views/user-profile-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/account/templates"],function(e,t,i,n,s){"use strict";var a=i.extend({events:{"change #user-profile-avatar-input":"handleAvatarUpload","click .cancel-button":"handleCancelClick","click .save-button":"handleSaveClick","click .crop-button":"handleCropClick","submit #profile-form":"handleFormSubmit"},defaultSettings:{id:"user-profile-modal",addlClasses:"",headerContent:s.userProfileModalHeader(),modalTitle:"Edit Profile",modalContent:"",binding:".user-profile-button",tailDirection:"fixed",hasCloseButton:!0,hasOverlay:!0,cropBoundaries:{x1:0,y1:0,x2:0,y2:0},tailLeftOffset:-40,tailTopOffset:-40,cropperWidth:80,cropperHeight:80},initialize:function(e){var i=this;this.settings=t.extend({},this.defaultSettings,e),this.settings.openCallback=function(){i.model||require(["shared/community/instances/community-user"],function(e){i.model=e,i.model.isNew()?i.model.once("change",i.render,i):i.render(),i.model.on("avatarFailed",i.render,i)}),this.subscribeOnce(i,"nyt:profile-modal-close",this.close)},this.settings.modalContent=this.renderModalContent()},renderModalContent:function(){return s.userProfileModalContent({user:this.model?this.model:null})},handleUserReady:function(){var e=new n(this.settings);this.setElement(e.$modal),e.addToPage(),e.settings.closeCallback=this.render.bind(this),this.modal=e},render:function(){this.modal&&this.model&&this.modal.updateTemplate(this.renderModalContent())},handleCancelClick:function(e){e.preventDefault(),this.local(this,"nyt:profile-modal-close")},handleSaveClick:function(e){e.preventDefault(),this.model&&(this.model.setName(this.$el.find("#user-profile-name").val()),this.model.setLocation(this.$el.find("#user-profile-location").val()),this.model.setNotify(this.$el.find("#global-comment-notify-checkbox").is(":checked")),this.$(".save-button").addClass("disabled").attr("disabled","disabled"),this.model.once("sync",function(){this.local(this,"nyt:profile-modal-close")},this).save())},handleFormSubmit:function(e){e.preventDefault()},handleAvatarUpload:function(e){this.$(".user-profile-avatar-button").addClass("loading"),this.model&&e.target.files&&this.model.once("avatarUploaded",this.createCropper.bind(this)).addRawAvatar(e.target.files[0])},handleCropClick:function(t){var i=this;t.preventDefault(),e(t.target).addClass("disabled").attr("disabled","disabled"),this.model.once("avatarCropped",function(){i.render()}).cropRawAvatar(this.settings.cropBoundaries)},getCropBoundingBox:function(e,t){var i=Math.abs(parseInt(e.css("left"),10)),n=Math.abs(parseInt(e.css("top"),10)),s={};return s.x1=Math.ceil(i*t),s.y1=Math.ceil(n*t),s.x2=Math.ceil((i+this.settings.cropperWidth)*t),s.y2=Math.ceil((n+this.settings.cropperHeight)*t),s},createCropper:function(t){
var i,n=this.$(".avatar-crop"),s=this;return e.fn.draggable?(this.$("#user-profile-form").addClass("avatar-editing"),void(i=e('<img src="'+t+'"/>').on("load",function(){var t,a=this.width>this.height?"avatar-horizontal":"avatar-vertical",o=this.width>this.height?"x":"y",r=this.naturalHeight/n.height();i.removeClass("avatar-horizontal avatar-vertical").addClass(a).css({left:"0px",top:"0px"}),n.empty().append(i),s.settings.cropBoundaries=s.getCropBoundingBox(i,r),t=e('<div class="avatar-crop-container"></div>').prependTo(n).css({height:s.settings.cropperHeight+2*(this.height-s.settings.cropperHeight)+"px",width:s.settings.cropperWidth+2*(this.width-s.settings.cropperWidth)+"px",top:-1*(this.height-s.settings.cropperHeight)+"px",left:-1*(this.width-s.settings.cropperWidth)+"px"}),i.draggable({axis:o,containment:t,stop:function(){s.settings.cropBoundaries=s.getCropBoundingBox(i,r)},cursor:"move"})}))):void require(["foundation/lib/jquery/jquery.draggable/1.11.4"],function(){this.createCropper(t)}.bind(this))}});return a}),define("shared/masthead/views/user-name-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/masthead/templates","foundation/models/user-data","foundation/hosts","shared/account/views/user-profile-modal"],function(e,t,i,n,s,a,o,r){"use strict";var l=i.extend({events:{"click .premier-subscriber a":"handleUserSubscriptionClick","click li a":"handleUserOptionClick"},defaultSettings:{id:"user-name-modal",modalTitle:"",modalContent:"",binding:".user-name-button",tailDirection:"up-right",tailTopOffset:-8,tailLeftOffset:-1,width:"260px",toggleSpeed:1,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:page-scroll",this.close),this.broadcast("nyt:masthead-user-modal-open")},closeCallback:function(){this.$target.removeClass("active")}},initialize:function(e){t.bindAll(this,"handleLogOut"),this.settings=t.extend({},this.defaultSettings,e),this.trackingBaseData={module:"ProfileDropdown",action:"click",region:"Masthead","WT.nav":"shell"}},handleUserReady:function(){var e,t=this.getSubscriptionLabel(a);this.settings.modalTitle=s.userNameModalTitle({userData:a,subscription:t}),this.settings.modalContent=s.userNameModalContent({userData:a,hosts:o}),new r,this.render(),e=this.$el.find(".user-subscription"),""===t.label&&e.remove(),""!==t.className&&e.addClass(t.className),""!==t.link&&e.find("a").attr("href",t.link),this.listenTo(a,"change",this.handleUsernameChange),this.listenToOnce(a,"nyt:user-image-loaded",this.handleProfileImage),this.listenToOnce(a,"nyt:masthead-user-modal-open",a.fetchUserName),this.$el.on("click",".log-out-button",this.handleLogOut)},getSubscriptionLabel:function(e){var t={label:"",className:"",link:""};return e.isPremierSubscriber()?(t.label="Digital Subscriber",t.className="digital-subscriber",t.link="javascript:;"):e.isHomeDeliverySubscriber()?(t.label="Home Delivery Subscriber",t.className="home-subscriber",t.link="javascript:;"):e.isWebSubscriber()&&e.isMobileSubscriber()?t.label="All Digital Access Subscriber":e.isTabletSubscriber()&&e.isWebSubscriber()?t.label="Tablet and Web Subscriber":e.isSmartphoneSubscriber()&&e.isWebSubscriber()?t.label="Smartphone and Web Subscriber":e.isWebSubscriber()?t.label="Web Subscriber":e.isOpinionSubscriber()&&e.isCookingSubscriber()?t.label="NYT Opinion & Cooking Subscriber":e.isCookingSubscriber()?t.label="Cooking Subscriber":e.isOpinionSubscriber()?(t.label="NYT Opinion Subscriber",t.link="http://www.nytimes.com/content/help/mobile/nyt-opinion/nyt-opinion.html"):e.isCrosswordsSubscriber()&&(t.label="Crosswords Subscriber"),t},render:function(){var e=new n(this.settings);this.setElement(e.$modal),e.addToPage()},handleUsernameChange:function(){this.$el.find(".user-name").text(a.get("name"))},handleProfileImage:function(){var e=s.profileIcon({userData:a});this.$el.find(".modal-heading").prepend(e)},handleUserSubscriptionClick:function(t){var i=e(t.currentTarget),n=this.trackingAppendParams(i.attr("href"),{contentCollection:"TimesPremier-InsideStory"});i.attr("href",n)},handleUserOptionClick:function(t){var i=e(t.target),n=i.text(),s=i.attr("href"),a={action:"Click",region:"TopBar","WT.nav":"shell"};s&&(n&&(a.module=n.replace(/\s/g,"")),s=this.trackingAppendParams(s,a),i.attr("href",s))},handleLogOut:function(){var e="http:"+o.www+"/logout";e=this.trackingAppendParams(e,{module:"LogOut",action:"Click",region:"TopBar","WT.nav":"shell"}),this.trackingTrigger("tagx-auth-interaction",{module:"LogOut",state:a.isLoggedIn()?"logged in":"logged out",eventName:"logout click | LogOut"}),window.location=e}});return l}),define("collection/views/masthead-meta",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({el:"#masthead .kicker",nytEvents:{"nyt:collections-search-changed":"handleQueryChanged","nyt:tabs-tab-click":"handleTabClick"},handleDomReady:function(){this.$searchContainer=this.$el.find(".search-meta"),this.$searchTerm=this.$el.find(".search-term")},handleTabClick:function(e){var t;this.$searchTerm&&this.$searchContainer&&(t=this.$searchTerm.text().length>0,"search"===e&&t?this.$searchContainer.removeClass("hidden"):this.$searchContainer.addClass("hidden"))},handleQueryChanged:function(e){var i,n=t.isString(e)&&e.length>0;n&&"e"!==e?(i="Search Results For "+e,this.$searchContainer.removeClass("hidden"),this.$searchTerm.text(i)):(this.$searchContainer.addClass("hidden"),this.$searchTerm.text(""))}});return n}),define("shared/onboarding/data/campaigns/default",[],function(){"use strict";return function(e,t){return{copy:{description:'Subscribe now and get your <strong>first year 50% off.</strong><br/><br/><span class="gray">You&rsquo;ll still get the rest of your trial for free.</span>',button:"Subscribe"},ltvCopy:{description:"Subscribe now and get your <strong>first year 40% off.</strong>",button:"Subscribe"},discoOffer:{defaultLandingPage:e+"//"+t+"nytimes.com/subscriptions/inyt/lp8H3H4.html",copy:{title:"Subscribe"},campaignIDs:{mtv1:{code:"6J4Q8"},mtv2:{code:"6J4QW"},mtv3:{code:"6J4UY"}}},"inTrialOffer-7":{defaultLandingPage:e+"//"+t+"nytimes.com/subscriptions/inyt/lp8H3H4.html",ltvLandingPage:e+"//"+t+"nytimes.com/subscriptions/Multiproduct/lp8Y6RY.html",campaignIDs:{mtv1:{code:"6J4QF"},mtv2:{code:"6J4QY"},ltv:{code:"6QFHY"}}},"inTrialOffer-14":{defaultLandingPage:e+"//"+t+"nytimes.com/subscriptions/inyt/lp8H3H4.html",ltvLandingPage:e+"//"+t+"nytimes.com/subscriptions/Multiproduct/lp8Y6RY.html",campaignIDs:{mtv1:{code:"6J4QJ"},mtv2:{code:"6J4R6"},ltv:{code:"6QFJ6"}}},"inTrialOffer-21":{defaultLandingPage:e+"//"+t+"nytimes.com/subscriptions/inyt/lp8H3H4.html",ltvLandingPage:e+"//"+t+"nytimes.com/subscriptions/Multiproduct/lp8Y6RY.html",campaignIDs:{mtv1:{code:"6J4QL"},mtv2:{code:"6J4R8"},ltv:{code:"6QFJ8"}}},postTrialOffer:{defaultLandingPage:e+"//"+t+"nytimes.com/subscriptions/inyt/lp8H3H4.html",ltvLandingPage:e+"//"+t+"nytimes.com/subscriptions/Multiproduct/lp8F7Q8.html",ltvCopy:{description:"Subscribe now and get your <strong>first year 40% off.</strong>"},copy:{description:'<span class="gray">Subscribe now and get your <strong>first year 50% off</strong>.</span>'},campaignIDs:{mtv1:{code:"6J4UR"},mtv2:{code:"6J4UW"},ltv:{code:"6QH9R"}}},inTrialUpsellPeriods:[{startDay:7,endDay:13},{startDay:14,endDay:20},{startDay:21,endDay:27}],postTrialUpsellPeriod:{startDay:28,endDay:34}}}}),define("shared/onboarding/data/onboarding-campaign",["underscore/nyt","foundation/views/page-manager","shared/onboarding/data/campaigns/default"],function(e,t,i){"use strict";var n,s="https:"===window.location.protocol?"https:":"http:",a=window.location.host,o="www.",r=/^ltv(2[0-1]|1[0-9]|[1-9])$/,l=i;return~a.indexOf(".stg.")&&(o+="stg."),n=l(s,o),n.getOffer=function(e,t){return"string"==typeof e?(t&&(e=e+"-"+t.startDay),n[e]):e},n.getCampaign=function(e,t,i){return r.test(t)&&(t="ltv"),i||(i=t),e.campaignIDs[i]||{}},n.getUpsellCopy=function(t,i,s,a){var o=n.getOffer(t,a),l=n.getCampaign(o,i,s);return r.test(i)?e.defaults({},l.ltvCopy,o.ltvCopy,n.ltvCopy):e.defaults({},l.copy,o.copy,n.copy)},n.getUpsellUrl=function(e,t,i,s){var a,o=n.getOffer(e,s),l=n.getCampaign(o,t,i);return a=l.landingPage?l.landingPage:r.test(t)?o.ltvLandingPage:o.defaultLandingPage,a+="?return_url="+encodeURIComponent(window.location.href)+"&mtv="+encodeURIComponent(t),l.code&&(a+="&campaignId="+encodeURIComponent(l.code)),a},n}),define("shared/onboarding/collections/onboarding-discoveries",["underscore/nyt","foundation/collections/base-collection","foundation/models/base-model","shared/onboarding/data/onboarding-campaign"],function(e,t,i,n){"use strict";return t.extend({model:i.extend({defaults:{subscribed:!1,imageSquare:!1},getUrlWithTracking:function(t,i,s){var a={ft2pu:this.get("id"),action:"click",module:"sov1"!==t?"Maple":"newsub",region:"FixedTop",mediaId:t,contentCollection:"Complete",contentId:this.get("id"),version:"discovery",eventName:"Complete",pgtype:i,discoverytype:window.encodeURIComponent(s)},o="regi-upsell"!==this.get("type")?this.get("uri"):n.getUpsellUrl("discoOffer","variation"),r=~o.indexOf("?")?"&":"?";return o+r+e.map(a,function(e,t){return t+"="+e}).join("&")}}),initialize:function(e){this.options=e},reset:function(i){return i=e.isArray(i)?i:[],t.prototype.reset.call(this,i.map(this.transform.bind(this)))},getActionByType:function(e){switch(e){case"article":return"View";case"regi-upsell":case"newsletter":return"Subscribe";case"crosswords":return"Play";default:return"Go"}},transform:function(t){return"newsletter"!==t.type&&"article"!==t.type&&(t.type=t.id),t.action=this.getActionByType(t.type),e.pick(t,["image","type","code","action","imageSquare","kicker","id","summary","uri","header","collection"])}})}),define("shared/onboarding/collections/onboarding-interests",["underscore/nyt","foundation/hosts","foundation/collections/base-collection","foundation/models/base-model"],function(e,t,i,n){"use strict";return i.extend({model:n,url:t.myaccountHost+"/svc/api/v2/ft/collections",xhrOptions:{dataType:"json",cache:!1,xhrFields:{withCredentials:!0}},sync:function(t,n,s){return i.prototype.sync(t,n,e.extend(s,this.xhrOptions))}})}),define("shared/onboarding/models/onboarding",["jquery/nyt","underscore/nyt","foundation/cookies","foundation/models/base-model","foundation/models/user-data","foundation/hosts","shared/onboarding/collections/onboarding-discoveries","shared/onboarding/collections/onboarding-interests"],function(e,t,i,n,s,a,o,r){"use strict";var l="ONBOARDING_API_CALL_THROTTLING_INFO";return n.extend({url:a.myaccountHost+"/svc/api/v2/ft/onboarding",defaults:{passedDays:null,duration:null,discoveries:[],collections:[]},xhrOptions:{dataType:"json",cache:!1,xhrFields:{withCredentials:!0}},initialize:function(){this.isSynced=!1,this.shouldRenderOnboarding=!0,this.listenToOnce(this,"sync",this.markSynced),this.listenToOnce(this,"sync",this.setAdxGlobals),this.interests=new r,this.discoveries=new o,n.prototype.initialize.apply(this,arguments)},sync:function(e,i,s){return n.prototype.sync(e,i,t.extend(s,this.xhrOptions))},parse:function(e){var i;return this.shouldCallApi(e),e?(i=e.onboarding||e.regi||{},i&&i.cards&&this.discoveries.reset(i.cards),i.hasOnboarding=e.hasOnboarding,i.selectedInterests=i.collections,t.omit(i,["cards","collections"])):e},shouldCallApi:function(e){var t=JSON.parse(window.localStorage.getItem(l)),i=!1,n=s.isLoggedIn()&&s.hasEntitlement("MM"),a=s.isLoggedIn()&&!s.hasEntitlement("MM")&&this.hasBeenAllocatedToMapleTest()&&(null===t||i),o=n&&(null===t||i),r=s.isLoggedIn()&&t&&t.userId!==s.id,d=parseInt(this.pageManager.getUrlParam("onboarding"),10);return t&&t.expire&&(i=t.expire<(new Date).getTime()),1===d?(window.localStorage.removeItem(l),!0):e&&!e.hasOnboarding?(this.shouldRenderOnboarding=!1,window.localStorage.setItem(l,JSON.stringify({expire:(new Date).getTime()+216e5,userId:s.id})),this.shouldRenderOnboarding&&null===window.localStorage.getItem(l)):(n||a||o||r||!this.hasPostOnboardingEnded()?(this.shouldRenderOnboarding=!0,null!==t&&window.localStorage.removeItem(l)):(this.shouldRenderOnboarding=!1,window.localStorage.setItem(l,JSON.stringify({expire:(new Date).getTime()+216e5,userId:s.id}))),this.shouldRenderOnboarding&&null===window.localStorage.getItem(l))},onInterestsReset:function(e){this.get("selectedInterests").each(function(t){e.get(t).set("selected",!0)})},userHasOnboarding:function(){return this.get("hasOnboarding")===!0},isUpsellTaken:function(){return"upsell"===this.get("participantStatus")},isSubscriber:function(){return"subscriber"===this.get("participantStatus")},isInTrialUpsellStepCompleted:function(e){return e=e&&"-"+e||"",this.isActionCompleted("upsell"+e)},isActionCompleted:function(e){return!!~this.get("discoveries").indexOf("action-"+e)},markActionComplete:function(e){return this.isActionCompleted(e)?void 0:this.markDiscoveryComplete("action-"+e)},isStepComplete:function(e){return!!~this.get("discoveries").indexOf("step-"+e)},markStepComplete:function(e){return this.isStepComplete(e)?void 0:this.markDiscoveryComplete("step-"+e)},getDaysLeft:function(){return this.has("duration")&&this.has("passedDays")?this.get("duration")-this.get("passedDays"):null},markSynced:function(){this.isSynced=!0,this.broadcast("nyt:onboarding-status-updated")},setAdxGlobals:function(){window.NYTD||(window.NYTD={}),null===window.localStorage.getItem("mapleVariation")&&window.localStorage.setItem("mapleVariation",this.get("variation")),window.NYTD.showMapleBar1Upsell=this.userHasOnboarding()&&!this.isUpsellTaken()&&!this.get("ended")},save:function(){console.error("Save called in models/onboarding.js, use saveCards or saveDiscoveries instead")},markDiscoveryComplete:function(i){var n={url:this.url,type:"POST",data:JSON.stringify({discoveries:[i]})};return e.ajax(t.extend(n,this.xhrOptions))},saveInterests:function(){var i=t.pluck(this.interests.filter(function(e){return e.get("selected")===!0}),"id"),n={url:this.interests.url,type:"POST",data:JSON.stringify({collections:i})};return e.ajax(t.extend(n,this.xhrOptions)).done(this.parse.bind(this))},getGroup:function(){var e=this.get("group");return e||(e=this.isInMapleTest()?"Maple":/^ltv(2[0-1]|1[0-9]|[1-9])$/.test(this.get("variation"))?"liftoff":"sov1"===this.get("variation")?"newsub":"onboarding"),e},isInMapleTest:function(){return/mtv[123]/.test(this.get("variation"))},hasBeenAllocatedToMapleTest:function(){return/maple_test_2016/.test(i.readCookie("mtrab"))},hasOnboardingEnded:function(){return this.isSubscriber()?this.get("ended"):this.get("passedDays")>=this.get("duration")},hasPostOnboardingEnded:function(){return this.hasOnboardingEnded()&&this.get("duration")+this.get("postOnboarding")<this.get("passedDays")}})}),define("shared/onboarding/templates",["underscore/nyt"],function(_){var templates={};return templates.onboardingCollections=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="onboarding-container">\n<div class="onboarding-collections-items">\n';for(var i=0;i<interests.length;i++)__p+='\n<div class="onboarding-collections-item onboarding-'+(null==(__t=interests[i]["class"])?"":__t)+" ",interests[i].selected&&(__p+="onboarding-icon-transform onboarding-collections-item-added"),__p+='" data-id="'+(null==(__t=interests[i].id)?"":__t)+'" style="background-image: url('+(null==(__t=interests[i].image.url)?"":__t)+')">\n<div class="onboarding-collections-item-title">'+(null==(__t=interests[i].name)?"":__t)+'</div>\n<button class="onboarding-collections-item-add button button-inverse button-primary button-circle">\n<span class="onboarding-icon onboarding-icon-plus onboarding-icon-plus-check"></span>\n<span class="onboarding-collections-item-add-text">Add<span class="onboarding-collections-item-add-text-suffix">ed</span>\n</button>\n</div>\n';__p+='\n</div>\n<div class="onboarding-actions">\n<button id="onboarding-next-step" class="button button-primary">Save</button>\n</div>\n</div>'}return __p},templates.onboardingCollectionsInstructions=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="onboarding-container">\n<div class="onboarding-instructions-image-lightbulb"></div>\n<div class="onboarding-instructions-header">Let us know what<br/>sparks your curiosity</div>\n<div class="onboarding-instructions-details">We&#8217;ll recommend our best stories<br/>based on your interests.</div>\n<div class="onboarding-actions">\n<button id="onboarding-next-step" class="button button-primary">Add interests</button>\n</div>\n</div>';return __p},templates.onboardingDiscoveries=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="onboarding-container">\n<!-- carousel arrow -->\n<div id="carousel-viewport" class="carousel-viewport">\n<div id="carousel-scroll-left" class="arrow-container arrow-container-left">\n<div class="arrow arrow-left">\n<div class="visually-hidden">Go to previous discovery</div>\n<div class="arrow-conceal"></div>\n</div>\n</div>\n<div id="onboarding-discoveries-items" class="scroll-container is-set">\n</div>\n<div id="carousel-scroll-right" class="arrow-container arrow-container-right">\n<div class="arrow arrow-right">\n<div class="visually-hidden">Go to next discovery</div>\n<div class="arrow-conceal"></div>\n</div>\n</div>\n<div class="white-shadow"></div>\n</div>\n<div class="onboarding-leave-feedback">\n<button type="button" class="button onboarding-leave-feedback-button"><span class="button-text">Leave feedback</span></button>\n</div>\n</div>';return __p},templates.onboardingDiscovery=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="',"article"===type&&(__p+="onboarding-discovery-action-button"),__p+='">\n<div class="onboarding-discovery-collection">\n',"article"===type&&(__p+='\n<span class="onboarding-discovery-tag">Your pick: </span>\n'),__p+="\n"+(null==(__t=kicker)?"":__t)+'\n</div>\n<div class="onboarding-discovery-content">\n<div class="onboarding-discovery-image onboarding-discovery-'+(null==(__t=type)?"":__t)+'">\n',__p+=imageSquare?'\n<img role="presentation" src="'+(null==(__t=imageSquare.url)?"":__t)+'"/>\n':'\n<img role="presentation" src="'+(null==(__t=image.url)?"":__t)+'"/>\n',__p+='\n</div>\n<div class="onboarding-discovery-info">\n<div class="onboarding-discovery-header">\n'+(null==(__t=header)?"":__t)+'\n</div>\n<div class="onboarding-discovery-summary">\n'+(null==(__t=summary)?"":__t)+"\n</div>\n","article"!==type&&(__p+='\n<div class="onboarding-discovery-action">\n<button class="button button-primary onboarding-discovery-action-button">\n',"newsletter"===type?(__p+="\n",__p+=subscribed?"\nUnsubscribe\n":"\nSign up\n",__p+="\n"):__p+="\n"+(null==(__t=action)?"":__t)+"\n",__p+="\n</button>\n</div>\n"),__p+="\n</div>\n</div>\n</div>";return __p},templates.onboardingFrame=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="onboarding-frame-header">\n<div class="onboarding-container">\n<a href="#" aria-controls="#onboarding-content" id="onboarding-toggle" class="onboarding-frame-toggle">\n<span class="text hide-all">Hide<span class="caret-icon"></span></span>\n<span class="text show-all">Show<span class="caret-icon"></span></span>\n</a>\n<div class="onboarding-frame-title">\n',headerCopy&&(__p+='\n<span class="onboarding-frame-header-name">'+(null==(__t=headerCopy)?"":__t)+"</span>\n"),__p+='\n<span id="onboarding-section-name" class="onboarding-frame-section-name">Get Started</span>\n</div>\n</div>\n</div>\n<div id="onboarding-content" class="onboarding-frame-content"></div>';return __p},templates.onboardingLeaveFeedbackModal=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="modal-panel">\n<div class="close-button-wrapper">\n<button type="button" class="close" aria-disabled="false">\n<i class="icon"></i>\n<span class="visually-hidden">Close this modal window</span>\n</button>\n</div>\n<div class="feedback-form-wrapper">\n<form class="onboarding-leave-feedback-form">\n<div class="checkbox-wrapper">\n<h2 class="leave-feedback-header">Do you like these recommendations?</h2>\n<div class="control radio-control">\n<div class="field-container">\n<input type="radio" name="onboarding-leave-feedback-answer" value="Yes" id="onboarding-leave-feedback-yes">\n</div>\n<div class="label-container">\n<label class="radio-label" for="onboarding-leave-feedback-yes">Yes</label>\n</div>\n</div>\n<div class="control radio-control">\n<div class="field-container">\n<input type="radio" name="onboarding-leave-feedback-answer" value="No" id="onboarding-leave-feedback-no">\n</div>\n<div class="label-container">\n<label class="radio-label" for="onboarding-leave-feedback-no">No</label>\n</div>\n</div>\n</div>\n<div class="textarea-wrapper">\n<h2 class="leave-feedback-header">Comments or suggestions?</h2>\n<div class="control">\n<div class="field-container">\n<textarea class="onboarding-leave-feedback-comment" name="onboarding-leave-feedback-comment" rows="" cols="" placeholder="Your note (optional, 500 characters max)"></textarea>\n</div>\n</div>\n<div class="control submit-feedback-button-wrapper">\n<button type="submit" class="button submit-feedback-button">Submit</button>\n</div>\n</div>\n</form>\n</div>\n<div class="feedback-thank-you">\n<h2 class="leave-feedback-header">Thank you for your feedback.</h2>\n<p>Your response will help improve The New York Times experience.</p>\n<div class="control feedback-done-button-wrapper">\n<button type="button" class="button feedback-done-button">Done</button>\n</div>\n</div>\n</div>';return __p},templates.onboardingPostTrial=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="onboarding-container">\n<div class="onboarding-post-trial-image"></div>\n<div class="onboarding-post-trial-heading">\nJoin us on our journey to<br/>understand the world.\n</div>\n<div class="onboarding-post-trial-summary">\n'+(null==(__t=copy.description)?"":__t)+'\n</div>\n<div>\n<a class="button button-primary" href="'+(null==(__t=takeUpsellUrl)?"":__t)+'">'+(null==(__t=copy.button)?"":__t)+"</a>\n</div>\n</div>";return __p},templates.onboardingRefineInterestDiscovery=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="onboarding-discovery onboarding-discovery-refine-interests">\n<div class="onboarding-refine-interests-wrapper">\n<div class="onboarding-discovery-content">\n<div class="onboarding-discovery-header">\nRefine your interest<br/>selection?\n</div>\n<div class="onboarding-discovery-action">\n<button class="button button-primary" id="onboarding-goto-interests">Update interests</button>\n</div>\n</div>\n</div>\n</div>\n</div>';return __p},templates.onboardingUpsell=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="modal-panel ',isLastSevenDays&&(__p+="upsell-urgent"),__p+='">\n<div class="close-button-wrapper">\n<button type="button" class="close" aria-disabled="false">\n<i class="icon"></i>\n<span class="visually-hidden">Close this modal window</span>\n</button>\n</div>\n<div>\n<div class="image"></div>\n<div class="heading">\n',__p+=isLastSevenDays?"\nYour free trial is<br/>almost over.\n":"\nWe hope youre enjoying your free trial.\n",__p+='\n</div>\n<div class="summary">\n'+(null==(__t=copy.description)?"":__t)+'\n</div>\n<div>\n<a class="button button-primary" href="'+(null==(__t=takeUpsellUrl)?"":__t)+'">'+(null==(__t=copy.button)?"":__t)+'</a>\n<a class="button button-secondary button-cancel" href="">No Thanks</a>\n</div>\n</div>\n</div>';return __p},templates}),define("shared/onboarding/views/onboarding-frame",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/onboarding/templates"],function(e,t,i,n){"use strict";var s=i.extend({className:"onboarding-frame",$overlay:e('<div class="onboarding-overlay"></div>'),events:{"click #onboarding-toggle":"toggleContent","click .onboarding-frame-header":"toggleContent"},nytEvents:{"nyt:onboarding-hide":"hideContent","nyt:onboarding-show":"showContent","nyt:masthead-search-click":"hideContent"},timeHidden:parseInt(localStorage.getItem("onboarding-contentHidden")||0,10),render:function(){var e={headerCopy:this.model.get("kicker")};return this.$el.html(n.onboardingFrame(e)),this},replaceContent:function(e){var t=this.$("#onboarding-content");t.empty().append(e),this.timeHidden>0?this.hideContentElement():this.hasOverlay()?this.showOverlay():this.hideOverlay()},updateHeading:function(e){var t,i=this.$("#onboarding-section-name"),n=this.model.getDaysLeft();if(null===n||n>7||!this.model.get("hasCounter"))i.text(e);else if(this.model.hasOnboardingEnded())t="Subscribe",i.addClass("onboarding-times-up"),i.text(t);else{switch(n){case 1:t="1 day left";break;case 0:t="Your trial has ended";break;default:t=n+" days left"}i.addClass("onboarding-times-up"),i.text(t)}},toggleContent:function(e){e.preventDefault(),e.stopPropagation(),this.$el.hasClass("onboarding-collapsed")?(this.broadcast("nyt:onboarding-show"),this.broadcast("nyt:onboarding-track-event","show")):(this.broadcast("nyt:onboarding-hide"),this.broadcast("nyt:onboarding-track-event","hide"))},hideContent:function(){this.hideContentElement(),localStorage.setItem("onboarding-contentHidden",Date.now())},hideContentElement:function(){this.$el.addClass("onboarding-collapsed").attr("aria-hidden",!0),this.$("#onboarding-toggle").attr("aria-expanded",!1),this.hasOverlay()&&this.hideOverlay()},showContent:function(){this.showContentElement(),localStorage.setItem("onboarding-contentHidden",0),this.timeHidden=0},showContentElement:function(){this.$el.removeClass("onboarding-collapsed").attr("aria-hidden",!1),this.$("#onboarding-toggle").attr("aria-expanded",!0),this.hasOverlay()&&this.showOverlay()},hideOverlay:function(){this.$overlay.animate({opacity:0},{always:function(){this.$overlay.removeClass("onboarding-overlay-visible").off("click")}.bind(this)})},showOverlay:function(){this.$overlay.addClass("onboarding-overlay-visible").animate({opacity:1}).on("click",function(){this.hideOverlay(),this.hideContent()}.bind(this))},hasOverlay:function(){return this.$el.hasClass("has-overlay")}});return s}),define("shared/onboarding/views/onboarding-instructions",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/onboarding/templates"],function(e,t,i,n){"use strict";var s=i.extend({className:"onboarding-instructions",events:{"click #onboarding-next-step":"nextStep"},initialize:function(e){this.options=e},render:function(){return this.$el.html(n[this.options.template]),this},nextStep:function(){this.broadcast("nyt:onboarding-track-event","add-interests"),this.broadcast("nyt:onboarding-next-step")}});return s}),define("shared/onboarding/views/onboarding-collections",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/onboarding/templates"],function(e,t,i,n){"use strict";var s=i.extend({className:"onboarding-collections",events:{"click #onboarding-next-step":"saveInterests","click .onboarding-collections-item-add":"toggleItem","click .onboarding-collections-item":"toggleItem"},initialize:function(){this.listenTo(this.model.interests,"reset",this.render),this.model.interests.fetch({reset:!0})},render:function(){return this.model.interests.length&&(this.$el.html(n.onboardingCollections({interests:this.model.interests.toJSON()})),this.updateSaveButton()),this},saveInterests:function(){this.$("#onboarding-next-step").html("Saving..."),this.model.saveInterests().done(function(){this.broadcast("nyt:onboarding-next-step")}.bind(this)),this.broadcast("nyt:onboarding-track-event","save")},toggleItem:function(e){var t=this.$(e.target).hasClass("onboarding-collections-item")?this.$(e.target):this.$(e.target).parents(".onboarding-collections-item"),i=t.data("id");e.stopPropagation(),t.toggleClass("onboarding-collections-item-added onboarding-icon-transform"),t.hasClass("onboarding-collections-item-added")?(this.model.interests.get(i).set("selected",!0),this.broadcast("nyt:onboarding-track-event","add",{id:i})):(this.model.interests.get(i).set("selected",!1),this.broadcast("nyt:onboarding-track-event","remove",{id:i})),this.updateSaveButton()},updateSaveButton:function(){var e=this.$("#onboarding-next-step");this.$(".onboarding-collections-item-added").length?e.removeAttr("disabled"):e.attr("disabled","disabled")}});return s}),define("shared/subscribenewsletter/api/newsletter",["jquery/nyt","foundation/hosts"],function(e,t){"use strict";var i=function(i,n,s,a){var o=t.myaccountHost+"/svc/account/newsletter/v1/"+n;e.ajax({type:i,url:o,data:s,xhrFields:{withCredentials:!0}}).error(function(e,t,i){a&&a(new Error("Error making request to "+o+"\n"+i+"\n"+t))}).success(function(e){a&&a(null,e.data)})};return{subscribe:function(e,t){i("POST","subscribe",{product:e},t)},unsubscribe:function(e,t){i("POST","unsubscribe",{product:e},t)},list:function(e){i("GET","list",{},function(t,i){t?e(t):e(null,i.subscriptions)})},available:function(e){i("GET","available",{},e)}}}),define("shared/subscribenewsletter/models/subscribe-newsletter",["backbone/nyt","jquery/nyt","underscore/nyt","foundation/models/base-model","shared/subscribenewsletter/api/newsletter"],function(e,t,i,n,s){"use strict";var a=n.extend({defaults:{code:!1,suggested:!1,thumb:!1,thumbClass:!1,title:"default title",description:!1,subscribed:!1,buttonText:["Subscribe","Subscribed","Unsubscribe"],saveImmediately:!0},initialize:function(){this.wasInitiallySubscribed=this.get("subscribed")},toggleSubscription:function(){this.get("subscribed")?this.unsubscribe():this.subscribe()},subscribe:function(){this.set("subscribed",!0),this.get("saveImmediately")&&this.save()},unsubscribe:function(){this.set("subscribed",!1),this.get("saveImmediately")&&this.save()},save:function(){this.get("subscribed")!==this.wasInitiallySubscribed&&(this.get("subscribed")?s.subscribe(this.get("code"),function(e){e?this.set("subscribed",this.wasInitiallySubscribed):this.wasInitiallySubscribed=!0}.bind(this)):s.unsubscribe(this.get("code"),function(e){e?this.set("subscribed",this.wasInitiallySubscribed):this.wasInitiallySubscribed=!1}.bind(this)))}});return a}),define("shared/onboarding/views/onboarding-discovery",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/onboarding/templates","shared/subscribenewsletter/models/subscribe-newsletter"],function(e,t,i,n){"use strict";var s=i.extend({className:"onboarding-discovery",events:{"click .onboarding-discovery-action-button":"onCallToAction"},initialize:function(e){t.extend(this,e),this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(n.onboardingDiscovery(this.model.toJSON())).addClass("onboarding-discovery-"+this.model.get("type")),this},onCallToAction:function(){switch("function"==typeof this.markDiscoveryComplete&&this.markDiscoveryComplete(this.model.get("id")),this.model.get("type")){case"newsletter":this.toggleSubscription(this.model.get("code"));break;default:window.location=this.model.getUrlWithTracking(this.variation,this.pageManager.getMeta("applicationName"),this.model.get("kicker"))}this.broadcast("nyt:onboarding-track-event","discovery",{id:this.model.get("id")})}});return s}),define("shared/onboarding/collections/onboarding-newsletters",["underscore/nyt","foundation/collections/base-collection","shared/subscribenewsletter/models/subscribe-newsletter","shared/subscribenewsletter/api/newsletter"],function(e,t,i,n){"use strict";return t.extend({model:i,fetch:function(){n.list(function(e,t){e||this.reset(t)}.bind(this))}})}),define("shared/onboarding/views/onboarding-discoveries",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/onboarding/templates","shared/onboarding/views/onboarding-discovery","shared/onboarding/collections/onboarding-newsletters"],function(e,t,i,n,s,a){"use strict";var o=i.extend({className:"onboarding-discoveries",events:{focusin:"onFocusIn",focusout:"onFocusOut","click #onboarding-next-step":"nextStep","click #carousel-scroll-left":"scrollLeft","click #carousel-scroll-right":"scrollRight",
"click #onboarding-goto-interests":"goToInterests"},newsletter:new a,initialize:function(){i.prototype.initialize.apply(this,arguments),this.listenTo(this.newsletter,"reset",this.onNewsletterReset),this.$window.on("resize.onboarding",this.onResize.bind(this)),this.newsletter.fetch()},remove:function(){this.$window.off("resize.onboarding")},render:function(){var e="mtv3"!==this.model.get("variation")?this.getRenderedInterestRefinement():null;return this.$el.attr("tabindex",1).html(n.onboardingDiscoveries()),this.$("#onboarding-discoveries-items").append(this.getRenderedDiscoveries(),e),this.initializeCarousel(),this},postRender:function(){this.goToStep(0)},getRenderedDiscoveries:function(){return this.model.discoveries.map(function(e){try{return new s({variation:this.model.get("variation"),model:e,markDiscoveryComplete:this.model.markDiscoveryComplete.bind(this.model),toggleSubscription:this.toggleSubscription.bind(this)}).render().$el}catch(t){console.error("Issue with rendering discovery",t)}}.bind(this))},getRenderedInterestRefinement:function(){return e(n.onboardingRefineInterestDiscovery())},goToInterests:function(){this.broadcast("nyt:onboarding-track-event","update-interests"),this.broadcast("nyt:onboarding-goto-interests")},toggleSubscription:function(e){var t=this.model.discoveries.findWhere({code:e}),i=this.newsletter.findWhere({code:e});i?(i.toggleSubscription(),t.set("subscribed",!t.get("subscribed"))):window.location.reload()},onNewsletterReset:function(e){e&&e.length>0&&this.model.discoveries.where({type:"newsletter"}).forEach(function(t){t.set("subscribed",e.findWhere({code:t.get("code")}).get("subscribed"))})},carouselScrollPosition:0,carouselCurrentStep:0,initializeCarousel:function(){var e,t=this.$(".onboarding-discovery").filter(function(e,t){return!this.$(t).hasClass("onboarding-discovery-refine-interests")}.bind(this));for(this.$carouselScroll=this.$(".scroll-container"),this.$carouselViewport=this.$(".carousel-viewport"),e=0;e<t.length;e+=3)t.slice(e,e+3).wrapAll('<div class="carousel-item" />');this.$(".onboarding-discovery-refine-interests").wrap('<div class="carousel-item" />'),this.$carouselScroll.find(".carousel-item").last().addClass("is-ref")},getCarouselLength:function(){return this.$carouselScroll.find(".carousel-item").length},findNextSlideItem:function(e){return e.next().length?e.next():this.$carouselScroll.find(".carousel-item").first()},findPrevSlideItem:function(e){return e.prev().length?e.prev():this.$carouselScroll.find(".carousel-item").last()},goToStep:function(t){var i,n,s=this.carouselCurrentStep,a=e(".is-ref");for(this.carouselCurrentStep=t,a.removeClass("is-ref"),t>s?(i=this.findNextSlideItem(a),this.$carouselScroll.removeClass("is-reversing")):t===s?i=a:(i=this.findPrevSlideItem(a),this.$carouselScroll.addClass("is-reversing")),i.addClass("is-ref").css("order",1),n=2;n<=this.getCarouselLength();n++)i=this.findNextSlideItem(i).css("order",n);return this.$carouselScroll.removeClass("is-set"),setTimeout(e.proxy(function(){return this.$carouselScroll.addClass("is-set")},this),50)},scrollLeft:function(){this.goToStep(this.carouselCurrentStep-1)},scrollRight:function(){this.goToStep(this.carouselCurrentStep+1)},checkControls:function(e){0===e?this.$("#carousel-scroll-left").addClass("disabled"):this.$("#carousel-scroll-left").removeClass("disabled"),e===(this.getCarouselLength()-1)/3?this.$("#carousel-scroll-right").addClass("disabled"):this.$("#carousel-scroll-right").removeClass("disabled")},onFocusIn:function(){this.$document.on("keydown.onboarding-discoveries",this.onKeyDown.bind(this))},onFocusOut:function(){this.$document.off("keydown.onboarding-discoveries")},onKeyDown:function(e){switch(e.keyCode){case 37:e.preventDefault(),this.scrollLeft();break;case 39:e.preventDefault(),this.scrollRight()}},onResize:function(){this.goToStep(this.carouselCurrentStep)}});return o}),define("shared/onboarding/views/onboarding-upsell",["foundation/views/base-view","foundation/hosts","shared/onboarding/templates","shared/onboarding/data/onboarding-campaign"],function(e,t,i,n){"use strict";return e.extend({className:"onboarding-upsell",template:i.onboardingUpsell,events:{"click .close":"close","click .button-cancel":"close"},period:null,initialize:function(e){var t;this.model=e.model,this.period=e.period,t="upsell"+(this.period&&"-"+this.period.startDay+"-"+this.period.endDay)||"",this.model.markActionComplete(t)},close:function(t){t.preventDefault(),this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),e.prototype.remove.call(this)},render:function(){return this.$el.html(this.template({takeUpsellUrl:n.getUpsellUrl("inTrialOffer",this.model.get("variation"),null,this.period),copy:n.getUpsellCopy("inTrialOffer",this.model.get("variation"),null,this.period),isLastSevenDays:21==this.period.startDay})),this}})}),define("shared/onboarding/views/onboarding-leave-feedback",["foundation/views/base-view","foundation/hosts","shared/onboarding/templates"],function(e,t,i){"use strict";return e.extend({className:"onboarding-leave-feedback-modal",template:i.onboardingLeaveFeedbackModal,events:{"click .close":"close","click .feedback-done-button":"close","submit .onboarding-leave-feedback-form":"submitForm"},close:function(t){t.preventDefault(),this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),e.prototype.remove.call(this)},resetForm:function(){this.$(".checkbox-wrapper").removeClass("error-no-answer"),this.$(".textarea-wrapper").removeClass("error-no-answer"),this.$(".form-error").remove()},submitForm:function(e){var t="sov1"===this.model.get("variation")?"newsub-":"maple-";return e.preventDefault(),this.resetForm(),this.$('input[name="onboarding-leave-feedback-answer"]:checked').val()?this.$('textarea[name="onboarding-leave-feedback-comment"]').val().length>=500?this.$(".textarea-wrapper").addClass("error-no-answer").before('<p class="form-error">Comment length is limited to 500 characters</p>'):(this.trackingTrigger(t+"leave-feedback",{action:this.$('input[name="onboarding-leave-feedback-answer"]:checked').val(),contentCollection:"discovery-view",eventName:"leave-feedback",mediaId:this.model.get("variation"),module:this.model.getGroup(),pageType:this.pageManager.getMeta("applicationName"),region:"fixedtop",version:"discovery-view",moduleDetail:this.$('textarea[name="onboarding-leave-feedback-comment"]').val()}),this.$(".feedback-form-wrapper").css("display","none"),void this.$(".feedback-thank-you").css("display","block")):this.$(".checkbox-wrapper").addClass("error-no-answer").before('<p class="form-error">Please answer this question</p>')},render:function(){return this.$el.html(this.template()),this}})}),define("shared/onboarding/views/onboarding-post-trial",["foundation/views/base-view","foundation/hosts","shared/onboarding/templates","shared/onboarding/data/onboarding-campaign"],function(e,t,i,n){"use strict";return e.extend({className:"onboarding-post-trial",template:i.onboardingPostTrial,render:function(){return this.$el.html(this.template({takeUpsellUrl:n.getUpsellUrl("postTrialOffer",this.model.get("variation")),copy:n.getUpsellCopy("postTrialOffer",this.model.get("variation"))})),this}})}),define("shared/onboarding/views/onboarding",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/onboarding/data/onboarding-campaign","shared/onboarding/models/onboarding","shared/onboarding/views/onboarding-frame","shared/onboarding/views/onboarding-instructions","shared/onboarding/views/onboarding-collections","shared/onboarding/views/onboarding-discoveries","shared/onboarding/views/onboarding-upsell","shared/onboarding/views/onboarding-leave-feedback","shared/onboarding/views/onboarding-post-trial"],function(e,t,i,n,s,a,o,r,l,d,c,h,u){"use strict";var g=[{View:r,args:{header:"Get Started",template:"onboardingCollectionsInstructions"},className:"onboarding-step-instructions",hasOverlay:!0,trackingName:"first-use-message"},{View:l,args:{header:"Get Started"},className:"onboarding-step-collections",hasOverlay:!0,trackingName:"interest-view"},{View:d,args:{header:"Discover"},className:"onboarding-step-discoveries",hasOverlay:!1,trackingName:"discovery-view"},{View:u,args:{header:"Subscribe"},className:"onboarding-step-post-trial",hasOverlay:!1,trackingName:"post-trial"}],m=i.extend({el:"body",currentStep:0,nytEvents:{"nyt:onboarding-next-step":"nextStep","nyt:onboarding-previous-step":"prevStep","nyt:onboarding-goto-interests":"goToInterests","nyt:onboarding-track-event":"onTrackEvent"},events:{"click .onboarding-leave-feedback-button":"renderLeaveFeedback"},initialize:function(e){this.options=e||{},this.model=new a,this.frame=new o({model:this.model,options:e})},handleUserReady:function(){var e=this.model.shouldCallApi();this.pageManager.flag("mapleFreeTrial")&&e&&-1===window.location.href.indexOf("nytapp=true")&&(this.render(),this.listenTo(this.model,"sync",this.render),this.model.fetch())},render:function(){return this.model.userHasOnboarding()&&this.model.shouldRenderOnboarding&&!this.model.hasPostOnboardingEnded()&&(this.model.hasOnboardingEnded()?this.currentStep=3:("mtv3"===this.model.get("variation")||this.model.isStepComplete("discoveries"))&&(this.currentStep=2),this.removeRibbonIfExists(),this.unpinMasthead(),this.frame.render(),this.$el.prepend(this.frame.$el,this.frame.$overlay),this.renderStep(this.currentStep),this.model.isUpsellTaken()||"mtv3"===this.model.get("variation")||this.renderUpsell()),this},renderStep:function(e){var i=g[e],n=new i.View(t.extend({model:this.model},i.args));return this.frame.$el.attr("class",this.frame.className+" "+i.className),i.hasOverlay?(this.frame.$el.addClass("has-overlay"),this.$el.addClass("onboarding-fixed"),this.$el.removeClass("onboarding-not-fixed")):(this.$el.removeClass("onboarding-fixed"),this.$el.addClass("onboarding-not-fixed"),!this.options.defaultCollapsed||g[this.currentStep].hasOverlay||g[e].hasOverlay||this.frame.$el.addClass("onboarding-collapsed"),0===this.frame.timeHidden&&this.$body.scrollTop(0)),this.frame.replaceContent(n.render().$el),this.frame.updateHeading(i.args.header),this.currentStep=e,2===e?this.model.markStepComplete("discoveries"):3!==e||this.model.isStepComplete("post-trial")||(this.model.markStepComplete("post-trial"),this.frame.showContent()),"function"==typeof n.postRender&&n.postRender(),n},renderUpsell:function(){var e=this.model.get("passedDays"),i=s.inTrialUpsellPeriods,n=this.model.userHasOnboarding()&&(this.model.isUpsellTaken()||this.model.isSubscriber()),a=t.find(i,function(t){return!this.model.isInTrialUpsellStepCompleted(t.startDay+"-"+t.endDay)&&!n&&e>=t.startDay&&e<=t.endDay},this);a&&this.$el.prepend(new c({model:this.model,period:a}).render().$el)},renderLeaveFeedback:function(){this.broadcast("nyt:onboarding-track-event","leave-feedback"),this.$el.prepend(new h({model:this.model}).render().$el)},onTrackEvent:function(e,t){var i,n,s=this.model.getGroup().toLowerCase()+"-";switch(e){case"add":case"remove":case"discovery":i=t.id;break;case"save":i=this.model.get("selectedInterests")}"save"===e&&(n=this.model.isStepComplete("discoveries")?"update-interests":"first-use-select-interests"),this.trackingTrigger(s+e,{action:"click",module:this.model.getGroup(),region:"fixedtop",location:n,eventName:e,version:g[this.currentStep].trackingName,mediaId:this.model.get("variation"),pageType:this.pageManager.getMeta("applicationName"),contentCollection:g[this.currentStep].trackingName,contentId:i})},nextStep:function(){this.renderStep(this.currentStep+1)},prevStep:function(){this.renderStep(this.currentStep-1)},goToInterests:function(){this.renderStep(1)},unpinMasthead:function(){this.broadcast("nyt:in-content-theme-deactivate-pinned-masthead")},removeRibbonIfExists:function(){e("#ribbon").remove()}});return m}),define("collection/instances/masthead",["jquery/nyt","shared/masthead/views/masthead","shared/masthead/views/in-story-theme","shared/masthead/views/search","shared/masthead/views/user-settings-modal","shared/masthead/views/user-name-modal","collection/views/masthead-meta","shared/onboarding/views/onboarding"],function(e,t,i,n,s,a,o,r){"use strict";new t,new n,new s({fixedOverride:!0,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:masthead-storytheme",this.close)}}),new a({fixedOverride:!0,openCallback:function(){this.$target.addClass("active"),this.listenToOnce(this.pageManager,"nyt:masthead-storytheme",this.close),this.broadcast("nyt:masthead-user-modal-open")}}),new i({metaContainer:".collection-meta",contentSelector:".collection",contentSwitchPointSelector:".collection-header .collection-heading"}),new o,new r}),define("collection/models/du-article",["underscore/nyt","backbone/nyt","foundation/models/base-model","foundation/hosts"],function(e,t,i,n){"use strict";var s=i.extend({imageHost:n.staticHost,uniqueClass:null,googleRatingValues:{"4.0":"5","3.0":"4","2.0":"3.5","1.0":"3",.75:"2",.5:"1",.25:"0"},initialize:function(){},getId:function(){return this.get("id")},getSummary:function(){return this.get("summary_short")||this.get("summary")},getByline:function(){return this.get("summary_byline")},getImageThumb:function(){return this.get("review_three_by_two")?this.imageHost+"/"+this.get("review_three_by_two"):null},getNeighborhood:function(){return this.get("neighborhood")},getTitle:function(){return this.get("name")},getUrl:function(){return this.get("nytreviewurl")||this.get("review")},getDate:function(){var e=this.get("review_date")||this.get("updated_date");return e=e.replace(" ","T")},isCriticsPick:function(){return"Y"===this.get("critics_pick")?!0:!1},getRating:function(){return this.get("rating")},getRatingClass:function(){var e="";switch(this.getRating()){case"0.25":case"0.5":case"0.75":e="critic-word-rating";break;case"1.0":case"2.0":case"3.0":case"4.0":e="critic-star-rating"}return e},getMinRatingValue:function(){return 0},getMaxRatingValue:function(){return 5},getGoogleRatingValue:function(){return this.googleRatingValues[this.getRating()]},getRatingString:function(e){var t,i=this.getRating(),n="";switch(e="undefined"!=typeof e?e:"&#9733;",i){case"0.25":n="Poor";break;case"0.5":n="Fair";break;case"0.75":n="Satisfactory";break;default:if(!i)return null;for(i=parseInt(i,10),t=0;i>t;t++)n+=e}return n},getAccessibleStars:function(){var e=this.getRating();return 1==e?"1 star":e>1?e+" stars":""},getCuisineValue:function(){return this.get("cuisine").replace(/;/g,", ")},getPriceValue:function(){var e,t=this.get("price"),i="";if(!t)return null;for(t=parseInt(t,10),e=0;t>e;e++)i+="$";return i},getFormattedDate:function(){var e=new Date(this.getDate());return this.dateHelper.getMonthShortName(e.getMonth())+" "+e.getDate()+", "+e.getFullYear()},getDataType:function(){return"guidedining"},setUniqueClass:function(e){this.uniqueClass=e||this.getId()||Math.floor(1e8+100*Math.random())},getUniqueClass:function(){return this.uniqueClass||this.setUniqueClass(),this.uniqueClass},getReservationsUrl:function(){var e=this.get("reservations_url");return e?e:""},getLatitude:function(){return 0!=this.get("editorial_geocode_latitude")?this.get("editorial_geocode_latitude"):this.get("geocode_latitude")},getLongitude:function(){return 0!=this.get("editorial_geocode_longitude")?this.get("editorial_geocode_longitude"):this.get("geocode_longitude")}});return s}),define("collection/collections/most-viewed",["backbone/nyt","foundation/collections/base-collection","foundation/helpers/utils","underscore/nyt","foundation/hosts","collection/models/du-article"],function(e,t,i,n,s,a){"use strict";var o=t.extend({model:a,url:function(){return s.contentApiHost+"/svc/mostpopular/v2/viewed/30.jsonp"},initialize:function(e){this.collectionName=e.collectionName},sync:function(t,i,n){return n.dataType="jsonp",n.jsonpCallback="jsonPopularBySection",n.jsonp="callback",n.cache=!0,this.collectionName&&(n.data={kicker:this.collectionName}),e.sync(t,i,n)},parse:function(e){return e.results}});return o}),define("collection/templates",["underscore/nyt"],function(_){var templates={};return templates.article=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+="";var keyword="string"==typeof query?query:"";__p+='\n<li id="story-id-'+(null==(__t=item.getUniqueClass())?"":__t)+'">\n<article class="story theme-summary '+(null==(__t=item.hasThumb()?"":"no-thumb")?"":__t)+" "+(null==(__t=item.hasKicker()?"has-kicker":"")?"":__t)+'">\n<div class="story-body">\n<a class="story-link" data-rref="" href="'+(null==(__t=item.getUrl())?"":__t)+'">\n<div class="story-meta">\n',item.hasKicker()&&(__p+='\n<h3 class="kicker '+(null==(__t=item.getKickerClass())?"":__t)+'">'+(null==(__t=item.getKicker())?"":__t)+"</h3>\n"),__p+='\n<h2 class="headline">'+(null==(__t=item.getTitle(keyword))?"":__t)+'</h2>\n<p class="summary">'+(null==(__t=item.getSummary(keyword))?"":__t)+"</p>\n",item.hasSnippet()&&""!=keyword&&(__p+='\n<p class="excerpt">'+(null==(__t=item.getSnippet())?"":__t)+"</p>\n"),__p+='\n<p class="byline">'+(null==(__t=item.getByline(keyword))?"":__t)+"</p>\n</div><!-- close story-meta -->\n",item.hasThumb()&&(__p+='\n<div class="wide-thumb">\n<img role="presentation" src="'+(null==(__t=item.getThumbUrl())?"":__t)+'" width="190" height="126" alt="'+(null==(__t=item.getCaption())?"":__t)+'" itemprop="thumbnailUrl" />\n',item.getImageMediaOverlayIconClass()&&(__p+='\n<div class="media-action-overlay">\n<i class="icon '+(null==(__t=item.getImageMediaOverlayIconClass())?"":__t)+'"></i>\n</div>\n'),__p+="\n</div>\n"),__p+='\n</a>\n</div><!-- close story-body -->\n<footer class="story-footer">\n<time class="dateline" datetime="'+(null==(__t=item.getDate())?"":__t)+'">'+(null==(__t=item.getFormattedDate())?"":__t)+"</time>\n</footer>\n</article>\n</li>"}return __p},templates.duArticle=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+="";"string"==typeof query?query:"";__p+='\n<li id="story-id-'+(null==(__t=item.getUniqueClass())?"":__t)+'">\n<article class="story theme-summary ',item.getImageThumb()||(__p+="no-thumb"),__p+='" itemscope itemtype="http://schema.org/Restaurant">\n<div class="story-body">\n<a class="story-link" data-rref="" href="'+(null==(__t=item.getUrl())?"":__t)+'">\n<div class="story-meta">\n<h2 class="headline" itemprop="headline">\n'+(null==(__t=item.getTitle())?"":__t)+'\n</h2>\n<ul class="review-meta-menu">\n',item.isCriticsPick()&&(__p+='\n<li class="critics-pick">\n<i class="icon sprite-icon"></i>\n<span class="critics-pick-label">NYT Critic&#8217;s Pick</span>\n</li>\n'),__p+="\n",item.getRating()&&(__p+='\n<li class="'+(null==(__t=item.getRatingClass())?"":__t)+'" itemprop="reviewRating" itemscope itemtype="http://schema.org/Rating">\n<meta itemprop="worstRating" content="'+(null==(__t=item.getMinRatingValue())?"":__t)+'">\n<meta itemprop="bestRating" content="'+(null==(__t=item.getMaxRatingValue())?"":__t)+'">\n<meta itemprop="ratingValue" content="'+(null==(__t=item.getGoogleRatingValue())?"":__t)+'">\n',item.getRatingString()&&(__p+='\n<span class="visually-hidden">'+(null==(__t=item.getAccessibleStars())?"":__t)+"</span>\n"),__p+="\n"+(null==(__t=item.getRatingString('<i class="icon sprite-icon star-icon"></i>'))?"":__t)+"\n</li>\n"),__p+="\n",item.getCuisineValue()&&(__p+='\n<li itemprop="servesCuisine">'+(null==(__t=item.getCuisineValue())?"":__t)+"</li>\n"),__p+="\n",item.getPriceValue()&&(__p+='\n<li itemprop="priceRange">'+(null==(__t=item.getPriceValue())?"":__t)+"</li>\n"),__p+="\n",item.getNeighborhood()&&(__p+='\n<li itemprop="addressLocality" itemscope itemtype="http://schema.org/PostalAddress">'+(null==(__t=item.getNeighborhood())?"":__t)+"</li>\n"),__p+='\n</ul>\n<p class="summary" itemprop="description">\n'+(null==(__t=item.getSummary())?"":__t)+"\n</p>\n",item.getByline()&&(__p+='\n<p class="byline" itemprop="author">\nBy\n<span class="author-name">\n'+(null==(__t=item.getByline())?"":__t)+"\n</span>\n</p>\n"),__p+="\n</div><!-- close story-meta -->\n",item.getImageThumb()&&(__p+='\n<div class="wide-thumb">\n<img role="presentation" src="'+(null==(__t=item.getImageThumb())?"":__t)+'" alt="" itemprop="thumbnailUrl" />\n</div><!-- close wide-thumb -->\n'),__p+='\n</a>\n</div><!-- close story-body -->\n<footer class="story-footer">\n<time class="dateline" itemprop="datePublished" datetime="'+(null==(__t=item.getDate())?"":__t)+'">'+(null==(__t=item.getFormattedDate())?"":__t)+'</time>\n<ul class="story-action-menu">\n<li>\n<a data-rref="" href="'+(null==(__t=item.getUrl())?"":__t)+'">Read Review</a>\n</li>\n',item.getReservationsUrl()&&(__p+='\n<li>\n<a class="reserve-table" href="'+(null==(__t=item.getReservationsUrl())?"":__t)+'" target="_blank" title="Reserve a Table">Reserve a Table</a>\n</li>\n'),__p+="\n</ul>\n</footer>\n</article>\n</li>"}return __p},templates.duReviewsMovies=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+="";"string"==typeof query?query:"";__p+='\n<li id="story-id-'+(null==(__t=item.getUniqueClass())?"":__t)+'">\n<article itemscope class="story theme-summary ',item.getImageThumb()||(__p+="no-thumb"),__p+='" itemtype="http://schema.org/Movie">\n<div class="story-body">\n<a class="story-link" data-rref="" href="'+(null==(__t=item.getUrl())?"":__t)+'">\n<div class="story-meta">\n<h2 class="headline" itemprop="headline">\n'+(null==(__t=item.getTitle())?"":__t)+'\n</h2>\n<ul class="review-meta-menu">\n',item.isCriticsPick()&&(__p+='\n<li class="critics-pick">\n<i class="icon sprite-icon"></i>\n<span class="critics-pick-label">NYT Critic&#8217;s Pick</span>\n</li>\n'),__p+="",item.getContentRatingValue()&&(__p+='\n<li itemprop="contentRating">'+(null==(__t=item.getContentRatingValue())?"":__t)+"</li>\n"),__p+="",item.getMovieGenres().length&&(__p+="\n<li>",_.each(item.getMovieGenres(),function(e,t,i){__p+='\n<span itemprop="genre">'+(null==(__t=e)?"":__t)+"</span>",t!=i.length-1&&1!=i.length&&(__p+=", "),__p+="\n"}),__p+="\n</li>\n"),__p+="",item.getDirectors().length&&(__p+="\n<li>Directed by\n",_.each(item.getDirectors(),function(e,t,i){__p+='\n<span itemprop="director" itemscope itemtype="http://schema.org/Person">'+(null==(__t=e)?"":__t)+"</span>",t!=i.length-1&&1!=i.length&&(__p+=", "),__p+="\n"}),__p+="\n</li>\n"),__p+='\n</ul>\n<p class="summary" itemprop="description">\n'+(null==(__t=item.getSummary())?"":__t)+"\n</p>\n",item.getByline()&&(__p+='\n<p class="byline" itemprop="author">\nBy\n<span class="author-name">\n'+(null==(__t=item.getByline())?"":__t)+"\n</span>\n</p>\n"),__p+="\n</div><!-- close story-meta -->\n",item.getImageThumb()&&(__p+='\n<div class="wide-thumb">\n<img role="presentation" src="'+(null==(__t=item.getImageThumb())?"":__t)+'" alt="" itemprop="thumbnailUrl" />\n</div><!-- close wide-thumb -->\n'),__p+='\n</a>\n</div><!-- close story-body -->\n<footer class="story-footer">\n<time class="dateline" datetime="'+(null==(__t=item.getDate())?"":__t)+'">'+(null==(__t=item.getFormattedDate())?"":__t)+'</time><ul class="story-action-menu">\n<li>\n<a href="'+(null==(__t=item.getUrl())?"":__t)+'">Read Review</a>\n</li>\n',item.getTicketUrl()&&(__p+='\n<li>\n<a class="find-tickets" href="'+(null==(__t=item.getTicketUrl())?"":__t)+'" target="_blank" title="'+(null==(__t=item.getTitle())?"":__t)+'">Find Tickets</a>\n</li>\n'),__p+="\n</ul>\n</footer>\n</article>\n</li>"}return __p},templates.duReviewsTheater=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+="";"string"==typeof query?query:"";__p+='\n<li id="story-id-'+(null==(__t=item.getUniqueClass())?"":__t)+'">\n<article itemscope class="story theme-summary ',item.getImageThumb()||(__p+="no-thumb"),__p+='" itemtype="http://schema.org/Events">\n<div class="story-body">\n<a class="story-link" data-rref="" href="'+(null==(__t=item.getUrl())?"":__t)+'">\n<div class="story-meta">\n<h2 class="headline" itemprop="headline">\n'+(null==(__t=item.getTitle())?"":__t)+'\n</h2>\n<ul class="review-meta-menu">\n',item.isCriticsPick()&&(__p+='\n<li class="critics-pick">\n<i class="icon sprite-icon"></i>\n<span class="critics-pick-label">Critics&#8217; Pick</span>\n</li>\n'),__p+="\n",item.getCategory()&&(__p+="\n<li>\n",item.getCategory()&&(__p+='\n<span itemprop="category" itemscope itemtype="http://schema.org/CreativeWork">'+(null==(__t=item.getCategory())?"":__t)+"</span>\n"),__p+="\n</li>\n"),__p+='\n</ul>\n<p class="summary" itemprop="description">\n'+(null==(__t=item.getSummary())?"":__t)+"\n</p>\n",item.getByline()&&(__p+='\n<p class="byline" itemprop="author">\nBy\n<span class="author-name">\n'+(null==(__t=item.getByline())?"":__t)+"\n</span>\n</p>\n"),__p+="\n</div><!-- close story-meta -->\n",item.getImageThumb()&&(__p+='\n<div class="wide-thumb">\n<img role="presentation" src="'+(null==(__t=item.getImageThumb())?"":__t)+'" alt="" itemprop="thumbnailUrl" />\n</div><!-- close wide-thumb -->\n'),__p+='\n</a>\n</div><!-- close story-body -->\n<footer class="story-footer">\n<time class="dateline" itemprop="datePublished" datetime="'+(null==(__t=item.getDate())?"":__t)+'">'+(null==(__t=item.getFormattedDate())?"":__t)+'</time>\n<ul class="story-action-menu">\n<li>\n<a href="'+(null==(__t=item.getUrl())?"":__t)+'">Read Review</a>\n</li>\n',item.getTicketUrl()&&(__p+='\n<li>\n<a href="'+(null==(__t=item.getTicketUrl())?"":__t)+'" target="_blank">Find Tickets</a>\n</li>\n'),__p+="\n</ul>\n</footer>\n</article>\n</li>"}return __p},templates.editionTemplate=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="edition-modal-view">\n<div class="edition-modal-content">\n<div class="inset">\n<div class="main-content">\n<div class="content">\n<div class="edition-frame">\n<iframe src="'+(null==(__t=iframeSrc)?"":__t)+'" scrolling="no" width="475" height="400" marginheight="10" marginwidth="10" frameborder="0"></iframe>\n</div>\n<div class="edition-body">\n<p class="edition-date">'+(null==(__t=todaysDate)?"":__t)+'</p>\n<p class="view-message">Download the high-resolution version of this front page</p>\n<a href="'+(null==(__t=iframeSrc)?"":__t)+'" target="_blank" class="button view-pdf">VIEW PDF</a>\n<p class="view-pdf-message">For personal use only. Publication, reproduction, use in advertising or for purpose of trade is strictly prohibited without written permission from The New York Times.</p>\n<p class="view-pdf-message"> 2018 The New York Times. All Rights Reserved.</p>\n<p class="high-quality-print"> To order a high-quality reprint of this page,<span class="high-quality-print-url"><a href="http://www.nytstore.com/Front-Page-New-York-Times-Reprint_p_103.html?utm_source=NYTimes&amp;utm_medium=frontpage&amp;utm_campaign=Buy_Now"> click here</a></span></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n</div>';return __p},templates.followable=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li class="followable-item" data-followable-id="'+(null==(__t=item.slug)?"":__t)+'">\n<div class="wide-thumb">\n<a href="'+(null==(__t=item.href)?"":__t)+'">\n<img role="presentation" src="'+(null==(__t=item.thumbnail)?"":__t)+'" width="68" height="68" alt="" itemprop="thumbnailUrl" />\n</a>\n</div>\n<div class="followable-meta">\n<h2 class="headline"><a href="'+(null==(__t=item.href)?"":__t)+'">'+(null==(__t=item.headline)?"":__t)+'</a></h2>\n<p class="summary">'+(null==(__t=item.summary)?"":__t)+'</p>\n</div>\n<div class="user-action">\n<button class="button follow-button',item.isFollowing&&(__p+=" following"),__p+='">\n',__p+=item.isFollowing?"\nFollowing\n":"\nFollow\n",__p+='\n</button>\n<p class="frequency-details">'+(null==(__t=item.publishing_frequency)?"":__t)+"</p>\n</div>\n</li>";return __p},templates.pageMarker=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li id="'+(null==(__t=id)?"":__t)+'" class="page-marker invisible-minimized"></li>';return __p},templates.savedArticle=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li class="story-menu-item">\n<article class="story theme-summary '+(null==(__t=item.hasThumb()?"":"no-thumb")?"":__t)+'">\n<div class="story-body">\n<a class="story-link" href="'+(null==(__t=item.getUrl())?"":_.escape(__t))+'">\n<div class="story-meta">\n<h2 class="headline">\n'+(null==(__t=item.getTitle())?"":_.escape(__t))+'\n</h2>\n<p class="summary">'+(null==(__t=item.getSummary())?"":__t)+'</p>\n<p class="byline">'+(null==(__t=item.getByline())?"":__t)+"</p>\n</div><!-- close story-meta -->\n",item.hasThumb()&&(__p+='\n<div class="wide-thumb">\n<img role="presentation" src="'+(null==(__t=item.getThumbUrl())?"":__t)+'" width="190" height="126" alt="'+(null==(__t=item.getCaptionStripTags())?"":__t)+'" itemprop="thumbnailUrl" />\n</div>\n'),__p+='\n</a>\n</div><!-- close story-body -->\n<footer class="story-footer">\n<time class="dateline" datetime="'+(null==(__t=item.getDate())?"":__t)+'">'+(null==(__t=item.getFormattedDate())?"":__t)+'</time>\n<div class="saved-item-tools-container">\n<div class="saved-item-tools" data-title="'+(null==(__t=item.getTitle())?"":_.escape(__t))+'" data-description="'+(null==(__t=item.getSummary())?"":__t)+'" data-url="'+(null==(__t=item.getUrl())?"":_.escape(__t))+'" data-shares="show-all" style="display:none;">\n<button class="button remove-saved-item-button" value="'+(null==(__t=item.getUrl())?"":_.escape(__t))+'">\n<i class="icon"></i>\n<span class="visually-hidden">Remove this saved item</span>\n</button>\n</div>\n</div>\n</footer>\n</article>\n</li>';return __p},templates.savedArticleError=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="error api-load-error">\n<p>\n<strong class="error-message">Were sorry, we couldnt load your saved items.</strong>\n</p>\n<p>Dont worry &mdash; your articles arent gone forever. You can reload this page or come back later.</p>\n</div>';return __p},templates.showMoreInSubNav=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isMobileDevice?(__p+='\n<div class="control select-menu-control">\n<label for="subnavigation-select-menu" class="visually-hidden">Select More</label>\n<select id="subnavigation-select-menu" class="subnavigation-select-menu">\n<option value="">MORE</option>\n<option disabled></option>\n',_.each(selectNavItems,function(e){if(__p+="\n",e.hasSubList){__p+="\n<optgroup label='"+(null==(__t=e.itemSubList[0])?"":__t)+"'>\n";for(var t=0;t<e.itemSubList.length;t++)__p+="\n",t>1&&(__p+="\n<option value='"+(null==(__t=e.itemLabels[t])?"":__t)+"'> "+(null==(__t=e.itemSubList[t])?"":__t)+"</option>\n"),__p+="\n";__p+="\n</optgroup>\n"}else __p+="\n<option value='"+(null==(__t=e.itemHref)?"":__t)+"'> "+(null==(__t=e.itemName)?"":__t)+"</option>\n";__p+="\n"}),__p+='\n</select>\n<div class="arrow arrow-down">\n<div class="arrow-conceal">\n</div>\n</div>\n</div>\n'):(__p+='\n<div class="control select-menu-control">\n<div class="more-header">MORE<div class="arrow arrow-down"><div class="arrow-conceal"></div></div></div>\n<ul id="subnavigation-select-menu" class="subnavigation-select-menu hidden">\n',_.each(selectNavItems,function(e){if(__p+="\n",e.hasSubList){__p+="\n<ul>\n<li>"+(null==(__t=e.itemName)?"":__t)+"</li>\n";for(var t=0;t<e.itemSubList.length;t++)__p+='\n<li><a href="'+(null==(__t=e.itemLabels[t])?"":__t)+'">'+(null==(__t=e.itemSubList[t])?"":__t)+"</a></li>\n";__p+="\n</ul>\n"}else __p+="\n<li><a href='"+(null==(__t=e.itemHref)?"":__t)+"'> "+(null==(__t=e.itemName)?"":__t)+"</a></li>\n";__p+="\n"}),__p+="\n</ul>\n</div>\n"),__p+="";return __p},templates.sortList=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<ul class="menu">\n',_.each(sorts,function(e,t){__p+='\n<li><button type="button" class="button" data-type="'+(null==(__t=t)?"":__t)+'">'+(null==(__t=e)?"":__t)+"</button></li>\n"}),__p+="\n</ul>";return __p},templates.todaysHeader=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="date-module">\n<div class="date-heading">\n<span class="date-header">The Times in Print For</span>\n<form class="date-form">\n<div class="date-select">\n<select id="date-menu" class="date-button"></select>\n</div>\n<div class="arrow arrow-down">\n<div class="arrow-conceal"></div>\n</div>\n</form>\n</div>\n</div>';
return __p},templates}),define("shared/page/helpers/nyt-collection-view-mixin",["jquery/nyt","foundation/helpers/utils"],function(e,t){"use strict";var i={assignRref:function(i,n,s){var a,o;a=s?e(s):this.$el,o=["collection",n,i].join("/"),a.find("a[data-rref]").removeAttr("data-rref").attr("href",function(e,i){return t.appendQueryParams(i,{rref:o})})}};return i}),define("collection/views/most-popular",["jquery/nyt","underscore/nyt","foundation/views/base-view","collection/collections/most-viewed","collection/templates","shared/page/helpers/nyt-collection-view-mixin"],function(e,t,i,n,s,a){"use strict";var o=i.extend(t.extend({},a,{el:"#most-popular-panel",nytEvents:{"nyt:tabs-tab-click":"loadData"},initialize:function(){var e=this.pageManager.getMeta("nyt-collection:identifier"),t=this.pageManager.getMeta("nyt-collection:type");this.collection=new n({collectionName:e}),this.listenToOnce(this.collection,"sync",this.render),this.assignRref(e,t)},loadData:function(e){"most-popular"===e&&this.collection.fetch()},render:function(){var e,t,i="";for(e=0,t=this.collection.length;t>e&&10>e;e+=1)i+=s.article({item:this.collection.at(e)});this.$el.find(".story-menu").html(i),this.assignRref()}}));return o}),define("collection/instances/most-popular",["collection/views/most-popular"],function(e){"use strict";new e}),define("collection/models/add-article",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model","foundation/views/page-manager"],function(e,t,i,n,s){"use strict";var a=n.extend({thumbnail:null,media:null,uniqueClass:null,collectionType:s.getMeta("nyt-collection:type"),initialize:function(){var e,t=this.get("promotional_media");t&&(this.media=t.image?t:t.promotional_media),this.media&&this.media.image&&this.media.image.image_crops&&(e=this.media.image.image_crops,e.mediumThreeByTwo210?this.thumbnail=e.mediumThreeByTwo210:this.thumbnail=e.thumbWide||"")},getId:function(){return this.get("data_id")},getSummary:function(e){return this.getWrappedKeywords(this.get("summary"),e)},hasKicker:function(){var e=this.getDataType();return"video"===e||"slideshow"===e||"imageslideshow"===e?!0:"column"===this.collectionType?!1:this.has("kicker")&&""!==this.get("kicker")},getKicker:function(){switch(this.getDataType()){case"video":return'Times<span class="video">Video</span>';case"imageslideshow":case"slideshow":return"Slide Show";default:return this.get("kicker")}},getByline:function(e){return this.getWrappedKeywords(this.get("byline"),e)},getTitle:function(e){return this.getWrappedKeywords(this.get("headline"),e)},getUrl:function(){return this.get("url")},getDate:function(){var e,t,i,n,s,a=this.get("add_sort_date");if(this.pageManager.flag("dateSortMisMatch")){if(!a)return s=new Date,s.getFullYear()+"-"+s.getMonth()+"-"+s.getDate()}else if(!a)return new Date;return e=/\.\w+$/i,t=e.exec(a),i=t?t[0]:"",n=".EDT"===i?a.replace(e,"-04:00"):".EST"===i?a.replace(e,"-05:00"):a.replace(e,""),this.pageManager.flag("dateSortMisMatch")?n:new Date(Date.parse(n))},getFormattedDate:function(){var e,t=this.getDate();return this.pageManager.flag("dateSortMisMatch")?(e=parseInt(t.substr(5,2),10)-1,this.dateHelper.getMonthShortName(e)+" "+t.substr(8,2)+", "+t.substr(0,4)):this.dateHelper.getMonthShortName(t.getMonth())+" "+t.getDate()+", "+t.getFullYear()},getThumbUrl:function(){return this.thumbnail&&this.thumbnail.url},getCaption:function(){return this.hasThumb()&&this.media&&this.media.image&&this.media.image.caption&&this.media.image.caption["short"]?this.media.image.caption["short"]:""},getSnippet:function(){return this.get("snippet")},hasSnippet:function(){return null!==this.get("snippet")&&this.get("snippet")!==this.get("summary")},isVideo:function(){var e=this.get("promotional_media")?this.get("promotional_media").data_type:null;return"video"===this.getDataType()||"video"===e},hasThumb:function(){return!!this.thumbnail},getWrappedKeywords:function(t,i){var n;return t&&i&&(n=new RegExp("("+e.trim(i).replace(/\s+/g,"|")+")","gi"),t=t.replace(n,'<span class="highlighted-keyword">$1</span>')),t},getDataType:function(){return this.get("data_type")},getImageMediaOverlayIconClass:function(){switch(this.getDataType()){case"imageslideshow":return"sprite-icon slideshow-icon";case"video":return"video-icon";default:return""}},getKickerClass:function(){switch(this.getDataType()){case"video":return"timesvideo";default:return""}},setUniqueClass:function(e){this.uniqueClass=e||this.getId()||Math.floor(1e8+100*Math.random())},getUniqueClass:function(){return this.uniqueClass||this.setUniqueClass(),this.uniqueClass}});return a}),define("collection/models/du-reviews-theater",["underscore/nyt","backbone/nyt","foundation/hosts","collection/models/du-article"],function(e,t,i,n){"use strict";var s=n.extend({reviewInfo:[],getReviewInfo:function(e){this.get("reviews")&&"undefined"!=typeof this.get("reviews")[0]&&(this.reviewInfo[e]=this.get("reviews")[0][e])},getByline:function(){return this.getReviewInfo("byline"),this.reviewInfo.byline},getCategory:function(){return this.get("category")},getGenre:function(){return this.get("genres")},getTitle:function(){return this.get("perf_name")},getUrl:function(){var e;return this.getReviewInfo("url"),e=this.reviewInfo.url,e.indexOf("nytimes.com")>-1?e:i.DUHost+"/"+e},getDate:function(){return this.getReviewInfo("publish_date"),this.reviewInfo.publish_date},isCriticsPick:function(){return 1===this.get("critics_pick")?!0:!1},getTicketUrl:function(){var e=this.get("tickets_url");return/^(f|ht)tps?:\/\//i.test(e)?e:!1},getRating:function(){return this.get("rating")},getDataType:function(){return"guidetheater"},setUniqueClass:function(e){this.uniqueClass=e?e:this.getId()},getUniqueClass:function(){return this.uniqueClass||this.setUniqueClass(),this.uniqueClass},getImageThumb:function(){var e;return this.getReviewInfo("image_medium_three_by_two"),e=this.reviewInfo.image_medium_three_by_two,e?"https://static01.nyt.com//"+e:void 0},getSummary:function(){return this.getReviewInfo("summary"),this.reviewInfo.summary}});return s}),define("collection/models/du-reviews-movies",["underscore/nyt","backbone/nyt","foundation/hosts","collection/models/du-article"],function(e,t,i,n){"use strict";var s=n.extend({getFirstReview:function(){return this.get("reviews")[0]},getSummary:function(){return this.getFirstReview().summary},getByline:function(){return this.getFirstReview().byline},getTitle:function(){var e=this.getFirstReview().title;return e?e:this.get("title")},getUrl:function(){var e=this.getFirstReview().review_url;return e?"/"+e:void 0},getTicketUrl:function(){var e=this.get("ticket_url");return/^(f|ht)tps?:\/\//i.test(e)?e:!1},getDate:function(){return this.getFirstReview().publish_date},isCriticsPick:function(){return 1===this.get("critics_pick")?!0:!1},getDataType:function(){return"guidemovies"},setUniqueClass:function(e){this.uniqueClass=e?e:this.getId()},getUniqueClass:function(){return this.uniqueClass||this.setUniqueClass(),this.uniqueClass},getImageThumb:function(){var e=this.getFirstReview().image_medium_three_by_two;return e?this.imageHost+"/"+e:void 0},getContentRatingValue:function(){var t=this.get("rating");return-1!==e.indexOf(["NR","Unrat","Unrated"],t)?"Not Rated":t},getDirectors:function(){return this.get("directors")},getMovieGenres:function(){return this.get("genres")}});return s}),define("collection/collections/paginated",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts","collection/models/add-article","collection/models/du-article","collection/models/du-reviews-theater","collection/models/du-reviews-movies"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=n.extend({model:a,url:s.ADDCollectionHost+"/svc/collections/v1/publish/"+s.wwwDomain,useDU:!1,DU_PAGE_LENGTH:10,DU_PAGE_LIMIT:10,filterValue:null,filterType:null,page:2,query:"",sort:"newest",isTopicsCollection:!1,initialize:function(e){this.collectionName=e.collectionName,this.collectionType=e.collectionType,this.collectionURL=e.collectionURL,this.collectionURI=e.collectionURI,"timestopic"===e.collectionType&&(this.isTopicsCollection=!0),this.isDataUniverse(this.collectionURL)&&(this.useDU=!0,this.url=this.collectionURL,"theater-guide"===this.collectionName?this.model=r:"movie-guide"===this.collectionName?this.model=l:this.model=o),this.totalPages=e.totalPages,this.dedupeItemsDuringSync=e.dedupeItems},isDataUniverse:function(e){var t=0,i=["/svc/dining/","/svc/events/","/svc/movies/","svc/theater/"];for(t=0;t<i.length;t+=1)if(-1!==e.indexOf(i[t]))return!0;return!1},sync:function(e,t,n){var a="dedupe_hl";return this.useDU?this.syncDU(e,t,n):(n.dataType="json",n.cache=!0,n.url=this.url+this.collectionURI,this.isTopicsCollection&&(n.url=this.url.replace("publish/www","publish/topics")+"/topic/"+this.collectionURL.split("topic/").pop()),n.data={q:this.query,sort:this.sort,page:this.page,dom:s.wwwDomain,type:this.assetType},this.dedupeItemsDuringSync&&(n.data[a]="y"),i.sync(e,t,n))},syncDU:function(e,t,n){var s=this.sort,a="asc",o="desc",r=o,l=this.page*this.DU_PAGE_LENGTH;switch(n.url=this.url,this.pageManager.flag("restaurantSearchAPIUpdate")&&this.query&&"restaurant-guide"===this.collectionName?n.url+=this.query.replace(/ /g,"+")+".json":this.query&&"movie-guide"!==this.collectionName&&(n.url+=this.query.replace(/ /g,"+")),s){case"oldest":s="review",r=a;break;case"newest":s="review",r=o}return"restaurant-guide"===this.collectionName?n.data=this.getRestaurantQueryParams(r,s,l):"theater-guide"===this.collectionName?n.data=this.getTheaterQueryParams(l,this.getCurrentTheaterFilter()):"movie-guide"===this.collectionName&&(n.data=this.getMovieQueryParams(r,l)),i.sync(e,t,n)},getMovieQueryParams:function(t,i){return{offset:i,limit:this.DU_PAGE_LIMIT,"sort-order":t,order:"publication_date",pick:e("#critics-pick-filter").is(":checked")?"y":void 0,genre:e("#genre-filter").val()||void 0,rating:e("#mpaa-rating-filter").val()||void 0,query:this.query||void 0}},getCurrentTheaterFilter:function(){var t=e(".stream-filters-menu li a.current").prop("href");return t.split("/").pop()},getTheaterQueryParams:function(e,t){var i={"has-review":!0,"sort-order":"asc",order:"perf_name",limit:this.DU_PAGE_LIMIT,offset:e};switch(t){case"broadway":i.category="Broadway";break;case"off-broadway":i.category="Off Broadway,Off Off Broadway";break;case"plays":i.genre="play";break;case"musicals":i.genre="musical";break;case"family-friendly":i.kidfriendly="y";break;case"recently-opened":i["opened-within"]=30,i.order="start_date";break;case"closing-soon":i["closing-within"]=30;break;case"critics-pick":i.pick="y"}return i},getRestaurantQueryParams:function(t,i,n){return{"has-review":"Y","sort-order":t,"sort-by":i,offset:n,limit:this.DU_PAGE_LIMIT,dom:s.wwwDomain,neighborhood:e("#neighborhood-filter").val()||void 0,price:e("#price-filter").val()||void 0,cuisine:e("#cuisine-filter").val()||void 0,rating:e("#rating-filter").val()||void 0,"critics-pick":e("#critics-pick-filter").is(":checked")?"Y":void 0}},parse:function(e){return this.useDU?this.parseDU(e):(this.totalPages=e.members.total_pages,this.totalItems=e.members.total_members,e.members.items)},parseDU:function(e){return"movie-guide"===this.collectionName||"theater-guide"===this.collectionName?0===e.has_more?(this.totalItems=(this.page-1)*this.DU_PAGE_LENGTH+e.results.length,e.results.length>0?this.totalPages=Math.ceil(this.totalItems/this.DU_PAGE_LENGTH):this.totalPages=0):(this.totalItems=1/0,this.totalPages=1/0):(this.totalItems=e.num_results,this.totalPages=Math.ceil(e.num_results/this.DU_PAGE_LENGTH)),e.results},nextPage:function(){var e;return this.page>=this.totalPages?(this.trigger("finished"),e=!1):(this.fetch(),this.page=this.page+1,this.page===this.totalPages&&this.trigger("finished"),e=!0),e},loadData:function(e,t,i){(this.query!==e||this.sort!==t)&&(this.broadcast("nyt:collections-search-changed",e),this.page=0),this.assetType=i,this.query=e,this.sort=t||"newest",this.fetch(),this.page=this.page+1},getQuery:function(){return this.query||""},getTotalPages:function(){return this.totalPages||0},getTotalCount:function(){return this.totalItems||0},getSort:function(){return this.sort}});return d}),define("collection/views/continuous-scroll-view",["jquery/nyt","underscore/nyt","foundation/views/page-manager","foundation/views/base-view","collection/templates","collection/collections/paginated","shared/page/helpers/nyt-collection-view-mixin"],function(e,t,i,n,s,a,o){"use strict";var r=n.extend(t.extend({},o,{defaultEvents:{"click .load-more-button":"handleLoadMoreClick"},collectionName:"",collectionType:"",childEvents:{},allPagesLoaded:!1,googleMapsPoints:[],autoScrollBreakpointThreshold:1050,additionalAdCounter:1,paidPostCounter:3,events:function(){return t.extend({},this.defaultEvents,this.childEvents)},initialize:function(e){var t=this.$el.find(".stream").data().totalPages;this.collectionName=e.collectionName,this.collectionType=e.collectionType,this.collectionURL=e.collectionURL,this.collectionURI=e.collectionURI,1===t&&this.hideLoadMoreButton(),2===t&&(this.allPagesLoaded=!0),this.collection=new a({collectionName:this.collectionName,collectionType:this.collectionType,collectionURL:this.collectionURL,collectionURI:this.collectionURI,totalPages:t,dedupeItems:e.dedupeItems}),this.assignRref(this.collectionName,this.collectionType),this.setPageMarker(),this.addDefaultListeners()},handleError:function(){this.handleAllPagesLoaded()},handleLoadMoreClick:function(){var e=this.magnum.getViewportInteger();this.collection.filterType="loadMore",e>=this.autoScrollBreakpointThreshold?this.engageContinuousScroll():this.revealNextPage()},setPageMarker:function(){this.$pageMarker=this.$el.find("#"+this.pageMarkerId)},engageContinuousScroll:function(){this.isScrollingContinuously=!0,this.hideLoadMoreButton(),this.$el.find(".story-menu.additional-set").removeClass("hidden"),this.$el.find(".additional-set li:not(.page-marker):first a:first").focus(),this.allPagesLoaded||(this.watchForLastPage(),this.subscribe("nyt:page-scroll",this.watchForLastPage))},revealNextPage:function(){var e;e=this.$el.find(".initial-set li:last-child"),this.removePageMarker(),this.$el.find(".additional-set > li:not(.page-marker)").appendTo(this.$el.find(".story-menu.initial-set")),e.next().find("a:first").focus(),this.allPagesLoaded?this.hideLoadMoreButton():this.collection.nextPage()||this.hideLoadMoreButton()},addDefaultListeners:function(){this.listenTo(this.collection,"sync",this.render),this.listenTo(this.collection,"finished",this.handleAllPagesLoaded),this.listenTo(this.collection,"error",this.handleError)},appendPageOfResultsToList:function(){var t,i,n,a,o,r,l,d="",c=this.collection.getQuery(),h=this.$el.find(".story-menu.initial-set").is(":empty");for(n=h?this.$el.find(".story-menu.initial-set"):this.$el.find(".story-menu.additional-set"),h||(d+=s.pageMarker({id:this.pageMarkerId})),t=0,i=this.collection.length;i>t;t+=1)h&&1===t&&this.collection.nextPage(),0===t&&(a=this.collection.at(t).getId(),null===a&&(a=Math.floor(1e8+100*Math.random())),a=a+"-"+this.additionalAdCounter,this.collection.at(t).setUniqueClass(a),this.additionalAdCounter++),this.collection.useDU?"theater-guide"===this.collectionName?d+=s.duReviewsTheater({item:this.collection.at(t),query:c}):"movie-guide"===this.collectionName?d+=s.duReviewsMovies({item:this.collection.at(t),query:c}):(d+=s.duArticle({item:this.collection.at(t),query:c}),h&&"restaurant-guide"===this.collectionName&&this.appendGoogleMapsPoints(this.collection.at(t))):d+=s.article({item:this.collection.at(t),query:c});this.pageManager.flag("paidPostStream")&&(o="paid-post-"+(this.paidPostCounter-1),this.collection.length>9&&(r="paid-post-"+this.paidPostCounter,l='<li id="'+r+'" class="ad hidden"></li>',d+=l,this.paidPostCounter++)),n.append(d),h&&"restaurant-guide"===this.collectionName&&this.handleBroadcastGoogleMaps(),this.collection.length>4&&h===!1&&this.handleBroadCastAdditionalAd("#story-id-"+a),this.pageManager.flag("paidPostStream")&&e("#"+o).length>0&&this.handleBroadCastPaidPost("#"+o),this.setPageMarker()},watchForLastPage:function(){this.isPageMarkerAboveBottomOfViewport()&&(this.removePageMarker(),this.collection.nextPage())},hideLoadMoreButton:function(){this.$el.find(".story-menu-options").addClass("is-scrolling-continuously"),this.$el.find(".load-more-button").hide()},showLoadMoreButton:function(){this.$el.find(".story-menu-options").removeClass("is-scrolling-continuously"),this.$el.find(".load-more-button").show()},handleAllPagesLoaded:function(){this.allPagesLoaded=!0,this.stopSubscribing("nyt:page-scroll",this.watchForLastPage)},removePageMarker:function(){this.$pageMarker.remove()},isPageMarkerAboveBottomOfViewport:function(){var e=this.$el.find("#"+this.pageMarkerId).get(0);return this.$el.is(":visible")&&e&&e.getBoundingClientRect().top<=this.pageManager.getViewport().height},handleBroadCastAdditionalAd:function(e){("latest-panel"===this.$el.attr("id")||"stream-search"===this.$el.attr("id")&&this.$el.hasClass("stream-supplemental")===!0)&&this.broadcast("nyt:append-ads-to-stream",{element:this.$el.find("li"+e),parentId:this.$el.attr("id")})},handleBroadCastPaidPost:function(e){("latest-panel"===this.$el.attr("id")||"stream-search"===this.$el.attr("id"))&&this.broadcast("nyt:append-paidpost-to-stream",{element:this.$el.find("li"+e)})},appendGoogleMapsPoints:function(e){this.googleMapsPoints.push({name:e.getTitle(),longtitude:e.getLongitude(),latitude:e.getLatitude()})},handleBroadcastGoogleMaps:function(){this.broadcast("nyt:redraw-google-maps",{GoogleMapZoom:13,GoogleMapOptions:this.googleMapsPoints})}}));return r}),define("collection/views/latest",["jquery/nyt","underscore/nyt","collection/collections/paginated","collection/views/continuous-scroll-view"],function(e,t,i,n){"use strict";var s=n.extend({el:"#latest-panel",pageMarkerId:"latest-page-marker",render:function(){return this.appendPageOfResultsToList(),this.assignRref(this.collectionName,this.collectionType),this}});return s}),define("collection/instances/latest",["jquery/nyt","foundation/views/page-manager","collection/views/latest"],function(e,t,i){"use strict";var n=t.getMeta("nyt-collection:identifier"),s=t.getMeta("nyt-collection:type"),a=t.getMeta("nyt-collection:url"),o=t.getMeta("nyt-collection:uri"),r=e("#latest-panel").length>0;n&&""!==n&&r&&new i({collectionName:n,collectionType:s,collectionURL:a,collectionURI:o,dedupeItems:!0})}),define("collection/views/multimedia",["jquery/nyt","underscore/nyt","collection/collections/paginated","collection/views/continuous-scroll-view"],function(e,t,i,n){"use strict";var s=n.extend({el:"#multimedia-panel",pageMarkerId:"multimedia-page-marker",nytEvents:{"nyt:tabs-tab-click":"loadData"},loadData:function(){this.collection.loadData("","newest","multimedia")},render:function(){return this.appendPageOfResultsToList(),this.assignRref(this.collectionName,this.collectionType),this}});return s}),define("collection/instances/multimedia",["jquery/nyt","foundation/views/page-manager","collection/views/multimedia"],function(e,t,i){"use strict";var n=t.getMeta("nyt-collection:identifier"),s=t.getMeta("nyt-collection:type"),a=t.getMeta("nyt-collection:url"),o=t.getMeta("nyt-collection:uri"),r=e("#multimedia-panel").length>0;n&&""!==n&&r&&new i({collectionName:n,collectionType:s,collectionURL:a,collectionURI:o,dedupeItems:!0})}),define("collection/views/timeline",["jquery/nyt","underscore/nyt","collection/collections/paginated","collection/views/continuous-scroll-view"],function(e,t,i,n){"use strict";var s=n.extend({el:"#timeline-panel",pageMarkerId:"timeline-page-marker",nytEvents:{"nyt:tabs-tab-click":"loadData"},loadData:function(){this.collection.loadData("","newest","timeline")},render:function(){return this.appendPageOfResultsToList(),this}});return s}),define("collection/instances/timeline",["jquery/nyt","foundation/views/page-manager","collection/views/timeline"],function(e,t,i){"use strict";var n=t.getMeta("nyt-collection:identifier"),s=t.getMeta("nyt-collection:type"),a=t.getMeta("nyt-collection:url"),o=t.getMeta("nyt-collection:uri"),r=e("#timeline-panel").length>0;n&&""!==n&&r&&new i({collectionName:n,collectionType:s,collectionURL:a,collectionURI:o,dedupeItems:!0})}),define("shared/swiper/views/swiper",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({$container:"",$slides:"",$navigation:"",slideWidth:0,slideCount:0,currentSlide:0,slideSpacer:0,hammerSettings:{drag_lock_to_axis:!0},events:{release:"handleRelease",dragleft:"handleDrag",dragright:"handleDrag",swipeleft:"handleSwipeNext",swiperight:"handleSwipePrev"},nytEvents:{"nyt:page-resize":"resetSwiperDimensions","nyt:handleOrientation":"resetSwiperDimensions"},initialize:function(e){this.$el=e.el},handleDomReady:function(){this.$el.has("ol").length?this.$container=this.$el.find("ol"):this.$container=this.$el.find("ul"),this.$slides=this.$container.find("li"),this.$container.after('<div class="dot-navigation"></div>'),this.$navigation=this.$el.find(".dot-navigation"),this.slideSpacer=parseInt(this.$slides.css("margin-right"),10),this.slideWidth=this.$el.width()+this.slideSpacer,this.slideCount=this.$slides.length,this.renderIndicators(),this.showSlide(this.currentSlide)},renderIndicators:function(){var t="",i=this;this.$slides.each(function(e){t+='<span class="dot" data-slide="'+e+'"></span>'}),this.$navigation.append(t),this.$navigation.find(".dot").on("click",function(){i.showSlide(e(this).attr("data-slide"))})},showSlide:function(e){var t,i;this.currentSlide=e,this.setIndicator(this.currentSlide),i=-(100/this.slideCount)*this.currentSlide,t=this.slideWidth*this.slideCount/100*i,this.$container.css({left:t+"px",transition:"left .2s linear"})},resetSwiperDimensions:function(){var e,t;this.slideWidth=this.$el.width()+this.slideSpacer,t=-(100/this.slideCount)*this.currentSlide,e=this.slideWidth*this.slideCount/100*t,this.$container.css("left",e+"px")},setIndicator:function(e){this.$navigation.find(".dot").removeClass("active"),this.$navigation.find(".dot").eq(e).addClass("active")},next:function(){var e=this.currentSlide+1;return e=e>this.slideCount-1?this.showSlide(this.currentSlide):this.showSlide(this.currentSlide+1)},prev:function(){var e=this.currentSlide-1;return e=0>e?this.showSlide(this.currentSlide):this.showSlide(this.currentSlide-1)},handleDrag:function(e){var t,i=-(100/this.slideCount)*this.currentSlide,n=100/this.slideWidth*e.gesture.deltaX/this.slideCount;e.gesture.preventDefault(),(0===this.currentSlide&&"right"===e.gesture.direction||this.currentSlide===this.slideCount-1&&"left"===e.gesture.direction)&&(n*=.4),t=this.slideWidth*this.slideCount/100*(i+n),this.$container.css("left",t+"px")},handleRelease:function(e){Math.abs(e.gesture.deltaX)>this.slideWidth/2?"right"===e.gesture.direction?this.prev():this.next():this.showSlide(this.currentSlide)},handleSwipeNext:function(e){e.gesture.preventDefault(),this.next(),e.gesture.stopDetect()},handleSwipePrev:function(e){e.gesture.preventDefault(),this.prev(),e.gesture.stopDetect()}});return n}),define("collection/views/rank",["jquery/nyt","underscore/nyt","foundation/views/page-manager","foundation/views/base-view","shared/page/helpers/nyt-collection-view-mixin","shared/swiper/views/swiper"],function(e,t,i,n,s,a){"use strict";var o=n.extend(t.extend({},s,{el:".rank",defaultCollectionIdentifier:null,defaultCollectionType:null,swipers:[],swiperViewportIntegerThreshold:1010,swipersInitialized:!1,swipersEnabled:!1,nytEvents:{"nyt:page-resize":"handleSwiperReady"},initialize:function(e,t){this.defaultCollectionIdentifier=e,this.defaultCollectionType=t},handleDomReady:function(){this.handleSwiperReady(),this.addRrefToHighlights(),this.addRrefToEmbeddedCollections()},handleSwiperReady:function(){var t,n,s=this.$el.find(".embedded-collection-package:not(.template-2up)");if(this.currViewportInteger=i.getCurrentBreakpoint(),this.currViewportInteger<this.swiperViewportIntegerThreshold)if(this.swipersInitialized){if(!this.swipersEnabled){for(t=0;t<this.swipers.length;t++)this.swipers[t].$el.addClass("swiper");this.swipersEnabled=!0}}else{for(t=0;t<s.length;t++)n=new a({el:e(s[t])}),this.swipers.push(n),this.swipers[t].$el.addClass("swiper");this.swipersInitialized=!0,this.swipersEnabled=!0}else if(this.swipersEnabled){for(t=0;t<s.length;t++)e(s[t]).removeClass("swiper");this.swipersEnabled=!1}},addRrefToHighlights:function(){var e=this.$el.find(".highlights");this.assignRref(this.defaultCollectionIdentifier,this.defaultCollectionType,e)},addRrefToEmbeddedCollections:function(){var e,t=this.$el.find(".embedded-collection-package");for(e=0;e<t.length;e++)this.addRrefToContainer(t[e])},addRrefToContainer:function(t){var i,n,s=e(t);s.data("collectionType")&&s.data("collectionIdentifier")?(n=s.data("collectionType"),i=s.data("collectionIdentifier")):(n=this.defaultCollectionType,i=this.defaultCollectionIdentifier),this.assignRref(i,n,s)}}));return o}),define("collection/instances/rank",["jquery/nyt","foundation/views/page-manager","collection/views/rank"],function(e,t,i){"use strict";var n=t.getMeta("nyt-collection:identifier"),s=t.getMeta("nyt-collection:type"),a=e(".rank").length>0;a&&new i(n,s)}),define("collection/views/search",["jquery/nyt","underscore/nyt","collection/collections/paginated","collection/views/continuous-scroll-view"],function(e,t,i,n){"use strict";var s=n.extend({el:"#stream-search",pageMarkerId:"search-page-marker",sortType:"oldest",nytEvents:{"nyt:tabs-tab-click":"handleTabClick","nyt:collections-sortmodal-change":"handleSortChange","nyt:tabs-search-keyup":"handleSearchKeyUp","nyt:collections-search-changed":"handleQueryChanged","nyt:tabs-search-clear":"handleSearchCleared"},childEvents:{"change .stream-controls-filters .select-filter":"handleSearchFilters","change .stream-controls-filters #critics-pick-filter":"handleSearchFilters"},initialize:function(){n.prototype.initialize.apply(this,arguments),this.$el.find("#stream-controls-form").trigger("reset")},render:function(){return this.appendPageOfResultsToList(),this.updateSearchUI(),this.assignRref(this.collectionName,this.collectionType),this.$el.find(".story-menu-options").removeClass("hidden"),this},handleDomReady:function(){var t,i=this.pageManager.getUrlParam("q");i&&(i=decodeURIComponent(i),t=this.$el.parents("#main-tabs").find("#search-tab-input"),t.val(i).click().focus().trigger("keyup"),e("html, body").animate({scrollTop:t.offset().top-100},500))},handleSearchCleared:function(e){this.handleQueryChanged(),this.handleSearchKeyUp(""),("restaurant-guide"===this.collectionName||"movie-guide"===this.collectionName)&&(e||(e=window.event),e&&this.handleSearchFilters(e))},handleQueryChanged:function(){this.$el.find(".story-menu").empty(),this.$el.find(".story-menu-options").addClass("hidden"),this.allPagesLoaded=!1,this.isScrollingContinuously&&this.subscribe("nyt:page-scroll",this.watchForLastPage)},handleCriticsPicksUrl:function(){var t,i,n;-1===window.location.pathname.indexOf("/critics-picks")||e("#critics-pick-filter").is(":checked")||(n=window.location.pathname.split("/critics-picks")[0],window.Modernizr.history?(i=document.title.split(" - "),i.shift(),t=i.join(" - "),history.replaceState({},t,n),document.title=t,"function"==typeof window.ga&&window.ga("send","pageview",n)):window.location.href=n)},handleSearchFilters:function(t){var i,n=null,s=e("#stream-search-input");t||(t=window.event),this.handleCriticsPicksUrl(),i=e(t.target),"checkbox"===i.attr("type")?this.collection.filterValue=i.is(":checked")?"on":"off":this.collection.filterValue=t.target.value?t.target.value:"",this.collection.filterType=t.target.dataset?t.target.dataset.search:"",this.trackingTrigger("filter-applied",{module:"searchFilter",action:this.collection.filterType+"Applied",version:this.collectionName.replace("-guide","Review"),mData:{filterValue:this.collection.filterValue}}),void 0!==s.val()&&""!==s.val()&&(n=s.val()),this.handleQueryChanged(),this.commenceSearch(n),this.updateSearchUI()},removeStreamAds:function(){e(".stream-ad").remove()},buildSearchTermForUI:function(){var i=[],n=["#rating-filter","#neighborhood-filter","#price-filter","#cuisine-filter","#mpaa-rating-filter","#genre-filter"];return t.each(n,function(t){var n,s,a=e(t);if(void 0!==a.val()&&""!==a.val()){if("#rating-filter"==t)return n=a.find("option:selected").text(),s=(n.match(//g)||[]).length,n=n.replace(//g,'<span class="icon sprite-icon search-star-icon"></span>'),1===s?n='<span class="visually-hidden">1 star</span>'+n:s>1&&(n='<span class="visually-hidden">'+s+" stars</span>"+n),void i.push(n);i.push(a.find("option:selected").text())}}),e("#critics-pick-filter").is(":checked")&&i.push("NYT Critics Pick"),i.join(", ")},updateSearchUI:function(){var t,i,n=this.collection.getTotalCount(),s=this.buildSearchTermForUI();this.$el.find(".stream-search-header").removeClass("hidden"),this.$el.find(".search-term").html(s),this.$el.find("#results-for-word").toggleClass("hidden",""===s),i="es"===this.pageManager.getMeta("collection:language")?"esultado":"esult",t=n===1/0?"R"+i+"s":1===n?"1 r"+i:n+" r"+i+"s",this.$el.find(".result-count").text(t),this.isScrollingContinuously||(this.collection.getTotalPages()>1?this.showLoadMoreButton():this.hideLoadMoreButton()),0===this.collection.getTotalCount()?e(".stream-sort").addClass("hidden"):e(".stream-sort").removeClass("hidden")},loadData:function(e){this.removeStreamAds(),this.collection.loadData(e,this.sortType)},commenceSearch:t.debounce(function(e){var t="es"===this.pageManager.getMeta("collection:language");""===this.collection.getQuery()&&""!==e?this.collection.useDU?(this.setSortType("newest",!0),this.setSortName(t?"ms reciente":"newest")):(this.broadcast("collections-sortmodal-relevance",!0),this.setSortType("relevance",!0),this.setSortName(t?"relevancia":"relevance")):""===e&&(this.broadcast("collections-sortmodal-relevance",!1),this.setSortType("newest",!0),this.setSortName(t?"ms reciente":"newest")),this.collection.useDU&&(this.collection.page=0),this.loadData(e)},600),setSortType:function(e,t){this.sortType=e,t||this.loadData(this.collection.getQuery())},setSortName:function(t){var i=e("#stream-sort-modal");this.pageManager.flag("fixSearchSort")?(this.$el.find(".stream-sort-button .button-text, .stream-sort-button .button-text").text(t),i.find("button").removeClass("active"),i.find('[data-type="'+t+'"]').addClass("active")):this.$el.find(".stream-sort-button .button-text").text(t)},handleTabClick:function(e){var t=!1;return"search"!==e?!1:(this.collection.useDU&&this.collection.models.length>0&&this.collection.models[0].get("collectionName")===this.collectionName&&(t=!0),void((0===this.collection.length||t)&&(this.broadcast("nyt:tabs-empty-search-tab-activated"),this.setSortType("newest","newest"),this.loadData(""))))},handleSearchKeyUp:function(e){e!==this.collection.getQuery()&&this.commenceSearch(e)},handleSortChange:function(e,t){this.setSortType(e),this.setSortName(t)}});return s}),define("collection/instances/search",["jquery/nyt","foundation/views/page-manager","collection/views/search"],function(e,t,i){"use strict";var n=t.getMeta("nyt-collection:identifier"),s=t.getMeta("nyt-collection:type"),a=t.getMeta("nyt-collection:url"),o=t.getMeta("nyt-collection:uri"),r=e("#stream-search").length>0;n&&""!==n&&r&&new i({collectionName:n,collectionType:s,collectionURL:a,collectionURI:o,dedupeItems:!1})}),define("collection/views/stream-sort-modal",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","collection/templates"],function(e,t,i,n,s){"use strict";var a=(e("#stream-search .stream-sort-button").length>0,"#stream-search .stream-sort-button"),o=i.extend({$relevanceSortbutton:null,$newestSortbutton:null,events:{"click button":"handleClick"},nytEvents:{"collections-sortmodal-relevance":"handleRelevance"},defaultSettings:{id:"stream-sort-modal",addlClasses:"stream-sort-modal",binding:a,tailDirection:"up",tailTopOffset:-5,tailLeftOffset:5,width:"150px",toggleSpeed:1,
hasCloseButton:!1},initialize:function(e){var i,n=e.sorts||{newest:"newest",oldest:"oldest",relevance:"relevance"},a="es"===this.pageManager.getMeta("collection:language"),o={newest:"ms reciente",oldest:"ms antiguo",name:"nombre",cuisine:"comida",priceHigh:"precio altos",priceLow:"precios bajos",rating:"valuacon",relevance:"relevancia"};if(a)for(i in n)n.hasOwnProperty(i)&&(n[i]=o[i]);this.modalSettings=t.extend({},this.defaultSettings,e),this.modalSettings.modalContent=s.sortList({sorts:n})},handleDomReady:function(){this.render()},handleClick:function(t){var i=e(t.target);this.$el.find("button").removeClass("active"),i.addClass("active"),this.broadcast("nyt:collections-sortmodal-change",i.data("type"),i.text()),this.sortModal.close()},handleRelevance:function(e){this.pageManager.flag("fixSearchSort")?(this.$el.find("button").removeClass("active"),e?this.$relevanceSortbutton.addClass("active").closest("li").removeClass("hidden"):(this.$newestSortbutton.addClass("active"),this.$relevanceSortbutton.closest("li").addClass("hidden"))):(this.$el.find("button").removeClass("active").eq(2).toggleClass("active",e).end().eq(1).toggleClass("active",!e),this.$el.find("li").eq(0).toggleClass("hidden",!e))},render:function(){this.sortModal=new n(this.modalSettings).addToPage(),this.setElement(this.sortModal.$modal),this.pageManager.flag("fixSearchSort")&&(this.$relevanceSortbutton=this.$el.find('button[data-type="relevance"]'),this.$newestSortbutton=this.$el.find('button[data-type="newest"]'),this.$newestSortbutton.addClass("active"),this.$relevanceSortbutton.closest("li").addClass("hidden"))}});return o}),define("collection/instances/stream-sort-modal",["foundation/views/page-manager","collection/views/stream-sort-modal"],function(e,t){"use strict";var i=e.getMeta("nyt-collection:url"),n={};return/\.du\./.test(i)&&(n.sorts={newest:"newest",oldest:"oldest"}),new t(n)}),define("collection/views/site-index",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/page/helpers/nyt-collection-view-mixin"],function(e,t,i){"use strict";var n=i.extend({el:"#site-index",handleDomReady:function(){this.$el.addClass("site-index-theme-collection")}});return n}),define("collection/instances/site-index",["collection/views/site-index"],function(e){"use strict";new e}),define("collection/views/collection",["jquery/nyt","underscore/nyt","foundation/views/base-view","collection/templates","shared/modal/views/modal","foundation/hosts","foundation/cookies"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend({el:"#main",defaultModalSettings:{id:"edition-pdf-modal",modalTitle:"",binding:".edition-pdf-modal",disableBindings:!0,tailDirection:"",hasOverlay:!0,hasCloseButton:!0,modalContent:"",autoPosition:!1,closeOnClick:!1,closeOnEsc:!1},events:{"click .collection-subheading .user-action":"handleExpandBioClick","click .stream-controls-toggle":"handleStreamControlsToggleClick","click .select-menu-control":"handleMoreClick","click .subnavigation li":"handleNavClick","mouseover .category-select-menu li a":"handleNavHoverLeave","mouseleave .category-select-menu li a":"handleNavHoverLeave","mouseover #subnavigation-select-menu li a":"handleNavHoverLeave","mouseleave #subnavigation-select-menu li a":"handleNavHoverLeave","click .front-page-module li a":"handlePageModuleClick","click .button.show-more":"handleShowMore","click .edition-content":"handleImageClick","change .date-button":"handleDateChange","change .subnavigation-select-menu":"handleSelectChange"},nytEvents:{"nyt:messaging-critical-alerts-move-furniture":"handleMoveFurniture","nyt:messaging-suggestions-move-furniture":"handleMoveFurniture","nyt:page-breakpoint":"handleBreakpointChange","nyt:page-orientation":"handleOrientationChange"},initialize:function(e){var i=this,n=new Date,s=window.location.pathname.split("/");this.isMobileDevice=!1,s.length>3?this.formattedDate=[s[3],s[4],s[5]].join("/"):this.formattedDate=n.getFullYear()+"/"+(n.getMonth()+1<10?"0":"")+(n.getMonth()+1)+"/"+(n.getDate()<10?"0":"")+n.getDate(),this.daysOfTheWeek=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.abbreviatedMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],this.modalSettings=t.extend({},this.defaultModalSettings,e),this.modalSettings.openCallback=function(){i.modalOpened=!0},this.modalSettings.closeCallback=function(){this.removeFromPage(),i.modalOpened=!1}},handleDomReady:function(){var t=this,i=this.pageManager.flag("gdpr")&&"1"===o.readCookie("nyt-gdpr")&&"out"===o.readCookie("NYT-T");this.updateTimestamps(),this.handleSelectControlToggle(),(e("html").hasClass("section-todayspaper")||e("html").hasClass("section-todaysinyt")||e("html").hasClass("section-todaysheadlines"))&&(e("html").addClass("issue-collection"),this.setEdition(),e(".collection-headings").append(n.todaysHeader({todaysDate:t.calculateDate()})),this.populatedropdown()),!e("html").hasClass("mobile")||navigator.userAgent.match(/iPad/i)||e("html").hasClass("issue-collection")||(this.isMobileDevice=!0,e("html").addClass("mobile-nav")),this.displayResponsiveSubNav(),this.$body.on("click",this.handleClickClose),setTimeout(this.handleCollectionMeta,3e3),this.pageManager.isMobile()&&this.handleShowMoreSections(),i&&e("html").addClass("no-ads")},timestampCounter:0,handleMoveFurniture:function(t){t(e("body").find("#page"))},handleExpandBioClick:function(t){var i=e(t.target).hasClass("icon")?e(t.target).parent():e(t.target);i.hide(),e(".collection-description").fadeIn()},handleStreamControlsToggleClick:function(){var t=e(".stream-controls-toggle .toggle-state");e(".stream-controls-form, p.toggle i, .stream-controls-toggle").toggleClass(function(e,i){return i.indexOf("active")>-1?t.text("Show"):t.text("Hide"),"active"})},handleBreakpointChange:function(){this.handleSelectControlToggle(),this.displayResponsiveSubNav()},handleOrientationChange:function(){this.broadcast("nyt:ad-library:dfp:refresh",["TopAd"])},handleSelectControlToggle:function(){var e,t=this.$el.find(".stream-controls-form"),i=this.$el.find(".stream-controls-toggle");this.pageManager.getCurrentBreakpoint()>=1e3?(e="removeAttr",t[e]("aria-expanded","true")[e]("aria-expanded","false"),i[e]("role","button")[e]("tabindex","0")[e]("aria-pressed","true")[e]("aria-pressed","false")):(e="attr",t[e]("aria-expanded","true")[e]("aria-expanded","false"),i[e]("role","button")[e]("tabindex","0")[e]("aria-pressed","true")[e]("aria-pressed","false"))},updateTimestamps:function(){var t=this,i=e(".rank-template time"),n=6e4;t.timestampCounter+=1,t.timestampCounter<=20&&(n=1e3),this.renderTimestamps(i,!0),setTimeout(function(){t.updateTimestamps()},n)},renderTimestamps:function(t,i){var n,s=this;t.each(function(){var t=e(this).data("utc-timestamp"),a=Math.ceil(Math.log(t+1)/Math.LN10),o=13;t=o>a?t*Math.pow(10,o-a):t,n=s.prettyDate(t,i),"Just now"===n||"1 m ago"===n||"1 minute ago"===n?e(".highlights time").addClass("now"):e(".highlights time").removeClass("now"),n&&e(this).text(n)})},handleMoreClick:function(t){var i=e(t.target);(!this.isMobileDevice||e("html").hasClass("section-opinion"))&&(e("ul.category-select-menu").is(":visible")&&e("ul.category-select-menu").addClass("hidden"),i.hasClass("more-header")?i.parent().find(".subnavigation-select-menu").toggleClass("hidden"):i.find(".subnavigation-select-menu").toggleClass("hidden"))},displayResponsiveSubNav:function(){var i,s,a,o,r,l=this,d=[],c=10,h=0,u=this.$el.find(".subnavigation");if(0!==u.length&&(u.css("display","block"),u.find(".select-menu-control").remove(),s=u.width(),i=this.isMobileDevice?u.find("ol li"):u.find("ol > li"),i.css("display",""),t.each(i,function(t){a=[],a.itemWidth=e(t).outerWidth(!0),a.itemName=e.trim(e(t).find("a").text()),a.itemHref=e(t).find("a").attr("href").replace(/'/g,""),l.isMobileDevice?e(t).has("select").length>0?(a.hasSubList=!0,r=e(t).find(".category-select-menu option"),a.itemLabels=e.map(r,function(e){return e.value}),a.itemSubList=e.map(r,function(e){return e.label})):a.hasSubList=!1:e(t).find("ul").length>0?(a.itemName=e.trim(e(t).find(".head-line").text()),a.hasSubList=!0,r=e(t).find(".category-select-menu li"),a.itemLabels=e.map(r,function(t){return e(t).find("a").attr("href")}),a.itemSubList=e.map(r,function(t){return e(t).find("a").text()})):a.hasSubList=!1,d.push(a),c+=a.itemWidth,s-79>c&&h++}),h<d.length)){for(o=d.slice(h,d.length),h;h<d.length;h++)i.eq(h).css("display","none");u.append(n.showMoreInSubNav({selectNavItems:o,isMobileDevice:this.isMobileDevice}))}},handleNavClick:function(t){var i,n=e(t.target),s=n.hasClass("head-line"),a=n.parent().find(".category-select-menu"),o=n.find(".category-select-menu");i=s?a:o,this.isMobileDevice||e(".subnavigation-select-menu").is(":visible")&&e(".subnavigation-select-menu").addClass("hidden"),e("ul.category-select-menu").is(":visible")&&e("ul.category-select-menu").not(i).addClass("hidden"),s?a.toggleClass("hidden"):o.toggleClass("hidden")},handleNavHoverLeave:function(t){var i,n=e(t.target),s=n.parent();s.hasClass("nav-item")?(i=s.parent().parent().prev(),e("ul.category-select-menu").is(":visible")&&("mouseover"===t.type?i.addClass("add-label-decor"):"mouseleave"===t.type&&i.removeClass("add-label-decor"))):(i=s.parent().prev(),e(".subnavigation-select-menu").is(":visible")&&("mouseover"===t.type?i.addClass("add-label-decor"):"mouseleave"===t.type&&i.removeClass("add-label-decor")))},handleClickClose:function(t){var i=e(".subnavigation");0===i.has(t.target).length&&i[0]&&i[0]!==t.target&&(e(".category-select-menu").is(":visible")&&e(".category-select-menu").addClass("hidden"),e("html").hasClass("mobile-nav")||e(".subnavigation-select-menu").is(":visible")&&e(".subnavigation-select-menu").addClass("hidden"))},handleCollectionMeta:function(){var t=e("html").hasClass("has-supported-by-ad"),i=e(".collection-meta-header");t||(0===i.find(".kicker").length?i.addClass("hidden"):"hidden"==i.find(".kicker").css("visibility")&&i.addClass("hidden"))},handlePageModuleClick:function(t){var i,n,s=e(t.target),a=this.$el.find(".edition-list li a"),o=s.attr("class"),r=e(".edition-content .edition-image"),l=this.formattedDate;"international-edition"===o&&(l=this.setInternationalEditionDate()),i="https://static01.nyt.com/images/"+l+"/nytfrontpage/","newyork-edition"===o?n=i+"scan.jpg":"national-edition"===o?n=i+"scannat.jpg":"international-edition"===o&&(n=i+"INYT_frontpage_global."+l.replace(/\//g,"")+".jpg"),a.removeClass("active"),s.addClass("active"),r.attr("src",n)},handleShowMoreSections:function(){var i,n=this.$el.find(".story-template"),s=n.find(".article-stories");t.each(s,function(t){i=e(t).find("li"),i.size()>=5&&e(t).addClass("has-more")})},handleShowMore:function(t){var i=e(t.target).closest("ol"),n=e(t.target).parent();i.removeClass("has-more"),n.addClass("hidden")},setEdition:function(){var t=e(".edition-content .edition-image"),i=e("li .newyork-edition");t.attr("src","https://static01.nyt.com/images/"+this.formattedDate+"/nytfrontpage/scan.jpg"),i.addClass("active")},handleImageClick:function(){var i,a=this,o=this.calculateDate(),r=e(".front-page-module li a.active"),l=this.formattedDate;this.pdfLink="",r.hasClass("international-edition")&&(l=this.setInternationalEditionDate()),i=r.hasClass("newyork-edition")?"scan":r.hasClass("national-edition")?"scannat":"INYT_frontpage_global."+l.replace(/\//g,""),this.pdfLink="https://static01.nyt.com/images/"+l+"/nytfrontpage/"+i+".pdf",this.modalSettings.modalContent=n.editionTemplate({todaysDate:o,iframeSrc:a.pdfLink}),this.isMobile()&&(this.modalSettings=t.extend({},this.modalSettings,{tailDirection:"centered",width:"300px",positionTailSide:!1,autoPosition:!1})),this.editionModal=new s(this.modalSettings),this.editionModal.addToPage(),this.editionModal.open()},calculateDate:function(){var e=new Date(this.formattedDate),t=this.formattedDate.split("/"),i=t[1],n=this.daysOfTheWeek[e.getDay()]+", "+this.abbreviatedMonths[i-1]+" "+t[2]+", "+t[0];return n},isMobile:function(){return!e("html").hasClass("viewport-medium-10")},handleDateChange:function(t){var i,n,s,o=e(t.target),r=o.val(),l=r.replace(/-/g,"/");e("html").hasClass("section-todaysinyt")?(n="/todays-new-york-times-international-edition",s="todaysinyt/"):e("html").hasClass("section-todaysheadlines")?(n="/todays-headlines",s="todaysheadlines/"):(n="/todays-new-york-times",s="todayspaper/"),i=a.du+"/issue/"+s+l+n,window.location.href=i},populatedropdown:function(){var t,i,n=new Date(this.formattedDate),s=n.getDate(),a="";for(i=0;7>i;i++)t=new Date(n.getTime()),t.setDate(s-i),a+="<option value="+this.getOptionValue(t.toString())+">"+this.formatDate(t.toString())+"</option>";e("#date-menu").append(a)},formatDate:function(e){var t=new Date(e),i=""+(t.getMonth()+1),n=""+t.getDate();return i.length<2&&(i="0"+i),n.length<2&&(n="0"+n),this.daysOfTheWeek[t.getDay()]+", "+this.abbreviatedMonths[i-1]+" "+n+", "+t.getFullYear()},getOptionValue:function(e){var t=new Date(e),i=""+(t.getMonth()+1),n=""+t.getDate();return i.length<2&&(i="0"+i),n.length<2&&(n="0"+n),[t.getFullYear(),i,n].join("/")},handleSelectChange:function(t){var i,n=e(t.target);if(t.target.value){if(-1!==t.target.value.indexOf(""))return void n.prop("selectedIndex",0);i=t.target.value}n.prop("selectedIndex",0),i&&(window.location.href=i)},setInternationalEditionDate:function(){var e,t=this.formattedDate,i=new Date(this.formattedDate),n=i.getDate(),s="Sunday"===this.daysOfTheWeek[i.getDay()]?!0:!1;return s&&(e=new Date(i.getTime()),e.setDate(n-1),t=this.getOptionValue(e.toString())),t}});return r}),define("collection/instances/collection",["collection/views/collection"],function(e){"use strict";new e}),define("collection/views/tracking/tracking",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({el:"#shell",events:{"click .highlights a":"handleRankHighlightsClick","click .theme-stream a":"handleStreamClick","click .supplemental aside a":"handleSupplementalClick","click .subnavigation a":"handleSubnavClick","click .tab":"handleMultimediaClick","click .live-blog-module a":"handleNewsEventLiveBlogClick","click .movie-guide-collection .find-tickets":"handleFindMovieTicketsClick"},initialize:function(){this.trackingBaseData={action:"click",contentCollection:this.pageManager.getMeta("collection:section")}},handleRankHighlightsClick:function(t){var i,n=e(t.currentTarget),s=n.closest("li").index()+1;n.hasClass("container-heading")||("undefined"!=typeof n.attr("data-tracking-index")&&(s=n.attr("data-tracking-index")),i=this.trackingAppendParams(n.attr("href"),{region:"rank",module:"package",version:"highlights",contentPlacement:s}),n.attr("href",i))},handleStreamClick:function(t){var i,n=e(t.currentTarget),s=n.closest("li").index()+1,a="latest";n.closest("section")&&(a=n.closest("section").attr("id").replace("-panel","")),i=this.trackingAppendParams(n.attr("href"),{region:"stream",module:"stream_unit",version:a,contentPlacement:s}),n.attr("href",i)},handleSupplementalClick:function(t){var i=e(t.currentTarget),n=i.closest("aside").index()+1,s=i.closest("aside").data("name"),a=this.trackingAppendParams(i.attr("href"),{region:"supplemental",module:s,contentPlacement:n});i.attr("href",a)},handleSubnavClick:function(t){if(!e("html").hasClass("issue-collection")){var i=e(t.currentTarget),n=this.pageManager.getMeta("PT"),s=this.trackingAppendParams(i.attr("href"),{region:"navbar",module:"collectionsnav",pagetype:n});i.attr("href",s)}},handleMultimediaClick:function(t){var i,n=e(t.currentTarget),s=this,a=this.pageManager.getMeta("nyt-collection:type");"sectioncollection"===a&&"multimedia"===n.data("name")&&(i=this.$el.find(".tab-panel.multimedia-panel .story-menu.theme-stream.initial-set .icon.slideshow-icon"),i.each(function(){s.callTrackingTrigger(e.trim(e(this).closest(".story-link").find(".headline").first().text()))}))},handleDomReady:function(){this.handleSlideshowPromoImpression()},handleSlideshowPromoImpression:function(){var t,i=this,n=this.pageManager.getMeta("nyt-collection:type");"sectioncollection"===n&&(t=this.$el.find(".highlights .icon.slideshow-icon"),t.each(function(){i.callTrackingTrigger(e(this).closest(".story.theme-summary").find(".headline a").first().text())}))},callTrackingTrigger:function(e){this.trackingTriggerImpression("slideshow-promo-impression",{module:"Slide",action:"impression",slideshowTitle:e})},handleNewsEventLiveBlogClick:function(t){var i=e(t.currentTarget),n=i.closest("li").index()+2,s=this.trackingAppendParams(i.attr("href"),{region:"rank",module:"live-blog",pgtype:"collection",contentPlacement:n});i.attr("href",s)},handleFindMovieTicketsClick:function(t){var i=e(t.currentTarget),n=this.pageManager.getMeta("nyt-collection:type");this.trackingTrigger("outboundLinkClick",{module:"Movie_tickets",action:"click",region:"Body",contentCollection:i.attr("href"),ur:i.attr("href"),eventName:"outboundlinkClick",rref:"collection/reviews/movies",pgtype:n,show:i.attr("title")})}});return n}),define("collection/instances/tracking",["collection/views/tracking/tracking"],function(e){"use strict";new e}),define("collection/views/insider-nav",["foundation/views/base-view","foundation/models/user-data","foundation/hosts"],function(e,t,i){"use strict";var n=e.extend({el:".learn-more",handleUserReady:function(){this.$el.length&&t.isPremierSubscriber()&&this.$el.attr("href",i.myaccount+"/static/welcome-to-times-insider/index.htm")}});return n}),define("collection/instances/insider-nav",["collection/views/insider-nav"],function(e){"use strict";new e}),define("shared/sharetools/models/share-data",["foundation/models/base-model"],function(e){"use strict";var t=e.extend({dataAttributes:{URL:"data-url",TITLE:"data-title",MEDIA:"data-media",DESCRIPTION:"data-description",PUBLICATION_DATE:"data-publish-date",CONTENT_TYPE:"data-content-type",AUTHOR:"data-author",VIA:"data-via"},initialize:function(e){this.$container=e},getUrl:function(){var e=this.$container.attr(this.dataAttributes.URL);return e?e:this.pageManager.getCanonical()},setUrl:function(e){this.$container.attr(this.dataAttributes.URL,e)},getTitle:function(){var e=this.$container.attr(this.dataAttributes.TITLE);return e?e:this.pageManager.getMeta("og:title")},setTitle:function(e){this.$container.attr(this.dataAttributes.TITLE,e)},getAuthor:function(){var e=this.$container.attr(this.dataAttributes.AUTHOR);return e?e:this.pageManager.getMeta("byl")},setAuthor:function(e){this.$container.attr(this.dataAttributes.AUTHOR,e)},getMedia:function(){var e=this.$container.attr(this.dataAttributes.MEDIA);return e?e:this.pageManager.getMeta("og:image")},setMedia:function(e){this.$container.attr(this.dataAttributes.MEDIA,e)},getDescription:function(){var e=this.$container.attr(this.dataAttributes.DESCRIPTION);return e?e:this.pageManager.getMeta("description")},setDescription:function(e){this.$container.attr(this.dataAttributes.DESCRIPTION,e)},getPublicationDate:function(){var e=this.$container.attr(this.dataAttributes.PUBLICATION_DATE);return e?e:this.pageManager.getMeta("DISPLAYDATE")},setPublicationDate:function(e){this.$container.attr(this.dataAttributes.PUBLICATION_DATE,e)},getVia:function(){var e=this.$container.attr(this.dataAttributes.VIA),t=this.pageManager.getMeta("twitter:site");return e?e:"upshot"===this.pageManager.getMeta("CG")?"UpshotNYT":t&&"@nytimes"!==t?t.replace("@",""):""},setVia:function(e){this.$container.attr(this.dataAttributes.VIA,e)},getContentType:function(){var e=this.$container.attr(this.dataAttributes.CONTENT_TYPE);return e?e:"Content"},setContentType:function(e){this.$container.attr(this.dataAttributes.CONTENT_TYPE,e)}});return t}),define("shared/sharetools/templates",["underscore/nyt"],function(_){var templates={};return templates.emailModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<iframe src="'+(null==(__t=emailThisUrl)?"":__t)+(null==(__t=dataUrl)?"":__t)+'" title="Email This" id="emailthis" scrolling="'+(null==(__t=scrolling)?"":__t)+'" marginheight="0" marginwidth="0" frameborder="0"></iframe>';return __p},templates.savemodal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<ul class="instructions">\n<li>This item has been saved to read later from any device. </li>\n<li>Access saved items through your user name at the top of the page.</li>\n</ul>\n<p><a href="'+(null==(__t=link)?"":__t)+'">View Saved Items</a><p>\n<button class="button dismiss-button">OK</button>';return __p},templates.shareTool=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<a href="javascript:;" data-share="'+(null==(__t=id)?"":__t)+'" data-modal-title="'+(null==(__t=loginModalTitle)?"":__t)+'"><i class="icon sprite-icon"></i><span class="sharetool-text '+(null==(__t=isLabelHidden===!0?"visually-hidden":"")?"":__t)+'">'+(null==(__t=label)?"":__t)+"</span></a>";return __p},templates.shareTools=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="<ul>\n",_.each(shares,function(e){__p+='\n<li class="sharetool '+(null==(__t=e.type)?"":__t)+"-sharetool "+(null==(__t=config[e.type].loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config[e.type].loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=e.type)?"":__t)+'"><i class="icon sprite-icon"></i><span class="sharetool-text">'+(null==(__t=e.label)?"":__t)+"</span></a>\n</li>\n"}),__p+="\n</ul>";return __p},templates.shareToolsModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="section share ',isCompact&&(__p+="compact-share-tools"),__p+='">\n<ul class="sharetools-menu">\n'+(null==(__t=standardToolsList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly="readonly" />\n</div>\n</div>\n</form>\n',isCompact&&showTools&&(__p+='\n<form class="embed-url-form">\n<div class="control">\n<div class="label-container"><label for="embed-input">Embed</label></div>\n<div class="field-container">\n<input id="embed-input" class="embed-input text" type="text" name="embed-input" readonly="readonly" />\n</div>\n</div>\n</form>\n'),__p+="\n</div><!--close section -->\n",!isCompact&&showTools&&(__p+='\n<div class="section tools">\n<h4 class="modal-heading">Tools</h4>\n<ul class="sharetools-menu">\n'+(null==(__t=articleToolsList)?"":__t)+"\n</ul>\n</div><!--close section -->\n"),__p+="";return __p},templates.shareToolsModalFooter=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="ad show-all-sharetool-modal-ad hidden">\n<small class="ad-sponsor">'+(null==(__t=toolTypeSponsor)?"":__t)+" Tools Sponsored By</small>\n</div>";return __p},templates.showAllSharetoolCompactModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllLinkList)?"":__t)+'\n</ul>\n</div> <!--close section -->\n<div class="section tools">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllToolList)?"":__t)+'\n</ul>\n<div class="control permalink-control">\n<div class="label-container">\n<label for="permalink-input" class="sharetools-label">Permalink</label>\n</div>\n<div class="field-container">\n<input id="permalink-input" type="text" class="text short-url-input" placeholder="" readonly="readonly" />\n<span class="textbox-fade"></span>\n</div>\n</div><!-- close control -->\n<div class="control embed-control">\n<div class="label-container">\n<label for="embed-input" class="sharetools-label">Embed</label>\n</div>\n<div class="field-container">\n<input id="embed-input" type="text" class="text embed-input" placeholder="" readonly="readonly" />\n<span class="textbox-fade"></span>\n</div>\n</div><!-- close control -->\n</div><!--close section -->';return __p},templates.showAllSharetoolModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="section share">\n<ul class="sharetools-menu">\n'+(null==(__t=showAllLinkList)?"":__t)+'\n</ul>\n<form class="short-url-form">\n<div class="control">\n<div class="label-container"><label for="short-url-input">Permalink</label></div>\n<div class="field-container">\n<input id="short-url-input" class="short-url-input text" type="text" name="short-url-input" value="'+(null==(__t=shortUrl)?"":__t)+'" readonly="readonly" />\n</div>\n</div>\n</form>\n</div> <!--close section -->\n<div class="section tools">\n<h5 class="modal-heading">Tools</h5>\n<ul class="sharetools-menu">\n'+(null==(__t=showAllToolList)?"":__t)+"\n</ul>\n</div><!--close section -->";return __p},templates.showallLinks=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li class="sharetool '+(null==(__t=shareObj.type)?"":__t)+"-sharetool "+(null==(__t=config.loginRequired?"login-modal-trigger":"")?"":__t)+'" data-modal-title="'+(null==(__t=config.loginModalText||"")?"":__t)+'">\n<a href="javascript:;" data-share="'+(null==(__t=shareObj.type)?"":__t)+'"><i class="icon sprite-icon"></i>'+(null==(__t=shareObj.label)?"":__t)+"</a>\n</li>";return __p},templates}),define("shared/sharetools/views/email",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/views/base-view","shared/modal/views/modal","shared/sharetools/templates"],function(e,t,i,n,s,a){"use strict";var o=n.extend({template:a.emailModal,className:"email-view-container",frameSize:{small:507,full:867,ad:285},defaultSettings:{emailThisUrl:"https:"+i.www+"/mem/email-this.html?url=",scrolling:window.Modernizr.postmessage?"no":"yes"},defaultModalSettings:{id:"email-share-modal",modalTitle:"Email This Article",binding:".email-sharetool",tailDirection:"centered",hasOverlay:!0,hasCloseButton:!0,modalContent:""},initialize:function(e){var i=this;t.bindAll(this,"handlePostMessage","responsive"),this.settings=t.extend({},this.defaultSettings,e),this.frameState="full",this.modalSettings=t.extend({},this.defaultModalSettings,{openCallback:function(){window.Modernizr.postmessage&&(window.addEventListener?window.addEventListener("message",i.handlePostMessage,!1):window.attachEvent("onmessage",i.handlePostMessage)),i.listenTo(i.pageManager,"nyt:page-breakpoint",i.responsive)},closeCallback:function(){this.removeFromPage(),window.addEventListener?window.removeEventListener("message",i.handlePostMessage,!1):window.detachEvent("onmessage",i.handlePostMessage),i.stopListening(i.pageManager,"nyt:page-breakpoint",i.responsive)}}),this.prepareUrls(),this.render()},render:function(){this.modalSettings.modalContent=this.template(this.settings),this.emailModal=new s(this.modalSettings),this.emailModal.addToPage(),t.defer(this.responsive,this.pageManager.getCurrentBreakpoint())},responsive:function(e){var t=this.emailModal.$modal.find("iframe");1010>=e&&"full"===this.frameState&&(t.css("height",t.height()+this.frameSize.ad+"px").width(this.frameSize.small),this.frameSize.state="small",this.emailModal.positionDialog()),e>1010&&"small"===this.frameState&&(t.css("height",t.height()-this.frameSize.ad+"px").width(this.frameSize.full),this.frameState="full",this.emailModal.positionDialog())},handlePostMessage:function(e){var t;/\.nytimes\.com$/.test(e.origin)&&(t=e.data.match(/(.+)\:(.+)/),t&&"frameheight"===t[1]?this.$el.css("height",t[2]):t&&"closewindow"===t[1]?this.emailModal.close():t&&"loginredirect"===t[1]&&(window.location=i.myaccount+"/auth/login?URI="+encodeURIComponent(window.location.href)))},prepareUrls:function(){"string"==typeof this.settings.dataUrl&&-1===this.settings.dataUrl.indexOf("http")&&(this.settings.dataUrl="http:"+i.www+this.settings.dataUrl)}});return o}),define("shared/sharetools/helpers/share-tools-config",["underscore/nyt","foundation/views/page-manager"],function(e,t){"use strict";var i={width:600,height:450,adPosition:"Frame4A",overlayAdPosition:"Frame6A",isModalMember:!0,isArticleTool:!1,isInDefaultSet:!1,isPopup:!0,usesShortUrl:!1,shareDataParameters:{},shareServiceParameters:{}},n=function(t){var n=e.extend({},i,t);return Object.freeze?Object.freeze(n):n},s={EMAIL:n({label:"Email",isInDefaultSet:!0,requiresLogin:!0,loginModalTitle:"Log in to email",modalDisplayOrder:1,mobileModalDisplayOrder:1}),FACEBOOK:n({label:"Share",isInDefaultSet:!0,url:"http://www.facebook.com/sharer.php",smid:"fb-share",modalDisplayOrder:3,mobileModalDisplayOrder:2,shareDataParameters:{url:"u"}}),GOOGLE:n({label:"Google+",url:"https://plus.google.com/share",smid:"go-share",height:600,modalDisplayOrder:4,mobileModalDisplayOrder:6,shareDataParameters:{url:"url"},shareServiceParameters:{hl:"en-US"}}),REDDIT:n({label:"Reddit",url:"http://www.reddit.com/submit",smid:"re-share",width:854,height:550,modalDisplayOrder:6,mobileModalDisplayOrder:7,shareDataParameters:{url:"url",title:"title"}}),PINTEREST:n({label:"Pin",url:"https://www.pinterest.com/pin/create/button/",smid:"pin-share",width:750,height:330,modalDisplayOrder:7,mobileModalDisplayOrder:4,shareDataParameters:{url:"url",media:"media",description:"description"}}),TWITTER:n({label:"Tweet",isInDefaultSet:!0,url:"https://twitter.com/share",smid:"tw-share",usesShortUrl:!0,modalDisplayOrder:5,mobileModalDisplayOrder:3,shareDataParameters:{url:"url",title:"text"}}),LINKEDIN:n({label:"Linkedin",url:"http://www.linkedin.com/shareArticle",smid:"li-share",width:750,modalDisplayOrder:2,mobileModalDisplayOrder:5,shareDataParameters:{url:"url",title:"title",description:"summary"},shareServiceParameters:{mini:"true",source:"The New York Times"}}),SAVE:n({label:"Save",isInDefaultSet:!0,isArticleTool:!0,loginModalTitle:"Log in to save",modalDisplayOrder:1}),PRINT:n({label:"Print",isModalMember:"interactive"!==t.getApplicationName(),isArticleTool:"interactive"!==t.getApplicationName(),modalDisplayOrder:3,shareServiceParameters:{pagewanted:"print"}}),REPRINTS:n({label:"Reprints",width:930,height:850,isArticleTool:!0,isModalMember:!0,url:"http://www.nytreprints.com",modalDisplayOrder:2}),EMBED:n({label:"Embed",isArticleTool:!1,isInDefaultSet:!1,isModalMember:!1}),"SHOW-ALL":n({label:"More",isInDefaultSet:!0,isModalMember:!1,isModalTrigger:!0}),AD:n({label:"Advertisement",isInDefaultSet:!0,isModalMember:!1})};return Object.freeze?Object.freeze(s):s}),define("shared/sharetools/models/saved-article",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/models/base-model"],function(e,t,i,n){"use strict";var s=n.extend({getSummary:function(){return this.get("Data")?this.get("Data").Summary:""},getByline:function(){return this.get("Data")?this.get("Data").Byline:""},getTitle:function(){return this.get("Data")?this.get("Data").Headline:this.get("URL")},getUrl:function(){return this.get("URL")},getDate:function(){return this.get("CreatedDate")},getFormattedDate:function(){var e=new Date(this.getDate());return this.dateHelper.getMonthShortName(e.getMonth())+" "+e.getDate()+", "+e.getFullYear()},getThumbUrl:function(){return this.get("Data")?this.get("Data").ImageCrops.MediumThreeByTwo210:""},getCaption:function(){var e="";return this.get("Data")&&(e=this.get("Data").ImageCaption),e},getCaptionStripTags:function(){return this.getCaption().replace(/<\/?[^>]+>/gi,"")},hasThumb:function(){return!!this.getThumbUrl()}});return s}),define("shared/sharetools/collections/cross-platform-save",["jquery/nyt","underscore/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts","shared/sharetools/models/saved-article"],function(e,t,i,n,s,a){"use strict";var o=n.extend({model:a,offset:0,limit:20,apiCommand:{save:"POST",list:"GET",remove:"DELETE"},url:s.readingListApiHost+"/reading-list/v2",currentArticleSaved:!1,initialize:function(){var e=this,i={};this._getArticlesStatus=function(n){var s,a;return t.has(i,n)?i[n]:(s={data:{url:n},url:e.url+"/active"},a=this.sync(this.apiCommand.list,s),i[n]=a,i[n])}},save:function(e){var t=this,i={data:JSON.stringify({URL:e})};this.sync(this.apiCommand.save,i).done(function(i){
t.articleIsSaved(!0,e),t.add(i),t.trigger("nyt:xps-saved",e,i)}).fail(function(){t.trigger("nyt:xps-failed",e)})},removeSavedArticle:function(e){var t=this,i={data:JSON.stringify({URL:e})};this.sync(this.apiCommand.remove,i).done(function(i){t.articleIsSaved(!1,e),t.remove(i),t.trigger("nyt:xps-article-removed",e,i)}).fail(function(){t.trigger("nyt:xps-failed",e)})},getSavedArticles:function(){var e=this,t={data:{offset:this.offset,limit:this.limit},url:this.url+"/data"};e.reset(),this.sync(this.apiCommand.list,t).done(function(t){e.add(t.Assets),e.totalCount=t.OverallSummary.Count,e.trigger("nyt:xps-articles-loaded",t.Assets)}).fail(function(){e.trigger("nyt:xps-load-failed")})},getNextSavedArticles:function(){return this.offset+=this.limit,this.limit=10,this.totalCount>this.offset?(this.getSavedArticles(),this.totalCount<=this.offset+this.limit&&this.trigger("nyt:xps-finished"),!0):!1},getArticlesStatus:function(e){var t=this;t._getArticlesStatus(e).done(function(i){t.articleIsSaved(0===i[0],e)}).fail(function(){t.broadcast("nyt:xps-load-failed")})},articleIsSaved:function(e,t){this.currentArticleSaved=e,this.broadcast("nyt:xps-article-status",e,t)},sync:function(i,n){var s=new e.Deferred,a=setTimeout(function(){s.reject()},5e3),o={type:i,dataType:"json",contentType:"application/json",url:this.url,headers:{},xhrFields:{withCredentials:!0},success:function(e){clearTimeout(a),e?s.resolve(e):s.reject()}};return e.ajax(t.extend(o,n)),s.promise()}});return o}),define("shared/sharetools/instances/cross-platform-save",["shared/sharetools/collections/cross-platform-save"],function(e){"use strict";return new e}),define("shared/sharetools/collections/short-url",["jquery/nyt","backbone/nyt","foundation/collections/base-collection","foundation/hosts"],function(e,t,i,n){"use strict";var s=i.extend({url:n.contentApiHost+"/svc/bitly/shorten.jsonp",initialize:function(){this.currentUrlRequest="",this.addCurrentPage()},sync:function(e,i,n){return n.dataType="jsonp",n.jsonpCallback="shortUrlCallback",n.jsonp="callback",n.cache=!0,n.data={url:this.currentUrlRequest},t.sync(e,i,n)},parse:function(e){return{url:this.currentUrlRequest,shortUrl:e.payload?e.payload.short_url:""}},addCurrentPage:function(){var t,i=this.pageManager.getCanonical();t="1"===this.pageManager.getUrlParam("rico")&&"undefined"!=typeof this.pageManager.getUrlParam("share_url")?this.pageManager.getUrlParam("share_url"):e("#masthead").find(".story-short-url").text(),i&&t&&this.add({url:i,shortUrl:t})},getRicoUrl:function(e){var t=this.pageManager.getUrlParam("share_url"),i=document.createElement("a");return i.href=e,i.pathname===location.pathname&&t&&7===t.indexOf("r-i.co/")?t:void 0},requestUrl:function(e){var t,i=this.findWhere({url:e});return i?i.get("shortUrl"):(t=this.getRicoUrl(e))?t:(this.currentUrlRequest=e,void this.fetch())}});return s}),define("shared/sharetools/instances/short-url",["shared/sharetools/collections/short-url"],function(e){"use strict";return new e}),define("shared/sharetools/views/common-mixin",["jquery/nyt","underscore/nyt","foundation/hosts","foundation/models/user-data","foundation/models/page-storage","foundation/tracking/tracking-mixin","shared/modal/views/modal","shared/sharetools/templates","shared/sharetools/views/email","shared/sharetools/helpers/share-tools-config","shared/sharetools/instances/cross-platform-save","shared/sharetools/instances/short-url"],function(e,t,i,n,s,a,o,r,l,d,c,h){"use strict";var u={handleShareAction:function(t,i){var s=e(t.target),a=s.attr("data-share")||s.parent().attr("data-share"),o=a&&d[a.toUpperCase()];return o?(i&&this.modal&&this.modal.close(),"imageslideshow"!==this.pageManager.getMeta("PT")&&this.trackShareData(a,o,i),o===d.EMBED?void this.triggerEmbedLoginModal(t):void(o.isModalTrigger?this.broadcast("nyt:open-share-modal",{instanceContainer:this.$instanceContainer}):o===d.EMAIL?this.isMobileShareTools()?this.openMailToLink():n.isLoggedIn()?this.openMailToLink():this.triggerLoginModal(t,"Log in to email","Email"):o===d.PRINT?window.print():o===d.SAVE?n.isLoggedIn()?c.currentArticleSaved?this.removeItem():this.saveItem():(this.trackingTrigger("loginmodal-open",{module:"LogIn",action:"Click",region:i?"ToolsMenu":this.trackingRegion,eventName:"ArticleTool-save"}),this.triggerLoginModal(t,"Log in to save","Save")):o.isPopup&&this.popupShareWindow(o))):void 0},handleModalShareAction:function(e){this.handleShareAction(e,!0)},triggerLoginModal:function(e,t,i){e.preventDefault(),e.stopPropagation(),this.broadcast("nyt:loginmodal-open",{modalTitle:t,moduleName:i})},triggerEmbedLoginModal:function(t){t.stopPropagation(),e(".show-all-sharetool a").trigger("click"),this.$body.find(".show-all-sharetool-modal #embed-input").select()},popupShareWindow:function(e){e.usesShortUrl?this.handleShortUrlShareAction(e):window.open(this.buildShareServiceUrl(e),"_blank",this.getPopupWindowFeatures(e))},getPopupWindowFeatures:function(e){return"toolbar=0,status=0,height="+e.height+",width="+e.width+",scrollbars=yes,resizable=yes"},buildShareServiceUrl:function(e){var t,i=[],n=e.smid,s=e.shareDataParameters,a=e.shareServiceParameters,o={url:this.shareData.getUrl(),title:this.shareData.getTitle(),description:this.shareData.getDescription(),media:this.shareData.getMedia()};if(n&&(o.url+=this.getQuerystringDelimiter(o.url),o.url+="smid="+n),s)for(t in s)s.hasOwnProperty(t)&&o.hasOwnProperty(t)&&i.push(s[t]+"="+encodeURIComponent(o[t]));if(a){a.hasOwnProperty("publicationDate")&&(a.publicationDate=this.shareData.getPublicationDate()),a.hasOwnProperty("author")&&(a.author=this.shareData.getAuthor());for(t in a)a.hasOwnProperty(t)&&i.push(t+"="+encodeURIComponent(a[t]))}return e.url+"?"+i.join("&")},handleShortUrlShareAction:function(t){var i,n,s,a,o=this,r=this.shareData.getUrl(),l=t.smid,d=this.shareData.getTitle(),c="tw-share"===l&&"archives"===this.pageManager.getMeta("CG")?!0:!1;/(?:iPad|iPhone)/.test(navigator.userAgent)?(a=e("#masthead").find(".story-short-url").text()||this.pageManager.getCanonical()||r,c&&(d=this.truncatedHeadline(a,d)),i=t.url+"?url="+encodeURIComponent(a)+"&text="+encodeURIComponent(d),window.open(i,"_blank",this.getPopupWindowFeatures(t))):(n=window.open("","_blank",this.getPopupWindowFeatures(t)),s=function(e){var i=o.shareData.getVia();c&&(d=o.truncatedHeadline(e,d)),e=t.url+"?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(d),i&&(e+="&via="+encodeURIComponent(i)),n.location.href=e},l&&!this.pageManager.isMobile()&&(r+=this.getQuerystringDelimiter(r),r+="smid="+l),i=h.requestUrl(r)||"",i?s(i):this.listenToOnce(h,"add",function(){var e=h.findWhere({url:r});e&&s(e.get("shortUrl"))}))},getQuerystringDelimiter:function(e){return-1===e.indexOf("?")?"?":"&"},saveItem:function(){var e,t,n,a,o=this,l=this.shareData.getUrl();t=function(){var e="sharetools_hasSaves";s.get(e)!==!0?(a(),s.set(e,!0)):n()},n=function(){o.showModal({id:"save-item-growl-modal",modalTitle:'<i class="icon"></i>Saved',tailDirection:"centered",openCallback:function(){window.setTimeout(this.removeFromPage,2e3)}})},a=function(){o.showModal({id:"save-item-modal",modalTitle:'<i class="icon"></i>Saved',modalContent:r.savemodal({link:i.www+"/saved"}),hasOverlay:!0,hasCloseButton:!0,tailDirection:"centered",closeCallback:function(){this.removeFromPage()}})},e=c.where({url:l}),e.length?n():(this.subscribeOnce(c,"nyt:xps-saved",t),c.save(l))},removeItem:function(){var e=this,t=this.shareData.getUrl(),i=function(){e.showModal({id:"save-item-growl-modal",modalTitle:'<i class="icon"></i>Removed',tailDirection:"centered",openCallback:function(){window.setTimeout(this.removeFromPage,2e3)}})};this.subscribeOnce(c,"nyt:xps-article-removed",i),c.removeSavedArticle(t)},trackShareData:function(e,t,i){var n={};c.currentArticleSaved&&(e="unsave"),this.trackingBaseData={module:"ShareTools",action:"click",version:this.shareData.getContentType(),contentCollection:this.pageManager.getMeta("article:section")},i?(n.region="ToolsMenu",n.version="Content"):n.region=this.trackingRegion,t.isArticleTool?(n.module="ArticleTools",n.eventName="ArticleTool-"+e):"show-all"===e?n.eventName="Share-ShowAll":n.eventName="Share-"+e,this.trackingTrigger("share-tools-click",n)},showModal:function(e){var i=new o(e);i.addToPage(),t.defer(i.open)},isMobileShareTools:function(){return this.pageManager.getCurrentBreakpoint()<1e3},openMailToLink:function(){var e,t="%0A%0A",i=encodeURIComponent(this.shareData.getTitle()),n=encodeURIComponent(this.shareData.getDescription()),s=encodeURIComponent(this.shareData.getUrl()),a="NYTimes.com: "+i,o="From The New York Times:"+t+i+t+n+t+s;this.isMobileShareTools()?window.location="mailto:?subject="+a+"&body="+o:(e=window.open("mailto:?subject="+a+"&body="+o,"_blank"),e.opener=null)},truncatedHeadline:function(e,t){var i=e.length,n=t.length,s=n+i+1,a=280-i,o=s-i-a,r=t;return s>280&&(r=t.substring(0,n-o)),r}};return u}),define("shared/sharetools/views/share-tool",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/sharetools/views/common-mixin","shared/sharetools/templates"],function(e,t,i,n,s){"use strict";var a=i.extend(t.extend({},n,{tagName:"li",events:{click:"handleShareAction"},initialize:function(e){this.toolId=e.toolId,this.toolConfig=e.toolConfig,this.label=e.customLabel||this.toolConfig.label,this.loginModalTitle=this.toolConfig.loginModalTitle||"",this.$instanceContainer=e.instanceContainer,this.shareData=e.shareData,this.trackingRegion=e.trackingRegion,""===e.customLabel&&(this.isLabelHidden=!0)},render:function(){var e,t,i=this.toolId.toLowerCase();return this.isAdView()?(e=this.pageManager.getCurrentBreakpoint()<=1020?"Position1":"Frame4A",this.$instanceContainer.find(".sharetools-inline-article-ad").attr("id",e),this.broadcast("nyt:ad-library:dfp:queue-placement",e),this.$instanceContainer.find("#"+e).removeClass("hidden")):(t=s.shareTool({id:i,label:this.label,loginModalTitle:this.loginModalTitle,isLabelHidden:this.isLabelHidden}),this.$el.addClass("sharetool "+i+"-sharetool"),this.$el.append(t)),this},isAdView:function(){return"AD"===this.toolId}}));return a}),define("shared/sharetools/views/containers-mixin",["jquery/nyt","underscore/nyt","shared/sharetools/models/share-data","shared/sharetools/views/share-tool","shared/sharetools/helpers/share-tools-config"],function(e,t,i,n,s){"use strict";var a={getToolIdsAndCustomLabels:function(e){var t,i,n,a;if(this.toolIds=[],this.customLabels={},e)for(e=e.split(","),t=0,n=e.length;n>t;t++)i=e[t].toUpperCase(),a=i.indexOf("|"),-1!==a&&(i=i.substring(0,a),this.customLabels[i]=e[t].substr(a+1)),this.toolIds.push(i);else for(i in s)s.hasOwnProperty(i)&&s[i].isInDefaultSet===!0&&this.toolIds.push(i)},instantiateViews:function(e){var i,a,o,r,l,d=[];for(i=0,a=e.length;a>i;i++)o=e[i],r=this.customLabels&&this.customLabels[o],s.hasOwnProperty(o)&&(l={toolId:o,toolConfig:s[o],instanceContainer:this.$instanceContainer,shareData:this.shareData,trackingRegion:this.trackingRegion},t.isString(r)&&(l.customLabel=r),d.push(new n(l)));return d},renderToolViews:function(){var e,t,i;for(t=this.instantiateViews(this.toolIds),e=0,i=t.length;i>e;e++)t[e].isAdView()?t[e].render():this.$el.append(t[e].render().el)},getToolViewsMarkup:function(t){var i,n=document.createElement("div"),s=this.instantiateViews(t),a=s.length;for(i=0;a>i;i++)n.appendChild(s[i].render().el);return e(n).html()}};return a}),define("shared/sharetools/views/share-tools-modal-container",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/modal/views/modal","shared/sharetools/helpers/share-tools-config","shared/sharetools/views/share-tool","shared/sharetools/views/common-mixin","shared/sharetools/views/containers-mixin","shared/sharetools/instances/short-url","shared/sharetools/templates"],function(e,t,i,n,s,a,o,r,l,d){"use strict";var c=i.extend(t.extend({},o,r,{events:{click:"handleModalShareAction"},defaultModalSettings:{id:"show-all-sharetool-modal",modalTitle:"share",binding:".show-all-sharetool",tailDirection:"up",hasOverlay:!1,hasCloseButton:!1,positionTailSide:!1,autoPosition:!1,modalContent:"",toolTypeSponsor:"Share",tailLeftOffset:0,tailTopOffset:0,openCallback:function(){this.$target.addClass("active")},closeCallback:function(){this.$target.removeClass("active"),this.removeFromPage()}},initialize:function(i){this.$instanceContainer=i.instanceContainer,this.trackingRegion=i.trackingRegion,this.shareData=i.shareData,this.configIds=i.modalSettings.shares,this.showTools=i.modalSettings.hasOwnProperty("showTools")?i.modalSettings.showTools:!0,this.modalSettings=t.extend({},this.defaultModalSettings,i.modalSettings),this.modalSettings.modalFooter=d.shareToolsModalFooter({toolTypeSponsor:this.modalSettings.toolTypeSponsor}),this.isMobileShareTools()&&(this.modalSettings=t.extend({},this.modalSettings,{tailDirection:"centered",hasCloseButton:!0,hasOverlay:!0,positionTailSide:!1,autoPosition:!1})),this.el=document.createElement("ul"),this.el.className="sharetools-menu",this.$el=e(this.el),this.urlWithSmid=this.shareData.getUrl(),this.urlWithSmid+=-1===this.urlWithSmid.indexOf("?")?"?":"&",this.urlWithSmid+="smid=pl-share",this.permalink=l.requestUrl(this.urlWithSmid)||"",this.permalink||this.listenToOnce(l,"add",this.handleShortUrl),this.render()},render:function(){var e="Frame6A",t=this;this.modalSettings.modalContent=d.shareToolsModal(this.buildMarkup()),this.modal=new n(this.modalSettings),this.setElement(this.modal.$modal),this.modalSettings.embedCode&&this.modal.$modal.find(".embed-input").val(this.modalSettings.embedCode),this.modal.$modal.find(".show-all-sharetool-modal-ad").attr("id",e),this.modalSettings.articleSaved&&this.modal.$modal.find(".save-sharetool").addClass("article-saved"),this.modal.addToPage(),this.isMobileShareTools()||this.broadcast("nyt:ad-library:dfp:request-placement",e),this.subscribe("nyt:page-resize",function(){t.modal.close()})},buildMarkup:function(){var i,n,a,o=this,r=[],l=[],d=function(e){var i;s.hasOwnProperty(e)&&(i=t.extend({},s[e],{id:e}),s[e].isArticleTool?"REPRINTS"===e?"article"!==o.pageManager.getMeta("PT")||/\/(?:aponline|reuters|opinion|t-magazine|magazine)\//.test(o.shareData.getUrl())||"books"===o.pageManager.getMeta("CG")&&"Review"===o.pageManager.getMeta("tom")||l.push(i):s[e].isArticleTool&&l.push(i):r.push(i))};if(this.configIds)for(this.getToolIdsAndCustomLabels(this.configIds),i=0,a=this.toolIds.length;a>i;i++)d(this.toolIds[i]);else{for(n in s)s[n].isModalMember&&d(n);r=t.sortBy(r,function(t){return e("html").hasClass("viewport-medium")?t.modalDisplayOrder:t.mobileModalDisplayOrder}),l=t.sortBy(l,function(t){return e("html").hasClass("viewport-medium")?t.modalDisplayOrder:t.mobileModalDisplayOrder})}return{shortUrl:this.permalink,showTools:this.showTools,isCompact:"homepage"===o.pageManager.getApplicationName(),standardToolsList:this.getToolViewsMarkup(t.pluck(r,"id")),articleToolsList:this.getToolViewsMarkup(t.pluck(l,"id"))}},handleShortUrl:function(){var e=l.findWhere({url:this.urlWithSmid});e&&this.modal.$modal.find(".short-url-input").val(e.get("shortUrl"))}}));return c}),define("shared/sharetools/views/share-tools-container",["jquery/nyt","underscore/nyt","foundation/views/base-view","foundation/models/user-data","shared/sharetools/models/share-data","shared/sharetools/views/containers-mixin","shared/sharetools/views/share-tools-modal-container","shared/sharetools/instances/cross-platform-save"],function(e,t,i,n,s,a,o,r){"use strict";var l=i.extend(t.extend({},a,{initializedAttribute:"data-share-tools-initialized",initialize:function(t){this.$instanceContainer=t.el,this.trackingRegion=t.trackingRegion||"",this.$instanceContainer&&!this.$instanceContainer.attr(this.initializedAttribute)&&(this.getToolIdsAndCustomLabels(this.$instanceContainer.data("shares")),this.shareData=new s(this.$instanceContainer),this.el=document.createElement("ul"),this.$el=e(this.el),this.$el.addClass("sharetools-menu"),t.modalSettings&&(this.subscribe("nyt:xps-article-status",function(e){t.modalSettings.articleSaved=e}),n.isLoggedIn()&&r.getArticlesStatus(this.pageManager.getCanonical()),this.subscribe("nyt:open-share-modal",function(e){e.instanceContainer&&this.$instanceContainer.get(0)===e.instanceContainer.get(0)&&new o({instanceContainer:e.instanceContainer,modalSettings:t.modalSettings,trackingRegion:this.trackingRegion,shareData:this.shareData})})),this.render())},render:function(){var i,n,s=void 0!==t.find(this.toolIds,function(e){return"AD"===e}),a=this.$instanceContainer.find(".sharetools-inline-article-ad");this.renderToolViews(),this.$instanceContainer.attr(this.initializedAttribute,"1"),s&&a.length?this.$el.insertBefore(a):this.$instanceContainer.append(this.el),i=this.$el.closest(".sharetools"),n=i.attr("id"),("sharetools-masthead"===n&&(this.isTemplateMinimal()||this.hasCoverMedia())||i.data("share-label"))&&e("#sharetools-masthead .show-all-sharetool .sharetool-text").text("Share")},isTemplateMinimal:function(){return this.$html.hasClass("template-minimal")?!0:void 0},hasCoverMedia:function(){return this.$html.hasClass("has-cover-media")?!0:void 0}}));return l}),define("collection/instances/sharetools",["jquery/nyt","shared/sharetools/views/share-tools-container"],function(e,t){"use strict";new t({el:e("#sharetools"),trackingRegion:"Body",modalSettings:{modalTitle:"share this page",tailDirection:"up-right",positionTailSide:!1,autoPosition:!1,toggleSpeed:1,showTools:!1}})}),define("collection/instances/wsod",["foundation/views/base-view","foundation/models/user-data"],function(e,t){var i=e.extend({insertModule:function(e){var i="",n=document.getElementsByTagName("head").item(0),s=document.createElement("script");t.isLoggedIn()&&(i="&user_id="+t.getUserId()),s.setAttribute("language","javascript"),s.setAttribute("type","text/javascript"),s.setAttribute("src",e+i),n.appendChild(s)}});return new i}),define("shared/realestatesearch/helpers/constants",[],function(){"use strict";var e={APPLICATION_URL_PATH:"real-estate"};return e}),define("shared/realestatesearch/helpers/realestate-mixin",["jquery/nyt","underscore/nyt","shared/realestatesearch/helpers/constants"],function(e,t,i){"use strict";var n=t.extend({},{getChannelSlug:function(e){var i;switch(t.isObject(e)&&(e=e.value),e||(e=""),e.toLowerCase()){case"rent":case"rental":case"rentals":i="rent";break;case"sale":case"sales":default:i="sale"}return"homes-for-"+i+"/"},getChannelValue:function(){var e="None";return this.$channelValue?e=this.$channelValue.val():t.each(this.destructSearchUrl(),function(t){"channel"===t.name&&(e=t.value)}),e},getSearchUrl:function(n,s){var a=s||window.location.pathname,o=new RegExp("homes-for-(sale|rent)"),r=t.some(n,function(e){return"channel"===e.name&&"SALES"===e.value}),l="SALES",d=t.find(n,function(e){return"location"===e.name});return o.test(a)||(a="/"+i.APPLICATION_URL_PATH+"/"+this.getChannelSlug(l)),d?a=r?a.replace(o,"homes-for-sale"):a.replace(o,"homes-for-rent"):(l=r?"SALES":"RENTALS",a="/"+i.APPLICATION_URL_PATH+"/"+this.getChannelSlug(l)),n=t.reject(n,function(e){return"channel"===e.name}),a+"?"+e.param(n)}});return n}),define("shared/realestatesearch/templates",["underscore/nyt"],function(_){var templates={};return templates.locationSuggestions=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",results.length&&(__p+="\n<ul class='real-estate-search-results'>\n",_.each(results,function(e){__p+='\n<li class="location-suggestion"><a data-seo="'+(null==(__t=e.seo)?"":__t)+'">\n'+(null==(__t=e.title)?"":__t)+"</a>\n</li>\n"}),__p+="\n</ul>\n"),__p+="";return __p},templates.lozenge=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li class="lozenge-row" role="button" data-seo="'+(null==(__t=seo)?"":__t)+'" data-id="'+(null==(__t=id)?"":__t)+'" data-shape="'+(null==(__t=shape)?"":__t)+'">\n<input type="checkbox" name="locations[]" value="'+(null==(__t=seo)?"":__t)+'" checked class="hidden"/>\n<div tabindex="-1" class="lozenge-button" title="'+(null==(__t=text)?"":__t)+'">\n<h3>'+(null==(__t=text)?"":__t)+'</h3>\n<em class="lozenge-delete" title="Remove '+(null==(__t=text)?"":__t)+' role="button""></em>\n</div>\n<div class="select-search-button"><span class="plus-icon">+</span></div>\n</li>';return __p},templates.lozengeModal=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="<ul>\n",_.each(lozenges,function(e){__p+='\n<li class="lozenge-row" role="button" data-lozenge-ref="'+(null==(__t=e.lozengeRef)?"":__t)+'">\n<em class="lozenge-delete" title="Remove '+(null==(__t=e.text)?"":__t)+'"></em>\n'+(null==(__t=e.text)?"":__t)+"\n</li>\n"}),__p+="\n</ul>";return __p},templates.lozengeNote=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button type="button" tabindex="-1" class="lozenge-button">'+(null==(__t=text)?"":__t)+"</button>";return __p},templates}),define("shared/realestatesearch/models/location-suggestion",["foundation/models/base-model"],function(e){"use strict";var t=e.extend({});return t}),define("shared/realestatesearch/collections/location-suggestion-collection",["jquery/nyt","backbone/nyt","underscore/nyt","foundation/collections/base-collection","foundation/hosts","shared/realestatesearch/models/location-suggestion"],function(e,t,i,n,s,a){"use strict";var o=n.extend({url:"https://service-nytimes.gabriels.net/v1.3/Service.aspx",basicSearchUrl:"https://service-nytimes.gabriels.net/v1.3/Service.aspx",smartSearchUrl:"https://service-nytimes.gabriels.net/v1.3/SmartSearchResults.aspx",suggestServiceUrl:s.realestateJsonHost+"/Suggest/v1.0/NYT.Suggest.svc/getSmartSearchResults",model:a,query:"",apiType:"basic",amountOfSuggestions:4,channel:"sales",existingValues:[],fetch:function(e){var n,s,a,o,r;return this.pageManager.flag("newSuggestAPI")?t.Collection.prototype.fetch.call(this,i.extend(e||{},{apiType:"suggestService"})):(e=e?i.clone(e):{},void 0===e.parse&&(e.parse=!0),o=this,r=e.success,s=this.sync("read",this,i.extend(e,{apiType:"basic"})),a=this.sync("read",this,i.extend(e,{apiType:"smart"})),n=s.then(function(e){return e.group.length&&e.group[0].option.length?(e.apiType="basic",e):a.then(function(e){return e.apiType="smart",e})}),n.then(function(t){var i=e.reset?"reset":"set";o[i](t,e),r&&r.call(e.context,o,t,e),o.trigger("sync",o,t,e)}),n)},sync:function(e,i,n){switch(n.apiType){case"basic":n.url=this.basicSearchUrl,n.data={Channel:this.channel.toUpperCase(),SearchType:"Suggest",ReturnType:"json",term:this.query},n.dataType="jsonp",n.jsonp="callback";break;case"smart":n.url=this.smartSearchUrl,n.data={cha:this.channel.toLowerCase(),ret:"json",key:this.query},n.dataType="jsonp",n.jsonp="callback";break;case"suggestService":n.url=this.suggestServiceUrl,n.data={channel:this.channel.toLowerCase(),key:this.query},n.headers={Accept:"application/json"}}return t.sync(e,i,n)},parse:function(e){var t;if(this.pageManager.flag("newSuggestAPI"))return this.parseSmartApi(e,{matchgroupKey:"matchGroupList",matchKey:"matchList",seoPathKey:"seoPath"});switch(e.apiType){case"basic":t=this.parseBasicApi(e);break;case"smart":t=this.parseSmartApi(e);break;default:t=[]}return t},parseBasicApi:function(e){var t;return e.group[0].option.length?(t=i.map(e.group[0].option,function(e){return{title:e.title,seo:e.valueseo}}),t=this.filterSuggestions(t),i.first(t,this.amountOfSuggestions)):!1},parseSmartApi:function(e,t){var n=[],s=i.defaults(t||{},{matchgroupKey:"matchgroup",matchKey:"match",seoPathKey:"seopath"});return i.each(e[s.matchgroupKey],function(e){i.each(e[s.matchKey],function(e){var t=e[s.seoPathKey].replace(/(^\/((sales|rentals)\/)?|\/+$)/g,"");n.push({title:e.description,seo:t})})}),n=this.filterSuggestions(n),i.first(n,this.amountOfSuggestions)},setExistingValues:function(e){this.existingValues=e},filterSuggestions:function(e){var t=this;return e=i.filter(e,function(e){var i=e.seo;return!(t.existingValues.indexOf(i)>-1)})},newQuery:function(e){this.query=e,this.fetch()}});return o}),define("shared/realestatesearch/views/lozenge-modal",["jquery/nyt","underscore/nyt","shared/modal/views/modal"],function(e,t,i){"use strict";var n=i.extend({events:function(){return t.extend({},i.prototype.events,{"click .lozenge-delete":"handleLozengeDeleteClick"})},handleLozengeDeleteClick:function(e){this.broadcast("lozenge:delete",e),this.close(e)}});return n}),define("shared/realestatesearch/views/lozenge",["jquery/nyt","backbone/nyt","underscore/nyt","foundation/views/base-view","shared/realestatesearch/views/lozenge-modal","shared/realestatesearch/templates","foundation/models/page-storage"],function(e,t,i,n,s,a,o){"use strict";var r=n.extend({lozengeCount:0,multiline:!1,defaultLozenge:{seo:"new-york-ny-usa",text:"Manhattan"},firstLineLozenges:[],lozengeCounter:1,events:{"mousedown .lozenge-delete":"handleDeleteLozengeClick","click .lozenge-row":"handleClickLozenge","click .lozenge-note":"handleNoteExpand","click .select-search-button":"focusSearchInput","mouseenter .lozenge-row":"handleMouseEnter","mouseleave .lozenge-row":"handleMouseLeave"},nytEvents:{"nyt:realestate-search-updating":"handleSearchUpdate","nyt:realestate-search-setLocations":"handleSetLocations","lozenge:delete":"handleDeleteLozengeClick","nyt:realestate-addLozenge":"handleAddLozenge","nyt:realestate-removeLozenge":"handleRemoveLozenge","nyt:realestate-shapeRemoved":"handleRemoveShapeLozenge","nyt:page-resize":"handlePageResize"},defaultModalSettings:{id:"lozenge-modal",binding:".lozenge-note",tailDirection:"up",tailLeftOffset:-25,addlClasses:"lozenge-modal",openCallback:function(){this.subscribeOnce("nyt:page-scroll",this.close)}},placeholderText:"Enter neighborhoods, zip codes or addresses",localLozengeKey:"realestate_lozenges",initialize:function(e){e||(e={}),this.addDefaultLozenge=e.addDefaultLozenge===!1?!1:!0,this.$container=this.$el.find("#tagged-items"),this.$textarea=this.$el.parent().find("#listings-search-input"),this.modalSettings=i.extend({},this.defaultModalSettings),this.modal=new s(this.modalSettings).addToPage(),this.lozengeCount=this.$el.find(".lozenge-row").length,this.collapseTextarea(),0===this.lozengeCount&&this.$textarea.attr("placeholder",this.placeholderText),this.saveLozenges()},hasLozenge:function(e,t){return t=t?t:{},t.ignoreHidden?!!this.$el.find('.lozenge-row[data-seo="'+e.seo+'"]:not(.hidden)').length:!!this.$el.find('.lozenge-row[data-seo="'+e.seo+'"]').length},addLozenge:function(t,i){var n,s=this.$el.find(".lozenge-row");this.$textarea.attr("placeholder",""),t.id=this.lozengeCounter,t.shape=t.shape?t.shape:!1,t.text="new-york-ny-usa"===t.seo?"Manhattan":t.text,t.shape!==!1&&(this.handleRemoveShapeLozenge(),this.removeDefaultLozenge(),s=this.$el.find(".lozenge-row")),n=e(a.lozenge(t)),this.lozengeCounter++,this.$container.append(n),this.lozengeCount=this.lozengeCount+1,1===s.length&&s.hasClass("hidden")?this.deleteLozenge(s):(this.resizeTextarea(),this.broadcast("nyt:realestate-search-refresh",i)),this.broadcast("nyt:realestate-lozenge-change"),this.focusLozenge(),this.saveLozenges()},removeDefaultLozenge:function(){1==this.lozengeCount&&this.hasLozenge(this.defaultLozenge,{ignoreHidden:!1})&&this.clearLozenges({skipUpdate:!0})},deleteLozenge:function(e,t){var i,n;t=t||{},e.length&&(i=e.closest(".lozenge-row"),t.forceDelete||1!==this.lozengeCount||i.hasClass("hidden")?(n=i.next().not(".hidden"),n.length||(n=i.prev().not(".hidden")),i.remove(),this.lozengeCount=this.lozengeCount-1,0===this.lozengeCount&&this.addDefaultLozenge?this.handleAddLozenge(this.defaultLozenge):this.broadcast("nyt:realestate-search-refresh",t),this.focusLozenge(n)):(i.addClass("hidden"),this.$activeLozenge=void 0,this.$textarea.attr("placeholder",this.placeholderText),this.broadcast("nyt:realestate-lozenges-hidden")),this.broadcast("nyt:realestate-lozenge-change"),this.resizeTextarea())},clearLozenges:function(e){e=e||{},this.$el.find(".lozenge-row").remove(),this.$activeLozenge=void 0,this.lozengeCount=0,this.$textarea.val(""),this.expandTextarea(),this.collapseTextarea(),e.skipUpdate||(this.broadcast("nyt:realestate-lozenge-change"),this.addDefaultLozenge&&this.handleAddLozenge(this.defaultLozenge))},expandTextarea:function(){this.expanded=!0,1!==this.lozengeCount&&this.$el.find(".lozenge-row.hidden").removeClass("hidden"),this.removeLozengeNote(),this.resizeTextarea()},collapseTextarea:function(){this.expanded=!1,0===this.lozengeCount&&this.$textarea.attr("placeholder",this.placeholderText),this.addLozengeNote(),this.resizeTextarea(),this.$textarea.css("overflow","hidden").css("height","")},displayTruncatedLozenge:function(){1===this.lozengeCount&&(this.$textarea.attr("placeholder",""),this.$el.find(".lozenge-row.hidden").removeClass("hidden"),this.broadcast("nyt:realestate-lozenge-change"),this.collapseTextarea())},resizeTextarea:function(){this.setTopPadding(this.$textarea),this.setLeftPadding(this.$textarea)},addLozengeNote:function(){var t,n,s,o=this,r=0,l=this.$container.width(),d=0,c=0,h=5,u=this.$container.find(".lozenge-row");if(u.length){if(this.firstLineLozenges=[],u.each(function(){n=e(this),s=o.firstLineLozenges.length<1?!0:l>d&&r+n.outerWidth()<l?!0:!1,s&&(r+=n.outerWidth(),c+=1,o.firstLineLozenges.push(this)),d+=n.outerWidth()}),l>=d||!this.firstLineLozenges.length)return void(this.multiline=!1);this.$secondaryLineLozenges=u.not(this.firstLineLozenges),this.multiline=!0,t=a.lozengeNote({title:"expand",text:" + "+(u.length-c)+" More"}),this.lastLozenge=this.firstLineLozenges[this.firstLineLozenges.length-1],this.$lozenge=e(t).css("position","absolute").css("left",this.lastLozenge.offsetLeft+this.lastLozenge.clientWidth-h).css("top","0").addClass("lozenge-note"),this.$el.append(this.$lozenge),i.each(u.not(this.firstLineLozenges),function(t){e(t).addClass("hidden")})}},removeLozengeNote:function(){this.$el.find(".lozenge-note").remove()},setTopPadding:function(e){e.css("padding-top","").css("height",""),this.expanded?e.css("padding-top",this.$container.outerHeight()-28).css("height",Math.max(this.$container.outerHeight()+5,parseInt(this.$textarea.css("height"),10))):e.css("padding-top","")},setLeftPadding:function(e){var t,i,n;i=this.$container.find(".lozenge-row").not(".hidden"),0===i.length?t="":(n=this.$el.find(".lozenge-note"),this.lastLozenge=i.length>1?i[i.length-1]:i[0],t=n[0]?this.lastLozenge.offsetLeft+this.lastLozenge.clientWidth+80:this.lastLozenge.offsetLeft+this.lastLozenge.clientWidth+10),e.css("padding-left",t)},popLozenge:function(){return this.$activeLozenge&&this.$activeLozenge.length?(this.deleteLozenge(this.$activeLozenge),!0):!1},deleteLozengeElement:function(e){var t;t=e.attr("data-lozenge-ref"),t&&(e=this.$el.find(".lozenge-row[data-id="+t+"]")),this.deleteLozenge(e),this.$textarea.focus()},handleDeleteLozengeEvent:function(e){this.deleteLozengeElement(e)},handleDeleteLozengeClick:function(t){var i;t.preventDefault(),t.stopPropagation(),i=e(t.target).closest(".lozenge-row"),this.deleteLozengeElement(i)},handleClickLozenge:function(){},handleMouseEnter:function(t){var i=e(t.currentTarget),n=i.data("seo");this.broadcast("nyt:realestate-highlight-neighborhood",n)},handleMouseLeave:function(){this.broadcast("nyt:realestate-highlight-neighborhood")},handleNoteExpand:function(t){var i,n;t.preventDefault(),t.stopPropagation(),this.modal.$target=this.$lozenge,i=this.$secondaryLineLozenges.map(function(){return n=e(this),{lozengeRef:n.attr("data-id"),text:n.find(".lozenge-button").text().trim()}}),this.modal.updateTemplate(a.lozengeModal({lozenges:i})),this.modal.open()},handleSetLocations:function(t){var n,s,a,o=[],r=this.$el.find(".lozenge-row");i.each(r,function(a){n=e(a),s=n.find('input[name="location"]').val(),o.push(s),-1===i.indexOf(t,s)&&(this.deleteLozenge(n,{disablePathUpdate:!0,forceDelete:!0}),this.expandTextarea(),this.collapseTextarea())}.bind(this)),i.each(t,function(e){-1===i.indexOf(o,e)&&(a=this.getLocalLozenge(e),a&&(this.addLozenge(a,{disablePathUpdate:!0}),this.expandTextarea(),this.collapseTextarea()))}.bind(this))},handleSearchUpdate:function(){this.displayTruncatedLozenge()},handleAddLozenge:function(e){this.expandTextarea(),this.addLozenge(e),this.collapseTextarea();
},handleRemoveLozenge:function(e){var t;e.seo&&(this.expandTextarea(),t=this.$el.find(".lozenge-row[data-seo="+e.seo+"]"),this.deleteLozenge(t),this.collapseTextarea())},handlePageResize:function(){this.expandTextarea(),this.collapseTextarea()},handleRemoveShapeLozenge:function(){var e;this.expandTextarea(),e=this.$el.find(".lozenge-row[data-shape=true]"),this.deleteLozenge(e),this.collapseTextarea()},saveLozenges:function(){var t,n=this.$el.find(".lozenge-row");i.each(n,function(i){t=e(i),i={text:t.find(".lozenge-button").text().trim(),seo:t.find('input[name="location[]"]').val(),shape:t.data("shape")},this.shouldSaveLocalLozenge(i)&&this.addLocalLozenge(i)}.bind(this))},getLocalLozenges:function(){return o.has(this.localLozengeKey)?JSON.parse(o.get(this.localLozengeKey)):[]},setLocalLozenges:function(e){o.set(this.localLozengeKey,JSON.stringify(e))},addLocalLozenge:function(e){var t=this.getLocalLozenges()||[];t.push(e),this.setLocalLozenges(t)},shouldSaveLocalLozenge:function(e){var t=this.getLocalLozenges();return!i.some(t,function(t){return t.seo===e.seo})},getLocalLozenge:function(e){var t=this.getLocalLozenges();return i.findWhere(t,{seo:e})},getLozengeValues:function(){var e=this.$el.find(".lozenge-row").not(".hidden").find('input[name="locations[]"]').serializeArray();return i.pluck(e,"value")},focusLozenge:function(e){void 0===e&&(e=this.$el.find(".lozenge-row").last().not(".hidden")),e.length&&(this.$activeLozenge&&this.$activeLozenge.length&&this.$activeLozenge.removeClass("active"),this.$activeLozenge=e,this.$activeLozenge.addClass("active"))},clearLozengeFocus:function(){this.$activeLozenge&&(this.$activeLozenge.removeClass("active"),this.$activeLozenge=void 0)},focusNextLozenge:function(){this.focusLozenge(this.$activeLozenge.next())},focusPrevLozenge:function(){this.focusLozenge(this.$activeLozenge.prev())},focusSearchInput:function(){this.$textarea.focus()}});return r}),define("shared/realestatesearch/views/location-input",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/searchform/helpers/search-form-mixin","shared/realestatesearch/templates","shared/realestatesearch/collections/location-suggestion-collection","shared/realestatesearch/views/lozenge"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend(t.extend({},n,{collection:new a,events:{"keyup .search-input":"handleKeyUp","keydown .search-input":"handleKeyDown","click .clear-button":"handleClearButton","mousedown .location-suggestion":"handleSuggestionClick","focus .search-input":"handleInputFocus","blur .search-input":"handleInputBlur"},nytEvents:{"nyt:realestate-createLozengeFromSuggestion":"handleCreateLozengeFromSuggestion","nyt:realestate-search-channel-change":"handleChannelChange","nyt:realestate-search-refresh":"handleFiltersChange","nyt:realestate-lozenge-change":"handleLozengeChange"},KEYS:t.extend(n.KEYS,{BACKSPACE:8}),initialize:function(e){e||(e={}),this.lozenge=new o({el:"#lozenge",addDefaultLozenge:e.addDefaultLozenge}),this.$searchInput=this.$el.find(".search-input"),this.collection.channel=this.$el.find("#channel-select").val(),this.keyCodes=t.values(this.KEYS),this.collection.setExistingValues(this.lozenge.getLozengeValues()),t.bindAll(this,"handlePageClicks")},afterInitialize:function(){this.getSearchValue().length&&this.throttledSuggestions(),this.$shell.on("click",this.handlePageClicks)},render:function(){var e,i,n=this.collection.toJSON();t.isEmpty(n)||(i=s.locationSuggestions,e=i({results:n}),this.$list.html(e).show())},handleKeyUp:function(e){var t=e.which;this.handleInputTextChange(),this.$input&&this.$input.length&&(t===this.KEYS.BACKSPACE?this.handleBackspaceKey():t===this.KEYS.ENTER&&(this.getActiveLink()?this.createLozengeFromSuggestion():this.broadcast("nyt:realestate-enterKey-down")),-1===this.keyCodes.indexOf(t)&&this.lozenge.clearLozengeFocus(),n.handleKeyUp.apply(this,arguments))},handleBackspaceKey:function(){0===this.getSearchValue().length&&(this.lozenge.popLozenge()||this.lozenge.focusLozenge())},handleEnterKey:function(){this.createLozengeFromSuggestion()},handleRightLeftKey:function(e){var t=e.which;this.getSearchValue().length>0||(e.preventDefault(),t===this.KEYS.RIGHT_ARROW?this.lozenge.focusNextLozenge():t===this.KEYS.LEFT_ARROW&&this.lozenge.focusPrevLozenge())},handleCreateLozengeFromSuggestion:function(){this.getSearchValue()&&(this.createLozengeFromSuggestion(),this.handleInputTextChange())},handleInputTextChange:function(){this.$searchInput.val().length>0?this.$el.addClass("hasText"):this.$el.removeClass("hasText")},createLozengeFromSuggestion:function(){var e=this.getActiveLink();return e?(this.addLozenge(e),this.setSearchValue(""),this.hideAutoSuggest(),void this.emptyAutoSuggest()):!1},getActiveLink:function(){var e=this.$list.find("a.active");return e.length||(e=this.$list.find("a").first()),e.length?e:!1},handleSuggestionClick:function(t){t.preventDefault(),t.stopPropagation(),this.addLozenge(e(t.target).closest("a")),this.setSearchValue(""),this.hideAutoSuggest(),this.emptyAutoSuggest(),this.$input.focus()},addLozenge:function(e){var t,i=e.data("seo");t={seo:i,text:e.text().split(",")[0]},this.lozenge.hasLozenge(t,{ignoreHidden:!0})||this.lozenge.addLozenge(t)},emptyAutoSuggest:function(){this.$list.find(".location-suggestion").remove()},handleFiltersChange:function(){this.lozenge.lozengeCount>=10?this.$searchInput.prop("disabled",!0):this.$searchInput.prop("disabled",!1)},handleChannelChange:function(e,t){e&&"none"!==e.toLowerCase()&&(this.collection.channel=e),t&&t.preventLozengeClear||this.lozenge.clearLozenges()},handleLozengeChange:function(){var e=this.lozenge.getLozengeValues();this.collection.setExistingValues(e)},getSearchValue:function(){return this.$input&&this.$input.length?e.trim(this.$input.val()):""},handleInputFocus:t.debounce(function(){this.lozenge.expandTextarea(),0===this.getSearchValue().length&&this.lozenge.focusLozenge(),this.$el.addClass("focused")},50),handleInputBlur:t.debounce(function(){this.lozenge.clearLozengeFocus(),this.lozenge.collapseTextarea(),this.handleInputTextChange(),this.$el.removeClass("focused")},100)}));return r}),define("shared/realestatesearch/views/channel-select",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/realestatesearch/helpers/realestate-mixin"],function(e,t,i,n){"use strict";var s=i.extend(t.extend({},n,{events:{"click .channel-option":"handleChannelOptionClick","click .mobile-channel-option":"handleMobileChannelOptionClick"},nytEvents:{"nyt:realestate-search-channel-change":"setChannelValue"},initialize:function(){this.$channelValue=this.$el.find("#channel-select"),this.$channelSelector=this.$el.find("#channel-selector"),this.$channelSelectorMobile=this.$el.find("#mobile-channel-selector"),this.setChannelValue(this.getChannelValue()),t.bindAll(this,"handlePageClicks"),this.afterInitialize()},afterInitialize:function(){this.$shell.on("click",this.handlePageClicks)},handleChannelOptionClick:function(e){this.$channelSelector.hasClass("open")?this.selectChannel(e.currentTarget):this.openChannelMenu()},handleMobileChannelOptionClick:function(e){this.selectChannel(e.currentTarget)},openChannelMenu:function(){this.$channelSelector.addClass("open")},closeChannelMenu:function(){this.$channelSelector.removeClass("open")},selectChannel:function(t){var i=this.$channelValue.val(),n=e(t).data("channel");return i===n?void this.closeChannelMenu():(this.setChannelValue(n),void this.broadcast("nyt:realestate-search-channel-change",n))},setChannelValue:function(e){var t=this.$channelSelector.find("#channel-option-sales"),i=this.$channelSelector.find("#channel-option-rentals");this.$channelSelector.removeClass("open sales rentals").addClass(e.toLowerCase()),this.$channelSelectorMobile.removeClass("sales rentals").addClass(e.toLowerCase()),this.$channelValue.val(e),"SALES"===e?t.insertBefore(i):i.insertBefore(t)},handlePageClicks:function(t){e(t.target).hasClass("channel-option")||this.closeChannelMenu()}}));return s}),define("shared/realestatesearch/views/search-form",["jquery/nyt","underscore/nyt","foundation/views/base-view","shared/realestatesearch/helpers/realestate-mixin","shared/realestatesearch/views/location-input","shared/realestatesearch/views/channel-select","shared/realestatesearch/helpers/constants"],function(e,t,i,n,s,a,o){"use strict";var r=i.extend(t.extend({},n,{events:{"click #realestate-submit-button":"handleSubmitClick"},nytEvents:{"nyt:realestate-search-channel-change":"handleChannelChange"},initialize:function(e){e=e?e:{},new s({el:e.el,addDefaultLozenge:e.addDefaultLozenge}),new a({el:e.el}),this.appName=e.appName?e.appName:"find-a-home",this.$searchBar=this.$el.find("#realestate-search-bar"),this.$searchInput=this.$searchBar.find("#listings-search-input"),this.$search=this.$searchBar.find("#input-container"),this.$minPriceSelector=this.$el.find("#for-sale-min-price"),this.$maxPriceSelector=this.$el.find("#for-sale-max-price"),this.$priceSelectors=this.$el.find(".filter-price select"),this.$channelValue=this.$el.find("#channel-select"),this.$channelSelector=this.$el.find("#channel-selector")},handleSubmitClick:function(){var i,n,s=[],a=this.$channelValue.val(),r="/"+o.APPLICATION_URL_PATH+"/"+this.getChannelSlug(a);n=this.$el.find(".lozenge-row"),s.push({name:"channel",value:a}),t.each(n,function(t){e(t).find("input").each(function(t,n){i=e(n),s.push({name:i.attr("name"),value:i.val()})})}),t.each(this.$el.find("select").serializeArray(),function(e){""!==e.value&&s.push({name:e.name,value:e.value})}),s.push({name:"redirect",value:this.appName}),window.location=this.getSearchUrl(s,r)},handleChannelChange:function(){this.resetPriceSelectors()},handlePriceChange:function(t){this.filterPrices(e(t.target))},resetPriceSelectors:function(){var t=this.$el.find("#min-price"),i=this.$el.find("#max-price"),n=e("<div></div>");this.$priceSelectors.find("option").each(function(){e(this).prop("disabled",!1).prop("hidden",!1).removeAttr("selected")}),this.$minPriceSelector.find("option").appendTo(n),t.find("option").appendTo(this.$minPriceSelector),n.find("option").appendTo(t),this.$maxPriceSelector.find("option").appendTo(n),i.find("option").appendTo(this.$maxPriceSelector),n.find("option").appendTo(i),n.remove(),this.$minPriceSelector.find("option").first().attr("selected","selected"),this.$maxPriceSelector.find("option").first().attr("selected","selected")},refocusInput:function(){this.$searchInput.focusout().focus()}}));return r}),define("collection/instances/realestate-search",["jquery/nyt","shared/realestatesearch/views/search-form"],function(e,t){"use strict";e("#realestate-search-bar").length&&new t({el:"#realestate-search-bar",addDefaultLozenge:!1})}),define("shared/https/instances/toggle-button",["jquery/nyt","foundation/cookies"],function(e,t){"use strict";function i(){l=!l}function n(e){h.style.transition=h.style.WebkitTransition="none",h.getBoundingClientRect(),h.style.transition=h.style.WebkitTransition="fill 0.5s ease",u.style.transition=u.style.WebkitTransition="none",u.style.strokeDasharray=g+" "+g,u.style.strokeDashoffset=e,u.getBoundingClientRect(),u.style.transition=u.style.WebkitTransition="stroke-dashoffset 0.5s ease-in-out"}function s(){n(0),h.style.fill="#9C9C9C",u.style.strokeDashoffset=g-m}function a(){n(g-m),h.style.fill="#6EAB47",u.style.strokeDashoffset=0}var o,r,l,d,c,h,u,g,m,p={cookieName:"nyt.np.https-everywhere",elementId:"internal-https-menu"};o=e("#"+p.elementId),0===o.length?o=e("<div />").attr("id",p.elementId):o.empty(),o.css({bottom:"20px",cursor:"pointer",height:"60px",padding:"5px",position:"fixed",right:"5px",width:"60px"}),r=t.readCookie(p.cookieName),null!==r&&"9"!==r&&o.appendTo(e("body")),l="1"===r,d=['<svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" x="0" y="0" width="50" height="50">','<circle cx="25" cy="25" r="25" style="fill: #6EAB47" />','<path fill="transparent" stroke="#FFF" stroke-width="2" d="M20 23 C 20 11, 30 11, 30 23" />','<rect x="17" y="23" width="16" height="12" fill="#FFF" />',"</svg>"].join("\n"),c=e(d),h=c.find("circle")[0],u=c.find("path")[0],g=u.getTotalLength(),m=19,c.css({boxShadow:"0 0 4px rgba(0,0,0,.14), 0 4px 8px rgba(0,0,0,.28)",borderRadius:"50%"}).on("click",function(){t.writeCookie(p.cookieName,l?"0":"1",{domain:".nytimes.com",path:"/",expires:l?7:180}),l?s(e(this)):a(e(this)),document.location.reload()}).appendTo(o),l||s(c),setInterval(function(){var n=t.readCookie(p.cookieName);null===n||"9"===n?o.detach():e.contains(document,o[0])||o.appendTo("body"),l&&"1"!==n?(s(c),i()):l||"1"!==n||(a(c),i())},1e4)}),define("collection/views/dining-googlemap-service",["jquery/nyt","underscore/nyt","foundation/views/base-view"],function(e,t,i){"use strict";var n=i.extend({map:null,model:null,center:null,options:null,bounds:null,infoWin:null,markers:[],initialize:function(){this.listenTo(this.pageManager,"nyt:redraw-google-maps",this.handleRedrawMakers)},handleDomReady:function(){this.render(),e(".map").on("click",this.handleMapClicked)},render:function(){document.getElementById("map-data")&&(this.model=JSON.parse(e("#map-data").get(0).innerHTML)),this.model&&this.setMap()},setMap:function(){window.google?(this.bounds=new window.google.maps.LatLngBounds,this.center=new window.google.maps.LatLng(this.model.GoogleMapOptions[0].latitude,this.model.GoogleMapOptions[0].longtitude),this.options={clickable:!1,scrollwheel:!1,center:this.center,disableDefaultUI:!0,draggable:!1},this.map=new window.google.maps.Map(document.querySelector(".map"),this.options),this.map.setTilt(45),this.setMarkers()):this.hideMap()},hideMap:function(){document.getElementById(".map")&&e(".map").remove()},setMarkers:function(){var e,t;if(this.map)for(t=0;t<this.model.GoogleMapOptions.length;t++)e=new window.google.maps.LatLng(this.model.GoogleMapOptions[t].latitude,this.model.GoogleMapOptions[t].longtitude),this.bounds.extend(e),this.markers[t]=new window.google.maps.Marker({position:e,icon:"https://content.api.nyt.net/tools/restaurants/images/marker_restaurant_red_23x23.png",map:this.map,title:this.model.GoogleMapOptions[t].title,url:"/reviews/dining/map/"}),this.map.fitBounds(this.bounds)},handleRedrawMakers:function(e){this.model=e,this.setMap()},handleMapClicked:function(){var t,i,n,s,a,o,r;t=e("input[name=stream-search-input]").val(),i=e("#rating-filter option:selected").val(),n=e("#neighborhood-filter option:selected").val(),s=e("#price-filter option:selected").val(),a=e("#cuisine-filter option:selected").val(),o=e("#critics-pick-filter").is(":checked")?!0:!1,r="/reviews/dining/map/?searchFilter="+encodeURIComponent(t)+"&rating="+encodeURIComponent("Rating"==i?"":i)+"&neighborhood="+encodeURIComponent("Neighborhood"==n?"":n)+"&price="+encodeURIComponent("Price"==s?"":s)+"&cuisine="+encodeURIComponent("Cuisine"==a?"":a)+"&criticsPick="+encodeURIComponent(o),window.location.href=r}});return n}),define("collection/instances/dining-googlemap-service",["foundation/views/page-manager","collection/views/dining-googlemap-service"],function(e,t){"use strict";var i=e.getMeta("nyt-collection:identifier");"restaurant-guide"===i&&new t}),require(["collection/instances/ads","shared/page/instances/app","shared/messaging/instances/messaging","shared/account/instances/account","shared/navigation/instances/navigation","shared/following/instances/follow-button","shared/externallinkmodal/instances/external-link-modal","collection/instances/tabs","collection/instances/stream-controls-search","collection/instances/masthead","collection/instances/most-popular","collection/instances/latest","collection/instances/multimedia","collection/instances/timeline","collection/instances/rank","collection/instances/search","collection/instances/multimedia","collection/instances/timeline","collection/instances/stream-sort-modal","collection/instances/site-index","collection/instances/collection","collection/instances/tracking","collection/instances/insider-nav","collection/instances/sharetools","collection/instances/wsod","collection/instances/realestate-search","shared/https/instances/toggle-button","collection/instances/dining-googlemap-service"]);
//# sourceMappingURL=main.js.map